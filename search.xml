<search>
    
     <entry>
        <title>å¥‡æ€ªç°è±¡ï¼šä¸¤ä¸ªConsumeræ¶ˆè´¹åŒä¸€ä¸ªåˆ†åŒºï¼ˆPartitionï¼‰</title>
        <url>https://orchidflower.github.io/2022/05/27/Two-Kafka-Consumer-consume-one-partition/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Kafka</tag><tag>Redis</tag><tag>Rebalancing</tag>
        </tags>
        <content type="html"> æœ€è¿‘ç”Ÿäº§ä¸Šç¢°åˆ°ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œç°åœºäººå‘˜åé¦ˆKafkaå·¥ä½œä¸æ­£å¸¸ã€‚ç»è¿‡å¼€å‘äººå‘˜æ£€æŸ¥ï¼Œå‘ç°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼šçº¿ä¸Šä¸¤å°æœåŠ¡å™¨ç«Ÿç„¶åœ¨åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªKafka Topicä¸­çš„ä¸€ä¸ªåˆ†åŒºï¼ˆPartitionï¼‰ã€‚
1. èƒŒæ™¯ æˆ‘ä»¬çš„ç¨‹åºè¦å®ç°çš„åŠŸèƒ½æ˜¯è¿™æ ·çš„ï¼šç³»ç»Ÿä¼šå®šæ—¶æ‰«æåº“å­˜è¡¨ï¼Œæ ¹æ®åº“å­˜æƒ…å†µå†³å®šæ˜¯å¦è¦æ‰§è¡Œå‡ºåº“æ“ä½œã€‚ä¹‹å‰æ˜¯é‡‡ç”¨å®šæ—¶ä»»åŠ¡å¤„ç†ï¼Œæ‰§è¡Œç­–ç•¥æ˜¯1åˆ†é’Ÿä¸€æ¬¡ï¼Œä¸ºäº†é˜²æ­¢å¤šå°æœåŠ¡å™¨å¹¶å‘æ‰§è¡Œï¼Œä½¿ç”¨Quartzé›†ç¾¤æ¨¡å¼ç¡®ä¿å®šæ—¶ä»»åŠ¡åªåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚æœ€è¿‘å®¢æˆ·æå‡ºéœ€æ±‚ï¼ŒæŸäº›æ—¶å€™å®¢æˆ·å¸Œæœ›å“åº”æ›´åŠæ—¶ä¸€äº›ï¼Œè­¬å¦‚æŸé¡¹è¯·æ±‚åˆ°è¾¾çš„æ—¶å€™ï¼Œå°±è¦ç«‹å³æ£€æŸ¥åº“å­˜å¹¶å†³å®šæ˜¯å¦éœ€è¦å‡ºåº“ã€‚å› æ­¤ï¼Œå¼€å‘äººå‘˜å¯¹ç³»ç»Ÿè¿›è¡Œäº†è°ƒæ•´ï¼Œæ”¹ä¸ºä½¿ç”¨Kafka Consumeræ¥è§¦å‘æ‰«æåº“å­˜åŠ¨ä½œï¼›å®šæ—¶ä»»åŠ¡å’Œæ¥å£å¤„åŒæ—¶è´Ÿè´£å‘é€è§¦å‘åº“å­˜æ‰«æçš„æ¶ˆæ¯ã€‚
ç›¸å…³çš„ä»£ç å¦‚ä¸‹ï¼š
Consumerç”¨æ¥å¤„ç†æ‰«æåº“å­˜çš„åŠŸèƒ½ï¼š
1public class LibraryOutboundTriggerConsumer { 2 private final OutboundService outboundService; 3 private final BoxInfoService boxInfoService; 4 5 @KafkaListener(topics = &amp;#34;${fwm.core.topic.library-outbound-trigger}&amp;#34;) 6 public void consume(ConsumerRecord&amp;lt;String, String&amp;gt; record) { 7 log.info(&amp;#34;\n\n&amp;#34;); 8 log.info(&amp;#34;=====================å¼€å§‹æ‰§è¡Œå‡ºåº“æ‰«æ=====================&amp;#34;); 9 if (boxInfoService.hasBoxUpdateTask()) { 10 log.info(&amp;#34;=====================å­˜åœ¨æ–™ç®±æ›´æ–°ä»»åŠ¡ï¼Œæ‰§è¡Œå‡ºåº“æ‰«æç»“æŸ=====================&amp;#34;); 11 return; 12 } 13 Stopwatch stopwatch = Stopwatch.createStarted(); 14 try { 15 boxInfoService.startOutboundTask(90); 16 outboundService.outboundTaskScan(); 17 } finally { 18 boxInfoService.stopOutboundTask(); 19 } 20 21 log.info(&amp;#34;=====================æ‰§è¡Œå‡ºåº“æ‰«æç»“æŸ,æ€»è€—æ—¶{}ms=====================&amp;#34;, stopwatch.elapsed(TimeUnit.MILLISECONDS)); 22 } 23} å®šæ—¶ä»»åŠ¡ç›¸å…³ä»£ç ï¼Œç”¨æ¥å‘é€è§¦å‘æ‰«æçš„Kafkaæ¶ˆæ¯ï¼š
1public class LibraryScanJob extends QuartzJobBean { 2 private final KafkaTemplate&amp;lt;String, String&amp;gt; kafkaTemplate; 3 private final CoreProperties coreProperties; 4 5 @Override 6 protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException { 7 kafkaTemplate.send(coreProperties.getTopic().getLibraryOutboundTrigger(), &amp;#34;1&amp;#34;, &amp;#34;Job Trigger&amp;#34;); 8 } 9} æˆ‘ä»¬æœåŠ¡ç«¯éƒ¨ç½²çš„æƒ…å†µæ˜¯ï¼šåº”ç”¨éƒ¨ç½²åœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šserver01ï¼Œserver02ï¼›Kafkaéƒ¨ç½²åœ¨ä¸‰å°æœåŠ¡å™¨ä¸ŠKafka01ï¼ŒKafka02ï¼ŒKafka03ã€‚Consumerè´Ÿè´£æ¶ˆè´¹library-outbound-triggerè¿™ä¸ªTopicï¼Œè¿™ä¸ªTopicè™½ç„¶è¢«åˆ›å»ºä¸ºä¸‰ä¸ªåˆ†åŒºï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­åªç”¨äº†ä¸€ä¸ªåˆ†åŒºï¼Œè¿™æ˜¯å› ä¸ºåœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™æŒ‡å®šäº†Keyå€¼ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹Kafkaä¼šè°ƒç”¨Partitionerå¯¹å‘é€å†…å®¹è¿›è¡Œåˆ†åŒºï¼Œé»˜è®¤çš„åˆ†åŒºç®—æ³•ä¸ºDefaultPartitionerï¼Œç®€å•æ¥è¯´å…¶ç®—æ³•æ˜¯ï¼šå¦‚æœKeyæœ‰å€¼ï¼Œåˆ™æ ¹æ®keyè®¡ç®—ä¸€ä¸ªHashå€¼ï¼Œç„¶åé’ˆå¯¹åˆ†åŒºæ•°å–ä½™ï¼›å¦‚æœKeyä¸ºç©ºï¼Œåˆ™ä½¿ç”¨Round-Robinç­–ç•¥è¿›è¡Œåˆ†åŒºã€‚
DefaultPartitioner is a Partitioner that uses a 32-bit murmur2 hash to compute the partition for a record (with the key defined) or chooses a partition in a round-robin fashion (per the available partitions of the topic).
DefaultPartitioner is the default partitioning strategy (per ProducerConfig.PARTITIONER_CLASS_CONFIG configuration property).
å› ä¸ºä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬æŒ‡å®šäº†Keyå›ºå®šä¸º1ï¼Œæ‰€ä»¥å®ƒæ€»ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸­ï¼Œä¹Ÿå°±æ˜¯è™½ç„¶æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªåˆ†åŒºï¼Œå®é™…ä¸Šåº”è¯¥åªæœ‰ä¸€ä¸ªåˆ†åŒºæœ‰æ•°æ®ã€‚é€šè¿‡å·¥å…·è½¯ä»¶æŸ¥çœ‹Kafkaä¸­çš„æ•°æ®ä¹Ÿç¡®å®è¯æ˜äº†è¿™ä¸€ç‚¹ã€‚
å› ä¸ºå®é™…ä¸Šåªæœ‰ä¸€ä¸ªåˆ†åŒºæœ‰æ•°æ®ï¼Œæ‰€ä»¥Consumeråº”è¯¥åªåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šæ‰èƒ½å¤Ÿæ‰§è¡Œã€‚ä½†æ˜¯ç»è¿‡è§‚å¯Ÿæ—¥å¿—å‘ç°ï¼Œä¸¤å°æœåŠ¡å™¨ä¸Šéƒ½èƒ½å¤Ÿçœ‹åˆ°æ‰§è¡Œå‡ºåº“æ‰«æè¿™ç§æ—¥å¿—ã€‚
2.é—®é¢˜åˆ†æ Kafkaä¸­ä¸€ä¸ªPartitionåªèƒ½ç”±ä¸€ä¸ªConsumer Groupä¸­çš„ä¸€ä¸ªConsumeræ¶ˆè´¹ï¼Œè¿™æ˜¯ä¿è¯è´Ÿè½½å‡è¡¡çš„éœ€è¦ï¼Œä¹Ÿæ˜¯Kafkaå®ç°æ¶ˆæ¯ç›¸å¯¹æœ‰åºæ€§çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡ç†å¿µã€‚ç”¨è¿‡Kafkaçš„äººéƒ½åº”è¯¥è§è¿‡è¿™å¼ å›¾ï¼š è¿™å¼ å›¾æè¿°äº†ä¸¤ä¸ªConsumer GroupåŒæ—¶åœ¨æ¶ˆè´¹ä¸€ä¸ªTopicï¼Œä¸è®ºå“ªä¸ªConsumer Groupï¼Œå¯¹äºä¸€ä¸ªç‰¹å®šçš„Partitionæ¥è¯´ï¼Œæ€»æ˜¯åªæœ‰ä¸€ä¸ªConsumeråœ¨æ¶ˆè´¹å…¶ä¸­çš„æ¶ˆæ¯ã€‚å¯¹æˆ‘ä»¬çš„ç³»ç»Ÿæ¥è¯´ï¼Œåªæœ‰ä¸€ä¸ªåˆ†åŒºæœ‰æ•°æ®ï¼ŒæŒ‰ç†è¯´åº”è¯¥åªæœ‰ä¸€å°æœåŠ¡å™¨æ¶ˆè´¹æ‰æ­£ç¡®ã€‚
æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒå®‰è£…äº†Kafkaç®¡ç†å·¥å…·Kowlï¼Œç»è¿‡æŸ¥çœ‹Kafkaçš„è¿è¡ŒçŠ¶æ€ï¼Œå‘ç°è¯¥Topicç»å¸¸å‡ºç°æ²¡æœ‰Consumeræ¶ˆè´¹çš„æƒ…å†µï¼Œè€Œä¸”æ¶ˆè´¹è€…ä¹Ÿä¸å›ºå®šï¼›å¦å¤–ï¼Œè¯¥Topicå‡ºç°äº†éå¸¸å·¨å¤§çš„Lagï¼Œæ¶ˆè´¹Offsetå§‹ç»ˆæ²¡æœ‰æ›´æ–°ã€‚æ˜æ˜¾æ˜¯Kafkaè§¦å‘Rebalancingå¯¼è‡´çš„ã€‚ä½†æ˜¯å› ä¸ºæœåŠ¡ç«¯ç¦ç”¨äº†Rebalanceç›¸å…³çš„æ—¥å¿—ï¼Œæ‰€ä»¥ä»æ—¥å¿—ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è¯æ®ï¼Œåªèƒ½é€šè¿‡åˆ†æä»£ç æ¥ç¡®è®¤é—®é¢˜ã€‚
æ³¨æ„ä¸Šé¢Consumerä¸­çš„ä»£ç ï¼ŒStopwatchè®¡æ—¶çš„èŒƒå›´å¹¶ä¸åŒ…æ‹¬å¯¹hasBoxUpdateTaskçš„è°ƒç”¨ï¼Œè¯¥å‡½æ•°æ˜¯ç”¨äºé˜²å¹¶å‘è®¾ç½®çš„ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°æœ¬èº«å†™çš„æœ‰é—®é¢˜ï¼Œå¯¼è‡´æ‰§è¡Œæ—¶é—´è¿‡é•¿ã€‚è€Œæ—¥å¿—ä¸­çœ‹åˆ°çš„æ‰«ææ—¶é—´å¹¶æ²¡æœ‰åŒ…å«è¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„æ—¶é—´ï¼Œå› æ­¤æ²¡æœ‰çœ‹å‡ºå¼‚å¸¸æƒ…å†µã€‚hasBoxUpdateTaskçš„ä»£ç å¦‚ä¸‹ï¼š
1 @Override 2 public boolean hasBoxUpdateTask() { 3 List&amp;lt;String&amp;gt; keys = new ArrayList&amp;lt;&amp;gt;(); 4 redisTemplate.execute((RedisConnection connection) -&amp;gt; { 5 try (Cursor&amp;lt;byte[]&amp;gt; cursor = connection.scan( 6 ScanOptions.scanOptions().count(10).match(BOX_UPDATE_TASK_PREFIX &#43; &amp;#34;*&amp;#34;).build())) { 7 cursor.forEachRemaining(value -&amp;gt; { 8 keys.add(new String(value)); 9 }); 10 } catch (Exception e) { 11 log.error(&amp;#34;hasBoxUpdateTask&amp;#34;, e); 12 } 13 return keys; 14 }); 15 16 return keys.size() &amp;gt; 0; 17 } å¯ä»¥çœ‹åˆ°ä»£ç é‡Œé¢ä½¿ç”¨äº†Redisä¸­ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ç”¨çš„ScanæŒ‡ä»¤ã€‚è™½ç„¶Scanå‘½ä»¤æ¯”Keys *è¦å®‰å…¨ä¸€äº›ï¼Œä½†æ˜¯åŒæ ·æœ‰å¯èƒ½å¯¼è‡´å…¨åº“æ‰«æï¼šå½“å…¨åº“é”®å€¼å¾ˆå¤šï¼ŒåŒ¹é…æ•°é‡åˆå¾ˆå°‘çš„æ—¶å€™ï¼Œä¸€æ¬¡è°ƒç”¨å°±ä¼šè§¦å‘å…¨åº“æ‰«æï¼Œè€—æ—¶ä¼šå¾ˆé•¿ã€‚ç»è¿‡å®éªŒï¼Œæˆ‘ä»¬å…¨åº“19w&#43;ï¼Œä¸€æ¬¡ä¸åŒ¹é…çš„æ‰«æè€—æ—¶å¤§æ¦‚15~20ç§’ã€‚
åœ¨Springä¸­ï¼Œæˆ‘ä»¬å¯¹äºConsumeré…ç½®å¦‚ä¸‹ï¼š
1spring: 2 kafka: 3 consumer: 4 enable-auto-commit: true 5 auto-commit-interval: 1000ms æŒ‰ç…§ä¸Šé¢çš„é…ç½®ï¼ŒæœŸæœ›çš„è¡¨ç°æ˜¯æ¯ç§’é’Ÿæäº¤ä¸€æ¬¡Offsetï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°Offsetå§‹ç»ˆæ²¡æœ‰æ›´æ–°çš„æƒ…å†µå‘¢ï¼Ÿ
3. åŸå› è§£è¯» ä»¥å‰ä¸€ç›´çŸ¥é“Kafka Consumerå¦‚æœå¤„ç†æ—¶é—´è¿‡é•¿å°±å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚è¿™æ¬¡æ­£å¥½æŸ¥é˜…ä¸€ä¸‹æ–‡æ¡£æ¥æ˜ç¡®é—®é¢˜äº§ç”Ÿçš„åŸå› åŠé—®é¢˜çš„è¡¨ç°ã€‚
ç»è¿‡ç ”ç©¶ï¼Œå‘ç°ä¹‹å‰å¯¹äºè‡ªåŠ¨æäº¤è¿˜æœ‰äº›ç†è§£ä¸å‡†ç¡®çš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹O&#39;Reillyç»å…¸çš„Kafka: The Definitive Guideä¸­å…³äºè‡ªåŠ¨æäº¤çš„æè¿°ï¼ˆç¬¬4ç« ï¼‰ï¼š
Automatic Commit
The easiest way to commit offsets is to allow the consumer to do it for you. If you configure enable.auto.commit=true, then every five seconds the consumer will commit the largest offset your client received from poll(). The five-second interval is the default and is controlled by setting auto.commit.interval.ms. Just like everything else in the consumer, the automatic commits are driven by the poll loop. Whenever you poll, the consumer checks if it is time to commit, and if it is, it will commit the offsets it returned in the last poll.
Kafkaçš„è‡ªåŠ¨æäº¤æœºåˆ¶æ˜¯ä¾èµ–äºpollå¾ªç¯æœºåˆ¶çš„ï¼š
1while(true) { 2 // æ¯æ¬¡è°ƒç”¨pollçš„æ—¶å€™åˆ¤æ–­æ˜¯å¦éœ€è¦æäº¤offset 3 ConsumerRecords records = consumer.poll(Duration.ofMillis(10000)); 4 processRetrievedRecords(records); 5} ä¹Ÿå°±æ˜¯è¯´ï¼š Kafkaåªæœ‰åœ¨å‘ç”Ÿä¸€æ¬¡pollçš„æ—¶å€™æ‰ä¼šå°†ä¸Šæ¬¡å¤„ç†å®Œçš„Offsetæäº¤ä¸Šå»ã€‚ å¦‚æœæ¶ˆæ¯å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå‡ºç°Offsetæ²¡æœ‰æ¥å¾—åŠæäº¤çš„æƒ…å†µã€‚
è€Œä¸€æ¬¡æ¶ˆè´¹æ—¶é—´çš„é•¿çŸ­åˆä¸max.poll.recordsæœ‰å…³ï¼šKafkaä¸€æ¬¡pollå¯ä»¥æ‹‰å–æœ€å¤šmax.poll.recordsæ¡è®°å½•ï¼Œç„¶åç¼“å­˜åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚åªæœ‰æœ¬åœ°ç¼“å­˜çš„æ•°æ®å¤„ç†å®Œæ¯•ï¼Œæ‰ä¼šå†æ¬¡è¿›è¡Œpollã€‚è€Œè¿™ä¸ªå€¼é»˜è®¤ä¸º500ã€‚
max.poll.records
The maximum number of records returned in a single call to poll(). Note, that max.poll.records does not impact the underlying fetching behavior. The consumer will cache the records from each fetch request and returns them incrementally from each poll.
Type:	int Default:	500
è€Œåˆ¤æ–­å¤„ç†æ—¶é—´æ˜¯å¦è¶…æ—¶åˆ™ä¸max.poll.interval.msæœ‰å…³ï¼šmax.poll.interval.mså®šä¹‰äº†ä¸¤æ¬¡pollä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚
max.poll.interval.ms
The maximum delay between invocations of poll() when using consumer group management. This places an upper bound on the amount of time that the consumer can be idle before fetching more records. If poll() is not called before expiration of this timeout, then the consumer is considered failed and the group will rebalance in order to reassign the partitions to another member. For consumers using a non-null group.instance.id which reach this timeout, partitions will not be immediately reassigned. Instead, the consumer will stop sending heartbeats and partitions will be reassigned after expiration of session.timeout.ms. This mirrors the behavior of a static consumer which has shutdown.
Type:	int Default:	300000 (5 minutes)
å¯ä»¥çœ‹åˆ°ä¸¤æ¬¡pollä¹‹é—´çš„æœ€é•¿æ—¶é—´ä¸º5åˆ†é’Ÿï¼Œå¦‚æœè¶…è¿‡5åˆ†é’Ÿï¼Œåˆ™ä¼šè¢«åˆ¤å®šä¸ºConsumer LeaveGroupï¼Œç„¶åè§¦å‘Rebalancingã€‚
ç»¼åˆèµ·æ¥çœ‹ï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› åº”è¯¥æ˜¯è¿™æ ·ï¼š
Kafkaä¸€æ¬¡è·å–äº†å¤§é‡çš„è®°å½•ï¼Œä¾‹å¦‚500æ¡ï¼› æ¯æ¡è®°å½•æ¶ˆè´¹å¤§æ¦‚å ç”¨15~20ç§’ï¼› è®°å½•è¿˜æ²¡å¤„ç†å®Œï¼Œæ—¶é—´å°±è¶…è¿‡äº†5åˆ†é’Ÿï¼Œå¼•èµ·äº†Rebalancingï¼› Rebalancingä¹‹åï¼ŒConsumerç”±å¦ä¸€å°æœåŠ¡å™¨æ¥ç®¡ï¼Œè¿›å…¥ä¸Šé¢åŒæ ·çš„å¤„ç†ï¼›è€Œæ­¤æ—¶ç¬¬ä¸€å°æœåŠ¡å™¨ä¸Šçš„æ¶ˆæ¯è¿˜æ²¡æœ‰å¤„ç†å®Œæ¯•ï¼Œä¹Ÿåœ¨ç»§ç»­å¾ªç¯å¤„ç†ï¼› è¿™æ ·ä¸¤å°æœåŠ¡å™¨éƒ½åœ¨å¤„ç†æ•°æ®ï¼Œä½†æ˜¯Offsetå´æ°¸è¿œæ²¡æœ‰åŠæ³•æ›´æ–°ï¼›çœ‹ä¸Šå»å°±åƒæ˜¯ä¸¤ä¸ªConsumeråœ¨æ¶ˆè´¹åŒä¸€ä¸ªPartitionã€‚ 4. ä¿®æ”¹åŠæ€»ç»“ ä¿®æ”¹ä»£ç ï¼Œä¸å†ä½¿ç”¨Redisçš„ScanæŒ‡ä»¤ï¼Œæé«˜å¤„ç†é€Ÿåº¦ï¼Œé—®é¢˜å¾—ä»¥è§£å†³ã€‚
ä¸¤ç‚¹æ•™è®­ï¼š
åœ¨Redisç”Ÿäº§ç¯å¢ƒä¸­ä¸èƒ½å¤Ÿä½¿ç”¨ç±»ä¼¼Keysï¼ŒScanè¿™ç§æŒ‡ä»¤ï¼Œè¿™ç§æŒ‡ä»¤å¾ˆå®¹æ˜“å¯¼è‡´è¶…é•¿çš„å¤„ç†æ—¶é—´ï¼› Kafkaçš„è‡ªåŠ¨æäº¤æœºåˆ¶ä¾èµ–äºpollå¾ªç¯ï¼Œå¦‚æœä¸€æ¬¡æ¶ˆæ¯å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå‡ºé—®é¢˜ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯æé«˜å¤„ç†é€Ÿåº¦ï¼›å¦‚æœå®åœ¨ä¸è¡Œï¼Œå¯ä»¥é™ä½æ¯æ¬¡æ‹‰å–çš„è®°å½•æ•°ï¼Œä¿®æ”¹max.poll.recordså‚æ•°ã€‚åœ¨springbootä¸­å¯ä»¥é€šè¿‡spring.kafka.consumer.max-poll-recordså‚æ•°è¿›è¡Œä¿®æ”¹ã€‚ </content>
    </entry>
    
     <entry>
        <title>Flexå¸ƒå±€æ·»åŠ æ»šåŠ¨æ¡éœ€è¦æ³¨æ„çš„è§„åˆ™</title>
        <url>https://orchidflower.github.io/2022/03/02/Adding-Scrollbar-In-Flex-Layout/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Flex</tag><tag>å¼¹æ€§å¸ƒå±€</tag>
        </tags>
        <content type="html"> å¥½ä¹…ä¸å†™å‰ç«¯ä»£ç äº†ï¼Œæœ‰äº›ç”Ÿç–äº†ã€‚æœ€è¿‘ç”¨Electronå†™äº†ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼Œç¢°åˆ°äº†Flexå¸ƒå±€æ·»åŠ æ»šåŠ¨æ¡çš„é—®é¢˜ï¼Œè€—è´¹äº†ä¸å°‘æ—¶é—´ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹è¦ç‚¹ï¼š
æ ¹æ®æ»šåŠ¨æ¡çš„æ–¹å‘ï¼Œç¡®å®šå¥½çˆ¶å…ƒç´ çš„flex-flowæ–¹å‘ï¼š å¦‚æœè¦è®¾ç½®æ°´å¹³æ»šåŠ¨æ¡ï¼Œé‚£ä¹ˆçˆ¶å…ƒç´ çš„flex-flowè¦è®¾ç½®ä¸ºrowï¼›å¦‚æœè¦è®¾ç½®çºµå‘æ»šåŠ¨æ¡ï¼Œé‚£ä¹ˆçˆ¶å…ƒç´ çš„flex-flowè¦è®¾ç½®ä¸ºcolumnã€‚ å…ƒç´ æœ¬èº«flexè®¾ç½®ä¸º1ï¼› æ»šåŠ¨æ–¹å‘çš„å¤§å°ï¼ˆå®½åº¦æˆ–è€…é«˜åº¦ï¼‰è®¾ç½®ä¸º0ï¼Œéæ»šåŠ¨æ–¹å‘å¤§å°è®¾ç½®ä¸º100%æˆ–è€…ä¸€ä¸ªä½ å–œæ¬¢çš„å®½åº¦ï¼› å¦‚æœå…ƒç´ æœ¬èº«è¿˜æœ‰å­å…ƒç´ ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„å­å…ƒç´ çš„é«˜åº¦éœ€è¦è®¾ç½®ä¸º100%ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä¼šå¯¼è‡´å­å…ƒç´ æœ¬èº«çš„é«˜åº¦ä¸å—é™åˆ¶ï¼Œä»è€Œæ’‘çˆ†äº†å…ƒç´ æœ¬èº«ã€‚ ç‰¹åˆ«éœ€è¦æ³¨æ„çš„å°±æ˜¯ç¬¬4ç‚¹ï¼šå¸ƒå±€çš„æ—¶å€™ç»å¸¸ä½¿ç”¨åˆ°el-row/el-colï¼Œå…¶æœ€åç”Ÿæˆçš„htmlä»£ç å°±ä¼šå‡ºç°åµŒå¥—çš„divç»„åˆï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„çˆ¶å­ç»“æ„ã€‚è¿™æ—¶å°±è¦æ³¨æ„åœ¨el-colä¸Šè®¾ç½®ç›¸åº”çš„é«˜åº¦ä¸º100%ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ’‘çˆ†äº†çš„ç»“æœã€‚
ä¸‹é¢æ˜¯æœ€ç»ˆçš„ä»£ç ï¼Œç›¸å…³è¦ç‚¹æ·»åŠ äº†æ³¨é‡Šï¼š
1&amp;lt;div class=&amp;#34;app&amp;#34;&amp;gt; 2 &amp;lt;el-main class=&amp;#34;main&amp;#34;&amp;gt; 3 &amp;lt;div class=&amp;#34;title&amp;#34;&amp;gt;é‚®ä»¶é¢„è§ˆ&amp;lt;/div&amp;gt; 4 &amp;lt;el-row&amp;gt; 5 &amp;lt;el-col :span=&amp;#34;16&amp;#34;&amp;gt; 6 &amp;lt;div class=&amp;#34;mail-address&amp;#34;&amp;gt;æ”¶ä»¶äººï¼š{{ email }}&amp;lt;/div&amp;gt; 7 &amp;lt;/el-col&amp;gt; 8 &amp;lt;el-col :span=&amp;#34;8&amp;#34; style=&amp;#34;text-align: right; padding-right: 10px&amp;#34;&amp;gt; 9 &amp;lt;el-button type=&amp;#34;primary&amp;#34; @click=&amp;#34;sendMail&amp;#34; :disabled=&amp;#34;!sendEnabled&amp;#34;&amp;gt;å‘é€é‚®ä»¶&amp;lt;/el-button&amp;gt; 10 &amp;lt;/el-col&amp;gt; 11 &amp;lt;/el-row&amp;gt; 12 13 &amp;lt;div class=&amp;#34;mail-content&amp;#34;&amp;gt; 14 &amp;lt;div class=&amp;#34;box-card&amp;#34;&amp;gt; 15 &amp;lt;div v-html=&amp;#34;mailContent&amp;#34;&amp;gt;&amp;lt;/div&amp;gt; 16 &amp;lt;/div&amp;gt; 17 &amp;lt;/div&amp;gt; 18 19 &amp;lt;div class=&amp;#34;title&amp;#34; v-if=&amp;#34;logVisible&amp;#34;&amp;gt;æœåŠ¡æ—¥å¿—&amp;lt;/div&amp;gt; 20 &amp;lt;div class=&amp;#34;log-container&amp;#34; v-if=&amp;#34;logVisible&amp;#34;&amp;gt; 21 &amp;lt;div class=&amp;#34;box-card&amp;#34; ref=&amp;#34;logContainer&amp;#34;&amp;gt; 22 &amp;lt;pre&amp;gt;{{ serverLog }}&amp;lt;/pre&amp;gt; 23 &amp;lt;/div&amp;gt; 24 &amp;lt;/div&amp;gt; 25 &amp;lt;/el-main&amp;gt; 26&amp;lt;div&amp;gt; å¯¹åº”çš„cssä»£ç ï¼š
1.app { 2 display: flex; 3 flex-direction: column; 4 height: 100vh; 5} 6 7.main { 8 display:flex; /* flexå¸ƒå±€ */ 9 flex-direction: column; /* å‚ç›´æ’åˆ— */ 10} 11 12.title { 13 font-size: 16px; 14 font-weight: 400; 15 color: #1f2f3d; 16 line-height: 1; 17 position: relative; 18 padding: 10px 0 10px 20px; 19 box-sizing: border-box; 20 display: flex; 21 align-items: center; 22 background: #ffffff; 23} 24 25.box-card { 26 margin: 0 10px 10px; 27 height: 100%; /* å­å…ƒç´ çš„é«˜åº¦è®¾ç½®ä¸º100%ï¼Œé˜²æ­¢æ’‘çˆ†çˆ¶å…ƒç´  */ 28 overflow-y: scroll; 29 border: 1px solid #E0E0E0; 30 padding: 0 10px; 31 background: #f7f7f7; 32} 33 34.mail-address { 35 font-size: 14px; 36 padding: 10px 20px 10px 20px; 37 text-decoration:underline; 38} 39 40.mail-content { 41 flex: 3 0 auto; /* é‚®ä»¶æ˜¾ç¤ºåŒºä¸logåŒºæ¯”ä¾‹3ï¼š2 */ 42 font-size: 16px; 43 height: 0; /* heightè®¾ç½®æˆ0ï¼Œè®©flexå¸ƒå±€å¤„ç†å¤§å° */ 44 margin-bottom: 20px; 45} 46 47.log-container { 48 flex: 2 0 auto; /* é‚®ä»¶æ˜¾ç¤ºåŒºä¸logåŒºæ¯”ä¾‹3ï¼š2 */ 49 height: 0; /* heightè®¾ç½®æˆ0ï¼Œè®©flexå¸ƒå±€å¤„ç†å¤§å° */ 50 padding-bottom: 20px; /* é¿å…è¢«footerè¦†ç›– */ 51} 52 53.log-container pre { 54 font-size: 14px; 55} é™„å½•ã€å‚è€ƒèµ„æ–™ å¼¹æ€§ç›’å­Flex Boxæ»šåŠ¨æ¡åŸç†ï¼Œé¿å…è¢«æ’‘å¼€ï¼Œæ°¸ä¸å¤±æ•ˆ </content>
    </entry>
    
     <entry>
        <title>RSAè¯ä¹¦æ ¼å¼</title>
        <url>https://orchidflower.github.io/2021/11/26/RSA-certificate-format/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>è¯ä¹¦</tag><tag>RSA</tag>
        </tags>
        <content type="html"> 1. TL;DR # -----BEGIN CERTIFICATE----- å¼€å¤´çš„æ˜¯è¯ä¹¦ã€‚ # -----BEGIN RSA PRIVATE KEY----- å¼€å¤´æ˜¯éµå¾ªçš„PKCS#1è§„èŒƒï¼Œå…¶å†…å®¹åªæ˜¯ä¸€ä¸ªRSAç§é’¥ã€‚å®ƒæœ¬è´¨ä¸Šåªæ˜¯æ¥è‡ªPKCS#8çš„å…³é”®å¯¹è±¡ï¼Œä½†å‰é¢æ²¡æœ‰ç‰ˆæœ¬æˆ–ç®—æ³•æ ‡è¯†ç¬¦ã€‚ # -----BEGIN PRIVATE KEY----- å¼€å¤´éµå¾ªçš„æ˜¯PKCS#8è§„èŒƒï¼Œå¹¶æŒ‡ç¤ºå¯†é’¥ç±»å‹åŒ…å«åœ¨å¯†é’¥æ•°æ®æœ¬èº«ä¸­ã€‚ 2. æ›´è¯¦ç»† ä¸‹é¢å†…å®¹æ‘˜è‡ªå‚è€ƒèµ„æ–™ï¼Œä¾›æœ‰éœ€è¦çš„äººå‚è€ƒã€‚
2.1 RSA Public Key File (PKCS#1) The RSA Public key PEM file is specific for RSA keys.
It starts and ends with the tags:
1-----BEGIN RSA PUBLIC KEY----- 2BASE64 ENCODED DATA 3-----END RSA PUBLIC KEY----- Within the base64 encoded data the following DER structure is present:
1RSAPublicKey ::= SEQUENCE { 2 modulus INTEGER, -- n 3 publicExponent INTEGER -- e 4} 2.2 RSA Private Key File (PKCS#1) The RSA private key PEM file is specific for RSA keys.
It starts and ends with the tags:
1-----BEGIN RSA PRIVATE KEY----- 2BASE64 ENCODED DATA 3-----END RSA PRIVATE KEY----- Within the base64 encoded data the following DER structure is present:
1RSAPrivateKey ::= SEQUENCE { 2 version Version, 3 modulus INTEGER, -- n 4 publicExponent INTEGER, -- e 5 privateExponent INTEGER, -- d 6 prime1 INTEGER, -- p 7 prime2 INTEGER, -- q 8 exponent1 INTEGER, -- d mod (p-1) 9 exponent2 INTEGER, -- d mod (q-1) 10 coefficient INTEGER, -- (inverse of q) mod p 11 otherPrimeInfos OtherPrimeInfos OPTIONAL 12} 2.3 Public Key File (PKCS#8) Because RSA is not used exclusively inside X509 and SSL/TLS, a more generic key format is available in the form of PKCS#8, that identifies the type of public key and contains the relevant data.
It starts and ends with the tags:
1-----BEGIN PUBLIC KEY----- 2BASE64 ENCODED DATA 3-----END PUBLIC KEY----- Within the base64 encoded data the following DER structure is present:
1PublicKeyInfo ::= SEQUENCE { 2 algorithm AlgorithmIdentifier, 3 PublicKey BIT STRING 4} 5 6AlgorithmIdentifier ::= SEQUENCE { 7 algorithm OBJECT IDENTIFIER, 8 parameters ANY DEFINED BY algorithm OPTIONAL 9} So for an RSA public key, the OID is 1.2.840.113549.1.1.1 and there is a RSAPublicKey as the PublicKey key data bitstring.
2.4 Private Key File (PKCS#8) Because RSA is not used exclusively inside X509 and SSL/TLS, a more generic key format is available in the form of PKCS#8, that identifies the type of private key and contains the relevant data.
The unencrypted PKCS#8 encoded data starts and ends with the tags:
1-----BEGIN PRIVATE KEY----- 2BASE64 ENCODED DATA 3-----END PRIVATE KEY----- Within the base64 encoded data the following DER structure is present:
1PrivateKeyInfo ::= SEQUENCE { 2 version Version, 3 algorithm AlgorithmIdentifier, 4 PrivateKey OCTET STRING 5} 6 7AlgorithmIdentifier ::= SEQUENCE { 8 algorithm OBJECT IDENTIFIER, 9 parameters ANY DEFINED BY algorithm OPTIONAL 10} So for an RSA private key, the OID is 1.2.840.113549.1.1.1 and there is a RSAPrivateKey as the PrivateKey key data octet string.
The encrypted PKCS#8 encoded data start and ends with the tags:
1-----BEGIN ENCRYPTED PRIVATE KEY----- 2BASE64 ENCODED DATA 3-----END ENCRYPTED PRIVATE KEY----- Within the base64 encoded data the following DER structure is present:
1EncryptedPrivateKeyInfo ::= SEQUENCE { 2 encryptionAlgorithm EncryptionAlgorithmIdentifier, 3 encryptedData EncryptedData 4} 5 6EncryptionAlgorithmIdentifier ::= AlgorithmIdentifier 7 8EncryptedData ::= OCTET STRING 9The EncryptedData OCTET STRING is a PKCS#8 PrivateKeyInfo (see above). é™„å½•ã€å‚è€ƒèµ„æ–™ openssl â€“ â€œBEGIN RSA PRIVATE KEYâ€å’Œâ€œBEGIN PRIVATE KEYâ€ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ASN.1 key structures in DER and PEM </content>
    </entry>
    
     <entry>
        <title>Jenkinså·¥ä½œç©ºé—´é¡µé¢å´©æºƒé—®é¢˜è§£å†³</title>
        <url>https://orchidflower.github.io/2021/10/22/Jenkins-crashed-in-workspace-page/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Jenkins</tag>
        </tags>
        <content type="html"> 1. é—®é¢˜ æœ€è¿‘å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ Jenkins ä¸­æ‰“å¼€æŸäº›é¡¹ç›®çš„å·¥ä½œç©ºé—´ï¼ˆWorkSpaceï¼‰çš„æ—¶å€™ï¼Œé¡µé¢ä¼šå´©æºƒï¼Œæ˜¾ç¤ºå¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š æŸ¥çœ‹ Jenkins æ—¥å¿—å‘ç°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œæç¤ºçš„æ˜¯è·¯å¾„æ— æ•ˆé”™è¯¯ï¼ˆInvalidPathExceptionï¼‰ï¼Œè¯¥ç›®å½•åº”è¯¥æ˜¯ä¸­æ–‡åå­—ï¼ŒçŒœæµ‹æ˜¯ç¼–ç è½¬æ¢å‡ºäº†é”™è¯¯ã€‚ 2. è§£å†³ ç”±äºæ˜¯ä½¿ç”¨ Docker è¿è¡Œçš„ Jenkinsï¼Œç™»å½•è¿› Jenkins å®¹å™¨å†…éƒ¨ï¼ŒæŸ¥çœ‹å¯¹åº”çš„ç›®å½•ï¼š å‘ç°åœ¨å®¹å™¨å†…éƒ¨çœ‹åˆ°çš„ç›®å½•å°±æ˜¯ä¹±ç äº†ã€‚è€Œåœ¨å¤–éƒ¨ç¯å¢ƒå¯ä»¥æ­£å¸¸æ˜¾ç¤ºç›®å½•ï¼š
æ‰€ä»¥çŒœæµ‹åº”è¯¥æ˜¯ Docker å®¹å™¨åŠ è½½ç›®å½•è¿‡ç¨‹ä¸­ç¼–ç é”™è¯¯ï¼Œå¯¼è‡´è½¬æ¢å‡ºé”™ã€‚ç»è¿‡æŸ¥æ‰¾ï¼Œä¿®æ”¹å¦‚ä¸‹å³å¯ï¼š
1services: 2 jenkins: 3 image: jenkins/jenkins:2.303.1 4 environment: 5 # æ³¨æ„ï¼Œæ­¤å¤„ä¸èƒ½ç”¨en_US.UTF-8ï¼Œå› ä¸ºè¯¥å®¹å™¨ä¸­æ²¡æœ‰è¯¥localeï¼Œåªèƒ½ç”¨C.UTF-8 6 - LANG=C.UTF-8 éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨en_US.UTF-8ã€‚è®¾ç½®æˆè¿™ä¸ªæ²¡æœ‰è§£å†³é—®é¢˜ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚
3. å¤‡æ³¨ å¦å¤–ï¼Œç½‘ä¸Šè¿˜æœ‰è¯´æ³•è¦æ·»åŠ  JAVA_OPTS=&amp;quot;-Dsun.jnu.encoding=UTF-8 -Dfile.encoding=UTF-8&amp;quot;ï¼Œä½†æ˜¯ç»è¿‡å®éªŒå‘ç°æ²¡æœ‰ç”¨å¤„ã€‚æˆ‘è¿™ä¸ªé—®é¢˜åŸå› åœ¨äº Docker å†…éƒ¨æ–‡ä»¶ç³»ç»Ÿå°±ç¼–ç ä¸æ­£ç¡®ï¼ŒJava å±‚é¢çš„ä¿®æ”¹ä¸èƒ½å¤Ÿè§£å†³é—®é¢˜ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ è§£å†³dockerå®¹å™¨ä¸­æ–‡ä¹±ç ï¼Œä¿®æ”¹dockerå®¹å™¨ç¼–ç æ ¼å¼ ã€ç»éªŒè¯æ— æ•ˆã€‘jenkinsä¹±ç é—®é¢˜ </content>
    </entry>
    
     <entry>
        <title>Vueè¿›è¡Œæ¡ä»¶ç¼–è¯‘å‘å¸ƒ</title>
        <url>https://orchidflower.github.io/2021/09/24/Vue-compile-on-condition/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Vue</tag><tag>è„šæ‰‹æ¶</tag>
        </tags>
        <content type="html"> æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼šå…¬å¸æ–°ç”³è¯·äº†ä¸€ä¸ªå…¬ä¼—å·ï¼Œè¿™ä¸ªæ–°å…¬ä¼—å·çš„åŠŸèƒ½ä¸ä¹‹å‰ä¸€ä¸ªå…¬ä¼—å·åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯ä¸¤ä¸ªå…¬ä¼—å·çš„ç”¨æˆ·åè®®æœ‰äº›åŒºåˆ«ï¼Œæ‰€ä»¥å°±ä¼šå…¬ç”¨ä¸€ä»½ä»£ç ã€‚ç°åœ¨éœ€è¦è§£å†³å‘å¸ƒçš„é—®é¢˜ï¼Œéœ€è¦ç¡®ä¿å‘å¸ƒåˆ°ä¸¤ä¸ªä¸åŒå…¬ä¼—å·çš„é¡µé¢æ˜¯æ­£ç¡®çš„ï¼Œä¸åŒå…¬ä¼—å·çš„ç”¨æˆ·çœ‹åˆ°æ­£ç¡®çš„ç”¨æˆ·åè®®ã€‚
ç»è¿‡ä¸Šç½‘æŸ¥æ‰¾æ–¹æ¡ˆï¼Œå‘ç° Vue è„šæ‰‹æ¶ä¸­æä¾›çš„ vue-cli-service å†…ç½®äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ï¼Œè¿™é‡Œç®€å•è¯´ä¸€ä¸‹å…¶æ¶‰åŠåˆ°çš„æ”¹åŠ¨è¦ç‚¹ï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒvue-cliçš„æ–‡æ¡£æ¨¡å¼å’Œç¯å¢ƒå˜é‡ã€‚
1. å®˜æ–¹æ–¹æ¡ˆè§£è¯» 1.1 æ¨¡å¼ æ¨¡å¼ï¼ˆmodeï¼‰æ˜¯ Vue è„šæ‰‹æ¶é¡¹ç›®çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè„šæ‰‹æ¶é¡¹ç›®ä¼šæœ‰ä¸‰ä¸ªæ¨¡å¼ï¼š
development æ¨¡å¼ç”¨äº vue-cli-service serve test æ¨¡å¼ç”¨äº vue-cli-service test:unit production æ¨¡å¼ç”¨äº vue-cli-service build å’Œ vue-cli-service test:e2e æˆ‘ä»¬é€šå¸¸ç”¨çš„å¼€å‘å‘½ä»¤ yarn serveï¼Œyarn build éƒ½æ˜¯ç”± package.json å°è£…çš„ Vue è„šæ‰‹æ¶å‘½ä»¤çš„ç®€åŒ–ç‰ˆï¼š
1{ 2 &amp;#34;name&amp;#34;: &amp;#34;mp-web&amp;#34;, 3 &amp;#34;version&amp;#34;: &amp;#34;0.1.0&amp;#34;, 4 &amp;#34;private&amp;#34;: true, 5 &amp;#34;scripts&amp;#34;: { 6 &amp;#34;serve&amp;#34;: &amp;#34;vue-cli-service serve&amp;#34;, 7 &amp;#34;build&amp;#34;: &amp;#34;vue-cli-service build&amp;#34;, 8 &amp;#34;lint&amp;#34;: &amp;#34;vue-cli-service lint&amp;#34; 9 }, 10} å¯ä»¥çœ‹åˆ°ï¼Œyarn serve å¯¹åº”çš„å°±æ˜¯ development æ¨¡å¼ï¼›yarn build å¯¹åº”çš„æ˜¯ production æ¨¡å¼ã€‚
1.2 ç¯å¢ƒå˜é‡ NodeJS åº”ç”¨ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç¯å¢ƒå˜é‡ NODE_ENVã€‚Vueè„šæ‰‹æ¶ä¸­ä¹Ÿä½¿ç”¨äº†è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚NODE_ENV å†³å®šåº”ç”¨è¿è¡Œçš„æ¨¡å¼ï¼Œæ˜¯å¼€å‘ï¼Œç”Ÿäº§è¿˜æ˜¯æµ‹è¯•ï¼Œå› æ­¤ä¹Ÿå†³å®šäº†åˆ›å»ºå“ªç§ webpack é…ç½®ã€‚æ–‡æ¡£ä¸­è¯´æ˜å¦‚ä¸‹ï¼š
ä¾‹å¦‚é€šè¿‡å°† NODE_ENV è®¾ç½®ä¸º &amp;ldquo;test&amp;rdquo;ï¼ŒVue CLI ä¼šåˆ›å»ºä¸€ä¸ªä¼˜åŒ–è¿‡åçš„ï¼Œå¹¶ä¸”æ—¨åœ¨ç”¨äºå•å…ƒæµ‹è¯•çš„ webpack é…ç½®ï¼Œå®ƒå¹¶ä¸ä¼šå¤„ç†å›¾ç‰‡ä»¥åŠä¸€äº›å¯¹å•å…ƒæµ‹è¯•éå¿…éœ€çš„å…¶ä»–èµ„æºã€‚
åŒç†ï¼ŒNODE_ENV=development åˆ›å»ºä¸€ä¸ª webpack é…ç½®ï¼Œè¯¥é…ç½®å¯ç”¨çƒ­æ›´æ–°ï¼Œä¸ä¼šå¯¹èµ„æºè¿›è¡Œ hash ä¹Ÿä¸ä¼šæ‰“å‡º vendor bundlesï¼Œç›®çš„æ˜¯ä¸ºäº†åœ¨å¼€å‘çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿé‡æ–°æ„å»ºã€‚
å½“ä½ è¿è¡Œ vue-cli-service build å‘½ä»¤æ—¶ï¼Œæ— è®ºä½ è¦éƒ¨ç½²åˆ°å“ªä¸ªç¯å¢ƒï¼Œåº”è¯¥å§‹ç»ˆæŠŠ NODE_ENV è®¾ç½®ä¸º &amp;ldquo;production&amp;rdquo; æ¥è·å–å¯ç”¨äºéƒ¨ç½²çš„åº”ç”¨ç¨‹åºã€‚
é™¤äº† NODE_ENV å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šå…¶ä»–ç¯å¢ƒå˜é‡ã€‚åœ¨æ–‡æ¡£ä¸­æåˆ°å¯ä»¥åœ¨ .env æˆ– .env.[mode]æ–‡ä»¶ä¸­æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œèµ·å§‹è¿˜å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ export æ–¹å¼è®¾ç½®ç¯å¢ƒå˜é‡ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„æœ¬åœ°ç¯å¢ƒå˜é‡éƒ½å¯ä»¥åœ¨ä»£ç ä¸­èƒ½å¤Ÿè§åˆ°ã€‚æŒ‰ç…§æ–‡æ¡£çš„è¯´æ˜ï¼Œåªæœ‰å¦‚ä¸‹å‡ ä¸ªå¯ä»¥ï¼š
NODE_ENVï¼› BASE_URLï¼› VUE_APP_å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼› å…¶ä»–çš„ç¯å¢ƒå˜é‡ï¼Œä¼šè¢«è„šæ‰‹æ¶è¿‡æ»¤æ‰ï¼Œä»¥é˜²æ­¢å…³é”®ä¿¡æ¯æ³„éœ²ã€‚ 2. æ”¹é€ é¡¹ç›® æ ¹æ®å®˜æ–¹æä¾›çš„åŠŸèƒ½ï¼Œå¯¹é¡¹ç›®è¿›è¡Œäº†è°ƒæ•´ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹è°ƒæ•´çš„ä¸»è¦å†…å®¹ï¼Œä»¥æ­¤è®°å½•ä¸€ä¸‹ã€‚
2.1 ç”¨æˆ·åè®® ä¸¤ä»½ç”¨æˆ·åè®®åˆ†åˆ«å®šä¹‰æˆäº†ä¸¤ä¸ªç»„ä»¶ï¼Œç„¶ååœ¨ä½¿ç”¨çš„é¡µé¢æ ¹æ®æƒ…å†µé€‰æ‹©æ˜¾ç¤ºã€‚ä»£ç å®ä¾‹å¦‚ä¸‹ï¼š
1&amp;lt;template&amp;gt; 2 &amp;lt;div&amp;gt; 3 &amp;lt;div class=&amp;#34;content&amp;#34;&amp;gt; 4 &amp;lt;!-- &amp;lt;div class=&amp;#34;title&amp;#34;&amp;gt;åè®®å†…å®¹&amp;lt;/div&amp;gt; --&amp;gt; 5 &amp;lt;div class=&amp;#34;agreementCont&amp;#34; v-if=&amp;#34;site === &amp;#39;palytech&amp;#39;&amp;#34;&amp;gt; 6 &amp;lt;v-nycont&amp;gt;&amp;lt;/v-nycont&amp;gt; 7 &amp;lt;/div&amp;gt; 8 &amp;lt;div class=&amp;#34;agreementCont&amp;#34; v-else&amp;gt; 9 &amp;lt;v-cont&amp;gt;&amp;lt;/v-cont&amp;gt; 10 &amp;lt;/div&amp;gt; 11 &amp;lt;/div&amp;gt; 12&amp;lt;/template&amp;gt; 13&amp;lt;script lang=&amp;#34;ts&amp;#34;&amp;gt; 14import agreementCont from &amp;#39;@/components/agreementCont/content.vue&amp;#39;; 15import nyContent from &amp;#39;@/components/agreementCont/nyContent.vue&amp;#39;; 16@Component({ 17 components: { 18 &amp;#39;v-cont&amp;#39;: agreementCont, 19 &amp;#39;v-nycont&amp;#39;: nyContent 20 } 21}) 22export default class infoPerfection extends Vue { 23 site: string | null = &amp;#39;&amp;#39;; 24 async mounted() { 25 this.site = localStorage.getItem(&amp;#39;site&amp;#39;); 26 } 27... é¡µé¢ä¸­ä½¿ç”¨siteè¿™ä¸ªå˜é‡æ¥å†³å®šæ˜¾ç¤ºå“ªä¸€ä¸ªç”¨æˆ·åè®®ã€‚è€Œè¿™ä¸ªsiteå‚æ•°æ˜¯ä»localStorageä¸­è·å–åˆ°çš„ã€‚ä¸‹é¢ä¼šè¯´åˆ°è¿™ä¸ªsiteå‚æ•°æ˜¯å¦‚ä½•å†™åˆ°localStorageä¸­çš„ã€‚
2.2 main.ts åœ¨ Vue ä»£ç å…¥å£çš„main.tsä¸­ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼Œè¿™æ®µä»£ç ä¼šå°†siteå‚æ•°å†™å…¥localStorageã€‚æ³¨æ„è¿™é‡Œç”¨åˆ°äº†VUE_APP_SITEè¿™ä¸ªç¯å¢ƒå˜é‡ã€‚
1import Vue from &amp;#39;vue&amp;#39;; 2import App from &amp;#39;./App.vue&amp;#39;; 3 4if (process.env.VUE_APP_SITE === &amp;#39;zhongbl&amp;#39;) { 5 console.log(&amp;#39;ç”Ÿäº§ç¯å¢ƒ zhongbl&amp;#39;); 6 localStorage.setItem(&amp;#39;site&amp;#39;, &amp;#39;zhongbl&amp;#39;); 7} else if (process.env.VUE_APP_SITE === &amp;#39;palytech&amp;#39;) { 8 console.log(&amp;#39;ç”Ÿäº§ç¯å¢ƒ palytech&amp;#39;); 9 localStorage.setItem(&amp;#39;site&amp;#39;, &amp;#39;palytech&amp;#39;); 10} else { 11 console.log(&amp;#39;å¼€å‘ç¯å¢ƒ eveus&amp;#39;); 12 localStorage.setItem(&amp;#39;site&amp;#39;, &amp;#39;eveus&amp;#39;); 13} 2.3 ç¯å¢ƒå˜é‡è®¾ç½® è€ƒè™‘åˆ°æˆ‘ä»¬çš„å‘å¸ƒè„šæœ¬ä¸­ç¡¬ç¼–ç äº†yarn buildï¼Œæ‰€ä»¥ç¯å¢ƒå˜é‡VUE_APP_SITEæˆ‘æ˜¯é‡‡ç”¨exportæ–¹å¼è®¾ç½®çš„ã€‚ä¾‹å¦‚ç¼–è¯‘çš„æ—¶å€™ç”¨ï¼š
1export VUE_APP_SITE=zhongbl 2# è°ƒç”¨åŸå…ˆçš„å‘å¸ƒè„šæœ¬ 3bash /opt/release/build-deploy-vue.sh -p $Project -s $Service éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¿…é¡»ä½¿ç”¨exportå°†ç¯å¢ƒå˜é‡è®¾ç½®å‡ºå»ï¼Œè¦ä¸ç„¶åœ¨å¦ä¸€ä¸ªshellè„šæœ¬ä¸­ä¼šçœ‹ä¸åˆ°è¿™ä¸ªå˜é‡ã€‚ å¦å¤–ï¼Œè¿˜å¯ä»¥åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“ä¸åœ¨å‘½ä»¤è¡Œä¸­exportçš„æ—¶å€™ï¼Œå°±ä¼šç”¨åˆ°.envæ–‡ä»¶ä¸­è®¾ç½®çš„å€¼ã€‚
3. å…¶ä»–çš„ä¸€äº›å¤‡å¿˜ 3.1 ç¼–è¯‘ç»“æœ 2.2ä¸­çš„é‚£æ®µä»£ç ç»è¿‡ç¼–è¯‘åï¼Œä¼šæ ¹æ®ç¯å¢ƒå˜é‡çš„æƒ…å†µè¿›è¡Œä¼˜åŒ–ï¼Œå»æ‰ä¸éœ€è¦çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå½“VUE_APP_SITEè®¾ç½®æˆpalytechçš„æ—¶å€™ï¼Œæœ€åç”Ÿæˆçš„ä»£ç ç­‰æ•ˆäºï¼š
1 console.log(&amp;#39;ç”Ÿäº§ç¯å¢ƒ palytech&amp;#39;); 2 localStorage.setItem(&amp;#39;site&amp;#39;, &amp;#39;palytech&amp;#39;); å…¶ä»–ä¸¤ä¸ªæ¡ä»¶ä¸­çš„å†…å®¹æ ¹æœ¬ä¸ä¼šåœ¨ç¼–è¯‘ç»“æœä¸­å­˜åœ¨ï¼è¿™ç‚¹æŒºæœ‰æ„æ€çš„ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ æ¨¡å¼å’Œç¯å¢ƒå˜é‡ </content>
    </entry>
    
     <entry>
        <title>MySQLå¦‚ä½•ä¿å­˜emojiå­—ç¬¦</title>
        <url>https://orchidflower.github.io/2021/07/22/How-Could-MySQL-Save-emoji/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Java</tag><tag>MyBatis</tag><tag>MySQL</tag>
        </tags>
        <content type="html"> 1. é—®é¢˜ 1.1 å‘ç°é—®é¢˜ æœ€è¿‘ç”Ÿäº§ç¯å¢ƒæ—¥å¿—ä¸­æŠ¥äº†ä¸€ä¸ªå¼‚å¸¸ï¼š
12021-07-11 20:54:41.632 ERROR 26289 --- [XNIO-1 task-11] c.e.t.s.t.mp.WxMpMessageRouterService : 2### Error updating database. Cause: java.sql.SQLException: Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1 3### The error may exist in com/eveus/tap/account/mapper/AccountMapper.java (best guess) 4### The error may involve com.eveus.tap.account.mapper.AccountMapper.insert-Inline 5### The error occurred while setting parameters 6### SQL: INSERT INTO tap_account ( open_id, avatar, nick_name, country, province, city, gender, secret, status, IS_DISABLED, is_subscribe, create_time, update_time ) VALUES 7 ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? ) 8### Cause: java.sql.SQLException: Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1 9; uncategorized SQLException; SQL state [HY000]; error code [1366]; Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1; nested exception is java.sql.SQLException: 10 Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1 11 12org.springframework.jdbc.UncategorizedSQLException: 13### Error updating database. Cause: java.sql.SQLException: Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1 14### The error may exist in com/eveus/tap/account/mapper/AccountMapper.java (best guess) 15### The error may involve com.eveus.tap.account.mapper.AccountMapper.insert-Inline 16### The error occurred while setting parameters 17### SQL: INSERT INTO tap_account ( open_id, avatar, nick_name, country, province, city, gender, secret, status, IS_DISABLED, is_subscribe, create_time, update_time ) VALUES 18 ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? ) 19### Cause: java.sql.SQLException: Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1 20; uncategorized SQLException; SQL state [HY000]; error code [1366]; Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1; nested exception is java.sql.SQLException: 21 Incorrect string value: &amp;#39;\xF0\x9F\xA6\x84&amp;#39; for column &amp;#39;NICK_NAME&amp;#39; at row 1 22 at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89) 23 at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81) 24 at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81) 25 at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:88) 26 at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:440) 27 at com.sun.proxy.$Proxy134.insert(Unknown Source) 28 at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:271) 29 at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:60) 30 at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:96) 31 at com.sun.proxy.$Proxy186.insert(Unknown Source) 32 at com.baomidou.mybatisplus.extension.service.IService.save(IService.java:59) 33 at com.eveus.tap.account.service.impl.AccountServiceImpl.addAccount(AccountServiceImpl.java:151) 34 at com.eveus.tap.account.service.impl.AccountServiceImpl.ensureLoad(AccountServiceImpl.java:226) 35 at com.eveus.tap.account.service.impl.AccountServiceImpl$$FastClassBySpringCGLIB$$34fe95c8.invoke(&amp;lt;generated&amp;gt;) 36 at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218) 37 at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:769) 38 at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) 39 at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:747) 40 at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:95) 41 at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) 42 at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:747) 43 at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:689) 44 at com.eveus.tap.account.service.impl.AccountServiceImpl$$EnhancerBySpringCGLIB$$cbb1e26b.ensureLoad(&amp;lt;generated&amp;gt;) 45 at com.eveus.tap.server.taxer.mp.handler.SubscribeHandler.handle(SubscribeHandler.java:54) 46 at me.chanjar.weixin.mp.api.WxMpMessageRouterRule.service(WxMpMessageRouterRule.java:226) 47 at me.chanjar.weixin.mp.api.WxMpMessageRouter.route(WxMpMessageRouter.java:203) 48 at me.chanjar.weixin.mp.api.WxMpMessageRouter.route(WxMpMessageRouter.java:154) 49 at me.chanjar.weixin.mp.api.WxMpMessageRouter.route(WxMpMessageRouter.java:233) çœ‹é”™è¯¯ä¿¡æ¯æ˜¯å› ä¸º MySQL å­—ç¬¦ç¼–ç ä¸æ­£ç¡®å¯¼è‡´æ— æ³•ä¿å­˜ç‰¹æ®Šå­—ç¬¦å¯¼è‡´çš„ã€‚æŠŠå­—ç¬¦è¿˜åŸä¸€ä¸‹ï¼Œå‘ç° \xF0\x9F\xA6\x84 ä»£è¡¨çš„å­—ç¬¦å†…å®¹æ˜¯ï¼šğŸ¦„ï¼Œæ˜¯ä¸€ä¸ª Emoji å­—ç¬¦ã€‚
å½“ä½¿ç”¨å¯¹ utf8 ç¼–ç çš„æ—¶å€™ï¼Œå’Œä¸€èˆ¬æ±‰å­—å ç”¨3ä¸ªå­—èŠ‚ä¸åŒï¼ŒEmoji å­—ç¬¦çš„ç¼–ç ä¼šæ¯”è¾ƒç‰¹æ®Šä¸€ç‚¹ï¼Œå ç”¨4ä¸ªå­—èŠ‚ã€‚è€Œç”±äºå†å²çš„åŸå› ï¼ŒMySQL ä½¿ç”¨çš„ utf8 ç¼–ç æœ€é•¿æ”¯æŒ3ä¸ªå­—èŠ‚ï¼Œå¦‚æœè¦ä¿å­˜4ä¸ªå­—èŠ‚çš„ unicodeï¼Œåˆ™éœ€è¦ä½¿ç”¨ utf8mb4 ç¼–ç ã€‚ä¸Šè¿°é”™è¯¯åº”è¯¥æ˜¯å› æ­¤è€Œå‡ºã€‚
1.2 å¯»æ‰¾åŸå›  è®©æˆ‘å¥‡æ€ªçš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥ä¸ä¼šå‡ºç°æ‰å¯¹å•Šï¼Œå› ä¸ºè¿™ä¸ªè¡¨éœ€è¦å­˜å‚¨ä»å¾®ä¿¡è·å–çš„ç”¨æˆ·æ˜µç§°ï¼Œå½“æ—¶å·²ç»è€ƒè™‘äº†å¯èƒ½å­˜åœ¨ Emoji å­—ç¬¦ï¼Œå› æ­¤è¯¥è¡¨çš„ç¼–ç å·²ç»è¢«ä¿®æ”¹æˆäº† utf8mb4 ã€‚æŸ¥çœ‹ä¸€ä¸‹è¡¨ç»“æ„ï¼Œç°æœ‰çš„è¡¨ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š
1CREATE TABLE `tap_account` ( 2 `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &amp;#39;ä¸»é”®&amp;#39;, 3 `AVATAR` varchar(256) DEFAULT NULL COMMENT &amp;#39;å¤´åƒ,å¾®ä¿¡æˆæƒ,ç”¨æˆ·å¤´åƒï¼Œæœ€åä¸€ä¸ªæ•°å€¼ä»£è¡¨æ­£æ–¹å½¢å¤´åƒå¤§å°ï¼ˆæœ‰0ã€46ã€64ã€96ã€132æ•°å€¼å¯é€‰ï¼Œ0ä»£è¡¨640*640æ­£æ–¹å½¢å¤´åƒï¼‰&amp;#39;, 4 `NICK_NAME` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL, 5 ... 6 PRIMARY KEY (`ID`), 7 UNIQUE KEY `tap_account_OPEN_ID_uindex` (`OPEN_ID`) 8) ENGINE=InnoDB AUTO_INCREMENT=72 DEFAULT CHARSET=utf8mb4 COMMENT=&amp;#39;è‡ªç„¶äººè´¦å·è¡¨&amp;#39;; å¯ä»¥çœ‹åˆ°ç›®å‰çš„å­—ç¬¦é›†å·²ç»é…ç½®æˆäº† utf8mb4 ï¼ŒæŒ‰ç†è¯´åº”è¯¥èƒ½å¤Ÿä¿å­˜æˆåŠŸæ‰å¯¹ã€‚
ä¸ºäº†éªŒè¯ä¸€ä¸‹æ•°æ®åº“æ˜¯å¦ä¿®æ”¹æ­£ç¡®ï¼Œç›´æ¥ä½¿ç”¨sqlä¿®æ”¹è®°å½•è¯•è¯•ï¼š
1update tap_account set nick_name=&amp;#39;åƒé¢æ€ªğŸ¦„&amp;#39; where id=1; å‘ç°æ›´æ–°ç¡®å®å¯ä»¥æˆåŠŸï¼Œæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼›è€Œä¸”ä¹Ÿå¯ä»¥æ­£å¸¸æŸ¥è¯¢åˆ°çš„ä¿®æ”¹åçš„ç»“æœã€‚è¿™è¯´æ˜è¡¨æ–¹é¢åº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚
å› ä¸ºä¹‹å‰è€ƒè™‘åˆ°å…¶ä»–è¡¨æ²¡æœ‰å­˜å‚¨ Emoji è¡¨æƒ…çš„éœ€è¦ï¼Œæ‰€ä»¥æ²¡æœ‰åœ¨æ•°æ®åº“å±‚é¢æ•´ä½“ä¿®æ”¹ç¼–ç ã€‚ä¹Ÿå°±æ˜¯æœ‰ä¸€éƒ¨åˆ†è¡¨è¿˜æ˜¯ä½¿ç”¨ utf8 ç¼–ç ï¼Œåªæœ‰è¿™ä¸ªè¡¨ tap_account ä½¿ç”¨äº† utf8mb4 ç¼–ç ã€‚çœ‹ä¸€ä¸‹ MySQL çš„ç³»ç»Ÿå˜é‡ï¼š
1MySQL [tap_admin]&amp;gt; show variables like &amp;#39;%character%&amp;#39;; 2&#43;--------------------------&#43;---------&#43; 3| Variable_name | Value | 4&#43;--------------------------&#43;---------&#43; 5| character_set_client | utf8mb4 | 6| character_set_connection | utf8mb4 | 7| character_set_database | utf8 | 8| character_set_filesystem | binary | 9| character_set_results | utf8mb4 | 10| character_set_server | utf8 | 11| character_set_system | utf8 | 12| character_sets_dir | | 13&#43;--------------------------&#43;---------&#43; 148 rows in set (0.001 sec) å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨é»˜è®¤çš„ç¼–ç ï¼ˆcharacter_set_serverï¼‰ä¸º utf8 ã€‚
æ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¸ªåŸå› å¯¼è‡´çš„é—®é¢˜å‘¢ï¼Ÿ
2. å…³äºç¼–ç è‡ªåŠ¨æ£€æµ‹ æˆ‘ä½¿ç”¨çš„ MySQL åº“ä¸º mysql-connector-javaï¼Œç‰ˆæœ¬ä¸º 8.0.19ã€‚é…ç½®çš„è¿æ¥å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š
1spring: 2 datasource: 3 url: jdbc:mysql://rm-uecp.mysql.rds.aliyuncs.com:3306/tap_admin?useUnicode=true&amp;amp;serverTimezone=GMT%2b8:00 è¿æ¥å­—ç¬¦ä¸²ä¸­åªæ˜¯ä½¿ç”¨äº†useUnicodeå¼€å¯äº†unicodeæ”¯æŒï¼Œå¹¶æ²¡æœ‰æŒ‡å®šå…·ä½“çš„å­—ç¬¦ç¼–ç ã€‚è¿™æ—¶ä¼šç”¨åˆ° mysql-connector-java çš„è‡ªåŠ¨æ£€æµ‹æœºåˆ¶ã€‚æ ¹æ® MySQL å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œè¿™ä¸ªæ£€æµ‹æœºåˆ¶ä¼šç”¨åˆ° character_set_server è¿™ä¸ªå‚æ•°ã€‚
The character encoding between client and server is automatically detected upon connection (provided that the Connector/J connection properties characterEncoding and connectionCollation are not set). You specify the encoding on the server using the system variable character_set_server (for more information, see Server Character Set and Collation). The driver automatically uses the encoding specified by the server. For example, to use the 4-byte UTF-8 character set with Connector/J, configure the MySQL server with character_set_server=utf8mb4, and leave characterEncoding and connectionCollation out of the Connector/J connection string. Connector/J will then autodetect the UTF-8 setting.
å½“åœ¨è¿æ¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰è®¾ç½® charcterEncoding çš„æ—¶å€™ï¼Œå°†è‡ªåŠ¨ä½¿ç”¨MySQLç³»ç»Ÿå˜é‡ character_set_server ä¸­æŒ‡å®šçš„å­—ç¬¦é›†ã€‚å¦‚æœéœ€è¦è¦†ç›–ä»¥ä¸Šæ£€æµ‹æœºåˆ¶ï¼Œå¯ä»¥æŒ‡å®š characterEncoding å˜é‡ï¼š
To override the automatically detected encoding on the client side, use the characterEncoding property in the connection URL to the server. Use Java-style names when specifying character encodings. The following table lists MySQL character set names and their corresponding Java-style names:
ç‰¹åˆ«çš„å¯¹äº characterEncoding=utf8 ï¼Œä¸åŒç‰ˆæœ¬çš„ mysql-connector-java å¤„ç†ä¸Šæ˜¯æœ‰äº›åŒºåˆ«çš„ï¼š ç®€å•æ¥è¯´ï¼š8.0.13åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ utf8mb4ï¼›è€Œä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨çš„åˆ™æ˜¯ utf8mb3ï¼ˆä¹Ÿå°±æ˜¯é€šå¸¸çš„utf8ç¼–ç ï¼‰ã€‚
3. åŸå› åˆ†æ ç°åœ¨æ¥çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆæ•°æ®åº“èƒ½å¤Ÿä¿å­˜ Emoji å­—ç¬¦ï¼Œä½†æ˜¯é€šè¿‡ Java å´æ— æ³•ä¿å­˜ã€‚
3.1 utf8mb4 æ”¯æŒæ¡ä»¶ é¦–å…ˆæ€»ç»“ä¸€ä¸‹æ”¯æŒ utf8mb4 éœ€è¦çš„å‰ç½®æ¡ä»¶ã€‚
3.1.1 æ•°æ®åº“ç‰ˆæœ¬ utf8mb4 éœ€è¦çš„æœ€ä½mysqlç‰ˆæœ¬ä¸º 5.5.3&#43;ï¼Œè‹¥ä¸æ˜¯ï¼Œåˆ™éœ€è¦å‡çº§ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SQL æŸ¥è¯¢ä¸€ä¸‹å½“å‰çš„ç‰ˆæœ¬å·ï¼š
1select version(); 3.1.2 ä¿®æ”¹æ•°æ®åº“ã€è¡¨æˆ–å­—æ®µçš„å­—ç¬¦é›† å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLä¿®æ”¹æ•°æ®åº“ã€è¡¨æˆ–å­—æ®µæ”¯æŒ utf8mb4 ç¼–ç ï¼š
1-- ä¿®æ”¹æ•°æ®åº“ç¼–ç  2ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci; 3-- ä¿®æ”¹è¡¨ç¼–ç  4ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; 5-- ä¿®æ”¹å­—æ®µç¼–ç  6ALTER TABLE table_name CHANGE column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; ç»è¿‡å®éªŒï¼Œç¡®è®¤å¯ä»¥åªä¿®æ”¹è¡¨æ”¯æŒ utf8mb4 å³å¯ï¼Œæ•°æ®åº“å±‚é¢å¯ä»¥ä¿æŒ utf8 ç¼–ç ä¸ç”¨ä¿®æ”¹ã€‚
3.1.3 MySQLå®¢æˆ·ç«¯ mysql connectoréœ€è¦è‡³å°‘å¤§äº5.1.13ï¼Œå¦åˆ™æ— æ³•æ”¯æŒ utf8mb4ã€‚å¦å¤–è¿˜è¦æ³¨æ„8.0.13å‰åæ”¯æŒå½¢å¼æœ‰æ‰€åŒºåˆ«ã€‚
3.1.4 é“¾æ¥å­—ç¬¦ä¸² éœ€è¦åœ¨ mysql-connector-java é“¾æ¥å­—ç¬¦ä¸²ä¸­å¢åŠ  useUnicode=true&amp;amp;characterEncoding=utf8mb4 æ¥å¼€å¯ utf8mb4 æ”¯æŒã€‚
3.2 ç»“è®º æˆ‘ç”¨çš„mysql-connector-javaç‰ˆæœ¬æ˜¯ 8.0.19ï¼Œå¤§äº8.0.13ï¼Œæ‰€ä»¥ä½¿ç”¨ characterEncoding=utf8 å°±ç›¸å½“äºæ”¯æŒäº† utf8mb4 ç¼–ç ã€‚
ä½†æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰å°†æ•´ä¸ªæ•°æ®åº“çš„ç¼–ç æ”¹ä¸º utf8mb4 ï¼Œæ‰€ä»¥ä¸æŒ‡å®šè¯¥å‚æ•°çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨æ£€æµ‹ä¸º utf8 ç¼–ç ï¼Œå¯¼è‡´ä¿å­˜å¤±è´¥ã€‚
æœ€åå°†è¿æ¥å­—ç¬¦ä¸²æ”¹æˆè¿™æ ·é—®é¢˜å°±è§£å†³äº†ï¼š
1spring: 2 datasource: 3 url: jdbc:mysql://rm-uecp.mysql.rds.aliyuncs.com:3306/tap_admin?useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;serverTimezone=Asia/Shanghai 4. æ€»ç»“ æ€»ç»“ä¸€ä¸‹ï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› æ˜¯å› ä¸ºæ²¡æœ‰æ›´æ”¹æ•°æ®åº“çš„å­—ç¬¦ç¼–ç ï¼Œå¯¼è‡´ mysql-connector-java çš„è‡ªåŠ¨æ£€æµ‹æœºåˆ¶åšå‡ºäº†é”™è¯¯çš„å‡è®¾ï¼Œæ²¡æœ‰è®¾ç½®ä¸ºéœ€è¦çš„ utf8mb4 ç¼–ç ã€‚
å¦å¤–ä»ç½‘ä¸ŠæŸ¥åˆ°çš„èµ„æ–™ä¸€èˆ¬è¯´çš„éƒ½æ˜¯åŒæ—¶ä¿®æ”¹æ•°æ®åº“ã€è¡¨çš„å­—ç¬¦é›†ï¼Œæ²¡æœ‰æˆ‘è¿™ç§åªä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œè€Œæ•°æ®åº“å­—ç¬¦é›†æ²¡æ›´æ”¹çš„æƒ…å†µã€‚é‡åˆ°è¿™ç§ç‰¹æ®Šæƒ…å†µè¿˜æ˜¯è¦è‡ªå·±å¤šåšå®éªŒï¼Œå®è·µå‡ºçœŸçŸ¥ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ mysql/JavaæœåŠ¡ç«¯å¯¹emojiçš„æ”¯æŒ RDS MySQLå­—ç¬¦é›†ç›¸å…³è¯´æ˜ Chapter 10 Character Sets, Collations, Unicode 6.7 Using Character Sets and Unicode </content>
    </entry>
    
     <entry>
        <title>MyBatis Plusä¸­ä¸»é”®ç”Ÿæˆæ–¹å¼ASSIGN_IDçš„ç®—æ³•åˆ†æ</title>
        <url>https://orchidflower.github.io/2021/07/02/MyBatis-ASSIGN_ID-Algorithm/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Java</tag><tag>MyBatis</tag>
        </tags>
        <content type="html"> MyBatis Plus ä¸­æä¾›äº† ASSIGN_ID è¿™ç§æ–¹å¼ç”Ÿæˆä¸»é”®ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œåªè¦åœ¨POä¸Šå®šä¹‰ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚ï¼š
1public class Order extends Model&amp;lt;Order&amp;gt; { 2 3 @TableId(value = &amp;#34;id&amp;#34;, type = IdType.ASSIGN_ID) 4 private Long id; 5 6 //... 7} è¿™æ ·åœ¨ä¿å­˜çš„æ—¶å€™ï¼ŒMyBatis Plusä¼šè´Ÿè´£ç”Ÿæˆä¸»é”®å€¼ï¼Œè‡ªåŠ¨è®¾ç½®åˆ°å­—æ®µidä¸­ã€‚ ä¸€ç›´å¥½å¥‡è¿™ä¸ªä¸»é”®æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼ŒæŠ½æ—¶é—´æŸ¥çœ‹äº†ä¸€ä¸‹æºç ï¼Œç‰¹æ„è®°å½•ä¸€ä¸‹ã€‚
1. MybatisDefaultParameterHandler é€šè¿‡çœ‹MyBatis Plusçš„æ–‡æ¡£ï¼Œå‘ç°è¿™ä¸ªä¸»é”®ç”Ÿæˆè¿‡ç¨‹åº”è¯¥æ˜¯åœ¨ParameterHandlerä¸­è¿›è¡Œå¤„ç†çš„ã€‚åœ¨MyBatis Plusä¸­ParameterHandleræ˜¯ç”¨æ¥è®¾ç½®å‚æ•°è§„åˆ™çš„ï¼Œå½“StatementHandlerè°ƒç”¨prepareæ–¹æ³•ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨å®ƒæ¥è¿›è¡Œè®¾ç½®å‚æ•°ã€‚
å¯¹ASSIGN_IDè¿›è¡Œå¤„ç†çš„çš„åœ°æ–¹æ˜¯åœ¨MybatisDefaultParameterHandlerä¸­ï¼ˆåœ¨3.4.xç‰ˆæœ¬ä¸­ï¼Œè¯¥ç±»æ”¹ä¸ºMybatisParameterHandlerï¼‰ï¼Œè¯¥ç±»åœ¨åŒ…com.baomidou.mybatisplus.coreä¸­ã€‚å¯¹ä¸»é”®å¤„ç†çš„ä»£ç åœ¨populateKeysè¿™ä¸ªæ–¹æ³•ä¸­ï¼š
1 /** 2 * å¡«å……ä¸»é”® 3 * 4 * @param tableInfo æ•°æ®åº“è¡¨åå°„ä¿¡æ¯ 5 * @param metaObject å…ƒæ•°æ®å¯¹è±¡ 6 * @param entity å®ä½“ä¿¡æ¯ 7 */ 8 protected static void populateKeys(TableInfo tableInfo, MetaObject metaObject, Object entity) { 9 final IdType idType = tableInfo.getIdType(); 10 final String keyProperty = tableInfo.getKeyProperty(); 11 if (StringUtils.isNotBlank(keyProperty) &amp;amp;&amp;amp; null != idType &amp;amp;&amp;amp; idType.getKey() &amp;gt;= 3) { 12 final IdentifierGenerator identifierGenerator = GlobalConfigUtils.getGlobalConfig(tableInfo.getConfiguration()).getIdentifierGenerator(); 13 Object idValue = metaObject.getValue(keyProperty); 14 // æ­¤å¤„åˆ¤æ–­æ˜¯å¦idValueæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯å°±è¦æ ¹æ®ç±»å‹è¿›è¡Œè®¡ç®—èµ‹å€¼ 15 if (StringUtils.checkValNull(idValue)) { 16 if (idType.getKey() == IdType.ASSIGN_ID.getKey()) { // æ­¤å¤„å¤„ç†ASSIGN_IDç±»å‹çš„ä¸»é”®ç”Ÿæˆç®—æ³• 17 if (Number.class.isAssignableFrom(tableInfo.getKeyType())) { 18 // æ­¤å¤„è°ƒç”¨IdentitifierGeneratorç”Ÿæˆä¸»é”® 19 metaObject.setValue(keyProperty, identifierGenerator.nextId(entity)); 20 } else { 21 metaObject.setValue(keyProperty, identifierGenerator.nextId(entity).toString()); 22 } 23 } else if (idType.getKey() == IdType.ASSIGN_UUID.getKey()) { // æ­¤å¤„å¤„ç†ASSIGN_UUIDç±»å‹çš„ä¸»é”®ç”Ÿæˆç®—æ³• 24 metaObject.setValue(keyProperty, identifierGenerator.nextUUID(entity)); 25 } 26 } 27 } 28 } 2. DefaultIdentifierGenerator æ­¤ç±»åœ¨åŒ…com.baomidou.mybatisplus.core.incrementerä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š
1public class DefaultIdentifierGenerator implements IdentifierGenerator { 2 3 private final Sequence sequence; 4 5 public DefaultIdentifierGenerator() { 6 this.sequence = new Sequence(); 7 } 8 9 public DefaultIdentifierGenerator(long workerId, long dataCenterId) { 10 this.sequence = new Sequence(workerId, dataCenterId); 11 } 12 13 public DefaultIdentifierGenerator(Sequence sequence) { 14 this.sequence = sequence; 15 } 16 17 @Override 18 public Long nextId(Object entity) { 19 // æ­¤å¤„è°ƒç”¨Sequenceçš„nextIdç®—æ³•ç”ŸæˆçœŸæ­£çš„ä¸»é”®å€¼ 20 return sequence.nextId(); 21 } 22} 3. Sequence æ­¤ç±»åœ¨åŒ…com.baomidou.mybatisplus.core.toolkitä¸­ã€‚æ³¨æ„ï¼šä»¥ä¸‹ä»£ç è¿›è¡Œäº†ç¼©å‡ã€‚
1public class Sequence { 2 /** 3 * æ—¶é—´èµ·å§‹æ ‡è®°ç‚¹ï¼Œä½œä¸ºåŸºå‡†ï¼Œä¸€èˆ¬å–ç³»ç»Ÿçš„æœ€è¿‘æ—¶é—´ï¼ˆä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŠ¨ï¼‰ 4 */ 5 private final long twepoch = 1288834974657L; 6 /** 7 * æœºå™¨æ ‡è¯†ä½æ•° 8 */ 9 private final long workerIdBits = 5L; 10 private final long datacenterIdBits = 5L; 11 private final long maxWorkerId = -1L ^ (-1L &amp;lt;&amp;lt; workerIdBits); 12 private final long maxDatacenterId = -1L ^ (-1L &amp;lt;&amp;lt; datacenterIdBits); 13 /** 14 * æ¯«ç§’å†…è‡ªå¢ä½ 15 */ 16 private final long sequenceBits = 12L; 17 private final long workerIdShift = sequenceBits; 18 private final long datacenterIdShift = sequenceBits &#43; workerIdBits; 19 /** 20 * æ—¶é—´æˆ³å·¦ç§»åŠ¨ä½ 21 */ 22 private final long timestampLeftShift = sequenceBits &#43; workerIdBits &#43; datacenterIdBits; 23 private final long sequenceMask = -1L ^ (-1L &amp;lt;&amp;lt; sequenceBits); 24 25 26 public Sequence() { 27 this.datacenterId = getDatacenterId(maxDatacenterId); 28 this.workerId = getMaxWorkerId(datacenterId, maxWorkerId); 29 } 30 31 32 /** 33 * æ•°æ®æ ‡è¯†idéƒ¨åˆ† 34 */ 35 protected static long getDatacenterId(long maxDatacenterId) { 36 long id = 0L; 37 try { 38 InetAddress ip = InetAddress.getLocalHost(); 39 NetworkInterface network = NetworkInterface.getByInetAddress(ip); 40 if (network == null) { 41 id = 1L; 42 } else { 43 byte[] mac = network.getHardwareAddress(); 44 if (null != mac) { 45 // macåœ°å€æœ€åä¸¤èŠ‚ï¼Œä¾‹å¦‚å¯¹Macåœ°å€00:15:5d:2d:0b:01ï¼Œä¸‹é¢çš„ç»“æœæ˜¯id=0x0b01 46 id = ((0x000000FF &amp;amp; (long) mac[mac.length - 1]) | (0x0000FF00 &amp;amp; (((long) mac[mac.length - 2]) &amp;lt;&amp;lt; 8))) &amp;gt;&amp;gt; 6; 47 // è¿™é‡Œæ˜¯è®¡ç®—é™¤ä»¥32åå¾—åˆ°çš„ä½™æ•° 48 id = id % (maxDatacenterId &#43; 1); 49 } 50 } 51 } catch (Exception e) { 52 logger.warn(&amp;#34; getDatacenterId: &amp;#34; &#43; e.getMessage()); 53 } 54 return id; 55 } 56 57 /** 58 * è·å– maxWorkerId 59 */ 60 protected static long getMaxWorkerId(long datacenterId, long maxWorkerId) { 61 StringBuilder mpid = new StringBuilder(); 62 mpid.append(datacenterId); 63 // æ­¤å¤„è¿”å›çš„æ˜¯the name representing the running Java virtual machine 64 String name = ManagementFactory.getRuntimeMXBean().getName(); 65 if (StringUtils.isNotBlank(name)) { 66 /* 67 * GET jvmPid 68 */ 69 mpid.append(name.split(StringPool.AT)[0]); 70 } 71 /* 72 * MAC &#43; PID çš„ hashcode è·å–16ä¸ªä½ä½ 73 */ 74 return (mpid.toString().hashCode() &amp;amp; 0xffff) % (maxWorkerId &#43; 1); 75 } 76 77 /** 78 * è·å–ä¸‹ä¸€ä¸ª ID 79 * 80 * @return ä¸‹ä¸€ä¸ª ID 81 */ 82 public synchronized long nextId() { 83 long timestamp = timeGen(); 84 //é—°ç§’ 85 if (timestamp &amp;lt; lastTimestamp) { 86 long offset = lastTimestamp - timestamp; 87 if (offset &amp;lt;= 5) { 88 try { 89 wait(offset &amp;lt;&amp;lt; 1); 90 timestamp = timeGen(); 91 if (timestamp &amp;lt; lastTimestamp) { 92 throw new RuntimeException(String.format(&amp;#34;Clock moved backwards. Refusing to generate id for %d milliseconds&amp;#34;, offset)); 93 } 94 } catch (Exception e) { 95 throw new RuntimeException(e); 96 } 97 } else { 98 throw new RuntimeException(String.format(&amp;#34;Clock moved backwards. Refusing to generate id for %d milliseconds&amp;#34;, offset)); 99 } 100 } 101 102 if (lastTimestamp == timestamp) { 103 // ç›¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·è‡ªå¢ 104 sequence = (sequence &#43; 1) &amp;amp; sequenceMask; 105 if (sequence == 0) { 106 // åŒä¸€æ¯«ç§’çš„åºåˆ—æ•°å·²ç»è¾¾åˆ°æœ€å¤§ 107 timestamp = tilNextMillis(lastTimestamp); 108 } 109 } else { 110 // ä¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·ç½®ä¸º 1 - 3 éšæœºæ•° 111 sequence = ThreadLocalRandom.current().nextLong(1, 3); 112 } 113 114 lastTimestamp = timestamp; 115 116 // æ—¶é—´æˆ³éƒ¨åˆ† | æ•°æ®ä¸­å¿ƒéƒ¨åˆ† | æœºå™¨æ ‡è¯†éƒ¨åˆ† | åºåˆ—å·éƒ¨åˆ† 117 return ((timestamp - twepoch) &amp;lt;&amp;lt; timestampLeftShift) 118 | (datacenterId &amp;lt;&amp;lt; datacenterIdShift) 119 | (workerId &amp;lt;&amp;lt; workerIdShift) 120 | sequence; 121 } 122} è·Ÿè¸ªåˆ°è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°å…·ä½“çš„ç®—æ³•äº†ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥ç®—æ³•å°±æ˜¯Twitterçš„é›ªèŠ±ç®—æ³•çš„å˜ç§ã€‚æœ€åç”Ÿæˆçš„ä¸»é”®å€¼æ˜¯ä¸€ä¸ª64ä½é•¿æ•´æ•°ï¼Œå…¶å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š
æœ€é«˜1ä½æœªç”¨ï¼Œæ€»ä¸º0ï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯ç”Ÿæˆçš„ä¸»é”®å€¼æ°¸è¿œä¸ºæ•´æ•°ï¼› ç„¶åæ˜¯41ä½æ—¶é—´æˆ³ï¼Œå…¶å€¼ä¸ºUTCæ¯«ç§’æ•°å‡å»ä¸€ä¸ªå›ºå®šå€¼ï¼š1288834974657Lï¼› ç„¶åæ˜¯5ä½datacenterIdï¼Œä»ä¸Šé¢çš„ç®—æ³•æ¥çœ‹æ˜¯ä»ä¸»æœºçš„macåœ°å€å2æ®µè®¡ç®—å‡ºæ¥çš„ï¼› ç´§æ¥ç€æ˜¯5ä½çš„workerIdï¼› æœ€åæ˜¯12ä½é¡ºåºå·ã€‚ä¹Ÿå°±æ˜¯ä¸€æ¯«ç§’æ—¶é—´å†…æœ€å¤šèƒ½å¤Ÿç”Ÿæˆ4096ä¸ªä¸»é”®å€¼ã€‚ ä¸Twitterçš„é›ªèŠ±ç®—æ³•çš„å”¯ä¸€åŒºåˆ«æ˜¯å…¶41ä½çš„æ—¶é—´æˆ³å€¼å¤šå‡å»äº†ä¸€ä¸ªå›ºå®šå€¼ï¼š1288834974657Lã€‚
</content>
    </entry>
    
     <entry>
        <title>Linuxå¸¸ç”¨å‘½ä»¤ä»‹ç» 05 - unzip</title>
        <url>https://orchidflower.github.io/2021/02/26/linux-command-introduction-05-unzip/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag>
        </tags>
        <content type="html"> unzipå‘½ä»¤å¯ä»¥ç”¨æ¥è§£å‹zipæ–‡ä»¶ã€‚ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æœ‰äº›ä¸å¤ªå¸¸ç”¨çš„å‘½ä»¤éœ€è¦è®°å½•ä¸€ä¸‹ã€‚
1. æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ 1unzip -l ShadowHunters.epub 2# æŸ¥çœ‹æ›´è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‹ç¼©ç‡ç­‰ 3unzip -lv ShadowHunters.epub 2. è§£å‹æ–‡ä»¶ 1unzip -d ./temp ShadowHunters.epub 3. è§£å‹ä¸€ä¸ªæ–‡ä»¶ ä½¿ç”¨-på‘½ä»¤ï¼Œå°†æ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œç„¶åä½¿ç”¨é‡å®šå‘åˆ›å»ºæ–‡ä»¶ï¼š
1unzip -p ShadowHunters.epub ops/xhtml/cover.html &amp;gt; cover.html 4. æ›´æ–°æ–‡ä»¶ 1zip -u ShadowHunters.epub ops/xhtml/cover.html </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•åœ¨Ubuntuä¸Šé™æ€ç¼–è¯‘Golang&#43;GoCVç¨‹åº</title>
        <url>https://orchidflower.github.io/2020/12/18/How-to-build-static-binary-with-gocv/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Ubuntu</tag><tag>Golang</tag><tag>GoCV</tag><tag>é™æ€ç¼–è¯‘</tag>
        </tags>
        <content type="html"> æœ€è¿‘åšäº†ä¸€ä¸ªå›¾åƒå¢å¼ºç¨‹åºï¼Œç”¨åˆ°äº†OpenCVã€‚ä¸ºäº†æ–¹ä¾¿å‘å¸ƒï¼Œæˆ‘å°†ä»£ç ä½¿ç”¨Golang&#43;GoCVé‡å†™ï¼Œä½†æ˜¯ç¼–è¯‘çš„æ—¶å€™å‘ç°æ¯”è¾ƒéº»çƒ¦ï¼Œç‰¹åˆ«è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡åæŸ¥ã€‚ æœ¬æ–‡å¯¹åº”ç‰ˆæœ¬å¦‚ä¸‹ï¼š
Ubuntu 18.04.5 LTS Golang 1.15.6 OpenCV 4.5.0 GoCV 0.2.5 1. Golangç¯å¢ƒå‡†å¤‡ 1.1 å®‰è£…Golang ä¸‹è½½å¯¹åº”çš„åŒ…ï¼Œç„¶åè§£å‹ï¼Œè®¾ç½®PATHè·¯å¾„å³å¯ï¼Œä¸å¤šè¯´äº†ã€‚
1.2 è®¾ç½®GOPATH ä½¿ç”¨go getä¸‹è½½çš„åŒ…å°†ä¸‹è½½åˆ°$GOPATHç›®å½•ä¸­ã€‚ è¿™é‡Œè®¾ç½®æˆ/home/ubuntu/.goã€‚ä¸è®¾ç½®çš„è¯å°†è‡ªåŠ¨è®¾ç½®æˆ~/goç›®å½•ã€‚
1cd /home/ubuntu/.go 2export GOPATH=/home/ubuntu/.go 1.3 ä¸‹è½½GoCVæºç  1# è®¾ç½®ä»£ç†ç¿»å¢™ï¼Œè¦ä¸ç„¶ä¸‹è½½ä¸äº† 2git config --global http.proxy=http://127.0.0.1:12346 3git config --global https.proxy=http://127.0.0.1:12346 4export http_proxy=http://127.0.0.1:12346 5export https_proxy=http://127.0.0.1:12346 6go get -v -u -d gocv.io/x/gocv 2. å¼€å§‹ç¼–è¯‘ åœ¨GoCVçš„æºç ä¸­ï¼Œæœ‰ä¸€ä¸ªMakefileæ–‡ä»¶ï¼Œä½¿ç”¨è¯¥Makefileå¯ä»¥ç®€åŒ–OpenCVçš„ç¼–è¯‘è¿‡ç¨‹ã€‚æˆ‘æ˜¯ä»¥æ­¤æ–‡ä»¶ä¸ºåŸºç¡€ç¼–è¯‘çš„ã€‚
2.1 å®‰è£…ä¾èµ–åº“ 1# åˆ‡æ¢åˆ°æºç ç›®å½• 2ubuntu@testserver:~$ cd $GOPATH/src/gocv.io/x/gocv 3# å®‰è£…ä¾èµ–åº“ 4ubuntu@testserver:~/.go/src/gocv.io/x/gocv$ make deps 5sudo apt-get -y update 6sudo apt-get -y install unzip wget build-essential cmake curl git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libdc1394-22-dev 2.2 ä¸‹è½½ç›¸å…³æºç  ä¸‹è½½OpenCVç›¸å…³æºç ã€‚è®°å¾—æŒ‚ä»£ç†ã€‚
1ubuntu@testserver:~/.go/src/gocv.io/x/gocv$ make download 2rm -rf /tmp/opencv 3mkdir /tmp/opencv 4cd /tmp/opencv 5curl -Lo opencv.zip https://github.com/opencv/opencv/archive/4.5.0.zip 6unzip -q opencv.zip 7curl -Lo opencv_contrib.zip https://github.com/opencv/opencv_contrib/archive/4.5.0.zip 8unzip -q opencv_contrib.zip 9rm opencv.zip opencv_contrib.zip 10cd - 2.3 ç¼–è¯‘ åœ¨ç¼–è¯‘ä¹‹å‰éœ€è¦å¯¹Makefileè¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚å› ä¸ºFFMpegã€GTKã€DC1394è¿™å‡ ä¸ªåŠŸèƒ½çš„ä¾èµ–åº“ç‰¹åˆ«å¤æ‚ï¼Œè¦å®ç°é™æ€ç¼–è¯‘éå¸¸éº»çƒ¦ï¼Œå¯èƒ½éœ€è¦è‡ªå·±æ‰‹å·¥è£å‡ç¼–è¯‘è¿™å‡ ä¸ªåº“ã€‚å› ä¸ºç›®å‰ç¨‹åºæ²¡æœ‰ç”¨åˆ°çª—å£ã€è§†é¢‘ç­‰æ–¹é¢çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ç›´æ¥è£å‡æ‰è¿™å‡ ä¸ªåŠŸèƒ½ã€‚ ä¿®æ”¹æ–¹æ³•æ˜¯ä¿®æ”¹$GOPATH/src/gocv.io/x/gocv/Makefileè¿™ä¸ªæ–‡ä»¶ã€‚æ·»åŠ -D WITH_FFMPEG=OFF -D WITH_GTK=OFF -D WITH_1394=OFF -D WITH_TIFF=OFFè¿™å‡ ä¸ªå‚æ•°åˆ°ç›®æ ‡buildé‡Œé¢çš„cmakeå‘½ä»¤ä¸­å³å¯ã€‚
1# Build OpenCV. 2build: 3 cd $(TMP_DIR)opencv/opencv-$(OPENCV_VERSION) 4 mkdir build 5 cd build 6 rm -rf * 7 #cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D BUILD_SHARED_LIBS=${BUILD_SHARED_LIBS} -D OPENCV_EXTRA_MODULES_PATH=$(TMP_DIR)opencv/opencv_contrib-$(OPENCV_VERSION)/modules -D BUILD_DOCS=OFF -D BUILD_EXAMPLES=OFF -D BUILD_TESTS=OFF -D BUILD_PERF_TESTS=OFF -D BUILD_opencv_java=NO -D BUILD_opencv_python=NO -D BUILD_opencv_python2=NO -D BUILD_opencv_python3=NO -D WITH_JASPER=OFF -DOPENCV_GENERATE_PKGCONFIG=ON .. 8 cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D BUILD_SHARED_LIBS=${BUILD_SHARED_LIBS} -D OPENCV_EXTRA_MODULES_PATH=$(TMP_DIR)opencv/opencv_contrib-$(OPENCV_VERSION)/modules -D BUILD_DOCS=OFF -D BUILD_EXAMPLES=OFF -D BUILD_TESTS=OFF -D BUILD_PERF_TESTS=OFF -D BUILD_opencv_java=NO -D BUILD_opencv_python=NO -D BUILD_opencv_python2=NO -D BUILD_opencv_python3=NO -D WITH_JASPER=OFF -D WITH_FFMPEG=OFF -D WITH_GTK=OFF -D WITH_1394=OFF -DOPENCV_GENERATE_PKGCONFIG=ON .. 9 $(MAKE) -j $(shell nproc --all) 10 $(MAKE) preinstall 11 cd - æ³¨æ„WITH_TIFF=OFFè¿™ä¸ªå‚æ•°ä¹Ÿå¯ä»¥ä¸æ·»åŠ ï¼Œä¸è¿‡è¦ä¿®æ”¹åé¢æåˆ°çš„CGO_LDFLAGSã€‚å…·ä½“çœ‹ä¸‹é¢çš„ä»‹ç»ã€‚
ç„¶åå¯ä»¥æ‰§è¡Œç¼–è¯‘äº†ã€‚è¿™ä¸ªç¼–è¯‘è€—è´¹æ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚æˆ‘è¿™è¾¹èŠ±äº†20&#43;åˆ†é’Ÿã€‚
1# é»˜è®¤æ–¹å¼ç¼–è¯‘ï¼Œç¼–è¯‘å‡ºæ¥åŠ¨æ€åº“ã€‚æˆ‘ä¸ç”¨è¿™ç§æ–¹å¼ã€‚ 2ubuntu@testserver:~/.go/src/gocv.io/x/gocv$ make build 3# æˆ‘è¦ç¼–è¯‘é™æ€åº“ï¼Œæ‰€ä»¥æ·»åŠ BUILD_SHARED_LIBS=OFF 4ubuntu@testserver:~/.go/src/gocv.io/x/gocv$ make build BUILD_SHARED_LIBS=OFF æ¼«é•¿çš„ç­‰å¾…ã€‚
2.4 å®‰è£… 1# å°†ç¼–è¯‘å¥½çš„åº“å®‰è£…åˆ°ç³»ç»Ÿä¸­ 2ubuntu@testserver:~/.go/src/gocv.io/x/gocv$ make sudo_install 3cd /tmp/opencv/opencv-4.5.0/build 4sudo make install 5sudo ldconfig 6cd - 7[sudo] password for ubuntu: 2.5 ç¼–è¯‘Golangç¨‹åº ç›´æ¥ç¼–è¯‘æ˜¯æ— æ³•é€šè¿‡çš„ï¼Œéœ€è¦è®¾ç½®CGO_CPPFLAGS, CGO_LDFLAGSä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œç„¶åä½¿ç”¨go build -tags customenvç¼–è¯‘ã€‚
CGO_CPPFLAGSè¿™ä¸ªç¯å¢ƒå˜é‡ç”¨äºæŒ‡å®šincludeæ–‡ä»¶çš„è·¯å¾„ï¼›å¯ä»¥é€šè¿‡pkg-config --cflagsè¿™ä¸ªå‘½ä»¤è·å¾—å…¶å†…å®¹ã€‚ CGO_LDFLAGSè¿™ä¸ªç¯å¢ƒå˜é‡ç”¨äºè¿æ¥æ—¶æœŸï¼Œä¸»è¦æŒ‡å®šlibæ–‡ä»¶è·¯å¾„åŠéœ€è¦è¿æ¥çš„åº“ã€‚å¯ä»¥é€šè¿‡pkg-config --libsè·å¾—å…¶ä¸»è¦å†…å®¹ã€‚è§ä¸‹é¢çš„æ³¨é‡Šã€‚
1# ä½¿ç”¨`pkg-config --cflags opencv4`è·å¾— 2export CGO_CPPFLAGS=&amp;#34;-I/usr/local/include/opencv4&amp;#34; 3# ä½¿ç”¨`pkg-config --libs --static opencv4`è·å¾—ä¸»è¦å†…å®¹ã€‚ç„¶åæ·»åŠ ä¸Š`--static`è¿™ä¸ªå‚æ•°ã€‚ 4export CGO_LDFLAGS=&amp;#34;--static -L/usr/local/lib -L/usr/local/lib/opencv4/3rdparty -L/tmp/opencv/opencv-4.5.0/build/lib -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_intensity_transform -lopencv_line_descriptor -lopencv_mcc -lopencv_quality -lopencv_rapid -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core -littnotify -llibprotobuf -llibwebp -llibopenjp2 -lIlmImf -lquirc -lippiw -lippicv -lade -ljpeg -lpng -lz -ltiff -lfreetype -lharfbuzz -ljbig -llzma -lm -lpthread -lrt -lc -ldl&amp;#34; å¦å¤–ï¼Œå¦‚æœè¦æ”¯æŒTIFFæ ¼å¼ï¼ˆå‰é¢Makefileä¸­æ²¡æœ‰æ·»åŠ WITH_TIFF=OFFé€‰é¡¹ï¼‰ï¼Œåˆ™CPP_LDFLAGSä¸­è¿˜è¦åŠ ä¸Šï¼š-ljbig -llzmaè¿™ä¸¤ä¸ªå‚æ•°ï¼Œå¦åˆ™ç¼–è¯‘Goä»£ç çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚
æœ€åä½¿ç”¨go build -v -tags customenv .å‘½ä»¤å°±å¯ä»¥ç¼–è¯‘äº†ã€‚
3. ç¼–è¯‘ä¸­ç¢°åˆ°çš„ä¸€äº›é”™è¯¯ ç¼–è¯‘Goä»£ç çš„æ—¶å€™ç»å¸¸ç¢°åˆ°å„ç§undefined reference toé”™è¯¯ï¼Œè¿™éƒ½æ˜¯å› ä¸ºè¦é“¾æ¥çš„åº“æ²¡æœ‰åœ¨CPP_LDFLAGSä¸­æŒ‡å®šã€‚æ‰¾åˆ°å¯¹åº”çš„åº“ï¼Œæ·»åŠ åˆ°å‚æ•°ä¸­å°±å¥½äº†ã€‚
3.1 jbg 1(.text&#43;0x45): undefined reference to `jbg_enc_init&amp;#39; 2(.text&#43;0x4d): undefined reference to `jbg_enc_out&amp;#39; 3(.text&#43;0x55): undefined reference to `jbg_enc_free&amp;#39; ä»¥ä¸Šé”™è¯¯æ˜¯éœ€è¦libjbigè¿™ä¸ªåº“ï¼Œåº”è¯¥æ˜¯TIFFæ ¼å¼éœ€è¦çš„ã€‚å¦‚æœå…³é—­äº†TIFFæ ¼å¼æ”¯æŒï¼Œåº”è¯¥ä¸ä¼šæŠ¥ä¸Šé¢çš„é”™è¯¯ã€‚æ·»åŠ -ljbigå°±å¯ä»¥äº†ã€‚
3.2 lzma 1(.text&#43;0x1a0): undefined reference to `lzma_code&amp;#39; ä»¥ä¸Šé”™è¯¯æ˜¯éœ€è¦liblzmaè¿™ä¸ªåº“ï¼Œåº”è¯¥ä¹Ÿæ˜¯TIFFæ ¼å¼éœ€è¦çš„ã€‚æ·»åŠ ä¸Š-llzmaå‚æ•°è§£å†³ã€‚
3.3 dlopenã€getaddrinfo 1warning: Using &amp;#39;dlopen&amp;#39; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking libc
1Using &amp;#39;getaddrinfo&amp;#39; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking è¿™ä¸¤ä¸ªè­¦å‘Šä¿¡æ¯æš‚æ—¶æ‰¾ä¸åˆ°è§£å†³åŠæ³•ã€‚
4. å…¶ä»–ä¸€äº›CGOç¼–è¯‘ç›¸å…³çš„æŒ‡ä»¤ go clean -cache å¯ä»¥æ¸…é™¤å·²ç»ç¼–è¯‘çš„ç¼“å­˜ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ GoCV Home GoCV @Github Building OpenCV as a static library leads to thousands of undefined references Pls add static link opencv #217 Golang 1.9 build warning : Using &amp;lsquo;getaddrinfo&amp;rsquo; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking #21421 OpenCV configuration options reference ubuntuå®‰è£…opencvæ— æ³•ä¸‹è½½IPPICVçš„é—®é¢˜ ippicv_2020_lnx_intel64_20191018_general.tgz How to build more compact OpenCV applications on Linux </content>
    </entry>
    
     <entry>
        <title>åˆ é™¤å¯åŠ¨å°Launchpadä¸Šæ— æ•ˆçš„å›¾æ ‡</title>
        <url>https://orchidflower.github.io/2020/12/04/Delete-Invalid-Icon-from-Lauchpad/</url>
        <categories>
          <category>æŠ€å·§</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>Launchpad</tag>
        </tags>
        <content type="html"> ä»Šå¤©åˆ é™¤è½¯ä»¶çš„æ—¶å€™ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè½¯ä»¶è™½ç„¶è¢«åˆ é™¤äº†ï¼Œä½†æ˜¯å›¾æ ‡ä¾ç„¶åœ¨å¯åŠ¨å°ä¸Šã€‚æ€ä¹ˆä¹Ÿåˆ ä¸æ‰ã€‚ä¸Šç½‘æœäº†æœï¼Œæ‰¾åˆ°ä¸€ä¸ªåŠæ³•å¯ä»¥è§£å†³ã€‚ç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚
1# åˆ‡æ¢åˆ°ç›®å½• /private/var/folders 2cd /private/var/folders 3# å¯»æ‰¾ com.apple.dock.launchpad ç›®å½•ï¼Œå›¾æ ‡ä¿¡æ¯å­˜åœ¨è¯¥ç›®å½•ä¸­çš„ä¸€ä¸ªsqlite3æ•°æ®åº“ä¸­ 4sudo find . | grep com.apple.dock.launchpad 5# ç¡®å®šå¥½ç›®å½•ï¼Œç„¶åä½¿ç”¨cdè½¬å…¥å¯¹åº”çš„ç›®å½•ã€‚ç›®å½•åä¸åŒæœºå™¨ä¸Šä¸ä¸€æ · 6# ä½¿ç”¨sqlite3å·¥å…·æŸ¥è¯¢ä¸€ä¸‹ 7sqlite3 db &amp;#34;select * from apps where title like &amp;#39;eclipse%&amp;#39;;&amp;#34; 8# ç¡®è®¤ä¹‹åå¯ä»¥ä½¿ç”¨deleteè¯­å¥åˆ é™¤ 9sqlite3 db &amp;#34;delete from apps where title like &amp;#39;eclipse%&amp;#39;;&amp;#34; 10# ç„¶åæ€æ‰Dockè¿›ç¨‹ï¼Œå°±å¥½äº† 11killall Dock é™„å½•ã€å‚è€ƒèµ„æ–™ åˆ é™¤macå¯åŠ¨å°é‡Œåˆ ä¸æ‰çš„å›¾æ ‡ </content>
    </entry>
    
     <entry>
        <title>ç¦ç”¨CleanMyMacX HealthMonitor</title>
        <url>https://orchidflower.github.io/2020/11/27/How-to-Disable-CleanMyMacX-HealthMonitor/</url>
        <categories>
          <category>æŠ€å·§</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>CleanMyMacX</tag>
        </tags>
        <content type="html"> CleanMyMacX æ˜¯Macå¹³å°ä¸Šä¼˜ç§€çš„å¸è½½å·¥å…·ã€‚è™½ç„¶Macä¸Šçš„åº”ç”¨å®‰è£…å¸è½½æ¯”Windowsä¸Šç®€å•å¾ˆå¤šï¼ŒAppStoreä¸Šçš„è½¯ä»¶é‡‡ç”¨çš„æ˜¯æ²™ç›’æ¨¡å‹ï¼Œåˆ é™¤çš„æ—¶å€™ä¼šæŠŠç›¸å…³çš„æ•°æ®ä¸€å¹¶åˆ é™¤ï¼›ä½†æ˜¯å¤§é‡çš„éAppStoreè½¯ä»¶åœ¨åˆ é™¤å¯¹åº”çš„appä¹‹åä¸ä¼šåŒæ—¶åˆ é™¤å¯¹åº”çš„æ•°æ®ã€‚ CleanMyMacX è¿™ç§ç±»å‹çš„è½¯ä»¶ä¼šæ‰«æè¿™äº›ç›¸å…³çš„æ•°æ®å¹¶ä¸€èµ·åˆ é™¤ã€‚
æœ€è¿‘å‘ç° CleanMyMacX ä¼šé™„å¸¦ä¸€ä¸ªåå°æœåŠ¡ï¼šCleanMyMacX HealthMonitorï¼Œå³ä½¿è½¯ä»¶æœ¬èº«é€€å‡ºè¿™ä¸ªåå°æœåŠ¡è¿˜ä¸€ç›´è¿è¡Œã€‚è¿™å°±æœ‰ç‚¹360çš„å‘³é“äº†ï¼Œè®©äººä¸çˆ½ã€‚æœ€ä¸»è¦çš„æ˜¯è¿™ä¸ªè¿›ç¨‹å¯¹èµ„æºçš„å ç”¨è¿˜æ˜¯æœ‰çš„ï¼Œæ²¡æœ‰åˆ°é‚£ç§å¯ä»¥å®Œå…¨å¿½ç•¥çš„åœ°æ­¥ã€‚å› æ­¤æƒ³åŠæ³•ç¦ç”¨å®ƒã€‚
2020.12.03 è¡¥å……ï¼šè¯¥æ–¹æ³•ä¸å¤ªå¥½ï¼Œè¯·å‚è€ƒä¸‹é¢çš„è¯´æ˜ã€‚
å°è¯•äº†å¾ˆå¤šç½‘ä¸Šæä¾›çš„åŠæ³•éƒ½ä¸æˆåŠŸï¼Œæœ€åå‘ç°äº†ä¸€ä¸ªç®€å•çš„åŠæ³•ï¼Œåªè¦åˆ é™¤å¯¹åº”çš„æ‰§è¡Œæ–‡ä»¶å³å¯ï¼Œé’ˆå¯¹æœ€æ–°çš„4.6.15æœ‰æ•ˆï¼š
1rm &amp;#34;/Applications/CleanMyMac X.app/Contents/Library/LoginItems/CleanMyMac X Menu.app/Contents/Library/LoginItems/CleanMyMac X HealthMonitor.app/Contents/MacOS/*&amp;#34; 2020.12.03 è¡¥å……ï¼š ä»¥ä¸Šæ–¹æ³•æœ‰äº›åé—ç—‡ï¼Œæ‰“å¼€æ§åˆ¶å°ç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°åœ¨system.logä¸­å®šæœŸå‡ºç°å¼‚å¸¸ä¿¡æ¯ï¼š
1Dec 3 00:40:02 macBookPro com.apple.xpc.launchd[1] (com.macpaw.CleanMyMac4.HealthMonitor[7781]): Service exited with abnormal code: 78 2Dec 3 00:40:02 macBookPro com.apple.xpc.launchd[1] (com.macpaw.CleanMyMac4.HealthMonitor): Service only ran for 0 seconds. Pushing respawn out by 10 seconds. 3Dec 3 00:40:14 macBookPro com.apple.xpc.launchd[1] (com.macpaw.CleanMyMac4.HealthMonitor[7785]): Could not find and/or execute program specified by service: 45: Operation not supported: com.macpaw.CleanMyMac4.HealthMonitor è¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
ç»è¿‡è¯•éªŒï¼Œå¯ä»¥ä¿®æ”¹æƒé™è§£å†³ï¼Œä¸éœ€è¦åˆ é™¤æ–‡ä»¶ï¼Œä¹Ÿä¸ä¼šå‡ºç°system.logä¸­çš„å¼‚å¸¸æ—¥å¿—ã€‚é’ˆå¯¹4.7.1æœ‰æ•ˆï¼š
1chmod 400 &amp;#34;/Applications/CleanMyMac X.app/Contents/Library/LoginItems/CleanMyMac X Menu.app/Contents/Library/LoginItems/CleanMyMac X HealthMonitor.app/Contents/MacOS/CleanMyMac X HealthMonitor&amp;#34; 2chmod 400 &amp;#34;/Applications/CleanMyMac X.app/Contents/Library/LoginItems/CleanMyMac X Menu.app/Contents/Library/LaunchServices/com.macpaw.CleanMyMac4.Agent&amp;#34; 3chmod 400 &amp;#34;/Applications/CleanMyMac X.app/Contents/Library/LaunchServices/com.macpaw.CleanMyMac4.Agent&amp;#34; é™„å½•ã€å‚è€ƒèµ„æ–™ å½“ä¸‹ å¦‚ä½•ç¦ç”¨ æµæ°“å¯åŠ¨é¡¹ CleanMyMac X HealthMonitor </content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨MyBatis ResultHandlerè§£å†³å·¨å¤§ç»“æœé›†å¯¼å‡ºExcelå¼•å‘çš„OOM</title>
        <url>https://orchidflower.github.io/2020/09/04/Using-MyBatis-ResultHandler-to-export-huge-resultset-avoiding-OOM/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>MyBatis</tag><tag>OOM</tag><tag>ResultHandler</tag><tag>å†…å­˜æº¢å‡º</tag>
        </tags>
        <content type="html"> å½“ä¸€æ¬¡è¦å¯¼å‡ºéå¸¸å¤šæ•°æ®çš„æ—¶å€™ï¼Œä¾‹å¦‚100wæ¡ï¼Œå¦‚æœä½¿ç”¨MyBatiså°†å…¨éƒ¨ç»“æœéƒ½æŸ¥è¯¢åˆ°listä¸­ï¼Œç»å¸¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MyBatisçš„ResultHandleræ¥ä½¿ç”¨æ¸¸æ ‡æ–¹å¼è®¿é—®æ•°æ®ï¼Œä»è€Œé¿å…OOMã€‚
ResultHandleræ˜¯MyBatisæä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¯¥æ¥å£å¯ä»¥è®©MyBatisä»¥æµå¼çš„æ–¹å¼å¤„ç†ç»“æœé›†ï¼Œè€Œä¸å¿…ç­‰å¾…æ•´ä¸ªç»“æœé›†å…¨éƒ¨å‡†å¤‡å®Œæ¯•ï¼Œåœ¨å‡†å¤‡å¥½ä¸€æ¡è®°å½•åå°±è°ƒç”¨è¯¥æ¥å£ä¸­çš„handleResultæ–¹æ³•ï¼š
1void handleResult(ResultContext&amp;lt;? extends T&amp;gt; resultContext); è¦ä½¿ç”¨ResultHandleréœ€è¦åœ¨Mapperå±‚å£°æ˜çš„æ—¶å€™åšä¸€å®šçš„å¤„ç†ã€‚è¿™é‡Œç®€å•æè¿°ä¸€ä¸‹ã€‚
1. åŸºäºæ³¨è§£ 1public interface OrderMapper extends BaseMapper&amp;lt;Order&amp;gt; { 2 /** 3 * å¯¼å‡ºè®¢å•åŠŸèƒ½ 4 * @param wrapper 5 * @param handler 6 */ 7 @Select(&amp;#34;select * from tap_order ${ew.customSqlSegment}&amp;#34;) 8 @Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize = Integer.MIN_VALUE) 9 @ResultType(Order.class) 10 void export(@Param(&amp;#34;ew&amp;#34;) Wrapper wrapper, ResultHandler&amp;lt;Order&amp;gt; handler); 11} åŸºäºæ³¨è§£çš„å£°æ˜æ–¹å¼çœ‹ä¸Šå»ç›¸å½“ç›´è§‚ï¼š
ä½¿ç”¨@Selectæ³¨è§£å£°æ˜sqlè¯­å¥ï¼› ä½¿ç”¨@ResultTypeå£°æ˜ç»“æœé›†çš„ç±»å‹ï¼› ä½¿ç”¨@Optionså£°æ˜äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼Œå…¶ç›®çš„æ˜¯å¼€å¯MySQLçš„å®¢æˆ·ç«¯æ¸¸æ ‡ã€‚å¦‚æœä¸é…ç½®è¿™ä¸¤é¡¹ï¼ŒMySQLé»˜è®¤è¿˜æ˜¯ä¼šæŠŠæ•´ä¸ªç»“æœé›†è¿”å›å®¢æˆ·ç«¯ï¼› å‡½æ•°å£°æ˜ä¸­å¢åŠ ä¸€ä¸ªResultHandlerç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¹Ÿæ”¹æˆäº†voidç±»å‹ã€‚ 2. åŸºäºXMLé…ç½® åŸºäºXMLçš„é…ç½®åœ¨XMLæ–‡ä»¶ä¸­ä¸ä¹‹å‰çš„ä¼ ç»Ÿæ–¹å¼é…ç½®ä¸€ä¸ªæŸ¥è¯¢æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯éœ€è¦å¢åŠ fetchSizeå’ŒresultSetTypeä¸¤ä¸ªé…ç½®é¡¹ä»¥å¯ç”¨MySQLçš„å®¢æˆ·ç«¯æ¸¸æ ‡ï¼š
1&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt; 2&amp;lt;!DOCTYPE mapper PUBLIC &amp;#34;-//mybatis.org//DTD Mapper 3.0//EN&amp;#34; &amp;#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;#34;&amp;gt; 3&amp;lt;mapper namespace=&amp;#34;com.eveus.tap.trade.mapper.OrderMapper&amp;#34;&amp;gt; 4 &amp;lt;select id=&amp;#34;export&amp;#34; fetchSize=&amp;#34;-2147483648&amp;#34; resultSetType=&amp;#34;FORWARD_ONLY&amp;#34; resultType=&amp;#34;com.eveus.tap.trade.po.Order&amp;#34;&amp;gt; 5 SELECT * FROM `tap_order` ${ew.customSqlSegment} 6 &amp;lt;/select&amp;gt; 7&amp;lt;/mapper&amp;gt; åœ¨Mapperç±»ä¸­ï¼Œå®šä¹‰å‡½æ•°æ¥å£å’ŒåŸºäºæ³¨è§£çš„ä¸€æ ·ï¼Œåªæ˜¯ä¸éœ€è¦æ³¨è§£å£°æ˜ã€‚
1public interface OrderMapper extends BaseMapper&amp;lt;Order&amp;gt; { 2 /** 3 * å¯¼å‡ºè®¢å•åŠŸèƒ½ 4 * @param wrapper 5 * @param handler 6 */ 7 //@Select(&amp;#34;select * from tap_order ${ew.customSqlSegment}&amp;#34;) 8 //@Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize = Integer.MIN_VALUE) 9 //@ResultType(Order.class) 10 void export(@Param(&amp;#34;ew&amp;#34;) Wrapper wrapper, ResultHandler&amp;lt;Order&amp;gt; handler); 11} 3. ä½¿ç”¨æ–¹æ³• 1class OrderServiceImpl { 2 public ServiceResult&amp;lt;ExcelByte&amp;gt; export(Wrapper&amp;lt;Order&amp;gt; wrapper) { 3 ExcelExporter exporter = new ExcelExporter(); 4 exporter.addColumn(&amp;#34;è®¢å•å·&amp;#34;).withWidth(40); 5 // æ­¤æ—¶ä½¿ç”¨çš„å°±æ˜¯ResultHandlerå¯¹ç»“æœé›†è¿›è¡Œå¤„ç† 6 this.getBaseMapper().export(wrapper, resultContext -&amp;gt; { 7 Order order = resultContext.getResultObject(); 8 List values = new ArrayList(); 9 values.add(order.getId()); 10 exporter.addRow(values); 11 }); 12 if (exporter.getTotalRows()==0) { 13 return ServiceResult.fail(ResultCode.EXCEL_NO_ROWS); 14 } 15 // è½¬åŒ–ä¸ºbyteæ•°ç»„ 16 ExcelByte excelByte = new ExcelByte(); 17 excelByte.setContent(exporter.toBytes()); 18 exporter.dispose(); 19 return ServiceResult.ok(excelByte); 20 } 21} é™„å½•ã€å‚è€ƒèµ„æ–™ Mybatisæµå¼æŸ¥è¯¢é¿å…OOM ResultHandlerçš„ç”¨æ³• mybatis ResultHandler vs ResultSetHandleråŠè‡ªå®šä¹‰æ‰©å±• MyBatis Plusæ¡ä»¶æ„é€ å™¨ </content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨Pythonå†™ä¸€ä¸ªAlfred Workflow</title>
        <url>https://orchidflower.github.io/2020/08/21/Build-Alfred-workflow-using-python/</url>
        <categories>
          <category>æŠ€å·§</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>Alfred</tag><tag>Workflow</tag>
        </tags>
        <content type="html"> 1. Alfred å’Œ Workflows ä»‹ç» Alfred å·ç§°æ˜¯ Mac ä¸Šæœ€å¼ºå¤§çš„æ•ˆç‡å·¥å…·ï¼Œä¸€ç›´åœ¨ Mac å¹³å°çš„å·¥å…·ç±»ä¸­æ’åæ¦œé¦–ã€‚å®ƒåœ¨Spotlight ï¼ˆ Mac è‡ªå¸¦çš„æœç´¢å’Œå¿«é€Ÿå¯åŠ¨å¼•æ“ï¼‰åŸºç¡€ä¸Šä¼˜åŒ–äº†å¿«é€Ÿå¯åŠ¨ä¸æœç´¢çš„åŠŸèƒ½ï¼Œè¿˜å¼•å…¥äº† Workflows ç­‰å¼ºå¤§çš„æ‰©å±•åŠŸèƒ½ï¼Œä½¿ä¹‹æˆä¸ºäº†ä¸€ä¸ªæ‹¥æœ‰æ— é™è‡ªåŠ¨åŒ–æ½œåŠ›çš„ã€Œå·¥å…·å¹³å°ã€è½¯ä»¶ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°è¿‘ä¹ä¸€åˆ‡æœ‰å…³è‡ªåŠ¨åŒ–çš„æƒ³æ³•ã€‚
Worflows æ˜¯ Alfred çš„é«˜ç«¯åº”ç”¨æ–¹å¼ï¼Œå®ƒä»¥æµçš„æ–¹å¼æ¥è¿›è¡Œå·¥ä½œï¼Œä»è¾“å…¥ -&amp;gt; åŠ¨ä½œ -&amp;gt; è¾“å‡ºï¼Œå°†å„ç§å·¥å…·ä¸²è”åœ¨ä¸€èµ·è¿›è¡Œå·¥ä½œï¼Œéå¸¸å¼€æ”¾ï¼Œç”¨æ¥å°†å„ç§åŠŸèƒ½ä¸²è”èµ·æ¥æ‰§è¡Œï¼Œå¯ä»¥å®šåˆ¶å®Œæˆå„ç§æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œæ½œåŠ›æ— é™ã€‚
è™½ç„¶ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šåˆ«äººå†™å¥½çš„ Workflowï¼Œä½†æ€»æ˜¯ä¸å¤Ÿç”¨ï¼Œæ¯•ç«Ÿå„è‡ªçš„å·æ‡’ç‚¹ä¸åŒï¼Œå› æ­¤æœ‰å¿…è¦å­¦ä¼š Workflow çš„ç¼–å†™ï¼Œå¯ä»¥æ›´å¥½çš„æ»¡è¶³è‡ªå·±çš„è¦æ±‚ã€‚
2. å¼€å§‹å†™ä¸€ä¸ªWorkflows ä»Šå¤©æƒ³å†™ä¸€ä¸ªç”Ÿæˆéšæœºå­—ç¬¦ä¸²çš„Workflowï¼Œå¯é€‰æ¥æ”¶ä¸€ä¸ªé•¿åº¦å‚æ•°ï¼Œç”ŸæˆæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç”±æ•°å­—ã€å­—ç¬¦ã€æ•°å­—&#43;å­—ç¬¦ç­‰æ„æˆã€‚ä¸‹é¢è¯´ä¸€ä¸‹æ•´ä¸ªåˆ›å»ºè¿‡ç¨‹ã€‚
2.1 åˆ›å»ºä¸€ä¸ª Workflows æ‰“å¼€ Alfred çš„ Preferences çª—å£ï¼Œé€‰æ‹© Workflows èœå•ï¼Œç‚¹å‡»ä¸‹é¢çš„â€œ[&#43;]â€æŒ‰é’®ï¼Œå°±èƒ½å¤Ÿåˆ›å»ºæ–°çš„ Workflows äº†ã€‚Alfred æä¾›äº†å¤šç§æ¨¡æ¿å¯ä¾›å‚è€ƒï¼Œé€šå¸¸é€‰æ‹© Workflow Defaults... å°±å¯ä»¥äº†ã€‚ç„¶ååœ¨å¼¹å‡ºçš„çª—å£ä¸­å¡«ä¸Šå¿…è¦çš„ä¿¡æ¯ä¿å­˜å³å¯ã€‚è¿™äº›ä¿¡æ¯åœ¨ä½ å‘å¸ƒè¿™ä¸ª Workflow çš„æ—¶å€™å¯ä»¥æ›´å¥½çš„æè¿°å®ƒçš„ä½œè€…ã€åŠŸèƒ½ç­‰ä¿¡æ¯ï¼Œå¦‚æœè‡ªå·±ä½¿ç”¨çš„è¯ï¼Œéšä¾¿å¡«ä¸€ä¸‹ä¹Ÿæ— æ‰€è°“ï¼š
2.2 ä¸€äº›æ¦‚å¿µ ä¸€ä¸ªWorkflowä¸­å¯ä»¥æ·»åŠ å¤šç§ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚Triggers, Inputsç­‰ç­‰ï¼Œä»–ä»¬çš„å…·ä½“åŠŸèƒ½å¯ä»¥å‚è€ƒå®˜ç½‘çš„å¸®åŠ©ä¿¡æ¯ï¼š
Triggers: Activate Alfred from a hotkey, another Alfred feature or an external source. ç®€å•çš„è¯´Triggersçš„ç”¨é€”å°±æ˜¯é€šè¿‡çƒ­é”®æˆ–è€…å…¶ä»–æ–¹å¼å¯åŠ¨Alfredï¼Œè¿›è€Œå¯åŠ¨Workflowã€‚
Inputs: Keyword-based objects used to perform an action, on its own or followed by a query. Inputsé€šè¿‡ä¸€ä¸ªå®šä¹‰çš„å…³é”®å­—å¯¹è±¡æ¥æ‰§è¡Œä¸€ä¸ªactionï¼Œè¿™ä¸ªå…³é”®å­—å¯ä»¥å¸¦æŸ¥è¯¢å‚æ•°ä¹Ÿå¯ä»¥ä¸å¸¦ã€‚ä¾‹å¦‚ä½ å®šä¹‰å…³é”®å­—mcï¼Œé‚£ä¹ˆåœ¨Alfredæœç´¢æ¡†ä¸­è¾“å…¥mcå°±å¯ä»¥å¯åŠ¨è¿™ä¸ªåŠŸèƒ½ã€‚
Actions: The objects that do most of the work in your workflows; opening or revealing files and web searches, running scripts and performing commands. Actionså¯¹è±¡åœ¨workflowsä¸­è´Ÿè´£å®Œæˆç»å¤§å¤šæ•°çš„å·¥ä½œï¼Œä¾‹å¦‚å¯ä»¥æ‰“å¼€æ–‡ä»¶ï¼Œæ‰“å¼€æœç´¢ï¼Œæ‰§è¡Œè„šæœ¬ç­‰ç­‰ã€‚
Utilities: Utilities give you control over how your objects are connected together and how the arguments output by the previous object is passed on to the next object. Utilitieså¯ä»¥è®©ä½ æ§åˆ¶ä½ çš„å¯¹è±¡å¦‚ä½•è¿æ¥åœ¨ä¸€èµ·å·¥ä½œï¼Œæ§åˆ¶å‚æ•°å¦‚ä½•åœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’ã€‚è¿™ä¸ªå¯¹è±¡æˆ‘ç”¨çš„ä¸å¤šã€‚
Outputs: Collect the information from the earlier objects in your workflow to pop up a Notification Centre message, show output in Large Type, copy to clipboard or run a script containing the result of your workflow. Outputså¯¹è±¡è´Ÿè´£ä»ä½ çš„Workflowä¸­çš„å‰ä¸€ä¸ªå¯¹è±¡ä¸­æ”¶é›†ä¿¡æ¯ï¼Œç„¶åçœŸæ­£è¾“å‡ºåˆ°ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªè¾“å‡ºå¯èƒ½æ˜¯ï¼šå¼¹å‡ºä¸€ä¸ªé€šæ‰˜ç›˜é€šçŸ¥ï¼Œæ‹·è´åˆ°å‰ªè´´æ¿ï¼Œå†™ä¸€ä¸ªæ–‡ä»¶ï¼Œæ’­æ”¾ä¸€ä¸ªå£°éŸ³ç­‰ç­‰ã€‚
è¿™äº›å¯¹è±¡ä¸æ˜¯éƒ½è¦ç”¨åˆ°ï¼Œå¸¸ç”¨çš„æœ‰Script Filterï¼ˆInputsï¼‰ï¼ŒKeywordï¼ˆInputsï¼‰ã€Run Scriptï¼ˆActionsï¼‰ç­‰å‡ ä¸ªã€‚
è¿™æ¬¡è¦å†™ä¸€ä¸ªç”Ÿæˆéšæœºå­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œä¸»è¦ç”¨åˆ°ä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯ Script Filter å’Œ Copy to Clipboard ã€‚å…¶ä¸­ Script Filter è´Ÿè´£ç”Ÿæˆéšæœºæ•°ï¼ŒCopy to Clipboard è´Ÿè´£å°†è¢«é€‰ä¸­çš„éšæœºæ•°æ‹·è´åˆ°å‰ªåˆ‡æ¿ã€‚
2.3 Script Filterçš„ä¸€äº›è¯´æ˜ Script Filterçš„è¾“å‡ºç»“æœéœ€è¦ç¬¦åˆç‰¹å®šçš„æ ¼å¼æ‰èƒ½å¤Ÿè¢«Alfredè¯†åˆ«å¹¶è§£æå‡ºæ¥ã€‚è¿™ä¸ªæ ¼å¼å¯ä»¥æ˜¯xmlï¼Œä¹Ÿå¯ä»¥æ˜¯jsonã€‚å®˜æ–¹æ¨èç”¨jsonæ ¼å¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š
1{ 2 &amp;#34;items&amp;#34;: [ 3 { 4 &amp;#34;arg&amp;#34;: &amp;#34;7RWa7SASoDVjuv45&amp;#34;, 5 &amp;#34;title&amp;#34;: &amp;#34;7RWa7SASoDVjuv45&amp;#34;, 6 &amp;#34;subtitle&amp;#34;: &amp;#34;å­—æ¯åŠ æ•°å­—&amp;#34;, 7 &amp;#34;icon&amp;#34;: &amp;#34;&amp;#34; 8 }, 9 { 10 &amp;#34;arg&amp;#34;: &amp;#34;2550619258781486&amp;#34;, 11 &amp;#34;title&amp;#34;: &amp;#34;2550619258781486&amp;#34;, 12 &amp;#34;subtitle&amp;#34;: &amp;#34;æ•°å­—&amp;#34;, 13 &amp;#34;icon&amp;#34;: &amp;#34;&amp;#34; 14 }, 15 ... 16 ] 17} åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼Œitemsæ˜¯ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„å†…å®¹å°±æ˜¯å¤šæ¡è¦è¢«æ˜¾ç¤ºå‡ºæ¥çš„è®°å½•ã€‚æ¯æ¡è®°å½•ä¸­ï¼Œå…³é”®çš„å‡ ä¸ªå­—æ®µä¸ºï¼š
arg è¿™ä¸ªå€¼éå¸¸é‡è¦ï¼Œè¢«é€‰ä¸­é¡¹ç›®çš„argå€¼å°†è¢«ä¼ é€’åˆ°åç»­çš„actionä¸­ï¼›å®˜æ–¹çš„è§£é‡Šå¦‚ä¸‹ï¼š The argument which is passed through the workflow to the connected output action. While the arg attribute is optional, it&amp;rsquo;s highly recommended that you populate this as it&amp;rsquo;s the string which is passed to your connected output actions. If excluded, you won&amp;rsquo;t know which result item the user has selected.
title åœ¨Alfredç»“æœæ ä¸­æ˜¾ç¤ºçš„å†…å®¹ï¼Œæ˜¯å¿…é¡»çš„é€‰é¡¹ï¼Œé€šå¸¸è¿™ä¸ªå€¼ä¸argç›¸åŒï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºçš„å€¼ä¹Ÿæ˜¯è¦è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ªactionä¸­çš„å€¼ã€‚å®˜æ–¹è§£é‡Šå¦‚ä¸‹ï¼š The title displayed in the result row. There are no options for this element and it is essential that this element is populated.
subtitle å¯¹titleçš„ä¸€ä¸ªè§£é‡Šæ€§ä¿¡æ¯ï¼Œåœ¨ä¸»è¦å†…å®¹ä¸‹é¢ä»¥å°å­—æ˜¾ç¤ºï¼›å®˜æ–¹è¯´æ˜å¦‚ä¸‹ï¼š The subtitle displayed in the result row. This element is optional.
icon æ˜¯å›¾æ ‡ã€‚ä¸ºç©ºçš„è¯å°±ç”¨workflowæœ¬èº«çš„å›¾æ ‡ä»£æ›¿ã€‚ ä¸Šé¢çš„ç»“æœæ˜¾ç¤ºçš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š 2.4 æ·»åŠ ä¸€ä¸ª Script Filter åœ¨ Workflow å·¥ä½œåŒºä¸­ç‚¹å³é”®ï¼Œåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©å¥½ Script Filter æ·»åŠ å³å¯ã€‚Alfred é»˜è®¤çš„Python æ˜¯2.7ç‰ˆæœ¬ï¼Œå› ä¸ºè¦ç”¨åˆ°3.xç‰ˆæœ¬ï¼Œæ‰€ä»¥åœ¨ Language ä¸­é€‰æ‹©äº† External Scriptï¼Œç„¶åé€‰æ‹©æ–°å»ºä¸€ä¸ªè„šæœ¬å³å¯ã€‚
2.5 æ·»åŠ ä¸€ä¸ªCopy to Clipboard æœ€åæ·»åŠ ä¸€ä¸ª Copy to Clipboard å¯¹è±¡ï¼Œé…ç½®å¦‚å›¾å³å¯ï¼Œä¸éœ€è¦è‡ªå·±ç¼–å†™ä»»ä½•ä»£ç å°±èƒ½å¤ŸæŠŠé€‰ä¸­çš„é¡¹ç›®æ‹·è´åˆ°å‰ªè´´æ¿ï¼š
3. æœ€ç»ˆä»£ç  ä¸‹é¢ä»£ç æ˜¯Script Filterä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œè´Ÿè´£ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œå¹¶ç»„è£…æˆç‰¹å®šæ ¼å¼çš„JSONå­—ç¬¦ä¸²ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ä¸­ã€‚ä»£ç æ¯”è¾ƒç›´è§‚ï¼Œå°±ä¸åšè¿‡å¤šè§£è¯»äº†ã€‚
1#!/usr/bin/python3 2 3import sys 4import json 5import random 6from datetime import datetime, timezone 7#from workflow import Workflow 8 9TABLES = [ 10	&amp;#34;1234567890&amp;#34;, 11	&amp;#34;1234567890abcdef&amp;#34;, 12	&amp;#34;1234567890ABCDEF&amp;#34;, 13	&amp;#34;1234567890ABCDEFabcdef&amp;#34;, 14	&amp;#34;1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&amp;#34; 15] 16 17def addItem(items, itemValue, itemTitle): 18	item = { 19	&amp;#39;arg&amp;#39;: itemValue, 20	&amp;#39;title&amp;#39;: itemValue, 21	&amp;#39;subtitle&amp;#39;: itemTitle, 22	&amp;#39;icon&amp;#39;: &amp;#39;&amp;#39; 23	} 24	items.append(item) 25 26def randString(tableStr, length): 27	ret = &amp;#39;&amp;#39; 28	for i in range(length): 29	ret &#43;= random.choice(tableStr) 30	return ret 31 32def main(): 33	randomLength = 16 34 35	if len(sys.argv)&amp;gt;1: 36	randomLength = int(sys.argv[1]) 37 38	items = [] 39 40	addItem(items, randString(TABLES[4], randomLength), &amp;#39;å­—æ¯åŠ æ•°å­—&amp;#39;) 41	addItem(items, randString(TABLES[0], randomLength), &amp;#39;æ•°å­—&amp;#39;) 42	addItem(items, randString(TABLES[1], randomLength), &amp;#39;å°å†™16è¿›åˆ¶&amp;#39;) 43	addItem(items, randString(TABLES[2], randomLength), &amp;#39;å¤§å†™16è¿›åˆ¶&amp;#39;) 44	addItem(items, randString(TABLES[3], randomLength), &amp;#39;16è¿›åˆ¶&amp;#39;) 45	46 47	print(json.dumps({&amp;#39;items&amp;#39;: items})) 48 49 50if __name__ == &amp;#39;__main__&amp;#39;: 51	#wf = Workflow() 52	#sys.exit(wf.run(main)) 53 54	main() 4. è°ƒè¯•åŠæ’é”™ åˆšå¼€å§‹å†™ Workflow çš„æ—¶å€™éš¾å…ä¼šç¢°åˆ°é—®é¢˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œè°ƒè¯•å’Œæ’é”™äº†ã€‚é¦–å…ˆå¯ä»¥æ‰¾åˆ° Workflow çš„ç›®å½•åœ¨å“ªé‡Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œè‡ªå·±å†™çš„è„šæœ¬ï¼Œçœ‹çœ‹ç»“æœæ€ä¹ˆæ ·ã€‚å¯ä»¥é€šè¿‡åœ¨Workflowä¸Šç‚¹å³é”®é€‰æ‹©Open in Finderï¼ŒOpen in Terminalç­‰åŠŸèƒ½æ‰¾åˆ°è„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚
å¦å¤–ï¼ŒAlfredæ‰§è¡Œçš„æ—¶å€™ä¼šæŠŠè¾“å…¥è¾“å‡ºå†…å®¹éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œå¯ä»¥é€šè¿‡Alfredå†…ç½®çš„æ§åˆ¶å°çœ‹åˆ°è¿™äº›äº¤äº’å†…å®¹ï¼Œæ–¹æ³•æ˜¯ç‚¹å‡»å³ä¸Šè§’çš„BUGå›¾æ ‡ï¼Œå°±èƒ½å¤Ÿåœ¨æ‰“å¼€æ§åˆ¶å°äº†ã€‚è¿™æ—¶æ‰§è¡Œç»“æœåŒ…æ‹¬é”™è¯¯ä¿¡æ¯ä¹‹ç±»çš„éƒ½ä¼šæ˜¾ç¤ºåœ¨é‡Œé¢ã€‚
</content>
    </entry>
    
     <entry>
        <title>Macä¼‘çœ æ¨¡å¼è°ƒæ•´</title>
        <url>https://orchidflower.github.io/2020/08/11/How-to-change-hibernate-mod-for-Mac/</url>
        <categories>
          <category>æŠ€å·§</category>
        </categories>
        <tags>
          <tag>Mac</tag>
        </tags>
        <content type="html"> æ‰‹å¤´çš„Macå·²ç»ç”¨äº†ä¸‰å¹´äº†ï¼Œä¹‹å‰åˆç›–ç¡çœ çš„æ—¶å€™æ„Ÿè§‰æ‰ç”µè¿˜ä¸æ˜æ˜¾ï¼Œæœ€è¿‘å‡ æ¬¡ç³»ç»Ÿå‡çº§åæ„Ÿè§‰æ‰ç”µçš„æƒ…å†µæ˜æ˜¾äº†ï¼Œä¸€ä¸ªæ™šä¸Šä¼šæ‰5%å·¦å³ï¼Œè™½ç„¶ä¸å¤šï¼Œä½†æ˜¯è¿˜æ˜¯ä¸çˆ½ã€‚ ç»è¿‡æœç´¢ï¼Œå‘ç°å¯ä»¥é€šè¿‡ä¿®æ”¹ä¼‘çœ æ¨¡å¼ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚
1. pmsetåŠå‚æ•°ä»‹ç» pmsetæ˜¯Macçš„ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹å’Œç”µæºç®¡ç†ç›¸å…³çš„å‚æ•°ã€‚çœ‹manä¸­çš„å¸®åŠ©ï¼š
pmset can modify the values of any of the power management settings defined below. You may specify one or more setting &amp;amp; value pairs on the command-line invocation of pmset. The -a, -b, -c, -u flags determine whether the settings apply to battery ( -b ), charger (wall power) ( -c ), UPS ( -u ) or all ( -a ).
ç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥é€šè¿‡pmset -bæˆ–pmset -c,pmset -aç­‰å‘½ä»¤ä¿®æ”¹ç”µæºé…ç½®å‚æ•°ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡pmset -gå‘½ä»¤æŸ¥è¯¢å½“å‰çš„é…ç½®å‚æ•°æˆ–æ—¥å¿—ç­‰ã€‚ä¾‹å¦‚ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ç”µæºç›¸å…³é…ç½®ï¼š
1&amp;gt; pmset -g custom 2Battery Power: 3 lidwake 1 4 autopoweroff 1 5 standbydelayhigh 1800 6 autopoweroffdelay 28800 7 standbydelaylow 600 8 standby 1 9 proximitywake 0 10 ttyskeepawake 1 11 hibernatemode 3 12 powernap 0 13 gpuswitch 2 14 hibernatefile /var/vm/sleepimage 15 highstandbythreshold 95 16 displaysleep 2 17 sleep 1 18 acwake 0 19 halfdim 1 20 tcpkeepalive 1 21 lessbright 1 22 disksleep 10 23AC Power: 24 lidwake 1 25 autopoweroff 1 26 standbydelayhigh 86400 27 autopoweroffdelay 28800 28 standbydelaylow 10800 29 standby 1 30 proximitywake 1 31 ttyskeepawake 1 32 hibernatemode 3 33 powernap 1 34 gpuswitch 2 35 hibernatefile /var/vm/sleepimage 36 highstandbythreshold 50 37 displaysleep 10 38 womp 1 39 networkoversleep 0 40 sleep 10 41 tcpkeepalive 1 42 halfdim 1 43 acwake 0 44 disksleep 10 è¦ä¿®æ”¹Macçš„ä¼‘çœ ç›¸å…³é…ç½®ï¼Œéœ€è¦ç”¨åˆ°pmsetå‘½ä»¤ï¼Œå…¶ä¸­ä¸ä¼‘çœ ç›¸å…³çš„å‡ ä¸ªå…³é”®å‚æ•°æœ‰ï¼šhibernatemodeï¼Œstandbyï¼Œhighstandbythresholdï¼Œstandbydelayhighï¼Œstandbydelaylowã€‚æœ‰å…³è¿™å‡ ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰ä¸ç”¨é€”ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹manå¸®åŠ©ä¸­çš„æè¿°ã€‚
1.1 SAFE SLEEP ARGUMENTS hibernatemode supports values of 0, 3, or 25. Whether or not a hibernation image gets written is also dependent on the values of standby and autopoweroff
For example, on desktops that support standby a hibernation image will be written after the specified standbydelay time. To disable hibernation images completely, ensure hibernatemode standby and autopoweroff are all set to 0.
hibernatemode = 0 by default on desktops. The system will not back memory up to persistent storage. The system must wake from the contents of memory; the system will lose context on power loss. This is, historically, plain old sleep.
hibernatemode = 3 by default on portables. The system will store a copy of memory to persistent storage (the disk), and will power memory during sleep. The system will wake from memory, unless a power loss forces it to restore from hibernate image.
hibernatemode = 25 is only settable via pmset. The system will store a copy of memory to persistent storage (the disk), and will remove power to memory. The system will restore from disk image. If you want &amp;ldquo;hibernation&amp;rdquo; - slower sleeps, slower wakes, and better battery life, you should use this setting.
Please note that hibernatefile may only point to a file located on the root volume.
1.2 STANDBY ARGUMENTS standby causes kernel power management to automatically hibernate a machine after it has slept for a specified time period. This saves power while asleep. This setting defaults to ON for supported hardware. The setting standby will be visible in pmset -g if the feature is supported on this machine.
standbydelayhigh and standbydelaylow specify the delay, in seconds, before writing the hibernation image to disk and powering off memory for Standby. standbydelayhigh is used when the remaining battery capacity is above highstandbythreshold , and standbydelaylow is used when the remaining battery capacity is below highstandbythreshold.
highstandbythreshold has a default value of 50 percent.
autopoweroff is enabled by default on supported platforms as an implementation of Lot 6 to the European Energy- related Products Directive. After sleeping for seconds, the system will write a hibernation image and go into a lower power chipset sleep. Wakeups from this state will take longer than wakeups from regular sleep.
autopoweroffdelay specifies the delay, in seconds, before entering autopoweroff mode.
2. è§£é‡Š æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼š
macOS é»˜è®¤çš„ç¡çœ ï¼Œä¼šå…³é—­å±å¹•ï¼Œä½†ä¼šç»´æŒå¯¹å†…å­˜ï¼ˆRAMï¼‰çš„ä¾›ç”µã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€æ—¦æ‰“å¼€ç›–å­ï¼ŒmacOS å°±èƒ½ç«‹å³æ¢å¤ã€‚è‹¥æ˜¯ç”µæ± ç”µé‡ä½äºæŸä¸ªé¢„è®¾é˜ˆå€¼ï¼Œåˆ™ä¼šå°†å†…å­˜ä¸­çš„æ•°æ®è½¬å‚¨åˆ°ç¡¬ç›˜ï¼Œè€Œåå½»åº•æ–­ç”µã€‚
å¯¹åº”çš„ï¼ŒmacOS çš„ç¡çœ æœ‰ä¸¤ç§çŠ¶æ€ï¼š
ä¸æ–­ç”µï¼Œæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤ã€‚æˆ‘ä»¬ç§°è¿™ç§çŠ¶æ€ä¸ºç¡çœ ï¼ˆSleepï¼‰ï¼› æ–­ç”µï¼Œæ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œæ¢å¤å¾—è¾ƒæ…¢ã€‚æˆ‘ä»¬ç§°è¿™ç§çŠ¶æ€ä¸ºä¼‘çœ ï¼ˆHibernate/Stand-byï¼‰ã€‚ ç¡çœ å’Œä¼‘çœ å¯ä»¥ç»„åˆå‡ºä¸‰ç§æ¨¡å¼ï¼Œç”± hibernatemode æ§åˆ¶
hibernatemode = 0ï¼Œè¿™æ˜¯æ¡Œé¢è®¾å¤‡çš„é»˜è®¤å€¼ã€‚ç³»ç»Ÿåªç¡çœ ï¼Œä¸ä¼‘çœ ï¼Œä¸å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼› hibernatemode = 3ï¼Œè¿™æ˜¯ç§»åŠ¨è®¾å¤‡çš„é»˜è®¤å€¼ã€‚ç³»ç»Ÿé»˜è®¤ç¡çœ ï¼Œåœ¨ä¸€å®šæ—¶é—´åæˆ–ç”µé‡ä½äºé˜ˆå€¼å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œè€Œåä¼‘çœ ã€‚è¿™æ˜¯æ‰€è°“çš„å®‰å…¨ç¡çœ ï¼ˆSafe-Sleepï¼‰ï¼› hibernatemode = 25ã€‚åªä¼‘çœ ï¼Œä¸ç¡çœ ã€‚è¿™ç§æ¨¡å¼åªèƒ½é€šè¿‡pmsetè¿›è¡Œè®¾ç½®ã€‚ æ— è®ºæ˜¯å®‰å…¨ç¡çœ æ¨¡å¼è¿˜æ˜¯ä¼‘çœ æ¨¡å¼ï¼Œä»ç£ç›˜ä¸Šæ¢å¤æ—¶ï¼Œéƒ½ä¼šéœ€è¦ä¸€å®šçš„æ—¶é—´å±å¹•æ‰ä¼šè¢«ç‚¹äº®ã€‚
å¯¹äºå®‰å…¨ç¡çœ æ¨¡å¼ï¼Œåˆæœ‰å‡ ä¸ªå‚æ•°å¯ä»¥æ¥è¿›è¡Œå¾®è°ƒï¼š
å½“å‰©ä½™ç”µé‡å¤§äº highstandbythresholdï¼ˆé»˜è®¤ 50%ï¼‰æ—¶ï¼Œåœ¨ standbydelayhigh ç§’ï¼ˆé»˜è®¤ 86,400ï¼Œå³ä¸€æ•´å¤©ï¼‰åè¿›å…¥ä¼‘çœ ã€‚ å½“å‰©ä½™ç”µé‡å°äº highstandbythreshold æ—¶ï¼Œåœ¨ standbydelaylow ç§’ï¼ˆé»˜è®¤ 10,800ï¼Œå³ä¸‰å°æ—¶ï¼‰åè¿›å…¥ä¼‘çœ ã€‚ 3. ä¿®æ”¹ä¸€ä¸‹ æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹ï¼š
1# ä½¿ç”¨-bé™å®šåªä¿®æ”¹ç”µæ± ä¾›ç”µçš„æƒ…å†µä¸‹çš„é…ç½®ï¼Œå› ä¸ºæ™šä¸Šç¡çœ çš„æ—¶å€™ä¸æ’ç”µæº 2# hibernatemodeè®¾ç½®ä¸ºå®‰å…¨ç¡çœ æ¨¡å¼ 3pmset -b hibernatemode 3 4# ç”µé‡é˜ˆå€¼è®¾ç½®ä¸º95% 5pmset -b highstandbythreshold 95 6# ç”µé‡è¶…è¿‡95%çš„æ—¶å€™ä¼‘çœ å‰ç­‰å¾…30åˆ†é’Ÿ 7pmset -b standbydelayhigh 1800 8# ç”µé‡ä½äº95%çš„æ—¶å€™ä¼‘çœ å‰ç­‰å¾…10åˆ†é’Ÿ 9pmset -b standbydelaylow 600 10# è‡ªåŠ¨æ–­ç”µæ—¶é—´é™å®šä¸º30åˆ†é’Ÿ 11pmset -b autopoweroffdelay 1800 </content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨KeepAlivedé…ç½®Nginxé«˜å¯ç”¨</title>
        <url>https://orchidflower.github.io/2020/07/20/Use-keepalived-for-high-availability-support-for-nginx/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Ubuntu</tag><tag>Nginx</tag><tag>KeepAlived</tag><tag>é«˜å¯ç”¨</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ æœ€è¿‘ä¸ºä¸€ä¸ªä¼ ç»Ÿè¡Œä¸šçš„å®¢æˆ·å¼€å‘äº†ä¸€ä¸ªç”Ÿäº§è°ƒåº¦ç³»ç»Ÿã€‚ä½†æ˜¯ä»–çš„ç”Ÿäº§ç¯å¢ƒæ˜¯è‡ªå·±æ­å»ºçš„ï¼Œä¸æ˜¯è´­ä¹°çš„äº‘æœåŠ¡ï¼Œå› æ­¤ç¢°åˆ°äº†ä¸€äº›é—®é¢˜ã€‚
å®¢æˆ·è´­ä¹°äº†å¤šå°é«˜æ€§èƒ½çš„ç‰©ç†æœºï¼Œåœ¨ä¸Šé¢è‡ªè¡Œæ­å»ºè™šæ‹Ÿæœºã€‚ä½†æ˜¯åªæœ‰è™šæ‹Ÿæœºï¼Œæ²¡æœ‰æä¾›ç±»ä¼¼è´Ÿè½½å‡è¡¡ã€æ•°æ®åº“ç­‰åŸºç¡€æœåŠ¡ã€‚ä¸ºäº†è§£å†³è´Ÿè½½å‡è¡¡é—®é¢˜ï¼Œæˆ‘ä»¬è‡ªè¡Œå®‰è£…äº† Nginx ã€‚ä¸ºäº†ä¿è¯ç³»ç»Ÿå¥å£®å’Œæ€§èƒ½ï¼Œå®‰è£… Nginx çš„ä¸¤å°è™šæ‹Ÿæœºï¼ˆUbuntu 18.04.3 LTSï¼Œ172.16.45.22ï¼Œ172.16.45.26ï¼‰åˆ†åˆ«éƒ¨ç½²åœ¨ä¸¤å°ä¸åŒçš„ç‰©ç†æœºä¸Šï¼ˆ172.16.45.11ï¼Œ 172.168.45.12ï¼‰ã€‚ç„¶å DNS è§£æåˆ°ä¸¤å° Nginx ä¸»æœºä¸Šã€‚
ç°åœ¨çš„é—®é¢˜æ˜¯ï¼šå®¢æˆ·çš„è¦æ±‚æ˜¯ä»»ä½•ä¸€å°ç‰©ç†æœºå‡ºç°é—®é¢˜éƒ½è¦èƒ½å¤Ÿä¿è¯ç³»ç»Ÿå¯ç”¨ï¼ŒéªŒè¯çš„æ–¹å¼æ˜¯æµ‹è¯•çš„æ—¶å€™ä¼šç›´æ¥æ–­å¼€ç‰©ç†æœºçš„ç½‘çº¿ï¼Œè¿™å°†å¯¼è‡´é€šè¿‡ DNS è§£æå‡ºæ¥çš„ Nginx ä¸»æœºå¿…ç„¶æœ‰ä¸€å°æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚è®¿é—®æ˜¾ç„¶ä¼šå‡ºé—®é¢˜ã€‚
ç»è¿‡è€ƒè™‘ï¼Œæœ€åé€‰å®šè§£å†³åŠæ³•æ˜¯ï¼šä½¿ç”¨ KeepAlived åšé«˜å¯ç”¨ï¼Œä¸¤å° Nginx å…±åŒç»´æŠ¤ä¸€ä¸ªè™šæ‹ŸIPï¼ˆ172.16.45.50ï¼‰ï¼ŒDNS è§£æåˆ°è¿™ä¸ªè™šæ‹ŸIPä¸Šã€‚
è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹å®‰è£… KeepAlived çš„è¿‡ç¨‹ä»¥åŠç¢°åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚
2.å®‰è£…KeepAlived åœ¨ Ubuntu ä¸Šå®‰è£… KeepAlived éå¸¸ç®€å•ï¼š
1apt install keepalived å®‰è£…çš„ç‰ˆæœ¬æ˜¯1.3.9ã€‚ä¸ç®—æ–°ï¼Œä½†æ˜¯åº”è¯¥å¤Ÿç”¨ã€‚
3. é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶åä½ç½®ä¸ºï¼š/etc/keepalived/keepalived.confï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒKeepAlived å°†ä¸èƒ½å¤Ÿå¯åŠ¨ï¼Œè¯·è‡ªè¡Œåˆ›å»ºè¯¥æ–‡ä»¶ã€‚
1! Configuration File for keepalived 2# Global definitions configuration block 3global_defs { 4 # String identifying the machine (doesn&amp;#39;t have to be hostname). 5 # (default: local host name) 6 router_id server01 7} 8 9# A VRRP Instance is the VRRP protocol key feature. It defines and con- 10# figures VRRP behaviour to run on a specific interface. Each VRRP 11# Instances are related to a uniq interface. 12vrrp_instance VI_1 { 13 # Initial state, MASTER|BACKUP 14 # As soon as the other machine(s) come up, 15 # an election will be held and the machine 16 # with the highest priority will become MASTER. 17 # So the entry here doesn&amp;#39;t matter a whole lot. 18 state MASTER 19 # interface for inside_network, bound by vrrp 20 interface eth0 21 # arbitrary unique number from 1 to 255 22 # used to differentiate multiple instances of vrrpd 23 # running on the same NIC (and hence same socket). 24 virtual_router_id 50 25 # for electing MASTER, highest priority wins. 26 # to be MASTER, make this 50 more than on other machines. 27 priority 100 28 # VRRP Advert interval in seconds (e.g. 0.92) (use default) 29 advert_int 1 30 # Note: authentication was removed from the VRRPv2 specification by 31 # RFC3768 in 2004. 32 # Use of this option is non-compliant and can cause problems; avoid 33 # using if possible, except when using unicast, where it can be helpful. 34 authentication { 35 # PASS|AH 36 # PASS - Simple password (suggested) 37 # AH - IPSEC (not recommended)) 38 auth_type PASS 39 # Password for accessing vrrpd. 40 # should be the same on all machines. 41 # Only the first eight (8) characters are used. 42 auth_pass Password@123 43 } 44 # addresses add|del on change to MASTER, to BACKUP. 45 # With the same entries on other machines, 46 # the opposite transition will be occurring. 47 # For virutal_ipaddress, virtual_ipaddress_excluded, 48 # virtual_routes and virtual_rules most of the options 49 # match the options of the command ip address/route/rule add. 50 # The track_group option only applies to static addresses/routes/rules. 51 # no_track is specific to keepalived and means that the 52 # vrrp_instance will not transition out of master state 53 # if the address/route/rule is deleted and the address/route/rule 54 # will not be reinstated until the vrrp instance next transitions 55 # to master. 56 # &amp;lt;LABEL&amp;gt;: is optional and creates a name for the alias. 57 For compatibility with &amp;#34;ifconfig&amp;#34;, it should 58 be of the form &amp;lt;realdev&amp;gt;:&amp;lt;anytext&amp;gt;, for example 59 eth0:1 for an alias on eth0. 60 # &amp;lt;SCOPE&amp;gt;: (&amp;#34;site&amp;#34;|&amp;#34;link&amp;#34;|&amp;#34;host&amp;#34;|&amp;#34;nowhere&amp;#34;|&amp;#34;global&amp;#34;) 61 virtual_ipaddress { 62 172.16.45.50 63 } 64} ä¸»è¦é…ç½®å‚æ•°å¯ä»¥å‚è€ƒå…¶ä¸­çš„æ³¨é‡Šè¯´æ˜ã€‚å‡ ä¸ªå…³é”®å‚æ•°ç®€å•è¯´ä¸€ä¸‹ï¼š
state ç”¨äºæŒ‡å®šå½“å‰ä¸»æœºçš„åœ¨ KeepAlived ä¸­çš„åˆå§‹çŠ¶æ€ã€‚å¯ä»¥ä¸º MASTER å’Œ BACKUP ã€‚è™šæ‹ŸIPå°†ç»‘å®šåœ¨ MASTER ä¸Šï¼› interface æŒ‡å®šç»‘å®šçš„ç½‘å¡ï¼› vrrp_instance å®šä¹‰ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œè¿™æ˜¯ KeepAlived å®šä¹‰çš„ä¸€ä¸ªåŸºæœ¬å•ä½ï¼› virtual_ipaddress æŒ‡å®šç»‘å®šçš„è™šæ‹ŸIPã€‚è™šæ‹ŸIPä¼šæ ¹æ®ç½‘ç»œæƒ…å†µåœ¨ MASTER å’Œ BACKUP ä¹‹é—´æ¼‚ç§»ï¼› æ”¹å®Œé…ç½®æ–‡ä»¶ä¹‹åä½¿ç”¨å‘½ä»¤ï¼šservice keepalived restarté‡å¯æœåŠ¡å³å¯ã€‚
4. éªŒè¯ ä½¿ç”¨ip addr show eth0æŸ¥çœ‹ç½‘å¡çš„IPåœ°å€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰MASTERä¸Šé¢ä¼šæœ‰æ–°å¢çš„è™šæ‹ŸIPã€‚ ä½¿ç”¨service keepalived stopåœæ‰ä¸»èŠ‚ç‚¹çš„ KeepAlivedï¼Œç„¶åå°±ä¼šå‘ç°è™šæ‹ŸIPå‡ºç°åœ¨ BACKUP èŠ‚ç‚¹ä¸Šæ¥ã€‚å†æ¬¡å¯åŠ¨ MASTER ä¸Šçš„ KeepAlived ï¼Œè™šæ‹ŸIPåˆä¼šå‡ºç°åœ¨ MASTER èŠ‚ç‚¹ä¸Šã€‚ æ—¥å¿—å¦‚ä¸‹ï¼š MASTER èŠ‚ç‚¹ï¼š
1Jan 09 16:56:18 server01 systemd[1]: Stopping Keepalive Daemon (LVS and VRRP)... 2Jan 09 16:56:18 server01 Keepalived[2360]: Stopping 3Jan 09 16:56:18 server01 Keepalived_vrrp[2367]: VRRP_Instance(VI_1) sent 0 priority 4Jan 09 16:56:18 server01 Keepalived_healthcheckers[2366]: Stopped 5Jan 09 16:56:19 server01 Keepalived_vrrp[2367]: Stopped 6Jan 09 16:56:19 server01 Keepalived[2360]: Stopped Keepalived v1.3.9 (10/21,2017) 7Jan 09 16:56:19 server01 systemd[1]: Stopped Keepalive Daemon (LVS and VRRP). 8Jan 09 16:56:19 server01 systemd[1]: Starting Keepalive Daemon (LVS and VRRP)... 9Jan 09 16:56:19 server01 Keepalived[2408]: Starting Keepalived v1.3.9 (10/21,2017) 10Jan 09 16:56:19 server01 Keepalived[2408]: Opening file &amp;#39;/etc/keepalived/keepalived.conf&amp;#39;. 11Jan 09 16:56:19 server01 systemd[1]: Started Keepalive Daemon (LVS and VRRP). 12Jan 09 16:56:19 server01 Keepalived[2412]: Starting Healthcheck child process, pid=2416 13Jan 09 16:56:19 server01 Keepalived_healthcheckers[2416]: Opening file &amp;#39;/etc/keepalived/keepalived.conf&amp;#39;. 14Jan 09 16:56:19 server01 Keepalived[2412]: Starting VRRP child process, pid=2418 15Jan 09 16:56:19 server01 Keepalived_vrrp[2418]: Registering Kernel netlink reflector 16Jan 09 16:56:19 server01 Keepalived_vrrp[2418]: Registering Kernel netlink command channel 17Jan 09 16:56:19 server01 Keepalived_vrrp[2418]: Registering gratuitous ARP shared channel 18Jan 09 16:56:19 server01 Keepalived_vrrp[2418]: Opening file &amp;#39;/etc/keepalived/keepalived.conf&amp;#39;. 19Jan 09 16:56:19 server01 Keepalived_vrrp[2418]: Using LinkWatch kernel netlink reflector... 20Jan 09 16:56:19 server01 Keepalived_vrrp[2418]: VRRP_Instance(VI_1) Transition to MASTER STATE 21Jan 09 16:56:20 server01 Keepalived_vrrp[2418]: VRRP_Instance(VI_1) Entering MASTER STATE BACKUP èŠ‚ç‚¹ï¼š
1Jan 09 16:55:16 server02 systemd[1]: Starting Keepalive Daemon (LVS and VRRP)... 2Jan 09 16:55:16 server02 Keepalived[96635]: Starting Keepalived v1.3.9 (10/21,2017) 3Jan 09 16:55:16 server02 Keepalived[96635]: Opening file &amp;#39;/etc/keepalived/keepalived.conf&amp;#39;. 4Jan 09 16:55:16 server02 systemd[1]: Started Keepalive Daemon (LVS and VRRP). 5Jan 09 16:55:16 server02 Keepalived[96644]: Starting Healthcheck child process, pid=96650 6Jan 09 16:55:16 server02 Keepalived_healthcheckers[96650]: Opening file &amp;#39;/etc/keepalived/keepalived.conf&amp;#39;. 7Jan 09 16:55:16 server02 Keepalived[96644]: Starting VRRP child process, pid=96651 8Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: Registering Kernel netlink reflector 9Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: Registering Kernel netlink command channel 10Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: Registering gratuitous ARP shared channel 11Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: Opening file &amp;#39;/etc/keepalived/keepalived.conf&amp;#39;. 12Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: Truncating auth_pass to 8 characters 13Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: Using LinkWatch kernel netlink reflector... 14Jan 09 16:55:16 server02 Keepalived_vrrp[96651]: VRRP_Instance(VI_1) Entering BACKUP STATE 15Jan 09 16:56:18 server02 Keepalived_vrrp[96651]: VRRP_Instance(VI_1) Transition to MASTER STATE 16Jan 09 16:56:19 server02 Keepalived_vrrp[96651]: VRRP_Instance(VI_1) Entering MASTER STATE 17Jan 09 16:56:19 server02 Keepalived_vrrp[96651]: VRRP_Instance(VI_1) Received advert with higher priority 100, ours 50 18Jan 09 16:56:19 server02 Keepalived_vrrp[96651]: VRRP_Instance(VI_1) Entering BACKUP STATE 5. å‰©ä½™é—®é¢˜ è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œä¸Šé¢æ–¹æ¡ˆå®è¡Œåä¼šå¯¼è‡´åªæœ‰ä¸€å° Nginx ç”Ÿæ•ˆï¼Œå¦ä¸€å°ä¸Šå› ä¸ºæ²¡æœ‰ç»‘å®šè™šæ‹ŸIPï¼Œä¸ä¼šè¢«è®¿é—®åˆ°ï¼Œè¿™ç›¸å½“äºå°†ä¸¤å°åŒç­‰åœ°ä½çš„ Nginx å˜æˆäº†ä¸»ä»æ¨¡å¼ã€‚
ä¸€ä¸ªå¯è¡Œçš„è§£å†³åŠæ³•æ˜¯é‡‡ç”¨åŒä¸»æ¨¡å¼éƒ¨ç½² KeepAlivedã€‚æ–¹æ³•æ˜¯é…ç½®ä¸¤ä¸ªvrrp_instanceï¼Œä¸¤å°ä¸»æœºåˆ†åˆ«ä½œä¸ºä¸¤ä¸ªvrrp_instanceçš„ MASTER/BACKUP ã€‚
ä¾‹å¦‚ï¼šç¬¬ä¸€ä¸ªvrrp_instanceä¸­ server01 ä½œä¸º MASTERï¼Œserver02 ä½œä¸º BACKUPï¼Œç¬¬äºŒä¸ªvrrp_instanceä¸­ server01 ä½œä¸º BACKUPï¼Œserver02 ä½œä¸º MASTER.è¿™æ ·æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªè™šæ‹ŸIPåˆ†åˆ«æŒ‡å‘ server01 å’Œ server02ï¼Œè¾¾åˆ°äº†è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚å½“ç½‘ç»œå‡ºç°çŠ¶å†µçš„æ—¶å€™ - ä¾‹å¦‚ server02 å‡ºç°æ•…éšœï¼Œserver01 å°±å˜æˆäº†ä¸¤ä¸ª vrrp_instance çš„MASTERï¼Œæ¥ç®¡äº†æ‰€æœ‰çš„ç½‘ç»œé€šè®¯ï¼Œä»è€Œå®ç°äº†é«˜å¯ç”¨ã€‚å…·ä½“çš„é…ç½®å°±ä¸è´´äº†ï¼Œå¯ä»¥è‡ªè¡Œé˜…è¯»å‚è€ƒèµ„æ–™ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ KeepAlived Homepage KeepAlived Documentation VRRPåŸç†å’Œåˆ†æ KeepalivedåŸç† KeepAlived introduction How to Setup IP Failover with KeepAlived on Ubuntu &amp;amp; Debian How to setup a highly available load balancer with keepalived and HAProxy on Ubuntu 18.04 Linux Virtual ServeræŠ€æœ¯ Nginx&#43;keepalived é«˜å¯ç”¨åŒæœºçƒ­å¤‡ï¼ˆä¸»ä»æ¨¡å¼/åŒä¸»æ¨¡å¼ï¼‰ Nginx-keepalived&#43;Nginxå®ç°é«˜å¯ç”¨é›†ç¾¤ Keepalivedä¹‹â€”â€”Keepalived &#43; Nginx å®ç°é«˜å¯ç”¨ Web è´Ÿè½½å‡è¡¡ </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•ä¿®æ”¹UbuntuæœåŠ¡å™¨ä¸Šçš„DNSè®¾ç½®</title>
        <url>https://orchidflower.github.io/2020/07/10/How-to-Change-DNS-on-Ubuntu/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Ubuntu</tag><tag>DNS</tag>
        </tags>
        <content type="html"> å…¬å¸çš„å‡ å°æœåŠ¡å™¨å®‰è£…çš„æ—¶å€™è®¾ç½®äº†è”é€šçš„DNSæœåŠ¡å™¨ï¼Œç”±äºå…¬å¸ç½‘ç»œåˆ‡æ¢åˆ°äº†ç”µä¿¡ï¼Œæœ€è¿‘ç»å¸¸å‡ºç°è§£ææœåŠ¡å™¨IPå¤±è´¥çš„æƒ…å†µã€‚æ‰€ä»¥æƒ³ç€è¦æ›´æ¢ä¸€ä¸‹DNSæœåŠ¡å™¨ï¼Œä»¥æé«˜ç½‘ç»œè®¿é—®é€Ÿåº¦ã€‚
å› ä¸ºå†å²åŸå› ï¼ŒæœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸»è¦æœ‰ Ubuntu 16.04 LTS å’Œ Ubuntu 18.04 LTS ä¸¤ç§ã€‚å®é™…ä¿®æ”¹ä¸­å‘ç°ï¼Œä»–ä»¬çš„é…ç½®æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚
1. Ubuntu 16.04 LTS 16.04 LTSä¸Šä¸»è¦ä¿®æ”¹ä¸¤ä¸ªæ–‡ä»¶ã€‚
2.1 æ›´æ–°resolv.conf é¦–å…ˆä¿®æ”¹æ–‡ä»¶ï¼š/etc/resolvconf/resolv.conf.d/baseæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
1nameserver 114.114.114.114 2nameserver 223.5.5.5 ç„¶åæ‰§è¡Œï¼šresolvconf -uå‘½ä»¤å°±å¯ä»¥æ›´æ–°dnsæœåŠ¡å™¨äº†ã€‚
2.2 network/interfaces ç„¶åä¿®æ”¹æ–‡ä»¶ï¼š/etc/network/interfacesæ–‡ä»¶ï¼Œåˆ é™¤å…¶ä¸­çš„dns-nameserversé…ç½®é¡¹ï¼š
1# This file describes the network interfaces available on your system 2# and how to activate them. For more information, see interfaces(5). 3 4source /etc/network/interfaces.d/* 5 6# The loopback network interface 7auto lo 8iface lo inet loopback 9 10# The primary network interface 11auto ens33 12#iface ens33 inet dhcp 13iface ens33 inet static 14address 192.168.2.231 15netmask 255.255.255.0 16gateway 192.168.2.1 17#dns-nameservers 202.102.134.68 202.102.128.68 ç„¶åé‡å¯networkæœåŠ¡ï¼š/etc/init.d/networking restartï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚
å®é™…ä¿®æ”¹ä¸­ï¼Œå¤§éƒ¨åˆ†æœåŠ¡å™¨ä¿®æ”¹ç¬¬ä¸€ä¸ªå°±å¯ä»¥èµ·æ•ˆäº†ï¼Œåªæœ‰ä¸ªåˆ«çš„éœ€è¦ä¿®æ”¹ä¸¤ä¸ªã€‚ä¸ºäº†é˜²æ­¢æ­§ä¹‰ï¼Œæ¨èä¸¤ä¸ªéƒ½ä¿®æ”¹ã€‚
2. Ubuntu 18.04 LTS å¯¹ 18.04 LTS æ¥è¯´ï¼Œé…ç½®æ–‡ä»¶å˜æ›´ä¸ºï¼š/etc/netplan/*.yamlã€‚ä¾‹å¦‚ï¼š
1# This file is generated from information provided by 2# the datasource. Changes to it will not persist across an instance. 3# To disable cloud-init&amp;#39;s network configuration capabilities, write a file 4# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following: 5# network: {config: disabled} 6network: 7 ethernets: 8 ens160: 9 addresses: 10 - 192.168.2.237/24 11 dhcp4: false 12 gateway4: 192.168.2.1 13 nameservers: 14 addresses: 15# - 202.102.134.68 16# - 202.102.128.68 17 - 114.114.114.114 18 - 223.5.5.5 19 search: [] 20 version: 2 ä¿®æ”¹å®Œæˆä¹‹åä½¿ç”¨ï¼šsudo netplan applyç”Ÿæ•ˆã€‚
</content>
    </entry>
    
     <entry>
        <title>åœ¨Macä¸Šç¼–è¯‘RedisDesktopManagerï¼ˆ1ï¼‰å›½é™…åŒ–å¤„ç†</title>
        <url>https://orchidflower.github.io/2020/07/01/How-to-build-Redis-Desktop-Manager-on-Mac/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>Redis</tag><tag>RDM</tag><tag>RedisDesktopManager</tag>
        </tags>
        <content type="html"> 1. æ¦‚è¿° Redis Desktop Managerï¼ˆRedisDesktopManagerï¼ŒRDMï¼‰æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€å•ã€æ”¯æŒè·¨å¹³å°çš„ Redis æ¡Œé¢ç®¡ç†å·¥å…·ï¼ŒåŸºäº Qt 5 å¼€å‘ï¼Œæ”¯æŒé€šè¿‡ SSH Tunnel è¿æ¥ã€‚
&amp;ndash; å¼€æºä¸­å›½ä¸Šé¢å¯¹é¡¹ç›®çš„ä»‹ç»
RedisDesktopManager æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ Redis å®¢æˆ·ç«¯ã€‚æœ€åˆæ˜¯ä½œä¸ºå¼€æºé¡¹ç›®å‘å¸ƒçš„ï¼Œå®˜æ–¹ä¹Ÿä¼šå‘å¸ƒç¼–è¯‘å¥½çš„ç‰ˆæœ¬ã€‚åæ¥ï¼Œä½œè€…åšäº†ä¸€äº›å•†ä¸šåŒ–å¤„ç†ï¼Œä¸Šæ¶äº†App Storeï¼Œä»æ­¤ä¸å†å‘å¸ƒç¼–è¯‘åçš„ç‰ˆæœ¬ï¼Œä¹Ÿåœ¨å¼€æºç‰ˆæœ¬ä¸­é˜‰å‰²æ‰äº† SSH Tunnel åŠŸèƒ½ã€‚æœ‰é‰´äºæ­¤ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šäººå†™æ•™ç¨‹æ¥è¯´æ˜å¦‚ä½•ä»æºç æ„å»ºä¸€ä¸ªå‘è¡Œç‰ˆæœ¬ï¼Œä½†æ˜¯ç›®å‰è§åˆ°çš„æ•™ç¨‹å¤šå¤šå°‘å°‘éƒ½æœ‰ä¸€äº›é—®é¢˜ã€‚æœ€è¿‘èŠ±äº†ä¸€äº›æ—¶é—´å°è¯•å®Œå–„æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œç›®å‰è¿›å±•ä¸é”™ã€‚ä»¥åä¼šé™†ç»­è¯´æ˜ç¼–è¯‘è¿‡ç¨‹ä¸­ç¢°åˆ°çš„é—®é¢˜ä»¥åŠå¯¹åº”çš„è§£å†³åŠæ³•ã€‚
ä»Šå¤©é¦–å…ˆæ¥è¯´ä¸€ä¸‹å›½é™…åŒ–çš„é—®é¢˜ã€‚
ç›®å‰ç½‘ä¸Šæµè¡Œçš„ RedisDesktopManager ç¼–è¯‘æ–¹æ³•éƒ½æ²¡æœ‰å¯¹å›½é™…åŒ–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ç¼–è¯‘åçš„ç‰ˆæœ¬æ²¡æœ‰å›½é™…åŒ–åŠŸèƒ½ï¼Œç•Œé¢åªæ˜¾ç¤ºè‹±æ–‡ï¼Œè¯­è¨€åˆ‡æ¢åŠŸèƒ½æ— æ•ˆã€‚ç»è¿‡å¯¹ç›¸å…³æºç çš„åˆ†æï¼Œç»ˆäºæ‰¾åˆ°äº†æ­£ç¡®çš„ç¼–è¯‘å¤„ç†æ–¹æ³•ï¼Œç°åœ¨å¯ä»¥å®Œç¾åˆ‡æ¢è¯­è¨€ã€‚æ•ˆæœå¦‚å›¾ï¼š
2. æºç åˆ†æ å›½é™…åŒ–æœ‰å…³çš„æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹è¿™äº›ï¼š
src/app/app.cpp src/rdm.pro src/resources/tr.qrc src/resources/translations/*.ts ä¸‹é¢é€ä¸ªåˆ†æã€‚
2.1 app.cpp app.cpp æ˜¯æ•´ä¸ªæºç çš„èµ·å§‹ï¼ŒRedisDesktopManagerå¯åŠ¨ç›¸å…³çš„æºç åŸºæœ¬éƒ½åœ¨è¯¥æ–‡ä»¶ä¸­ã€‚é‡Œé¢ä¸å›½é™…åŒ–æœ‰å…³çš„ä¸»è¦æ˜¯ installTranslator è¿™ä¸ªå‡½æ•°ã€‚
1void Application::installTranslator() { 2 QSettings settings; 3 QString preferredLocale = settings.value(&amp;#34;app/locale&amp;#34;, &amp;#34;system&amp;#34;).toString(); 4 5 QString locale; 6 7 // å¦‚æœé¦–é€‰è¯­è¨€æ˜¯systemï¼Œåˆ™ä»ç³»ç»Ÿä¸­è·å–å½“å‰è¯­è¨€ã€‚åœ¨ä¸­æ–‡ç‰ˆMacä¸Šï¼Œè·å–åˆ°çš„å€¼æ˜¯ zh-Hans-CN 8 // è¿™å¯¼è‡´äº†åœ¨ä¸­æ–‡ç‰ˆMacä¸Šå¦‚æœé€‰æ‹©systemï¼Œç•Œé¢æ˜¾ç¤ºçš„è¿˜æ˜¯è‹±æ–‡ï¼Œè€Œä¸æ˜¯ä¸­æ–‡ã€‚è¯¦ç»†å†…å®¹è¯·çœ‹ä¸‹é¢çš„ä»‹ç» 9 if (preferredLocale == &amp;#34;system&amp;#34;) { 10 settings.setValue(&amp;#34;app/locale&amp;#34;, &amp;#34;system&amp;#34;); 11 locale = QLocale::system().uiLanguages().first().replace(&amp;#34;-&amp;#34;, &amp;#34;_&amp;#34;); 12 13 qDebug() &amp;lt;&amp;lt; QLocale::system().uiLanguages(); 14 15 if (locale.isEmpty() || locale == &amp;#34;C&amp;#34;) locale = &amp;#34;en_US&amp;#34;; 16 17 qDebug() &amp;lt;&amp;lt; &amp;#34;Detected locale:&amp;#34; &amp;lt;&amp;lt; locale; 18 } else { 19 locale = preferredLocale; 20 } 21 22 // ä½¿ç”¨localeåŠ è½½è¯­è¨€åŒ…ã€‚&amp;#34;:/translations/rdm_&amp;#34;ä¸­çš„&amp;#34;:&amp;#34;æ˜¯QTä¸­çš„ç”¨æ³•ï¼Œå«ä¹‰æ˜¯ä»èµ„æºæ–‡ä»¶ä¸­åŠ è½½ 23 // è¿™ä¸ªèµ„æºæ–‡ä»¶åº”è¯¥å·²ç»æ‰“åŒ…åœ¨å¯æ‰§è¡Œæ–‡ä»¶å†…éƒ¨äº†ã€‚ 24 QTranslator* translator = new QTranslator((QObject*)this); 25 if (translator-&amp;gt;load(QString(&amp;#34;:/translations/rdm_&amp;#34;) &#43; locale)) { 26 qDebug() &amp;lt;&amp;lt; &amp;#34;Load translations file for locale:&amp;#34; &amp;lt;&amp;lt; locale; 27 QCoreApplication::installTranslator(translator); 28 } else { 29 delete translator; 30 } 31} 2.2 rdm.pro rdm.pro æ–‡ä»¶æ˜¯ RedisDesktopManager é¡¹ç›®çš„ä¸»å·¥ç¨‹æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†æ•´ä¸ªé¡¹ç›®çš„ç»“æ„ã€‚å…¶ä¸­ä¹Ÿå®šä¹‰äº†å›½é™…åŒ–ç›¸å…³çš„å†…å®¹ï¼Œä¸»è¦å†…å®¹èŠ‚é€‰å¦‚ä¸‹ï¼š
1# æ­¤å¤„é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨rdm.qmè¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ·»åŠ tr.qrcæ–‡ä»¶ä¸ºèµ„æºæ–‡ä»¶ 2exists( $$PWD/resources/translations/rdm.qm ) { 3 message(&amp;#34;Translations found&amp;#34;) 4 RESOURCES &#43;= $$PWD/resources/tr.qrc 5} 6 7# è¿™é‡ŒæŒ‡å®šäº†ç›¸å…³çš„è¯­è¨€åŒ…æ–‡ä»¶ 8TRANSLATIONS = \ 9 $$PWD/resources/translations/rdm.ts \ 10 $$PWD/resources/translations/rdm_zh_CN.ts \ 11 $$PWD/resources/translations/rdm_zh_TW.ts \ 12 $$PWD/resources/translations/rdm_ru_RU.ts \ 13 $$PWD/resources/translations/rdm_es_ES.ts \ 14 $$PWD/resources/translations/rdm_ja_JP.ts \ 2.3 tr.qrc .qrc æ–‡ä»¶æ˜¯ QT çš„èµ„æºå®šä¹‰æ–‡ä»¶ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œèµ„æºæ–‡ä»¶ä¼šè¢«æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼ˆä¸ªäººçŒœæµ‹ï¼Œå°šæœªç¡®å®šï¼Œä½†åº”è¯¥å‡†ç¡®ï¼‰ã€‚
1&amp;lt;RCC&amp;gt; 2 &amp;lt;qresource prefix=&amp;#34;/&amp;#34;&amp;gt; 3 &amp;lt;file&amp;gt;translations/rdm_zh_CN.qm&amp;lt;/file&amp;gt; 4 &amp;lt;file&amp;gt;translations/rdm_zh_TW.qm&amp;lt;/file&amp;gt; 5 &amp;lt;file&amp;gt;translations/rdm_ru_RU.qm&amp;lt;/file&amp;gt; 6 &amp;lt;file&amp;gt;translations/rdm_es_ES.qm&amp;lt;/file&amp;gt; 7 &amp;lt;file&amp;gt;translations/rdm_ja_JP.qm&amp;lt;/file&amp;gt; 8 &amp;lt;/qresource&amp;gt; 9&amp;lt;/RCC&amp;gt; å¯ä»¥çœ‹åˆ°åœ¨èµ„æºæ–‡ä»¶ä¸­å®šä¹‰äº†éœ€è¦å¼•å…¥çš„qmæ–‡ä»¶åˆ—è¡¨ã€‚
2.4 translations åˆšä¸‹è½½å¥½çš„æºç ä¸­ src/resources/translations ç›®å½•ä¸‹é¢åªæœ‰ .ts æ–‡ä»¶ï¼Œtsçš„å«ä¹‰æ˜¯ translation source ï¼Œä¹Ÿå°±æ˜¯ç¿»è¯‘æºç æ–‡ä»¶çš„æ„æ€ã€‚
3. ç¼–è¯‘é—®é¢˜åˆ†æåŠè§£å†³ ä» rdm.pro æ–‡ä»¶ä¸­å†…å®¹æ¥çœ‹ï¼Œç¼–è¯‘æ—¶åªæœ‰å­˜åœ¨ src/resources/translations/rdm.qm è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™æ‰ä¼šæŠŠ tr.qrc æ–‡ä»¶ä½œä¸ºèµ„æºæ–‡ä»¶åŒ…å«è¿›æ¥ç¼–è¯‘ã€‚è€Œå®é™…ä¸Šä¸‹è½½çš„æºç ä¸­ç›®å½• src/resources/translations ä¸­åªæœ‰ .ts æ–‡ä»¶æ²¡æœ‰å¯¹åº”çš„ .qm æ–‡ä»¶ï¼Œè¿™å¯¼è‡´äº†ç¼–è¯‘è¿‡ç¨‹ä¸­è·³è¿‡äº†å¯¹è¯­è¨€åŒ…çš„å¤„ç†ï¼Œå› æ­¤ç¼–è¯‘åçš„æ–‡ä»¶å¤±å»äº†å›½é™…åŒ–çš„åŠŸèƒ½ã€‚
è§£å†³åŠæ³•å°±æ˜¯åœ¨æ­£å¼ç¼–è¯‘æºç ä¹‹å‰ï¼Œé¦–å…ˆå°†tsæ–‡ä»¶ç¼–è¯‘æˆqmæ–‡ä»¶ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š
1cd src/resources/translations 2for file in `ls -1 *.ts` 3do 4	echo &amp;#34;Convert $file&amp;#34; 5 lconvert -i $file -o ${file%.*}.qm 6done è¯´æ˜ï¼š lconvertæ˜¯QTå¸¦çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºåœ¨è¯­è¨€åŒ…ç›¸å…³å„ç§æ ¼å¼ä¹‹é—´è½¬æ¢ã€‚éœ€è¦é¦–å…ˆå®‰è£…qtã€‚ï¼ˆbrew install qtï¼‰
4. å‰©ä½™é—®é¢˜ ä¸Šé¢æåˆ°ï¼Œå¦‚æœè¯­è¨€é€‰æ‹©systemï¼Œåœ¨ä¸­æ–‡ç‰ˆMacä¸Šé¢æ˜¯ä¸èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºä¸­æ–‡çš„ã€‚å…¶åŸå› æ˜¯ä»ç³»ç»Ÿè·å¾—çš„è¯­è¨€åç§°æ˜¯zh-Hans-CNï¼Œç”±æ­¤æœŸå¾…çš„è¯­è¨€åŒ…æ–‡ä»¶åæ˜¯ï¼šrdm_zh_Hans_CN.qmï¼Œè€Œå®é™…è¯­è¨€åŒ…æ–‡ä»¶åæ˜¯ rdm_zh_CN.qm ï¼Œæ˜¾ç„¶æ— æ³•æ‰¾åˆ°ã€‚
è§£å†³åŠæ³•æ˜¯å¤šå¤åˆ¶ä¸€ä»½æ–‡ä»¶å³å¯ï¼š
1cd src/resources/translations 2for file in `ls -1 *.ts` 3do 4	echo &amp;#34;Convert $file&amp;#34; 5 lconvert -i $file -o ${file%.*}.qm 6done 7cp rdm_zh_CN.qm rdm_zh_Hans_CN.qm åŒæ—¶ä¿®æ”¹tr.qrcæ–‡ä»¶ï¼Œæ·»åŠ è¿™ä¸ªqmæ–‡ä»¶ï¼š
1&amp;lt;RCC&amp;gt; 2 &amp;lt;qresource prefix=&amp;#34;/&amp;#34;&amp;gt; 3 &amp;lt;file&amp;gt;translations/rdm_zh_CN.qm&amp;lt;/file&amp;gt; 4 &amp;lt;file&amp;gt;translations/rdm_zh_Hans_CN.qm&amp;lt;/file&amp;gt; 5 &amp;lt;file&amp;gt;translations/rdm_zh_TW.qm&amp;lt;/file&amp;gt; 6 &amp;lt;file&amp;gt;translations/rdm_ru_RU.qm&amp;lt;/file&amp;gt; 7 &amp;lt;file&amp;gt;translations/rdm_es_ES.qm&amp;lt;/file&amp;gt; 8 &amp;lt;file&amp;gt;translations/rdm_ja_JP.qm&amp;lt;/file&amp;gt; 9 &amp;lt;/qresource&amp;gt; 10&amp;lt;/RCC&amp;gt; é™„å½•ã€å‚è€ƒèµ„æ–™ RedisDesktopManager source on Github Macä¸‹ä¸€é”®ç¼–è¯‘RedisDesktopManager How can I convert qm to ts file? Qtå›½é™…åŒ–å¤šå›½è¯­è¨€å’Œå‘å¸ƒä¾‹å­ </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•åœ¨Macä¸Šç¼–è¯‘vcmiï¼ˆç»­ï¼‰-cpackæ‰“åŒ…åå¼‚å¸¸é€€å‡º</title>
        <url>https://orchidflower.github.io/2020/06/26/How-to-build-vcmi-on-mac-part3/</url>
        <categories>
          <category>æ¸¸æˆ</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>è‹±é›„æ— æ•Œ</tag><tag>Heroes2</tag><tag>HoMM</tag>
        </tags>
        <content type="html"> 1. ç°è±¡ VCMIç¼–è¯‘ä¹‹åå¯ä»¥ä½¿ç”¨cpackå‘½ä»¤ï¼ˆcmakeçš„ä¸€ä¸ªåŠŸèƒ½ï¼‰æ‰“åŒ…æˆdmgæ–‡ä»¶ï¼Œä»¥ä¾¿äºåˆ†å‘ã€‚æ‰“åŒ…è¿‡ç¨‹ä¸­ä¼šæŠŠéœ€è¦çš„ä¾èµ–æ–‡ä»¶éƒ½æ‰“åŒ…åˆ°æœ€åçš„.appæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯åœ¨å…¶ä»–æœºå™¨ä¸Šä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œç¼–è¯‘åçš„VCMIã€‚ æŒ‰ç…§ä¹‹å‰çš„æ–‡æ¡£ï¼Œç¼–è¯‘ä¹‹åç›´æ¥æ‰§è¡Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨cpackæ‰“åŒ…ä¹‹åè¿è¡Œç¼ºä¼šå¼‚å¸¸é€€å‡ºã€‚ç»è¿‡è§‚å¯ŸåŸºæœ¬ä¸Šå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡æˆ˜æ–—ä¸­ï¼Œç©å®¶æ“ä½œå®Œæ¯•ï¼Œç”µè„‘AIè·å¾—æ§åˆ¶æƒçš„æ—¶å€™å°±ä¼šå´©æºƒé€€å‡ºã€‚
2. åˆ†æ æœ€åˆæ€€ç–‘æ˜¯æ–°ç‰ˆæœ¬ä»£ç æœ‰é—®é¢˜ï¼Œæ‰€ä»¥åˆ‡æ¢åˆ°ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç ç¼–è¯‘ï¼Œå‘ç°è¿˜æ˜¯æœ‰åŒæ ·çš„é—®é¢˜ã€‚åæ¥ç»è¿‡åˆ†æé€€å‡ºçš„æ—¶é—´ç‚¹ï¼Œæ€€ç–‘æ˜¯vcmiçš„AIä»£ç æœ‰é—®é¢˜ï¼Œå› ä¸ºå¯¹ä»£ç éƒ¨åˆ†ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥å¾ˆé•¿æ—¶é—´æ²¡æœ‰è¿›å±•ã€‚ åæ¥ç»è¿‡æŸ¥çœ‹cpackçš„å·¥ä½œåŸç†ï¼Œæ€€ç–‘æ˜¯AIåº“å¯¹åº”çš„ä¾èµ–æ–‡ä»¶æ²¡æœ‰æ­£ç¡®æ‰“åŒ…å¯¼è‡´çš„ã€‚
ä½¿ç”¨otool -Låˆ†æåŠ¨æ€åº“ä¾èµ–ï¼Œå‘ç°AIç›®å½•ä¸‹çš„æ–‡ä»¶æ²¡æœ‰è¿›è¡Œä¾èµ–åº“çš„å¤„ç†ã€‚è¿˜æ˜¯æŒ‡å‘/usr/local/...ä¸‹é¢çš„dylibæ–‡ä»¶ã€‚è€Œvcmiclient/vcmiserverå·²ç»è¿›è¡Œäº†å¤„ç†ã€‚å› æ­¤æ€€ç–‘æ˜¯å› ä¸ºå¼•å…¥äº†ä¸¤ä»½åŠ¨æ€åº“å¯¼è‡´çš„é—®é¢˜ï¼Œvcmiclientå·²ç»åŠ è½½äº†ä¸€ä»½åŠ¨æ€åº“ï¼Œä½†æ˜¯å½“æ‰§è¡Œåˆ°AIåº“çš„æ—¶å€™åˆè¦ä»å…¶ä»–ä½ç½®åŠ è½½å¦ä¸€ä»½åŒåçš„åŠ¨æ€åº“ï¼Œå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªåŸå› å¯¼è‡´äº†å´©æºƒã€‚
3. è§£å†³åŠæ³• ç»è¿‡æŸ¥é˜…cpackçš„æ–‡æ¡£ï¼Œcpackæ‰“åŒ…çš„æ—¶å€™ä½¿ç”¨fixup_bundleå¯¹ä¾èµ–åº“è¿›è¡Œå¤„ç†ã€‚å› æ­¤æ”¹é€ ä¸€ä¸‹æ‰“åŒ…è„šæœ¬ï¼Œè„šæœ¬æ–‡ä»¶æ˜¯osx/CMakeLists.txtï¼š
1	install(CODE &amp;#34; 2	set(BU_CHMOD_BUNDLE_ITEMS ON) 3	include(BundleUtilities) 4 # åŸå…ˆçš„é…ç½®æ–‡ä»¶å†…å®¹ 5 # fixup_bundle(\&amp;#34;\${CMAKE_INSTALL_PREFIX}/${APP_BUNDLE_DIR}\&amp;#34; \&amp;#34;\&amp;#34; \&amp;#34;\&amp;#34;) 6 # ä¿®æ”¹æˆå¦‚ä¸‹çš„å†…å®¹ã€‚æ³¨æ„ï¼šä»¥ä¸Šè¿™ä¸‰è¡Œä¸è¦å¤åˆ¶åˆ°æœ€åçš„æ–‡ä»¶ä¸­ï¼Œåªå¤åˆ¶ä¸‹é¢ä¸€è¡Œå³å¯ã€‚ 7	fixup_bundle(\&amp;#34;\${CMAKE_INSTALL_PREFIX}/${APP_BUNDLE_DIR}\&amp;#34; \&amp;#34;libVCAI.dylib;libStupidAI.dylib;libBattleAI.dylib;libEmptyAI.dylib\&amp;#34; \&amp;#34;\${CMAKE_INSTALL_PREFIX}/${BIN_DIR}/AI\&amp;#34;) 8	&amp;#34; COMPONENT Runtime) è¯´æ˜ï¼š
fixup_bundleçš„ç”¨æ³•æ˜¯ï¼šfixup_bundle(&amp;lt;app&amp;gt; &amp;lt;libs&amp;gt; &amp;lt;dirs&amp;gt;)ï¼Œé€šå¸¸æŒ‡å®š.appæ–‡ä»¶è·¯å¾„å³å¯ï¼Œä¼šè‡ªåŠ¨ä¿®å¤å…¶ä¸­çš„Contents/MacOSè·¯å¾„ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½†æ˜¯å› ä¸ºvcmiçš„AIåº“æ–‡ä»¶åœ¨å•ç‹¬çš„ä¸€ä¸ªç›®å½•ä¸­ï¼ˆContents/MacOS/AIï¼‰ï¼Œæ‰€ä»¥é»˜è®¤æ²¡æœ‰åŠæ³•å¯¹AIæ–‡ä»¶è¿›è¡Œå¤„ç†ï¼› ä¿®æ”¹åŠæ³•æ˜¯å°†AIç›¸å…³åŠ¨æ€åº“ä½œä¸ºlibæ–‡ä»¶æ·»åŠ åˆ°libså‚æ•°ä¸­ï¼Œç„¶åä½¿ç”¨dirsæŒ‡å®šåº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼› libs å¢åŠ libVCAI.dylib;libStupidAI.dylib;libBattleAI.dylib;libEmptyAI.dylibè¿™å››ä¸ªAIçš„æ–‡ä»¶ã€‚ä½¿ç”¨åˆ†å‰²ç¬¦ ; (åˆ†å·)è¿›è¡Œåˆ†éš”ï¼› dirs å¢åŠ è¿™å››ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼› é‡æ–°cpackå³å¯ã€‚ é™„å½•ã€å‚è€ƒèµ„æ–™ Manual of BundleUtilities BundleUtilities source of cmake GetPrerequisites source of cmake cmake foreach manual </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•åœ¨Macä¸Šç¼–è¯‘vcmiï¼ˆç»­ï¼‰-è§£å†³æ— æ³•æ’­æ”¾MP3çš„é—®é¢˜</title>
        <url>https://orchidflower.github.io/2020/06/21/How-to-build-vcmi-on-mac-part2/</url>
        <categories>
          <category>æ¸¸æˆ</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>è‹±é›„æ— æ•Œ</tag><tag>Heroes2</tag><tag>HoMM</tag>
        </tags>
        <content type="html"> 1. é—®é¢˜ æŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡æ¡£çš„æ­¥éª¤ç¼–è¯‘ä¹‹åï¼Œå‘ç°mp3æ ¼å¼çš„èƒŒæ™¯éŸ³ä¹æ— æ³•æ’­æ”¾ã€‚é€šè¿‡ç›´æ¥æ‰§è¡Œvcmiclientå¯ä»¥çœ‹åˆ°åœ¨æ§åˆ¶å°ä¸­è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š
1Warning: Cannot open Music/MainMenu: Unrecognized audio format 2Unable to play music (music parameter was NULL) åŸå› æ˜¯æˆ‘æœ¬åœ°ç¯å¢ƒä½¿ç”¨çš„sdl2_mixeræ˜¯é€šè¿‡brewå®‰è£…çš„ï¼Œå½“æ—¶æ— æ³•æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä»‹ç»é€šè¿‡brew install sdl2_mixer --with-smpeg2è¿›è¡Œå®‰è£…ã€‚ å› ä¸ºå‘ç°æ— æ³•æ’­æ”¾mp3éŸ³ä¹ï¼Œæ‰€ä»¥æˆ‘å¯¹è¿™ä¸ªåº“è¿›è¡Œäº†ä¸€äº›äº†è§£ï¼Œå‘ç°brewå®˜æ–¹çš„ç‰ˆæœ¬å±è”½äº†mp3æ ¼å¼çš„æ”¯æŒã€‚æŸ¥çœ‹brewå®˜æ–¹çš„æºç å¯ä»¥çœ‹åˆ°ï¼š
1def install 2 inreplace &amp;#34;SDL2_mixer.pc.in&amp;#34;, &amp;#34;@prefix@&amp;#34;, HOMEBREW_PREFIX 3 4 args = %W[ 5 --prefix=#{prefix} 6 --disable-dependency-tracking 7 --disable-music-flac 8 --disable-music-flac-shared 9 --disable-music-midi-fluidsynth 10 --disable-music-midi-fluidsynth-shared 11 --disable-music-mod-mikmod-shared 12 --disable-music-mod-modplug-shared 13 --disable-music-mp3-mpg123 14 --disable-music-mp3-mpg123-shared 15 --disable-music-mp3-smpeg 16 --disable-music-ogg-shared 17 --enable-music-mod-mikmod 18 --enable-music-mod-modplug 19 --enable-music-ogg 20 ] 21 22 system &amp;#34;./configure&amp;#34;, *args 23 system &amp;#34;make&amp;#34;, &amp;#34;install&amp;#34; 24 end å¯ä»¥çœ‹åˆ°æœ‰å…³mp3çš„é€‰é¡¹éƒ½è¢«disabledæ‰äº†ã€‚
2. è§£å†³åŠæ³• brewå®˜æ–¹çš„ç‰ˆæœ¬ä¸æ”¯æŒmp3ï¼Œè€Œä¸”ä¹Ÿä¸æä¾›å®šåˆ¶å‚æ•°ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡æ‰‹å·¥ç¼–è¯‘æºç çš„æ–¹å¼è§£å†³ã€‚å¯ä»¥ä½¿ç”¨brew --build-from-sourceåŠŸèƒ½ç®€åŒ–æ‰‹å·¥ç¼–è¯‘çš„è¿‡ç¨‹ã€‚ ä¸‹è½½ä¸Šé¢çš„rbæ–‡ä»¶ï¼Œç¼–è¾‘å¦‚ä¸‹ï¼š
1... 2 # ç»è¿‡éªŒè¯ï¼Œå¯ä»¥åªå¢åŠ  mpg123 è¿™ä¸€ä¸ªä¾èµ–åº“ã€‚ 3 depends_on &amp;#34;mpg123&amp;#34; 4 # ç»è¿‡éªŒè¯ï¼Œå¯ä»¥ä¸æ·»åŠ smpeg2ï¼Œä½†éœ€è¦åŒæ—¶å¯ç”¨ç›¸åº”çš„disableé€‰é¡¹ 5 #depends_on &amp;#34;smpeg2&amp;#34; 6... 7# å±è”½mp3æœ‰å…³çš„å‡ ä¸ªçš„å‡ ä¸ªdisableé€‰é¡¹ï¼Œç›¸å½“äºå¯ç”¨mp3æ’­æ”¾åŠŸèƒ½ 8# å±è”½mpg123é€‰é¡¹ï¼Œä½†æ˜¯ç»§ç»­ä¿ç•™disable shared mpg123çš„é€‰é¡¹ï¼Œç¦ç”¨åŠ¨æ€é“¾æ¥ 9# --disable-music-mp3-mpg123 10 --disable-music-mp3-mpg123-shared 11# ç»§ç»­å±è”½smpeg2 12 --disable-music-mp3-smpeg ç‰¹åˆ«æ³¨æ„ï¼š
éœ€è¦ä¿ç•™--disable-music-mp3-mpg123-sharedè¿™ä¸ªé€‰é¡¹ï¼Œå¦åˆ™åœ¨libSDL2_mixer.dylibçš„ä¾èµ–è¡¨ä¸­æ— æ³•çœ‹åˆ°libmpg123ï¼Œä»è€Œå¯¼è‡´ä½¿ç”¨cpackæ‰“åŒ…çš„æ—¶å€™æ— æ³•ä¾¦æµ‹åˆ°libmpg123è¿™ä¸ªä¾èµ–åº“ï¼› çŒœæµ‹æ˜¯å› ä¸ºå±è”½sharedä¹‹åä¼šä½¿ç”¨åŠ¨æ€åŠ è½½åŠ¨æ€åº“çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šå‡ºç°åœ¨ä¾èµ–åº“åˆ—è¡¨ä¸­ã€‚ ç„¶åä½¿ç”¨ç¼–è¯‘æºç çš„æ–¹å¼å®‰è£…ï¼š
1# é¦–å…ˆå¸è½½å·²ç»å®‰è£…çš„ç‰ˆæœ¬ 2brew remove sdl2_mixer 3# ç¼–è¯‘å®‰è£… 4brew install --build-from-source ./sdl2_mixer è¿™æ ·brewå°±ä¼šè¯»å–æœ¬åœ°çš„sdl2_mixer.rbæ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§æŒ‡å®šçš„å‚æ•°è¿›è¡Œç¼–è¯‘å®‰è£…äº†ã€‚å®‰è£…æˆåŠŸä¹‹åçš„sdl2_mixeræä¾›mp3çš„æ”¯æŒã€‚ ä¸éœ€è¦é‡æ–°ç¼–è¯‘vcmiï¼Œç›´æ¥è¿è¡Œä¹‹å‰ç¼–è¯‘æˆåŠŸçš„ç‰ˆæœ¬å°±å¯ä»¥å‘ç°mp3æ ¼å¼çš„èƒŒæ™¯éŸ³ä¹å¯ä»¥æ­£å¸¸æ’­æ”¾äº†ï¼
é™„å½•ã€å‚è€ƒèµ„æ–™ sdl2_mixer on github æ›´æ–°è®°å½• 2020.07.06 æ˜ç¡®åªéœ€è¦ä¾èµ–mpg123è¿™ä¸ªåº“å³å¯ï¼Œæ˜ç¡®ç¼–è¯‘æ–¹æ³•ã€‚ </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•åœ¨Macä¸Šç¼–è¯‘vcmi</title>
        <url>https://orchidflower.github.io/2020/05/09/How-to-build-vcmi-on-mac/</url>
        <categories>
          <category>æ¸¸æˆ</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>è‹±é›„æ— æ•Œ</tag><tag>Heroes2</tag><tag>HoMM</tag>
        </tags>
        <content type="html"> vcmiæ˜¯è‹±é›„æ— æ•Œä¸‰çš„å¼€æºå¼•æ“ã€‚ä¸fheroes2ç±»ä¼¼ï¼Œå®ƒä¾æ‰˜äºè‹±é›„æ— æ•Œ3çš„æ¸¸æˆæ•°æ®ï¼Œä½¿ç”¨å®Œå…¨é‡å†™ã€å¼€æºçš„å¼•æ“ï¼Œå®ç°äº†åŸç‰ˆæ¸¸æˆçš„ç»å¤§å¤šæ•°åŠŸèƒ½ã€‚ç›¸æ¯”äºåŸç‰ˆæ¸¸æˆï¼Œå¯¹é«˜æ¸…åˆ†è¾¨ç‡çš„æ”¯æŒä¹Ÿæ›´å¥½ï¼Œè­¬å¦‚å¢åŠ äº†å®½å±åˆ†è¾¨ç‡çš„æ”¯æŒã€‚vcmiä½¿ç”¨c&#43;&#43;è¯­è¨€ç¼–å†™ï¼Œä¾èµ–åº“ä¸»è¦åŒ…æ‹¬ï¼šboostï¼Œffmpegï¼›å›¾å½¢åº“ä½¿ç”¨çš„æ˜¯SDL2ã€‚å¦å¤–ï¼Œå›¾å½¢å¯åŠ¨å·¥å…·ä¾èµ–äºQT5ã€‚vcmiæ”¯æŒå¹³å°åŒ…æ‹¬Windowsï¼ŒMacOSï¼ŒAndroidå’ŒLinuxï¼Œç®—æ˜¯å…¨å¹³å°æ”¯æŒäº†ã€‚
ä¸è¿‡å®˜æ–¹çš„å‘å¸ƒç³»ç»Ÿå¥½åƒæœ‰ç‚¹é—®é¢˜ï¼ŒMacOSç‰ˆæœ¬æœ€æ–°åˆ°2019å¹´9æœˆï¼Œåé¢çš„ç‰ˆæœ¬æ²¡æœ‰æ„å»ºæˆåŠŸã€‚
è‹±é›„æ— æ•Œ3ï¼Œå…¨ç§°ã€Šé­”æ³•é—¨ä¹‹è‹±é›„æ— æ•Œâ…¢ã€‹ï¼Œæ˜¯1999å¹´ç”±New World Computingåœ¨Windowså¹³å°ä¸Šå¼€å‘çš„å›åˆåˆ¶ç­–ç•¥é­”å¹»æ¸¸æˆï¼Œå…¶å‡ºç‰ˆå•†æ˜¯3DOã€‚åœ¨PCç‰ˆå‘å¸ƒä¹‹åï¼Œ3DOå’ŒLoki Softwareåˆ†åˆ«æ¨å‡ºäº†å¯åœ¨è‹¹æœæœºå’ŒLinuxç³»ç»Ÿä¸Šè¿è¡Œçš„ç‰ˆæœ¬ã€‚
è¯¥ä½œæ˜¯é­”æ³•é—¨ä¹‹è‹±é›„æ— æ•Œç³»åˆ—çš„ç¬¬ä¸‰ä»£ã€‚æ¸¸æˆæƒ…èŠ‚å‚ç…§ç¬¬ä¸€æ¬¡è´¯ç©¿äº†ã€Šé­”æ³•é—¨VIï¼šå¤©å ‚ä¹‹ä»¤ã€‹ï¼Œå¹¶ä¸”éƒ¨åˆ†ä½œä¸ºäº†ã€Šé­”æ³•é—¨VIIï¼šè¡€ç»Ÿä¸è£è€€ã€‹çš„å‰ä¼ ã€‚ç©å®¶å¯ä»¥é€‰æ‹©å…­ä¸ªæˆ˜å½¹ä¹‹ä¸­çš„ä¸€ä¸ªæ¥è¿›è¡Œæƒ…èŠ‚æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœºæ™¯æ¥è¿›è¡Œä¸ç”µè„‘æˆ–å…¶ä»–ç©å®¶çš„å¯¹æŠ—ã€‚ä¹‹åï¼Œåˆé™†ç»­å‘å¸ƒäº†ã€Šæœ«æ—¥ä¹‹åˆƒã€‹ã€ã€Šæ­»äº¡é˜´å½±ã€‹ä¸¤ä¸ªèµ„æ–™ç‰‡ï¼Œåæ¥åˆå‘å¸ƒäº†ã€Šè‹±é›„æ— æ•Œå†ä»£è®°ã€‹å…±è®¡8ä¸ªæˆ˜å½¹ã€‚
è‹±é›„æ— æ•Œ3å†æ¥è¢«ç§°ä¸ºè‹±é›„æ— æ•Œç³»åˆ—çš„ç»å…¸ä¹‹ä½œï¼Œå¯ä»¥è¯´æ˜¯è¿™ä¸ªç³»åˆ—æ¸¸æˆçš„å·…å³°ä¹‹ä½œã€‚
vcmiçš„å®˜ç½‘æœ‰ç¼–è¯‘æ–¹æ³•çš„è¯´æ˜ï¼Œä½†æ˜¯æœ‰äº›å°çš„åœ°æ–¹æœ‰äº›å°é—®é¢˜ã€‚ç‰¹æ­¤è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡åæŸ¥ã€‚æœ¬æ¬¡ç¼–è¯‘ä½¿ç”¨cmakeåœ¨å‘½ä»¤è¡Œä¸‹é¢å®Œæˆã€‚éœ€è¦ç¡®ä¿å·²ç»å®‰è£…äº†xcodeåŠbrewã€‚
1. ä¾èµ–åº“å®‰è£… 1# å®‰è£…sdl2ï¼Œcmakeï¼Œffmpegç­‰ 2brew install git cmake sdl2 sdl2_ttf sdl2_image boost ffmpeg minizip 3# å®˜ç½‘å®‰è£…sdl2_mixeræŒ‡å®šäº† --with-smpeg2å‚æ•°ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸Šè¯¥å‚æ•°æ— æ•ˆ 4brew install sdl2_mixer 5# å®‰è£…qt5 6brew install qt5 é…ç½®ç¯å¢ƒå˜é‡ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯zshï¼Œæ‰€ä»¥ç¼–è¾‘~/.zshrcå¢åŠ å¦‚ä¸‹å†…å®¹ï¼š
1export PATH=/usr/local/opt/qt/bin:$PATH 2export LDFLAGS=&amp;#34;-L/usr/local/opt/qt/lib&amp;#34; 3export CPPFLAGS=&amp;#34;-I/usr/local/opt/qt/include&amp;#34; 4export PKG_CONFIG_PATH=&amp;#34;/usr/local/opt/qt/lib/pkgconfig&amp;#34; 2. ä¸‹è½½æºç  1# åˆ›å»ºå·¥ä½œç›®å½• 2mkdir -p ~/work/git/github &amp;amp;&amp;amp; cd ~/work/git/github 3# ä¸‹è½½æºç ã€‚ä½¿ç”¨--recursiveä¸‹è½½æ‰€æœ‰ä¾èµ–çš„æºç åº“ 4git clone --recursive https://github.com/vcmi/vcmi.git 5# åˆ›å»ºä¸€ä¸ªç¼–è¯‘ç”¨çš„å·¥ä½œç›®å½• cmake 6mkdir cmake &amp;amp;&amp;amp; cd cmake 7# ç”Ÿæˆmakeæ–‡ä»¶ 8cmake ../vcmi -G &amp;#34;Unix Makefiles&amp;#34; -DCMAKE_BUILD_TYPE=Release -Wno-devc è¯·ç¡®ä¿ä¹‹å‰å·²ç»å®‰è£…å¥½äº†ä¾èµ–åº“ï¼Œå¹¶è®¾ç½®å¥½äº†ç¯å¢ƒå˜é‡ï¼Œå¦åˆ™ä¼šæç¤ºæ‰¾ä¸åˆ°qt5ç›¸å…³çš„ç¼–è¯‘ä¿¡æ¯ã€‚
3. ç¼–è¯‘ ç”Ÿæˆmakeæ–‡ä»¶ä¹‹åå°±å¯ä»¥å¼€å§‹ç¼–è¯‘äº†ã€‚
1cd ~/work/git/github/cmake 2# ä½¿ç”¨cmakeç¼–è¯‘ 3cmake --build . -- -j 4 4. æ‰“åŒ… ç¼–è¯‘æˆåŠŸåï¼Œä½¿ç”¨cpackæ‰“åŒ…ï¼Œç›´æ¥ç”Ÿæˆå®‰è£…ç”¨çš„dmgæ–‡ä»¶ã€‚
1cd ~/work/git/github/cmake 2# æ‰“åŒ…ç”Ÿæˆdmgæ–‡ä»¶ 3cpack 5. ç–‘éš¾é—®é¢˜è§£å†³ ç¼–è¯‘è¿‡ç¨‹ä¸­ç¢°åˆ°çš„é—®é¢˜é€šå¸¸æ˜¯å› ä¸ºä¾èµ–åŒ…å¼•èµ·çš„ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œéœ€è¦ä»”ç»†æŸ¥çœ‹æç¤ºä¿¡æ¯ï¼Œç¡®è®¤è·Ÿä»€ä¹ˆæœ‰å…³ç³»ã€‚ å¦‚æœç¡®è®¤è·ŸæŸä¸ªä¾èµ–åŒ…æœ‰å…³ç³»ï¼Œå¯ä»¥å°è¯•brew remove, brew installé‡è£…ä¾èµ–åŒ…ï¼Œå¹¶ä»”ç»†æŸ¥çœ‹å®‰è£…è®°å½•ï¼Œç¡®è®¤æ˜¯å¦æœ‰éœ€è¦ç‰¹æ®Šé…ç½®çš„åœ°æ–¹ï¼Œå¹¶å®‰è£…æç¤ºè¿›è¡Œé…ç½®ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ vcmiå®˜ç½‘ vcmi github Installation on MacOS Build on MacOS </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•åœ¨Macä¸Šç¼–è¯‘fheroes2</title>
        <url>https://orchidflower.github.io/2020/05/08/How-to-build-fheroes2-on-mac/</url>
        <categories>
          <category>æ¸¸æˆ</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>è‹±é›„æ— æ•Œ</tag><tag>Heroes2</tag><tag>HoMM</tag>
        </tags>
        <content type="html"> fheroes2æ˜¯è‹±é›„æ— æ•Œ2çš„å¼€æºå¼•æ“ï¼Œå®ƒåŸºäºè‹±é›„æ— æ•Œ2çš„æ¸¸æˆæ•°æ®ï¼Œé‡‡ç”¨å®Œå…¨é‡å†™çš„å¼•æ“å®ç°äº†ç»å¤§å¤šæ•°åŸç‰ˆæ¸¸æˆçš„åŠŸèƒ½ã€‚ä½¿ç”¨çš„å›¾å½¢å¼•æ“æ˜¯SDLã€‚
Free implementation of Heroes of the Might and Magic II engine. SDL is used.
fheroes2æœ€åˆæ˜¯åœ¨SourceForgeä¸Šé¢å¼€æºçš„ï¼Œä¸è¿‡æœ€è¿‘ä¸¤å¹´åŸºæœ¬åœæ­¢æ›´æ–°äº†ã€‚æœ€è¿‘åœ¨Githubä¸Šå¶ç„¶å‘ç°äº†æœ‰äººåœ¨ç»§ç»­å¼€å‘äº†ï¼Œå¹¶ä¸”å¯¹å›¾å½¢å¼•æ“è¿›è¡Œäº†æ›´æ–°ï¼ŒåŒæ—¶æ”¯æŒSDL2ã€‚
å› ä¸ºä¹‹å‰å¯¹è‹±é›„æ— æ•Œç³»åˆ—ç©å¾—æ¯”è¾ƒå¤šï¼Œå°¤å…¶æ˜¯2ä»£ï¼Œè€ŒMacä¸Šçš„Wineåœ¨å‡çº§åˆ°Catalinaä¹‹åå¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½æ— æ³•å·¥ä½œï¼ˆç›´åˆ°æœ€è¿‘æ‰æœ‰äº†ä¸€äº›è¿›å±•ï¼‰ï¼Œå› æ­¤å°è¯•ç€å¯¹æ¸¸æˆè¿›è¡Œäº†ç¼–è¯‘ï¼Œä»¥åœ¨Macä¸Šé¢å¯ä»¥ç©è‹±é›„æ— æ•Œ2ã€‚ä¸‹é¢ç®€å•è®°å½•ä¸€ä¸‹ç¼–è¯‘è¿‡ç¨‹ï¼Œä»¥å¤‡åç”¨ã€‚
0. ä¸‹è½½æºç  1git clone https://github.com/ihhub/fheroes2.git 1. å®‰è£…ä¾èµ–åº“ ä¾èµ–åº“å®‰è£…éœ€è¦é¦–å…ˆå®‰è£…brewï¼Œå…·ä½“å®‰è£…æ­¥éª¤å¯ä»¥å‚è€ƒå…¶ä»–èµ„æ–™ã€‚åœ¨Macä¸Šé¢æ¨èä½¿ç”¨SDL2å¼•æ“ï¼Œè€Œä¸ä½¿ç”¨SDL1ï¼Œæ®è¯´SDL1åœ¨Macæ–°ç‰ˆæœ¬ä¸Šé¢æ”¯æŒæœ‰é—®é¢˜ã€‚
1# Uninstall SDL 1.2 2brew remove sdl_image 3brew remove sdl_mixer 4brew remove sdl_ttf 5brew remove sdl 6 7# Install SDL 2 8brew install sdl2 9brew install sdl2_ttf 10brew install sdl2_mixer 11brew install sdl2_image æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ–è€…ç›´æ¥æ‰§è¡Œæºç ä¸­çš„script/install_sdl2.shã€‚
2. ç¼–è¯‘ç”¨çš„æ¸¸æˆæ–‡ä»¶ ç¼–è¯‘fhereos2éœ€è¦åŸç‰ˆçš„æ¸¸æˆæ–‡ä»¶ï¼Œå•çº¯ç¼–è¯‘çš„è¯å¯ä»¥ä½¿ç”¨æºç åŒ…ä¸­çš„script/demo/demo_macos.shè„šæœ¬ä¸‹è½½ä¸€ä¸ªdemoç‰ˆæœ¬çš„æ¸¸æˆæ–‡ä»¶åŒ…ã€‚å¦‚æœé€Ÿåº¦æ…¢ï¼Œæ³¨æ„æŒ‚ä»£ç†ã€‚
3. ç¼–è¯‘ ä¸Šé¢ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨æºç æ ¹ç›®å½•æ‰§è¡Œï¼š
1export WITH_SDL2=&amp;#34;ON&amp;#34; 2make å°±å¯ä»¥ç¼–è¯‘äº†ã€‚å°½æƒ…åœ¨Macä¸Šè¿›å…¥è‹±é›„æ— æ•Œçš„ä¸–ç•Œå§~~
é™„å½•ã€å‚è€ƒèµ„æ–™ fheroes2 sourceforge fheroes2 github fheroes2enh github </content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨HttpServletRequestWrapperè§£å†³æ— æ³•å¤šæ¬¡è·å–request Bodyçš„é—®é¢˜</title>
        <url>https://orchidflower.github.io/2020/04/30/Using-HttpServletRequestWrapper-solve-getInputStream/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>Spring</tag>
        </tags>
        <content type="html"> åœ¨ä½¿ç”¨AOPç¼–ç¨‹çš„æ—¶å€™ï¼Œç»å¸¸ç¢°åˆ°éœ€è¦å¤šæ¬¡è·å–æ•´ä¸ªè¯·æ±‚çš„bodyçš„æƒ…å†µã€‚ä¾‹å¦‚ï¼šå…¸å‹åœºæ™¯ä¸‹æˆ‘ä»¬è¦åœ¨AOPåˆ‡é¢ä¸­åšæ—¥å¿—è®°å½•æˆ–æƒé™æ ¡éªŒï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨request.getInputStreamè·å–è¾“å…¥æµï¼Œä»è€Œè¯»å–æ•´ä¸ªè¯·æ±‚çš„æ¶ˆæ¯ä½“ã€‚ä½†æ˜¯è¿™é€šå¸¸ä¼šè§¦å‘ä¸€ä¸ªå¼‚å¸¸ï¼šjava.lang.IllegalStateException: getInputStream() can&#39;t be called after getReader()ã€‚
å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯é»˜è®¤çš„HttpServletRequestå¯¹è±¡ä¸­çš„getInputStream,getReaderå‡½æ•°å¼åªå…è®¸è°ƒç”¨ä¸€æ¬¡ã€‚åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­ï¼Œé™¤äº†æˆ‘ä»¬åœ¨åˆ‡é¢ä¸­è°ƒç”¨getInputStreamä¹‹å¤–ï¼ŒSpring MVCæ¡†æ¶åœ¨è¿›è¡Œå‚æ•°è½¬æ¢çš„æ—¶å€™è¿˜éœ€è¦è°ƒç”¨getInputStreamæ–¹æ³•è¯»å–æ•´ä¸ªè¯·æ±‚çš„æ¶ˆæ¯ä½“ï¼Œç„¶åè½¬å›ä¸ºè¯·æ±‚å‚æ•°ï¼Œè¿™è¿èƒŒäº†åªè°ƒç”¨ä¸€æ¬¡çš„åŸåˆ™ï¼Œä»è€Œè§¦å‘äº†ä»¥å¼‚å¸¸ï¼Œ
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥HttpServletRequestWrapperè¿™ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªç±»å°è£…äº†HttpServletRequestçš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿è¿™ä¸ªç±»ï¼Œä»è€Œä½¿ç”¨ä¸€ä¸ªæ–°ç±»æ¨¡æ‹ŸåŸå§‹HttpServletRequestçš„è¡Œä¸ºã€‚ç„¶åä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆfilterï¼‰å°†åŸå§‹çš„HttpServletRequestå¯¹è±¡æ›¿æ¢ä¸ºHttpServletRequestWrapperå¯¹è±¡ã€‚
æœ€è¿‘åœ¨é¡¹ç›®ä¸­æœ‰éœ€æ±‚ä¸ºAPIè¯·æ±‚å¢åŠ å‚æ•°ç­¾åæ ¡éªŒï¼Œä½¿ç”¨äº†AOPåˆ‡é¢åŠŸèƒ½ï¼Œå› æ­¤ç¢°åˆ°äº†ä¸Šé¢çš„é—®é¢˜ï¼šå‚æ•°æ ¡éªŒåˆ‡é¢ä¸­éœ€è¦åœ¨è¯»å–æ•´ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼Œç„¶åå¯¹æŠ¥æ–‡è¿›è¡Œhmacç®—æ³•ä»è€Œè®¡ç®—ç­¾åå€¼ã€‚ä¸‹é¢è¯´ä¸€ä¸‹å…·ä½“çš„è§£å†³åŠæ³•ï¼Œä»¥ä»£ç ä¸ºä¸»ã€‚
1. ç›¸å…³ä»£ç  1.1 RequestWrapper RequestWrapperç»§æ‰¿äº†HttpServletRequestWrapperï¼Œåˆå§‹åŒ–çš„æ—¶å€™è¯»å–Requestçš„æ•´ä¸ªè¯·æ±‚ä½“ã€‚ç„¶åé‡è½½äº†getInputStreamå’ŒgetReaderæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šä»ç±»å˜é‡bodyä¸­è¯»å–å†…å®¹ã€‚
1public class RequestWrapper extends HttpServletRequestWrapper { 2 private final String body; 3 4 public RequestWrapper(HttpServletRequest request) throws IOException 5 { 6 //So that other request method behave just like before 7 super(request); 8 9 StringBuilder stringBuilder = new StringBuilder(); 10 BufferedReader bufferedReader = null; 11 try { 12 InputStream inputStream = request.getInputStream(); 13 if (inputStream != null) { 14 bufferedReader = new BufferedReader(new InputStreamReader(inputStream)); 15 char[] charBuffer = new char[128]; 16 int bytesRead = -1; 17 while ((bytesRead = bufferedReader.read(charBuffer)) &amp;gt; 0) { 18 stringBuilder.append(charBuffer, 0, bytesRead); 19 } 20 } else { 21 stringBuilder.append(&amp;#34;&amp;#34;); 22 } 23 } catch (IOException ex) { 24 throw ex; 25 } finally { 26 if (bufferedReader != null) { 27 try { 28 bufferedReader.close(); 29 } catch (IOException ex) { 30 throw ex; 31 } 32 } 33 } 34 //Store request pody content in &amp;#39;body&amp;#39; variable 35 body = stringBuilder.toString(); 36 } 37 38 @Override 39 public ServletInputStream getInputStream() throws IOException { 40 final ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(body.getBytes()); 41 ServletInputStream servletInputStream = new ServletInputStream() { 42 @Override 43 public boolean isFinished() { 44 return false; 45 } 46 47 @Override 48 public boolean isReady() { 49 return true; 50 } 51 52 @Override 53 public void setReadListener(ReadListener readListener) { 54 throw new UnsupportedOperationException(); 55 } 56 57 public int read() throws IOException { 58 return byteArrayInputStream.read(); 59 } 60 }; 61 return servletInputStream; 62 } 63 64 @Override 65 public BufferedReader getReader() throws IOException { 66 return new BufferedReader(new InputStreamReader(this.getInputStream())); 67 } 68 69 //Use this method to read the request body N times 70 public String getBody() { 71 return this.body; 72 } 73} 1.2 RequestWrapperFilter RequestWrapperFilteræ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå®ƒå®Œæˆå°†æ™®é€šçš„HttpServletRequestè½¬åŒ–ä¸ºRequestWrapperå¯¹è±¡çš„å·¥ä½œã€‚ä½¿ç”¨æ—¶éœ€è¦ä½¿ç”¨è¯¥filterè¿‡æ»¤éœ€è¦æ·»åŠ æ ¡éªŒçš„urlã€‚
1public class RequestWrapperFilter implements Filter { 2 private FilterConfig filterConfig = null; 3 4 @Override 5 public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { 6 servletRequest = new RequestWrapper((HttpServletRequest) servletRequest); 7 //Read request.getBody() as many time you need 8 filterChain.doFilter(servletRequest, servletResponse); 9 } 10 11 @Override 12 public void init(FilterConfig filterConfiguration) throws ServletException { 13 this.filterConfig = filterConfiguration; 14 } 15 16 @Override 17 public void destroy() { 18 this.filterConfig = null; 19 } 20} 1.3 Configuration åœ¨é…ç½®ç±»ä¸­éœ€è¦ä½¿ç”¨FilterRegisterationBeanå¯¹è¿‡æ»¤å™¨è¿›è¡Œé…ç½®ã€‚è¿™é‡Œé…ç½®è¿‡æ»¤urlä¸ºï¼š/api/dpp/*ã€‚
1 @Bean(name=&amp;#34;apiAuthFilter&amp;#34;) 2 public RequestWrapperFilter apiAuthFilter() { 3 return new RequestWrapperFilter(); 4 } 5 6 @Bean(name=&amp;#34;apiAuthBean&amp;#34;) 7 public FilterRegistrationBean apiAuthBean() { 8 FilterRegistrationBean registration = new FilterRegistrationBean(apiAuthFilter()); 9 registration.setOrder(1); 10 registration.addUrlPatterns(&amp;#34;/api/dpp/*&amp;#34;); 11 return registration; 12 } 1.4 ApiAuthAspect ApiAuthAspectå®Œæˆç­¾åçš„æ ¡éªŒåŠŸèƒ½ã€‚åœ¨è¯¥ç±»ä¸­ä½¿ç”¨äº†Springçš„RequestContextHolderç±»è·å–å½“å‰è¯·æ±‚å¯¹åº”çš„HttpServletRequestã€‚æ³¨æ„ï¼šè¿™é‡Œè·å–åˆ°çš„å¯¹è±¡ä¸­å®é™…åŒ…å«çš„å¯¹è±¡æ˜¯RequestWrapperå¯¹è±¡ã€‚ å› ä¸ºæ˜¯å·²ç»é‡æ–°åŒ…è£…è¿‡çš„RequestWrapperå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å†æ¬¡è°ƒç”¨getReader,getInputStreamæ–¹æ³•ä»¥è·å–æ•´ä¸ªæ¶ˆæ¯ä½“ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè·å–åˆ°çš„HttpServletRequestå¯¹è±¡æ— æ³•ç›´æ¥è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè½¬æ¢ä¸ºRequestWrapperï¼Œç±»å‹ä¸åŒ¹é…ã€‚çŒœæµ‹æ˜¯å®¹å™¨å°è£…äº†å¤šæ¬¡çš„åŸå› ã€‚æœ‰æ—¶é—´å†ä»”ç»†ç ”ç©¶ã€‚
1/** 2 * è·å–å½“å‰è¯·æ±‚çš„HttpServletRequestå¯¹è±¡ 3 * @return 4 */ 5 protected HttpServletRequest getHttpServletRequest() { 6 return ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest(); 7 } 8 9 protected String getRequestBody(HttpServletRequest request) { 10 StringBuffer sb = new StringBuffer(); 11 BufferedReader bufferedReader = null; 12 String content = &amp;#34;&amp;#34;; 13 14 try { 15 //InputStream inputStream = request.getInputStream(); 16 //inputStream.available(); 17 //if (inputStream != null) { 18 bufferedReader = request.getReader() ; //new BufferedReader(new InputStreamReader(inputStream)); 19 char[] charBuffer = new char[128]; 20 int bytesRead; 21 while ( (bytesRead = bufferedReader.read(charBuffer)) != -1 ) { 22 sb.append(charBuffer, 0, bytesRead); 23 } 24 //} else { 25 // sb.append(&amp;#34;&amp;#34;); 26 //} 27 28 } catch (IOException ex) { 29 logger.error(&amp;#34;Failed to getInputStream.&amp;#34;, ex); 30 } finally { 31 if (bufferedReader != null) { 32 try { 33 bufferedReader.close(); 34 } catch (IOException ex) { 35 logger.error(&amp;#34;Failed to getInputStream.&amp;#34;, ex); 36 } 37 } 38 } 39 40 return sb.toString(); 41 } 42 43 public Object apiAuthAround(ProceedingJoinPoint joinPoint) throws Throwable { 44 Object request = joinPoint.getArgs()[0]; 45 MethodSignature signature = ((MethodSignature) joinPoint.getSignature()); 46 47 HttpServletRequest httpRequest = getHttpServletRequest(); 48 String signatureType = httpRequest.getHeader(&amp;#34;x-signature-type&amp;#34;); 49 String signatureData = httpRequest.getHeader(&amp;#34;x-signature-data&amp;#34;); 50 String requestBody = getRequestBody(httpRequest); 51 52 // æ ¡éªŒ 53 } é™„å½•ã€å‚è€ƒèµ„æ–™ How to read request.getInputStream() multiple times HttpServletRequestWrapper example â€“ read httpservletrequest twice </content>
    </entry>
    
     <entry>
        <title>Linuxå¸¸ç”¨å‘½ä»¤ä»‹ç» 04 - journalctl</title>
        <url>https://orchidflower.github.io/2020/04/20/linux-command-introduction-04-journalctl/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag>
        </tags>
        <content type="html"> journalctlå‘½ä»¤æ˜¯Systemdæ—¥å¿—ç³»ç»Ÿçš„ä¸€ä¸ªå‘½ä»¤ï¼Œä¸»è¦ç”¨é€”æ˜¯ç”¨æ¥æŸ¥çœ‹é€šè¿‡Systemdæ—¥å¿—ç³»ç»Ÿè®°å½•çš„æ—¥å¿—ã€‚åœ¨Systemdå‡ºç°ä¹‹å‰ï¼ŒLinuxç³»ç»ŸåŠå„åº”ç”¨çš„æ—¥å¿—éƒ½æ˜¯åˆ†åˆ«ç®¡ç†çš„ï¼ŒSystemdå¼€å§‹ç»Ÿä¸€ç®¡ç†äº†æ‰€æœ‰Unitçš„å¯åŠ¨æ—¥å¿—ï¼Œè¿™æ ·å¸¦æ¥çš„å¥½å¤„å°±æ˜¯å¯ä»¥åªç”¨ä¸€ä¸ª journalctlå‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰å†…æ ¸å’Œåº”ç”¨çš„æ—¥å¿—ã€‚
1. åŸºç¡€ç”¨æ³• 1.1 æŸ¥çœ‹æ‰€æœ‰æ—¥å¿— ä¸ç”¨æ·»åŠ ä»»ä½•ä»»ä½•å‚æ•°è¿è¡Œå¯ä»¥æŸ¥çœ‹æœ¬æ¬¡å¯åŠ¨ä»¥æ¥çš„æ‰€æœ‰æ—¥å¿—ã€‚
1# æ˜¾ç¤ºæœ¬æ¬¡å¯åŠ¨ä»¥æ¥çš„å…¨éƒ¨æ—¥å¿— 2journalctl 1.2 æŸ¥çœ‹å†…æ ¸æ—¥å¿— ä½¿ç”¨-kå‚æ•°å¯ä»¥æŸ¥çœ‹å†…æ ¸æ—¥å¿—ã€‚
1# æ˜¾ç¤ºå†…æ ¸æ—¥å¿— 2journalctl -k 1.3 æ˜¾ç¤ºæœ€ånè¡Œæ—¥å¿— ä½¿ç”¨-nå‚æ•°å¯ä»¥æ˜¾ç¤ºæœ€ånè¡Œæ—¥å¿—ï¼Œå¦‚æœä¸æŒ‡å®šè¡Œæ•°ï¼Œé»˜è®¤æ˜¾ç¤º10è¡Œã€‚
1# æ˜¾ç¤ºæœ€å10è¡Œæ—¥å¿— 2journalctl -n 3# æ˜¾ç¤ºæœ€å100è¡Œæ—¥å¿— 4journalctl -n 100 1.4 æ˜¾ç¤ºæœ€è¿‘ä¸€æ®µæ—¶é—´çš„æ—¥å¿— ä½¿ç”¨-Sæˆ–--sinceå‚æ•°ï¼š
1# æ˜¾ç¤ºæœ€è¿‘30åˆ†é’Ÿä»¥æ¥çš„æ—¥å¿— 2journalctl --since=&amp;#34;30 minutes ago&amp;#34; 3journalctl --since=-30m 4# æ˜¾ç¤ºè‡ª2020-04-21 00:00:00ä»¥æ¥çš„æ—¥å¿— 5journalctl --since=&amp;#34;2020-04-21&amp;#34; 6# æ˜¾ç¤ºä»Šå¤©ä»¥æ¥çš„æ—¥å¿— 7journalctl --since=today 1.5 è·Ÿè¸ªæœ€è¿‘çš„æ—¥å¿— ä½¿ç”¨-få‚æ•°å¯ä»¥å®ç°ç±»å‹tail -fçš„åŠŸèƒ½ï¼ŒæŒç»­ç›‘æ§æœ€æ–°çš„æ—¥å¿—ï¼š
1# è·Ÿè¸ªæœ€è¿‘çš„æ—¥å¿— 2journalctl -f 1.6 æŸ¥çœ‹æŒ‡å®šUnitçš„æ—¥å¿— ä½¿ç”¨-uå‚æ•°ï¼Œå¯ä»¥æŒ‡å®šç‰¹å®šçš„unitï¼ˆSystemdçš„æ¦‚å¿µï¼Œç±»ä¼¼äºæœåŠ¡ï¼‰ã€‚ä¾‹å¦‚ï¼š
1# æŸ¥çœ‹sshdçš„æ—¥å¿— 2&amp;gt; journalctl -u sshd 3-- Logs begin at Tue 2019-11-12 20:18:40 CST, end at Fri 2020-04-17 17:45:01 CST. -- 4-- No entries -- 1.7 ä¸è¿›è¡Œåˆ†é¡µæ˜¾ç¤º é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºç»“æœæ˜¯è¿›è¡Œåˆ†é¡µæ˜¾ç¤ºçš„ã€‚å¯ä»¥ä½¿ç”¨-no-pagerå‚æ•°å»æ‰åˆ†é¡µåŠŸèƒ½ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ç®¡é“åŠŸèƒ½ï¼Œå»æ‰åˆ†é¡µæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚
2. ç»´æŠ¤ 2.1 æŸ¥çœ‹æ—¥å¿—å ç”¨çš„ç£ç›˜ç©ºé—´ ä½¿ç”¨--disk-usageå‚æ•°ã€‚ä¾‹å¦‚ï¼š
1# æŸ¥çœ‹æ—¥å¿—å ç”¨çš„ç©ºé—´ 2&amp;gt; journalctl --disk-usage 3Archived and active journals take up 560.0M in the file system. 2.2 æŒ‰ç…§å ç”¨ç©ºé—´æ¸…ç†æ—¥å¿— 1&amp;gt; journalctl --disk-usage 2Archived and active journals take up 350.2M on disk. 3# æ¸…ç†æ—¥å¿—ï¼Œä¿ç•™300Mçš„æ—¥å¿— 4&amp;gt; journalctl --vacuum-size 200M 5Deleted archived journal /run/log/journal/f94ba353537a4b3f954e3e875225d5d1/system@3064ddfc68cd4fae887e5834914cdce8-000000000027a69c-0005a2067cb4d733.journal (48.8M). 6Deleted archived journal /run/log/journal/f94ba353537a4b3f954e3e875225d5d1/system@3064ddfc68cd4fae887e5834914cdce8-000000000028a54d-0005a21c57b95ba9.journal (48.8M). 7Deleted archived journal /run/log/journal/f94ba353537a4b3f954e3e875225d5d1/system@3064ddfc68cd4fae887e5834914cdce8-000000000029d3a2-0005a239670d6298.journal (48.8M). 8Vacuuming done, freed 146.6M of archived journals on disk. 2.3 æŒ‰ç…§æ—¥å¿—æ—¶é—´æ¸…ç†æ—¥å¿— 1# æ¸…ç†ä¸€ä¸ªå‘¨å‰çš„æ—¥å¿— 2&amp;gt; journalctl --vacuum-time=1week 3Deleted archived journal /run/log/journal/f94ba353537a4b3f954e3e875225d5d1/system@3064ddfc68cd4fae887e5834914cdce8-00000000002b03ce-0005a258817ead63.journal (48.8M). 4Deleted archived journal /run/log/journal/f94ba353537a4b3f954e3e875225d5d1/system@3064ddfc68cd4fae887e5834914cdce8-00000000002c0f37-0005a2e4f7cb5b8f.journal (48.8M). 5Vacuuming done, freed 97.7M of archived journals on disk. 3. é…ç½® é…ç½®æ–‡ä»¶åœ¨/etc/systemd/journald.confã€‚å¯èƒ½ä¼šç”¨åˆ°çš„é…ç½®é¡¹æœ‰ï¼š
1# é…ç½®æ—¥å¿—ç³»ç»Ÿå ç”¨çš„æœ€å¤§ç©ºé—´ã€‚å¯ä»¥å®ç°ç±»ä¼¼2.2çš„åŠŸèƒ½ 2SystemMaxUse=500M 3# å®šä¹‰å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚æœ€å¤§128M 4SystemMaxFileSize=100M 5# å®šä¹‰æœ€å¤§æ—¥å¿—æ–‡ä»¶æ•°ç›®ã€‚æœ€å¤§100ä¸ª 6SystemMaxFiles=5 7# å®šä¹‰æ—¥å¿—æ–‡ä»¶æœ€å¤šä¿å­˜1ä¸ªæœˆ 8MaxRetentionSec=1month </content>
    </entry>
    
     <entry>
        <title>Linuxå¸¸ç”¨å‘½ä»¤ä»‹ç» 03 - tree</title>
        <url>https://orchidflower.github.io/2020/04/07/linux-command-introduction-03-tree/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag>
        </tags>
        <content type="html"> treeå‘½ä»¤çš„ä½œç”¨æ˜¯ä»¥æ ‘çŠ¶å›¾çš„å½¢å¼åˆ—å‡ºç›®å½•çš„å†…å®¹ã€‚é€šå¸¸åœ¨å†™æ–‡æ¡£æ—¶éœ€è¦åˆ—ä¸€ä¸‹æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œè¿™ä¸ªæ—¶å€™treeå‘½ä»¤å°±éå¸¸æœ‰ç”¨äº†
1. å®‰è£…&amp;amp;ä½¿ç”¨ æˆ‘ç”¨çš„Ubuntuä¸Šé»˜è®¤æ²¡æœ‰å®‰è£…treeå‘½ä»¤ã€‚å¯ä»¥é€šè¿‡ï¼šsudo apt install treeå‘½ä»¤å®‰è£…ã€‚å…¶ä»–çš„å‘è¡Œç‰ˆå‚è€ƒå¯¹åº”çš„å‘½ä»¤ã€‚
ç›´æ¥ä½¿ç”¨treeå‘½ä»¤æˆ–è€…tree [directory]å‘½ä»¤å³å¯åˆ—å‡ºç›®å½•ä¸­çš„å†…å®¹ã€‚
2. åªåˆ—å‡ºç›®å½• é»˜è®¤æƒ…å†µä¸‹ï¼Œtreeå‘½ä»¤ä¼šåŒæ—¶åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š
1# åˆ—å‡ºå…¨éƒ¨å†…å®¹ 2tree . 3. 4â”œâ”€â”€ Cargo.lock 5â”œâ”€â”€ Cargo.toml 6â””â”€â”€ src 7 â””â”€â”€ main.rs 8 91 directory, 3 files å¦‚æœä¸æƒ³æ˜¾ç¤ºæ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨-då‚æ•°ï¼Œåªåˆ—å‡ºæ–‡ä»¶å¤¹ï¼š
1# åªåˆ—å‡ºç›®å½• 2tree -d . 3. 4â””â”€â”€ src 5 61 directory 3. æŒ‡å®šç›®å½•çš„å±‚çº§ é»˜è®¤å¯ä»¥ä½¿ç”¨-Lå‚æ•°æŒ‡å®šåˆ—å‡ºçš„æœ€å¤§ç›®å½•å±‚æ•°ã€‚ä¾‹å¦‚ï¼š
1# åªåˆ—å‡ºä¸¤å±‚ç›®å½•å†…çš„ç»“æ„ 2tree -L 2 4. ä¸­æ–‡ æˆ‘åœ¨Macä¸Šé¢ä½¿ç”¨treeçš„æ—¶å€™ï¼Œä¸­æ–‡æ–‡ä»¶åæ˜¯æ˜¾ç¤ºä¹±ç çš„ã€‚å¯ä»¥ä½¿ç”¨-Nå‚æ•°è§£å†³ã€‚
1# è§£å†³Macä¸Šé¢çš„ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚å…¶ä»–å¹³å°å¦‚æœä¹Ÿç¢°åˆ°ï¼Œä¹Ÿå¯ä»¥å°è¯• 2tree -N 5. å‚æ•°ä»‹ç» -d List directories only. -L level Max display depth of the directory tree. -N Print non-printable characters as is instead of as escaped octal numbers. </content>
    </entry>
    
     <entry>
        <title>Linuxå¸¸ç”¨å‘½ä»¤ä»‹ç» 02 - ssh</title>
        <url>https://orchidflower.github.io/2020/03/29/linux-command-introduction-02-ssh/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag>
        </tags>
        <content type="html"> SSHåœ¨Linuxä¸­å æœ‰é‡è¦çš„åœ°ä½ã€‚é€šå¸¸æˆ‘ä»¬è¿œç¨‹ç™»å½•æœåŠ¡å™¨éƒ½æ˜¯é€šè¿‡sshåè®®ï¼Œä½†æ˜¯sshå‘½ä»¤ï¼ˆæˆ–è€…SSHåè®®ï¼‰èƒ½å¤Ÿå®ç°çš„åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šã€‚æˆ‘æ—¥å¸¸ç”¨åˆ°ä¸€äº›ï¼Œä½†æ˜¯è‚¯å®šè¿˜æœ‰å„ç§å„æ ·çš„ç”¨æ³•ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œæœç´¢æ›´å¤šèµ„æ–™ã€‚
1. é˜²æ­¢æ‰çº¿ ä½¿ç”¨SSHè¿æ¥æœåŠ¡å™¨æ—¶å€™ï¼Œé€šå¸¸ç¬¬ä¸€ä¸ªè¦ä¿®æ”¹çš„é€‰é¡¹å°±æ˜¯é˜²æ­¢æ‰çº¿ã€‚æ€»ä½“ä¸Šæ¥è¯´æœ‰ä¸¤ç±»æ–¹æ³•æ¥é˜²æ­¢æœåŠ¡å™¨æ‰çº¿ï¼š
å®¢æˆ·ç«¯/å®¢æˆ·ç«¯å·¥å…·å‘é€å¿ƒè·³åŒ…ï¼› æœåŠ¡å™¨ç«¯å‘é€å¿ƒè·³åŒ…ã€‚ å¦‚æœæœ‰æœåŠ¡å™¨çš„æ§åˆ¶æƒï¼Œå¯ä»¥ä¿®æ”¹sshçš„é…ç½®é€‰é¡¹ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼Œé€šå¸¸æ›´æœ‰ä¿éšœä¸€äº›ã€‚å¦‚æœæ²¡æœ‰æœåŠ¡å™¨çš„æ§åˆ¶æƒï¼Œé‚£å°±åªèƒ½ç”¨ç¬¬ä¸€ç§äº†ã€‚ 1.1 å®¢æˆ·ç«¯å·¥å…·SecureCRT å®¢æˆ·ç«¯å·¥å…·é…ç½®å› å·¥å…·è€Œå¼‚ã€‚æˆ‘ç”¨çš„æ˜¯SecureCRTï¼Œç›¸åº”çš„é…ç½®å¯ä»¥åœ¨ï¼šSession Options - Terminalä¸­ï¼Œå¯¹åº”çš„é€‰é¡¹ä¸ºï¼šSend protocol NO-OPï¼Œè¿™é‡Œéœ€è¦è®¾ç½®æ¯ä¸ªå¤šå°‘ç§’é’Ÿå‘é€ä¸€ä¸ªNO-OPæŒ‡ä»¤ç»™æœåŠ¡å™¨ä»¥ç»´æŒè¿æ¥ä¸æ–­å¼€ã€‚é…ç½®å¦‚ä¸‹å›¾ï¼š 1.2 Macå‘½ä»¤è¡Œå®¢æˆ·ç«¯ å¦‚æœä½¿ç”¨Macå‘½ä»¤è¡Œä¸­çš„sshå‘½ä»¤ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶.ssh/configä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š
1Host myhostshortcut 2 HostName myhost.com 3 User barthelemy 4 ServerAliveInterval 60 5 ServerAliveCountMax 10 1.3 æœåŠ¡å™¨ç«¯é…ç½® æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶åœ¨ï¼š/etc/ssh/sshd_configï¼Œå¢åŠ å¦‚ä¸‹é…ç½®å³å¯ï¼š
1ClientAliveInterval 30 2ClientAliveCountMax 86400 å…¶ä¸­çš„å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š
ServerAliveInterval: number of seconds that the client will wait before sending a null packet to the server (to keep the connection alive).
ClientAliveInterval: number of seconds that the server will wait before sending a null packet to the client (to keep the connection alive).
Setting a value of 0 (the default) will disable these features so your connection could drop if it is idle for too long.
æ€»ç»“ä¸€ä¸‹ï¼šServerAliveIntervalç”¨åœ¨å®¢æˆ·ç«¯é…ç½®ä¸Šï¼Œè®©å®¢æˆ·ç«¯æ¯ä¸ªä¸€æ®µæ—¶é—´å‘é€NO_OPåŒ…ä»¥ä¿æŒè¿æ¥æƒ³ï¼›ClientAliveIntervalç”¨åœ¨æœåŠ¡å™¨ç«¯é…ç½®ï¼Œè®©æœåŠ¡å™¨ç«¯æ¯éš”ä¸€æ®µæ—¶é—´å‘é€åŒ…ä»¥ä¿æŒè¿æ¥ã€‚ é™¤äº†ServerAliveInterval,ClientAliveIntervalå¤–è¿˜æœ‰ï¼šClientAliveCountMax,ServerAliveCountMaxï¼Œé»˜è®¤å€¼ä¸º3ã€‚ä¿æŒè¿çº¿çš„æœ€å¤§æ—¶é•¿=Interval*CountMaxã€‚
2. é€šè¿‡SSHæ˜ å°„è¿œç¨‹æœåŠ¡å™¨ç«¯å£åˆ°æœ¬åœ° ä¾‹å¦‚ï¼šæˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æœ‰æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿å¼€æ”¾ç«¯å£åˆ°å¤–ç½‘ã€‚è€Œæœ¬åœ°çš„ç ”å‘æˆ–è€…å…¶ä»–äººå‘˜ä¹Ÿæƒ³è®¿é—®å®ƒã€‚è¿™æ—¶å¯ä»¥é€šè¿‡sshåè®®å°†è¿œç¨‹ç«¯å£æ˜ å°„åˆ°æœ¬åœ°ç½‘ç»œä¸­ã€‚
ä¾‹å¦‚ï¼Œç¯å¢ƒä¿¡æ¯å¦‚ä¸‹ï¼š
æ•°æ®åº“æœåŠ¡å™¨IPä¸ºï¼š 192.168.77.99:3306 è·³æ¿æœºåœ°å€ä¸ºï¼štaxfort.eveus.com è·³æ¿æœºè®¿é—®ç”¨æˆ·æ˜¯ubuntuï¼Œè®¿é—®æ–¹å¼æ˜¯è¯ä¹¦ï¼ˆ/opt/apps/taxmyxql/id_rsaï¼‰ï¼› æ˜ å°„åˆ°æœ¬åœ°æœºå™¨ï¼š 192.168.2.236:33306 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å®ç°ï¼š
1#!/bin/bash 2ssh -o StrictHostKeyChecking=no -i /opt/apps/taxmysql/id_rsa -L 192.168.2.236:33306:192.168.77.99:3306 -N ubuntu@taxfort.eveus.com ç›¸å…³å‚æ•°ä»‹ç»ï¼š
-o StrictHostKeyChecking=no è·³è¿‡æœåŠ¡å™¨è¯ä¹¦å¼ºåˆ¶æ ¡éªŒã€‚ä¹Ÿå°±æ˜¯ä¸éœ€è¦åœ¨authorized_keysä¸­å­˜åœ¨ä¹Ÿå¯ä»¥é“¾æ¥æœåŠ¡å™¨ï¼› -i æŒ‡å®šè¿æ¥ç”¨çš„è¯ä¹¦ -L æŒ‡å®šç«¯å£æ˜ å°„çš„ä¿¡æ¯ã€‚æ ¼å¼æ˜¯ï¼š[bind_address:]port:host:hostport -N ä¸æ‰§è¡Œè¿œç«¯çš„å‘½ä»¤ã€‚ </content>
    </entry>
    
     <entry>
        <title>Macä¸Šé¢çš„æ–‡ä»¶æ¯”è¾ƒåŠŸèƒ½</title>
        <url>https://orchidflower.github.io/2020/03/20/How-to-compare-file-on-mac/</url>
        <categories>
          <category>æŠ€å·§</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>FileMerge</tag><tag>ForkLift</tag><tag>file</tag>
        </tags>
        <content type="html"> ä»¥å‰åœ¨Windowsä¸Šä¸€ç›´ä½¿ç”¨TotalCmdï¼Œå®ƒçš„æ¯”è¾ƒåŠŸèƒ½éå¸¸æ£’ã€‚ä¸è®ºæ˜¯ç›®å½•è¿˜æ˜¯æ–‡ä»¶ï¼Œåªè¦æŒ‰ä¸‹F10ï¼Œå°±èƒ½å¤Ÿæ¯”è¾ƒï¼Œè¿˜èƒ½å¤ŸåŒæ­¥ï¼Œéå¸¸æ–¹ä¾¿ã€‚åˆ‡æ¢åˆ°Macä¹Ÿæœ‰å¥½å‡ å¹´äº†ï¼Œä¸€ç›´æ²¡æœ‰æ‰¾åˆ°å®Œå…¨åŒ¹é…ä¸Šçš„æ›¿ä»£å“ã€‚ç°åœ¨ç”¨çš„æ˜¯ForkLiftï¼Œå¸¸ç”¨åŠŸèƒ½è¿˜å¯ä»¥ï¼Œä½†æ˜¯æ¯”è¾ƒåŠŸèƒ½å·®è·å¾ˆå¤§ã€‚ç›®å‰æ­£åœ¨æƒ³åŠæ³•è‡ªå·±å†™ä¸€äº›è„šæœ¬å¢å¼ºä¸€ä¸‹åŠŸèƒ½ã€‚
ç›®å‰å®ç°äº†ä¸€ä¸ªè„šæœ¬ï¼Œé€šè¿‡ForkLiftè°ƒç”¨ï¼Œå¯ä»¥æ»¡è¶³åŸºæœ¬çš„æ¯”è¾ƒåŠŸèƒ½ï¼š
ä½¿ç”¨fileåˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå¯¹æ–‡æœ¬ç±»å‹è°ƒç”¨FileMergeè¿›è¡Œæºç æ¯”è¾ƒï¼› å¦‚æœä¸æ˜¯ï¼Œåˆ™åªç”¨cmpåŠŸèƒ½æ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸ç­‰ï¼› åæœŸè€ƒè™‘å¢åŠ å¯¹ç›®å½•ç±»å‹çš„æ”¯æŒï¼Œå¼•å…¥ç›®å½•æ¯”è¾ƒå·¥å…·ã€‚ 1. ä»£ç  1#!/bin/bash 2# error &amp;#34;Message&amp;#34; 3function error() { 4 osascript &amp;lt;&amp;lt;EOT 5 tell app &amp;#34;System Events&amp;#34; 6 display dialog &amp;#34;$1&amp;#34; buttons {&amp;#34;OK&amp;#34;} default button 1 with icon caution with title &amp;#34;$(basename $0)&amp;#34; 7 return -- Suppress result 8 end tell 9EOT 10} 11 12src=$1 13dst=$2 14 15if [ &amp;#34;$src&amp;#34; = &amp;#34;&amp;#34; -o &amp;#34;$dst&amp;#34; = &amp;#34;&amp;#34; ]; then 16	error &amp;#34;Please choose two files to compare...&amp;#34; 17	exit 1 18fi 19 20# è·å–æ–‡ä»¶ç±»å‹ 21fi1=`file -I -b $src` 22fi2=`file -I -b $dst` 23 24# åªæœ‰åœ¨å…¨æ˜¯æ–‡æœ¬ç±»å‹çš„æ—¶å€™ä½¿ç”¨FileMergeè¿›è¡Œæ¯”è¾ƒ 25if [[ &amp;#34;$fi1&amp;#34; =~ ^text/.* &amp;amp;&amp;amp; &amp;#34;$fi2&amp;#34; =~ ^text/.* ]]; then 26	/Applications/Xcode.app/Contents/Applications/FileMerge.app/Contents/MacOS/FileMerge -left $1 -right $2 &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp; 27else 28	# å¦åˆ™ï¼Œä½¿ç”¨cmpæ¯”è¾ƒï¼Œç›´æ¥æ˜¾ç¤ºç»“æœ 29	cmp -s &amp;#34;$1&amp;#34; &amp;#34;$2&amp;#34; 30	if [ $? -eq 0 ]; then 31	error &amp;#34;Same. Files: \n ${src##*/} \n ${dst##*/}&amp;#34; 32	else 33	error &amp;#34;Not same. Files: \n ${src##*/} \n ${dst##*/}&amp;#34; 34	fi 35fi	2. ç”¨åˆ°çš„å·¥å…· 2.1 file fileå‘½ä»¤å¯ä»¥ç”¨æ¥è·å–æ–‡ä»¶çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š
1&amp;gt; file -I Application.java 2Application.java: text/x-c; charset=us-ascii 3 4&amp;gt; file -I soapui-settings.xml 5soapui-settings.xml: text/xml; charset=us-ascii 6 7&amp;gt; file -I *.jpg 8mmexport1576413628825.jpg: image/jpeg; charset=binary 9 10&amp;gt; file -I *.mkv 11[ç»ˆç»“è€…ï¼šé»‘æš—å‘½è¿].Terminator.Dark.Fate.2019.BluRay.720p.x264.AC3-CMCT.mkv: video/x-matroska; charset=binary fileå‘½ä»¤é€šè¿‡å¤šç§åˆ†ææ¥æœ€ç»ˆç¡®å®šä¸€ä¸ªæ–‡ä»¶çš„ç±»å‹ï¼ˆåŒ…æ‹¬ï¼šfilesystem tests, magic tests, language tests)ï¼Œå…·ä½“çš„å¯ä»¥çœ‹å¸®åŠ©ã€‚ å¸¸ç”¨çš„å‡ ä¸ªå‚æ•°ä»‹ç»ä¸€ä¸‹ï¼š
-I, --mime æ‰“å°æ–‡ä»¶çš„mimeç±»å‹ç¼–ç ã€‚ä¹Ÿå°±æ˜¯æ‰“å°è¯¸å¦‚:text/plain; charset=us-asciiè¿™ç§æ ¼å¼ä¿¡æ¯è€Œä¸æ˜¯ASCII textã€‚è¿™ç§è¿”å›çš„ç±»å‹æ¯”è¾ƒè§„èŒƒï¼Œä¾‹å¦‚ä¸Šé¢ä»£ç ä¸­å°±æ˜¯é€šè¿‡åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä»¥textå¼€å¤´æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚ -b, --brief ç²¾ç®€æ¨¡å¼ã€‚ä¸å†è¾“å‡ºç»“æœä¸­æ‰“å°æ–‡ä»¶åã€‚æ–¹ä¾¿ä»£ç ä¸­å¤„ç†ã€‚ 2.2 cmp cmpå‘½ä»¤æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œæ¯”è¾ƒå·¥å…·ï¼Œå¯ä»¥æŒ‰å­—èŠ‚æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒã€‚ç”¨åˆ°çš„å‚æ•°ä»‹ç»ï¼š
-s, --silent é™é»˜æ¯”è¾ƒæ–¹å¼ï¼Œå‘½ä»¤ä¸è¾“å‡ºä»»ä½•å†…å®¹ã€‚éœ€è¦åˆ¤æ–­å‘½ä»¤çš„è¿”å›å€¼æ˜¯å¦ä¸º0åˆ¤æ–­ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸ç­‰ã€‚ 2.3 FileMerge FileMergeæ˜¯XCodeä¸­è‡ªå¸¦çš„ä¸€ä¸ªæ–‡ä»¶æ¯”è¾ƒå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥æ¯”è¾ƒæºç ï¼Œå®ƒæ”¯æŒå‘½ä»¤è¡Œè°ƒç”¨ï¼ˆé€šè¿‡-left, -rightæŒ‡å®šæ–‡ä»¶ï¼‰ï¼Œè€Œä¸”æ¯”è¾ƒåŠŸèƒ½ä¹Ÿä¸é”™ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢æˆå…¶ä»–çš„å•†ä¸šè½¯ä»¶ä»¥è·å¾—æ›´å¼ºçš„æ¯”è¾ƒåŠŸèƒ½ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ How to Determine File Type &amp;amp; Encoding from Command Line in Mac OS X </content>
    </entry>
    
     <entry>
        <title>Linuxå¸¸ç”¨å‘½ä»¤ä»‹ç» 01 - curl</title>
        <url>https://orchidflower.github.io/2020/03/13/linux-command-introduction-01-curl/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag>
        </tags>
        <content type="html"> å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ã€‚ä¹‹å‰ä¸€ç›´ç”¨hexoï¼Œé…ç½®èµ·æ¥ç¨æ˜¾å¤æ‚ï¼Œå•ä¸ªçš„æ—¶é—´ä¸€é•¿æœ‰äº›å¿˜äº†ï¼Œæä¸èµ·æ¥äº†ï¼Œäºæ˜¯è’åºŸäº†å¾ˆé•¿æ—¶é—´ã€‚æœ€è¿‘ä¸‹å®šå†³å¿ƒè¿ç§»åˆ°äº†Hugoä¸Šã€‚æ€»ä½“æ„Ÿè§‰Hugoé€Ÿåº¦ç¡®å®å¿«ï¼Œè¿™ä¸€ç‚¹éå¸¸å–œæ¬¢ã€‚ä»¥åæœ‰æ—¶é—´å¯ä»¥ä»‹ç»ä¸€ä¸‹è¿™æ¬¡è¿ç§»çš„è¿‡ç¨‹ã€‚
è¿™å‡ å¹´ä¸€ç›´ä¸é—´æ–­çš„ä¸Linuxæ‰“äº¤é“ï¼Œä½†æ˜¯Linuxçš„å‘½ä»¤ä¸€ç›´æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œæ‰€ä»¥ç¢°åˆ°é—®é¢˜çš„æ—¶å€™è¿˜æ˜¯è¦å„ç§æœç´¢ï¼ŒæŒºéº»çƒ¦çš„ã€‚è¿™æ¬¡æƒ³æ•´ç†ä¸€ä¸ªå¸¸ç”¨å‘½ä»¤çš„ä»‹ç»ç³»åˆ—ï¼ŒæŠŠå¹³å¸¸ç”¨åˆ°çš„å‘½ä»¤ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚ä¸ä¼šæ˜¯è¯¦å°½çš„å¸®åŠ©ç±»ä»‹ç»ï¼Œæ›´å¤šçš„æ˜¯åŸºäºåœºæ™¯çš„ä»‹ç»ï¼šè­¬å¦‚è¦å®ç°ä»€ä¹ˆåŠŸèƒ½ç”¨ä»€ä¹ˆå‚æ•°ä¹‹ç±»çš„ã€‚ä½œä¸ºä»¥åçš„å¤‡æŸ¥å§ï¼Œå°±ä¸ç”¨å†åˆ°å¤„æœç´¢äº†ã€‚ï¼šï¼‰
ç¬¬ä¸€ä¸ªå‘½ä»¤ä»‹ç»curlã€‚
1. ç½‘ç«™è¯Šæ–­ æœ‰æ—¶å€™ç¢°åˆ°æŸä¸ªç½‘ç«™è¿æ¥æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨curlå‘½ä»¤ååŠ©è§£å†³ã€‚ä¾‹å¦‚å¯ä»¥ç”¨æ¥æ’æŸ¥è¯ä¹¦æ˜¯å¦æ­£ç¡®ã€è¿”å›Headerä¿¡æ¯æ˜¯å¦æ­£ç¡®ä¹‹ç±»çš„ã€‚ä¾‹å¦‚ï¼š
1&amp;gt; curl -v -I https://www.baidu.com 2* Trying 180.101.49.12... 3* TCP_NODELAY set 4* Connected to www.baidu.com (180.101.49.12) port 443 (#0) 5* ALPN, offering h2 6* ALPN, offering http/1.1 7* successfully set certificate verify locations: 8* CAfile: /etc/ssl/cert.pem 9 CApath: none 10* TLSv1.2 (OUT), TLS handshake, Client hello (1): 11* TLSv1.2 (IN), TLS handshake, Server hello (2): 12* TLSv1.2 (IN), TLS handshake, Certificate (11): 13* TLSv1.2 (IN), TLS handshake, Server key exchange (12): 14* TLSv1.2 (IN), TLS handshake, Server finished (14): 15* TLSv1.2 (OUT), TLS handshake, Client key exchange (16): 16* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1): 17* TLSv1.2 (OUT), TLS handshake, Finished (20): 18* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1): 19* TLSv1.2 (IN), TLS handshake, Finished (20): 20* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 21* ALPN, server accepted to use http/1.1 22* Server certificate: 23* subject: C=CN; ST=beijing; L=beijing; OU=service operation department; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com 24* start date: May 9 01:22:02 2019 GMT 25* expire date: Jun 25 05:31:02 2020 GMT 26* subjectAltName: host &amp;#34;www.baidu.com&amp;#34; matched cert&amp;#39;s &amp;#34;*.baidu.com&amp;#34; 27* issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign Organization Validation CA - SHA256 - G2 28* SSL certificate verify ok. 29&amp;gt; HEAD / HTTP/1.1 30&amp;gt; Host: www.baidu.com 31&amp;gt; User-Agent: curl/7.64.1 32&amp;gt; Accept: */* 33&amp;gt; 34&amp;lt; HTTP/1.1 200 OK 35HTTP/1.1 200 OK 36&amp;lt; Accept-Ranges: bytes 37Accept-Ranges: bytes 38&amp;lt; Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform 39Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform 40&amp;lt; Connection: keep-alive 41Connection: keep-alive 42&amp;lt; Content-Length: 277 43Content-Length: 277 44&amp;lt; Content-Type: text/html 45Content-Type: text/html 46&amp;lt; Date: Fri, 13 Mar 2020 08:51:05 GMT 47Date: Fri, 13 Mar 2020 08:51:05 GMT 48&amp;lt; Etag: &amp;#34;575e1f60-115&amp;#34; 49Etag: &amp;#34;575e1f60-115&amp;#34; 50&amp;lt; Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT 51Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT 52&amp;lt; Pragma: no-cache 53Pragma: no-cache 54&amp;lt; Server: bfe/1.0.8.18 55Server: bfe/1.0.8.18 56 57&amp;lt; 58* Connection #0 to host www.baidu.com left intact 59* Closing connection 0 å…¶ä¸­çš„å‚æ•°ä»‹ç»å¦‚ä¸‹ï¼š
-v, &amp;ndash;verbose æ˜¾ç¤ºè¯¦ç»†çš„æç¤ºä¿¡æ¯ï¼› -I, &amp;ndash;head åªè·å–è¯·æ±‚å¤´ä¿¡æ¯ã€‚åœ¨è¯Šæ–­é“¾æ¥çš„æ—¶å€™ä½¿ç”¨è¯¥å‚æ•°å¿½ç•¥çœŸæ­£è¿”å›çš„å†…å®¹æ¯”è¾ƒæ–¹ä¾¿æ’æŸ¥åŸå› ã€‚ 2. å¿½ç•¥è¯ä¹¦ å½“è®¿é—®ä¸€ä¸ªè‡ªç­¾åè¯ä¹¦çš„ç½‘ç«™çš„æ—¶å€™ï¼Œå¯ä»¥å¿½ç•¥å¯¹è¯ä¹¦çš„æ ¡éªŒã€‚ä¾‹å¦‚ï¼š
1# è¯¥ç½‘ç«™æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œç›´æ¥è®¿é—®æ— æ³•è®¿é—® 2&amp;gt; curl https://192.168.2.241 3curl: (60) SSL certificate problem: self signed certificate in certificate chain 4More details here: https://curl.haxx.se/docs/sslcerts.html 5 6curl failed to verify the legitimacy of the server and therefore could not 7establish a secure connection to it. To learn more about this situation and 8how to fix it, please visit the web page mentioned above. 9 10# åŠ ä¸Š-kå‚æ•°ï¼Œè·³è¿‡è¯ä¹¦æ£€æµ‹ 11&amp;gt; curl -k https://192.168.2.241 12&amp;lt;!DOCTYPE HTML PUBLIC &amp;#34;-//W3C//DTD HTML 4.01//EN&amp;#34; &amp;#34;http://www.w3.org/TR/html4/strict.dtd&amp;#34;&amp;gt; 13 14&amp;lt;html lang=&amp;#34;en&amp;#34;&amp;gt; 15&amp;lt;head&amp;gt; 16 &amp;lt;meta http-equiv=&amp;#34;content-type&amp;#34; content=&amp;#34;text/html; charset=utf8&amp;#34;&amp;gt; 17 &amp;lt;meta http-equiv=&amp;#34;refresh&amp;#34; content=&amp;#34;0;URL=&amp;#39;/ui&amp;#39;&amp;#34;/&amp;gt; 18&amp;lt;/head&amp;gt; 19&amp;lt;/html&amp;gt; å‚æ•°ä»‹ç»ï¼š
-k, &amp;ndash;insecure è·³è¿‡å¯¹æœåŠ¡å™¨ç«¯è¯ä¹¦çš„æ£€æµ‹ã€‚ 3. è®¾ç½®ä»£ç† å¯ä»¥é€šè¿‡-xå‚æ•°è®¾ç½®ä»£ç†æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼š
1-x socks5://127.0.0.1:12345 2-x http://127.0.0.1:12346 å‚æ•°ä»‹ç»ï¼š
-x, --proxy [protocol://]host[:port] protocolå¯ä»¥ä¸ºï¼šsocks4, socks4a, socks5, socks5h, httpæˆ–è€…httpsã€‚é»˜è®¤æ˜¯httpã€‚ 4. å‘é€jsonè¯·æ±‚ å¯ä»¥é€šè¿‡curlç›´æ¥æ¨¡æ‹Ÿhttpè®¿é—®å‘é€jsonæ ¼å¼çš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š
1curl -H &amp;#34;Content-Type: application/json&amp;#34; -X POST -d &amp;#39;{ &amp;#34;customerId&amp;#34;: 1, &amp;#34;customerName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;, &amp;#34;channelId&amp;#34;: 1, &amp;#34;channelName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;}&amp;#39; https://taxer.fxl.eveus.com/api/admin/qrcode -H æŒ‡å®šè¯·æ±‚ç”¨çš„headerã€‚è¿™é‡ŒæŒ‡å®šäº†Content-Typeä¸ºapplication/jsonï¼› -X æŒ‡å®šè¯·æ±‚ç±»å‹ã€‚é»˜è®¤æ˜¯GETã€‚å¯ä»¥æ˜¯POSTã€PUTã€OPTIONç­‰ï¼› -d åé¢æŒ‡å®šè¯·æ±‚ç”¨çš„å‚æ•°ã€‚ ä¹Ÿå¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–æ¶ˆæ¯å†…å®¹ï¼Œä½¿ç”¨-d @filenameæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶request.jsonï¼Œå†…å®¹å¦‚ä¸‹ï¼š
1{ &amp;#34;customerId&amp;#34;: 1, &amp;#34;customerName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;, &amp;#34;channelId&amp;#34;: 1, &amp;#34;channelName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;} ç„¶åä½¿ç”¨å‘½ä»¤è¯·æ±‚å¦‚ä¸‹ï¼š
1curl -H &amp;#34;Content-Type: application/json&amp;#34; -X POST -d @request.json https://taxer.fxl.eveus.com/api/admin/qrcode 5. ä½¿ç”¨ä¸ªäººè¯ä¹¦ å¦‚æœç½‘ç«™ä½¿ç”¨äº†åŒå‘httpsè®¤è¯ï¼Œåˆ™ä¼šæä¾›ä¸€ä¸ªå®¢æˆ·ç«¯è¯ä¹¦ç»™è®¿é—®è€…ã€‚curlä¹Ÿæ”¯æŒä½¿ç”¨ä¸ªäººè¯ä¹¦è¿›è¡Œæˆæƒè®¤è¯ã€‚æ–¹æ³•æ˜¯ä½¿ç”¨å‚æ•°ï¼š--certå’Œ--keyã€‚æ ¹æ®è¯ä¹¦å†…å®¹çš„ä¸åŒï¼Œ--keyæœ‰æ—¶å¯ä»¥ä¸ä½¿ç”¨ï¼ˆå¦‚æœè¯ä¹¦ä¸­å·²ç»åŒ…å«äº†ç§é’¥ï¼‰ã€‚ curlä¸æ”¯æŒp12æ ¼å¼çš„è¯ä¹¦ï¼Œå¦‚æœæ”¶åˆ°çš„æ˜¯p12æ ¼å¼çš„è¯ä¹¦ï¼ˆJavaç¨‹åºå¸¸ç”¨ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨opensslè½¬æ¢æˆéœ€è¦çš„pemæ ¼å¼ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š
1# å¦‚æœp12æ–‡ä»¶æ˜¯å¯†é’¥ä¿æŠ¤çš„ï¼Œåˆ™éœ€è¦è¾“å…¥å¯†ç  2# æå–è¯ä¹¦ï¼ŒåŒ…å«ç§é’¥ 3openssl pkcs12 -in client.p12 -out cert&amp;amp;key.pem 4# åªä¿ç•™è¯ä¹¦ï¼Œä¸åŒ…å«ç§é’¥ 5openssl pkcs12 -in client.p12 -nokeys -out cert.pem 6# åªæå–ç§é’¥ 7openssl pkcs12 -in client.p12 -nocerts -out key.pem -nodes ä½¿ç”¨è¯ä¹¦è¿›è¡Œæˆæƒæ–¹æ³•çš„å‘½ä»¤å¦‚ä¸‹ï¼š
1# ä½¿ç”¨åŒ…å«ç§é’¥çš„è¯ä¹¦ 2curl --cert cert&amp;amp;key.pem -H &amp;#34;Content-Type: application/json&amp;#34; -X POST -d &amp;#39;{ &amp;#34;customerId&amp;#34;: 1, &amp;#34;customerName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;, &amp;#34;channelId&amp;#34;: 1, &amp;#34;channelName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;}&amp;#39; https://taxer.fxl.eveus.com/api/admin/qrcode 3# ä½¿ç”¨åˆ†å¼€çš„è¯ä¹¦å’Œç§é’¥ 4curl --cert cert.pem --key key.pem -H &amp;#34;Content-Type: application/json&amp;#34; -X POST -d &amp;#39;{ &amp;#34;customerId&amp;#34;: 1, &amp;#34;customerName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;, &amp;#34;channelId&amp;#34;: 1, &amp;#34;channelName&amp;#34;: &amp;#34;é’å²›å“æœ›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸&amp;#34;}&amp;#39; https://taxer.fxl.eveus.com/api/admin/qrcode </content>
    </entry>
    
     <entry>
        <title>iOSè¯ä¹¦åŠæ¨é€ç›¸å…³æ¦‚å¿µ</title>
        <url>https://orchidflower.github.io/2018/09/04/ios-push-and-certificate/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>ios</tag><tag>push</tag><tag>è¯ä¹¦</tag><tag>æ¨é€</tag>
        </tags>
        <content type="html"> 1.i OSå¼€å‘ä¸­ç¢°åˆ°çš„æ¦‚å¿µ 1.1 å¼€å‘è€…è´¦å· è‹¹æœå¯¹å¼€å‘è€…è´¦å·åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š
ä¸ªäºº Individual ï¼ˆ$99/yearï¼Œå¯ä»¥ä¸Šæ¶Apple Storeï¼Œæœ€å¤§UUIDæ•°ç›®100ï¼‰ ç»„ç»‡ Organizationsã€‚åˆå¯ä»¥å†™åˆ†ä¸ºä¸¤ç±»ï¼š ç»„ç»‡ Organization ï¼ˆæ™®é€šè´¦å·ï¼Œ$99/yearï¼Œèƒ½å¤Ÿä¸Šä¼ Apple Storeï¼Œæœ€å¤§UUIDæ•°ç›®100ï¼‰ ä¼ä¸šè´¦å· Enterprise Program ï¼ˆä¼ä¸šè´¦å·ï¼Œ$299/yearï¼Œèƒ½å¤Ÿè¿›è¡Œä¼ä¸šå‘å¸ƒï¼Œä¸èƒ½å¤Ÿå‘å¸ƒåˆ°Apple Storeï¼Œä¸é™åˆ¶UUIDæ•°ç›®ï¼‰ æ•™è‚²æœºæ„ï¼ˆEducational Institutionsï¼‰ 1.2 è¯ä¹¦ Certificate è¯ä¹¦æ˜¯å¯¹ç”µè„‘å¼€å‘èµ„æ ¼çš„è®¤è¯ï¼Œæ¯ä¸ªå¼€å‘è€…å¸å·æœ‰ä¸€å¥—ã€‚å¼€å‘è€…è¯ä¹¦å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š
1.2.1 å¼€å‘è¯ä¹¦ Developer Certification å®‰è£…åœ¨ç”µè„‘ä¸Šæä¾›æƒé™ï¼šå¼€å‘äººå‘˜é€šè¿‡è®¾å¤‡è¿›è¡ŒçœŸæœºæµ‹è¯•ã€‚ å¯ä»¥ç”Ÿæˆå‰¯æœ¬ä¾›å¤šå°ç”µè„‘ä½¿ç”¨ã€‚
1.2.2 å‘å¸ƒè¯ä¹¦ Distribution Certification å®‰è£…åœ¨ç”µè„‘ä¸Šæä¾›å‘å¸ƒiOSç¨‹åºçš„æƒé™ï¼šå¼€å‘äººå‘˜å¯ä»¥åˆ¶åšæµ‹è¯•ç‰ˆå’Œå‘å¸ƒç‰ˆçš„ç¨‹åºã€‚ ä¸å¯ç”Ÿæˆå‰¯æœ¬ï¼Œä»…æœ‰é…ç½®è¯¥è¯ä¹¦çš„ç”µè„‘æ‰å¯ä½¿ç”¨ï¼›
1.3 æˆæƒæ–‡ä»¶ Provisioning Profile æˆæƒæ–‡ä»¶æ˜¯å¯¹è®¾å¤‡å¦‚iPod Touchã€iPadã€iPhoneçš„æˆæƒï¼Œæ–‡ä»¶å†…è®°å½•äº†æ˜¯è®¾å¤‡çš„UDIDå’Œç¨‹åºçš„App IDã€‚ å³ï¼šä½¿è¢«æˆæƒçš„è®¾å¤‡å¯ä»¥å®‰è£…æˆ–è°ƒè¯•Bundle identifierä¸æˆæƒæ–‡ä»¶ä¸­è®°å½•çš„App IDå¯¹åº”çš„ç¨‹åºã€‚ å¼€å‘è€…å¸å·åœ¨åˆ›å»ºæˆæƒæ–‡ä»¶æ—¶å€™ä¼šé€‰æ‹©App IDï¼Œï¼ˆå¼€å‘è€…å¸å·ä¸‹App IDä¸­æ·»åŠ ï¼Œå•é€‰ï¼‰å’ŒUDIDï¼ˆå¼€å‘è€…å¸å·ä¸‹Devicesä¸­æ·»åŠ æœ€å¤š100ä¸ªï¼Œå¤šé€‰ï¼‰ã€‚
æˆæƒæ–‡ä»¶åˆ†ä¸ºä¸¤ç§ï¼Œå¯¹åº”ç›¸åº”çš„è¯ä¹¦ä½¿ç”¨ï¼š
1.3.1 å¼€å‘æˆæƒæ–‡ä»¶ Developer Provisioning Profile åŠŸèƒ½ï¼šåœ¨è£…æœ‰å¼€å‘è¯ä¹¦æˆ–å‰¯æœ¬çš„ç”µè„‘ä¸Šä½¿ç”¨ï¼Œå¼€å‘äººå‘˜é€‰æ‹©è¯¥æˆæƒæ–‡ä»¶é€šè¿‡ç”µè„‘å°†ç¨‹åºå®‰è£…åˆ°æˆæƒæ–‡ä»¶è®°å½•çš„è®¾å¤‡ä¸­ï¼Œå³å¯è¿›è¡ŒçœŸæœºæµ‹è¯•ã€‚
æ³¨æ„ï¼š
ç¡®ä¿ç”µè„‘æœ‰æƒé™çœŸæœºè°ƒè¯•ï¼Œå³å®‰è£…äº†å¼€å‘è¯ä¹¦æˆ–å‰¯æœ¬ï¼› åœ¨å¼€å‘å·¥å…·ä¸­ç¨‹åºçš„Bundle identifierå’Œé€‰ä¸­ä½¿ç”¨çš„æˆæƒæ–‡ä»¶çš„App IDè¦ä¸€è‡´ï¼› è¿æ¥è°ƒè¯•çš„è®¾å¤‡çš„UDIDåœ¨é€‰ä¸­çš„æˆæƒæ–‡ä»¶ä¸­æœ‰è®°å½•ã€‚ 1.3.2 å‘å¸ƒæˆæƒæ–‡ä»¶ Distribution Provisioning Profile åŠŸèƒ½ï¼šåœ¨è£…æœ‰å‘å¸ƒè¯ä¹¦çš„ç”µè„‘ä¸Šï¼ˆå³é…ç½®è¯ä¹¦çš„ç”µè„‘ï¼Œåªæœ‰ä¸€å°ï¼‰åˆ¶åšæµ‹è¯•ç‰ˆå’Œå‘å¸ƒç‰ˆçš„ç¨‹åºã€‚
å‘å¸ƒç‰ˆå°±æ˜¯å‘å¸ƒåˆ°App Storeä¸Šçš„ç¨‹åºæ–‡ä»¶ï¼Œå¼€å‘è€…å¸å·åˆ›å»ºæˆæƒæ–‡ä»¶æ—¶é€‰æ‹©storeé€‰é¡¹ï¼Œé€‰æ‹©App IDï¼Œæ— éœ€é€‰æ‹©UDIDï¼› æµ‹è¯•ç‰ˆå°±æ˜¯åœ¨å‘å¸ƒä¹‹å‰äº¤ç»™æµ‹è¯•äººå‘˜å¯åŒæ­¥åˆ°è®¾å¤‡ä¸Šçš„ç¨‹åºæ–‡ä»¶ï¼Œå¼€å‘è€…å¸å·åˆ›å»ºæˆæƒæ–‡ä»¶æ—¶é€‰æ‹©AdHocï¼Œé€‰æ‹©App IDå’ŒUDIDï¼›åªæœ‰é€‰ä¸­çš„UDIDå¯¹åº”çš„è®¾å¤‡æ‰å¯èƒ½å®‰è£…ä¸Šé€šè¿‡è¯¥æˆæƒæ–‡ä»¶åˆ¶åšçš„ç¨‹åºã€‚ 1.4 AppID APPIDä»£è¡¨äº†ä¸€ä¸ªå…·ä½“çš„APPã€‚é€šè¿‡BundleIDå®šä¹‰ä¸€ä¸ªAPPï¼Œç†è®ºä¸Šæ¯ä¸ªAPPçš„BundleIDéƒ½éœ€è¦ä¸åŒï¼Œå› æ­¤åœ¨å¼€å‘è€…è´¦å·ä¸­å•ç‹¬æœ‰ä¸ªåŠŸèƒ½ç”¨æ¥ç»´æŠ¤AppIDï¼Œéœ€è¦æä¾›BundleIDæ¥åˆ›å»ºä¸€ä¸ªAppIDã€‚
AppIDä¼šç”¨äºç”Ÿæˆä¸APPæœ‰å…³çš„è¯ä¹¦ï¼ˆä¾‹å¦‚æ¨é€è¯ä¹¦ï¼‰å’Œæˆæƒæ–‡ä»¶ã€‚åœ¨åˆ›å»ºè¿™äº›å†…å®¹çš„æ—¶å€™å¯ä»¥é€‰æ‹©AppIDã€‚
1.5 UDID æ¯ä¸€å°Appleè®¾å¤‡éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¿™å°±æ˜¯UDIDã€‚Appleä¼šæ ¹æ®è¿™ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦è¿›è¡Œå®‰è£…æ–¹é¢çš„é™åˆ¶ï¼š
å¯¹æ²¡æœ‰ä¸Šæ¶çš„åº”ç”¨ï¼Œåªæœ‰UDIDåŒ…å«åœ¨å¯¹åº”çš„æˆæƒæ–‡ä»¶çš„æ—¶å€™æ‰èƒ½å®‰è£…ï¼› å¯¹äºä¸Šæ¶çš„åº”ç”¨ï¼ŒAppleåº”è¯¥ä¹Ÿç»´æŠ¤äº†ä¸€å¼ UDIDä¸AppIDçš„å¯¹åº”è¡¨ï¼Œä¸‹è½½è¿‡æˆ–è´­ä¹°è¿‡çš„ç”¨æˆ·ä¼šæœ‰ä¸€æ¡è®°å½•ï¼ˆçŒœæµ‹ï¼‰ã€‚ 2. æå…‰æ¨é€ æå…‰æ¨é€æä¾›äº†ä¸¤ç§æ¨é€æ–¹å¼ï¼š
çº¢è‰²éƒ¨åˆ†æ˜¯ APNs æ¨é€ï¼ŒJPush ä»£ç†å¼€å‘è€…çš„åº”ç”¨ï¼ˆéœ€è¦åŸºäºå¼€å‘è€…æä¾›çš„åº”ç”¨è¯ä¹¦ï¼‰ï¼Œå‘è‹¹æœ APNs æœåŠ¡å™¨æ¨é€ã€‚ç”± APNs Server æ¨é€åˆ° iOS è®¾å¤‡ä¸Šã€‚ è“è‰²éƒ¨åˆ†æ˜¯ JPush åº”ç”¨å†…æ¨é€éƒ¨åˆ†ï¼Œå³ App å¯åŠ¨æ—¶ï¼Œå†…åµŒçš„ JPush SDK ä¼šå¼€å¯é•¿è¿æ¥åˆ° JPush Serverï¼Œä»è€Œ JPush Server å¯ä»¥æ¨é€æ¶ˆæ¯åˆ° App é‡Œã€‚ ä»–ä»¬çš„åŒºåˆ«åŠåº”ç”¨åœºæ™¯ï¼š é™„å½•ã€å‚è€ƒèµ„æ–™ ã€å®ç”¨å¸–ã€‘è‹¹æœå¼€å‘è€…è´¦å·è¯ä¹¦è¯¦è§£ å¼€å‘è€…è´¦å·ç±»å‹ æå…‰æ¨é€iOS SDK </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 08 - æ—¥å¿—</title>
        <url>https://orchidflower.github.io/2018/07/13/migrating-to-spring-boot-08-logging/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> SpringBooté»˜è®¤çš„æ—¥å¿—é…ç½®é€šå¸¸æ¥è¯´è¶³å¤Ÿæ»¡è¶³è¦æ±‚ï¼šæ—¥å¿—è®°å½•åˆ°æ§åˆ¶å°ï¼Œä¹Ÿèƒ½å¤Ÿé…ç½®æ—¥å¿—çš„çº§åˆ«ï¼Œæ ·å¼ç­‰ç­‰ã€‚ä½†æ˜¯å…¶ä¹Ÿæœ‰äº›ä¸è¶³ï¼šæ²¡æœ‰äº†ä¹‹å‰logbackæä¾›çš„çƒ­æ›´æ–°æ—¥å¿—é…ç½®çš„åŠŸèƒ½ã€‚
logbackæœ‰ä¸ªéå¸¸å¥½ç”¨çš„é…ç½®æ˜¯â€œscanâ€ï¼Œå½“â€œscan=trueâ€çš„æ—¶å€™é»˜è®¤ä¸€åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡é…ç½®ã€‚è¿™æ ·å¯ä»¥è‡ªåŠ¨æ›´æ–°ç³»ç»Ÿçš„æ—¥å¿—çº§åˆ«ã€‚å¯¹äºåœ¨çº¿ç³»ç»Ÿå¯ä»¥æ–¹ä¾¿ä¿®æ”¹æ—¥å¿—çº§åˆ«è·å–æ›´åŠ è¯¦ç»†çš„æ—¥å¿—ï¼Œæ–¹ä¾¿å®šä½é”™è¯¯ã€‚è¿™æ ·å¯ä»¥ä¿è¯æœåŠ¡ä¸ä¸­æ–­çš„æƒ…å†µä¸‹è°ƒæ•´æ—¥å¿—çº§åˆ«è·å–æ›´å¤šæ—¥å¿—ä¿¡æ¯ã€‚ä½†æ˜¯é»˜è®¤çš„SpringBooté…ç½®ä¸­ä¸æ”¯æŒè¿™ç§é€‰é¡¹ã€‚
1. å¤šé…ç½®æ”¯æŒ æ”¹é€ æ–¹æ¡ˆæ˜¯ä½¿ç”¨logbackã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨é€šå¸¸ç”¨çš„ logback.xmlè¿™ä¸ªæ–‡ä»¶åæ¥è¿›è¡Œé…ç½®ã€‚å› ä¸ºè¿™ä¸ªæ–‡ä»¶åè¢«logbackè‡ªåŠ¨æ‰«æï¼Œæ— æ³•åšåˆ°ä¸åŒç¯å¢ƒä¸åŒé…ç½®ã€‚å¯ä»¥ä½¿ç”¨logging.configè¿™ä¸ªé…ç½®é¡¹ï¼Œæ¥è¿›è¡Œç¯å¢ƒä¸åŒçš„è®¾å®šï¼š
åœ¨application.yamlä¸­ï¼Œå¦‚ä¸‹é…ç½®ï¼š
1# Set logback configuration file 2logging: 3 config: classpath:logback-default.xml 2. é…ç½®æ–‡ä»¶ ä¸‹é¢æ˜¯æœ€åä½¿ç”¨çš„é…ç½®æ–‡ä»¶çš„ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥ä¾›ä»¥åé¡¹ç›®å‚è€ƒã€‚
1&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt; 2 3&amp;lt;configuration debug=&amp;#34;false&amp;#34; scan=&amp;#34;true&amp;#34; &amp;gt; 4 &amp;lt;!-- å®šä¹‰å…¨å±€çš„å˜é‡ //--&amp;gt; 5 &amp;lt;property name=&amp;#34;cap.logger.level&amp;#34; value=&amp;#34;info&amp;#34;/&amp;gt; 6 &amp;lt;property name=&amp;#34;cap.logger.level.server&amp;#34; value=&amp;#34;debug&amp;#34;/&amp;gt; 7 &amp;lt;property name=&amp;#34;cap.logger.outputdir&amp;#34; value=&amp;#34;/opt/cap/cap-uid-logs&amp;#34;/&amp;gt; 8 9 &amp;lt;!-- å®šä¹‰ä¸€äº›converionRule --&amp;gt; 10 &amp;lt;!-- clr å®šä¹‰è‰²å½© --&amp;gt; 11 &amp;lt;conversionRule conversionWord=&amp;#34;clr&amp;#34; converterClass=&amp;#34;org.springframework.boot.logging.logback.ColorConverter&amp;#34; /&amp;gt; 12 &amp;lt;!-- wex å¼‚å¸¸å¤„ç†ç”¨çš„ --&amp;gt; 13 &amp;lt;conversionRule conversionWord=&amp;#34;wex&amp;#34; converterClass=&amp;#34;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter&amp;#34; /&amp;gt; 14 &amp;lt;!-- wex å¼‚å¸¸å¤„ç†ç”¨çš„ --&amp;gt; 15 &amp;lt;conversionRule conversionWord=&amp;#34;wEx&amp;#34; converterClass=&amp;#34;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter&amp;#34; /&amp;gt; 16 17 &amp;lt;jmxConfigurator /&amp;gt; 18 19 &amp;lt;contextListener class=&amp;#34;ch.qos.logback.classic.jul.LevelChangePropagator&amp;#34;&amp;gt; 20 &amp;lt;resetJUL&amp;gt;true&amp;lt;/resetJUL&amp;gt; 21 &amp;lt;/contextListener&amp;gt; 22 23 &amp;lt;!-- Standard syslog/console used by root appenders --&amp;gt; 24 &amp;lt;appender name=&amp;#34;syslog&amp;#34; class=&amp;#34;ch.qos.logback.classic.net.SyslogAppender&amp;#34;&amp;gt; 25 &amp;lt;syslogHost&amp;gt;${PUBLIC_IP}&amp;lt;/syslogHost&amp;gt; 26 &amp;lt;facility&amp;gt;LOCAL7&amp;lt;/facility&amp;gt; 27 &amp;lt;suffixPattern&amp;gt;[%-5level] [%logger{0}] - %msg%n&amp;lt;/suffixPattern&amp;gt; 28 &amp;lt;/appender&amp;gt; 29 30 &amp;lt;!-- consoleè¾“å‡ºï¼Œæœ‰è‰²å½©æ”¯æŒçš„ //--&amp;gt; 31 &amp;lt;appender name=&amp;#34;console&amp;#34; class=&amp;#34;ch.qos.logback.core.ConsoleAppender&amp;#34;&amp;gt; 32 &amp;lt;!--&amp;lt;encoder class=&amp;#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&amp;#34;&amp;gt;--&amp;gt; 33 &amp;lt;!--&amp;lt;pattern&amp;gt;[%date] [%-5level] [%logger{0}] - %msg%n&amp;lt;/pattern&amp;gt;--&amp;gt; 34 &amp;lt;!--&amp;lt;/encoder&amp;gt;--&amp;gt; 35 &amp;lt;encoder&amp;gt; 36 &amp;lt;pattern&amp;gt;${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}&amp;lt;/pattern&amp;gt; 37 &amp;lt;/encoder&amp;gt; 38 &amp;lt;/appender&amp;gt; 39 40 &amp;lt;!-- accessFileã€‚ä½¿ç”¨æ ‡å‡†çš„springbootæ ¼å¼è¾“å‡ºï¼Œæ–¹ä¾¿é˜…è¯»ã€‚ //--&amp;gt; 41 &amp;lt;appender name=&amp;#34;accessFile&amp;#34; class=&amp;#34;ch.qos.logback.core.rolling.RollingFileAppender&amp;#34;&amp;gt; 42 &amp;lt;rollingPolicy class=&amp;#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&amp;#34;&amp;gt; 43 &amp;lt;!-- daily rollover --&amp;gt; 44 &amp;lt;fileNamePattern&amp;gt;${cap.logger.outputdir}/access_%d{yyyy_MM_dd}.log&amp;lt;/fileNamePattern&amp;gt; 45 &amp;lt;!-- keep 30 days&amp;#39; worth of history capped at 3GB total size --&amp;gt; 46 &amp;lt;maxHistory&amp;gt;90&amp;lt;/maxHistory&amp;gt; 47 &amp;lt;/rollingPolicy&amp;gt; 48 &amp;lt;append&amp;gt;true&amp;lt;/append&amp;gt; 49 &amp;lt;encoder&amp;gt; 50 &amp;lt;pattern&amp;gt;${FILE_LOG_PATTERN:-%d{yyyy-MM-dd HH:mm:ss.SSS} ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } --- [%t] %-40.40logger{39} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}&amp;lt;/pattern&amp;gt; 51 &amp;lt;/encoder&amp;gt; 52 &amp;lt;/appender&amp;gt; 53 54 &amp;lt;!-- ä½¿ç”¨JSONæ ¼å¼ã€‚æ–¹ä¾¿ç®¡ç†å¹³å°åˆ†æã€‚Use JSONLayout, UID Admin may analysis it //--&amp;gt; 55 &amp;lt;appender name=&amp;#34;errorFile&amp;#34; class=&amp;#34;ch.qos.logback.core.rolling.RollingFileAppender&amp;#34;&amp;gt; 56 &amp;lt;filter class=&amp;#34;ch.qos.logback.classic.filter.ThresholdFilter&amp;#34;&amp;gt; 57 &amp;lt;level&amp;gt;ERROR&amp;lt;/level&amp;gt; 58 &amp;lt;/filter&amp;gt; 59 &amp;lt;rollingPolicy class=&amp;#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&amp;#34;&amp;gt; 60 &amp;lt;!-- daily rollover --&amp;gt; 61 &amp;lt;fileNamePattern&amp;gt;${cap.logger.outputdir}/error_%d{yyyy_MM_dd}.log&amp;lt;/fileNamePattern&amp;gt; 62 &amp;lt;!-- keep 30 days&amp;#39; worth of history capped at 3GB total size --&amp;gt; 63 &amp;lt;maxHistory&amp;gt;90&amp;lt;/maxHistory&amp;gt; 64 &amp;lt;/rollingPolicy&amp;gt; 65 &amp;lt;append&amp;gt;true&amp;lt;/append&amp;gt; 66 &amp;lt;encoder class=&amp;#34;ch.qos.logback.core.encoder.LayoutWrappingEncoder&amp;#34;&amp;gt; 67 &amp;lt;layout class=&amp;#34;com.eveus.common.logger.JSONLayout&amp;#34; /&amp;gt; 68 &amp;lt;/encoder&amp;gt; 69 &amp;lt;/appender&amp;gt; 70 71 &amp;lt;!-- ä½¿ç”¨JSONæ ¼å¼ã€‚æ–¹ä¾¿ç®¡ç†å¹³å°åˆ†æã€‚Use JSONLayout, UID Admin may analysis it //--&amp;gt; 72 &amp;lt;appender name=&amp;#34;kafkaErrorFile&amp;#34; class=&amp;#34;ch.qos.logback.core.rolling.RollingFileAppender&amp;#34;&amp;gt; 73 &amp;lt;filter class=&amp;#34;ch.qos.logback.classic.filter.ThresholdFilter&amp;#34;&amp;gt; 74 &amp;lt;level&amp;gt;ERROR&amp;lt;/level&amp;gt; 75 &amp;lt;/filter&amp;gt; 76 &amp;lt;rollingPolicy class=&amp;#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&amp;#34;&amp;gt; 77 &amp;lt;!-- daily rollover --&amp;gt; 78 &amp;lt;fileNamePattern&amp;gt;${cap.logger.outputdir}/kafka_error_%d{yyyy_MM}.log&amp;lt;/fileNamePattern&amp;gt; 79 &amp;lt;!-- keep 30 days&amp;#39; worth of history capped at 3GB total size --&amp;gt; 80 &amp;lt;maxHistory&amp;gt;90&amp;lt;/maxHistory&amp;gt; 81 &amp;lt;/rollingPolicy&amp;gt; 82 &amp;lt;append&amp;gt;true&amp;lt;/append&amp;gt; 83 &amp;lt;encoder class=&amp;#34;ch.qos.logback.core.encoder.LayoutWrappingEncoder&amp;#34;&amp;gt; 84 &amp;lt;layout class=&amp;#34;com.eveus.common.logger.JSONLayout&amp;#34; /&amp;gt; 85 &amp;lt;/encoder&amp;gt; 86 &amp;lt;/appender&amp;gt; 87 88 &amp;lt;!-- third party library logger level --&amp;gt; 89 &amp;lt;logger name=&amp;#34;org.springframework&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34; /&amp;gt; 90 &amp;lt;logger name=&amp;#34;org.apache.cxf&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34; /&amp;gt; 91 &amp;lt;logger name=&amp;#34;ch.qos.logback&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34; /&amp;gt; 92 &amp;lt;logger name=&amp;#34;com.notnoop.apns&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34; /&amp;gt; 93 &amp;lt;logger name=&amp;#34;org.springframework.security&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34;/&amp;gt; 94 &amp;lt;logger name=&amp;#34;org.springframework.transaction&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34; /&amp;gt; 95 &amp;lt;logger name=&amp;#34;org.springframework.jdbc&amp;#34; level=&amp;#34;${cap.logger.level}&amp;#34; /&amp;gt; 96 97 &amp;lt;!-- UID server logger --&amp;gt; 98 &amp;lt;!-- change level to debug to show sql --&amp;gt; 99 &amp;lt;logger name=&amp;#34;com.eveus.cloudauth.dao&amp;#34; level=&amp;#34;info&amp;#34;/&amp;gt; 100 &amp;lt;!-- LoggerAspect, Used for API &amp;amp; Service logging --&amp;gt; 101 &amp;lt;logger name=&amp;#34;com.eveus.common.logger&amp;#34; level=&amp;#34;debug&amp;#34;/&amp;gt; 102 &amp;lt;!-- KafkaConsumer --&amp;gt; 103 &amp;lt;logger name=&amp;#34;com.eveus.common.kafka&amp;#34; level=&amp;#34;info&amp;#34;/&amp;gt; 104 &amp;lt;!-- AccessLogger --&amp;gt; 105 &amp;lt;logger name=&amp;#34;com.eveus.cloudauth.service.impl.jms.AccessLogService&amp;#34; level=&amp;#34;info&amp;#34;/&amp;gt; 106 107 &amp;lt;!-- The following needs detail log in development stage --&amp;gt; 108 &amp;lt;logger name=&amp;#34;com.eveus.cloudauth.api&amp;#34; level=&amp;#34;${cap.logger.level.server}&amp;#34;/&amp;gt; 109 &amp;lt;logger name=&amp;#34;com.eveus.cloudauth.service&amp;#34; level=&amp;#34;${cap.logger.level.server}&amp;#34;/&amp;gt; 110 &amp;lt;logger name=&amp;#34;com.eveus&amp;#34; level=&amp;#34;${cap.logger.level.server}&amp;#34; /&amp;gt; 111 112 &amp;lt;!-- kafka error logger --&amp;gt; 113 &amp;lt;logger name=&amp;#34;com.eveus.common.kafka.KafkaProducer&amp;#34; level=&amp;#34;error&amp;#34;&amp;gt; 114 &amp;lt;appender-ref ref=&amp;#34;kafkaErrorFile&amp;#34;/&amp;gt; 115 &amp;lt;/logger&amp;gt; 116 117 &amp;lt;root level=&amp;#34;${cap.logger.level}&amp;#34;&amp;gt; 118 &amp;lt;appender-ref ref=&amp;#34;console&amp;#34;/&amp;gt; 119 &amp;lt;appender-ref ref=&amp;#34;accessFile&amp;#34;/&amp;gt; 120 &amp;lt;appender-ref ref=&amp;#34;errorFile&amp;#34;/&amp;gt; 121 &amp;lt;/root&amp;gt; 122&amp;lt;/configuration&amp;gt; 3. éƒ¨ç½²æ–¹å¼ SpringBooté¡¹ç›®æ‰“åŒ…çš„æ—¶å€™ä¼šæŠŠé…ç½®æ–‡ä»¶ä¸€åŒæ‰“åŒ…åˆ°jaræ–‡ä»¶ä¸­ã€‚ è¿™æ ·ä¿®æ”¹logbacké…ç½®æ–‡ä»¶ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥åœ¨éƒ¨ç½²çš„æ—¶å€™ä¼šæŠŠé…ç½®æ–‡ä»¶è§£å‹å‡ºæ¥ï¼Œå’Œjaræ–‡ä»¶æ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸­ã€‚è¿™æ˜¯åˆ©ç”¨äº†SpringBooté…ç½®æ–‡ä»¶åŠ è½½çš„ä¸€ä¸ªç‰¹æ€§ã€‚å®˜æ–¹æ–‡æ¡£ä»‹ç»å¦‚ä¸‹ï¼š
SpringApplication will load properties from application.properties files in the following locations and add them to the Spring Environmentï¼ˆSpringBootä¼šæŒ‰ç…§é¡ºåºä»ä¸‹é¢çš„è·¯å¾„ä¸­åŠ è½½é…ç½®æ–‡ä»¶ï¼‰:
A /config subdirectory of the current directory. ï¼ˆå½“å‰ç›®å½•å†…çš„/configç›®å½•ï¼‰ The current directory ï¼ˆå½“å‰ç›®å½•ï¼‰ A classpath /config package ï¼ˆclasspathä¸­çš„/configæ–‡ä»¶å¤¹ï¼‰ The classpath root ï¼ˆclasspathæ ¹ç›®å½•ï¼‰ The list is ordered by precedence (properties defined in locations higher in the list override those defined in lower locations). åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™å°†é…ç½®æ–‡ä»¶è§£å‹å‡ºæ¥ï¼Œæ”¾åˆ°å½“å‰ç›®å½•ä¸‹ï¼ˆå’Œjaræ–‡ä»¶ç»Ÿè®¡ç›®å½•ï¼‰ï¼Œè¿™æ ·å®ƒçš„ä¼˜å…ˆçº§é«˜äºåœ¨jaråŒ…ä¸­çš„é…ç½®æ–‡ä»¶ã€‚
æœ€åè¿˜éœ€è¦åœ¨å¯åŠ¨å‘½ä»¤ä¸­å¢åŠ é…ç½®ï¼ŒæŒ‡å®šlogbackçš„é…ç½®æ–‡ä»¶ï¼Œæ–¹æ³•æ˜¯æŒ‡å®šlogging.configè¿™ä¸ªJavaç¯å¢ƒå˜é‡ï¼š
1-Dspring.profiles.active=chanpayprd -Dlogging.config=file:/opt/cap/cap-uid/logback-chanpayprd.xml é™„å½•ã€å‚è€ƒèµ„æ–™ USING YAML IN SPRING BOOT TO CONFIGURE LOGBACK </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 07 - Rediså‘å¸ƒè®¢é˜…æœºåˆ¶</title>
        <url>https://orchidflower.github.io/2018/07/09/migrating-to-spring-boot-07-Redis-Pub-Sub/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> Redisä¸­çš„å‘å¸ƒè®¢é˜…æœºåˆ¶ï¼ˆPub/Subï¼‰æ˜¯åŸºäºchannelè¿™ä¸€æ¦‚å¿µçš„ï¼Œè¿™æœ‰äº›ç±»ä¼¼äºKafkaä¸­çš„åŸºäºtopicçš„æ¶ˆæ¯æœºåˆ¶ï¼Œåªæ˜¯ä¸æ”¯æŒæŒä¹…åŒ–ã€‚å¦‚æœpublishçš„æ¶ˆæ¯ï¼Œæ²¡æœ‰ä»»ä½•clientå¤„äº&amp;quot;subscribe&amp;quot;çŠ¶æ€ï¼Œæ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœclientåœ¨subcribeæ—¶ï¼Œé“¾æ¥æ–­å¼€åé‡è¿ï¼Œé‚£ä¹ˆæ­¤æœŸé—´çš„æ¶ˆæ¯ä¹Ÿå°†ä¸¢å¤±ã€‚Redis serverå°†ä¼š&amp;quot;å°½åŠ›&amp;quot;å°†æ¶ˆæ¯å‘é€ç»™å¤„äºsubscribeçŠ¶æ€çš„clientï¼Œä½†æ˜¯ä»ä¸ä¼šä¿è¯æ¯æ¡æ¶ˆæ¯éƒ½èƒ½è¢«æ­£ç¡®æ¥æ”¶ã€‚
ä¸ºäº†è§£è€¦å‘å¸ƒè€…(publisher)å’Œè®¢é˜…è€…(subscriber)ä¹‹é—´çš„å…³ç³»ï¼ŒRedis ä½¿ç”¨äº† channel (é¢‘é“)ä½œä¸ºä¸¤è€…çš„ä¸­ä»‹ï¼šå‘å¸ƒè€…å°†ä¿¡æ¯ç›´æ¥å‘å¸ƒç»™ channel ï¼Œè€Œ channel è´Ÿè´£å°†ä¿¡æ¯å‘é€ç»™é€‚å½“çš„è®¢é˜…è€…ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æ²¡æœ‰ç›¸äº’å…³ç³»ï¼Œä¹Ÿä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚
Spring Data Redisç»„ä»¶å¯¹Pub/Subæœºåˆ¶è¿›è¡Œäº†æŠ½è±¡ï¼Œæä¾›äº†ç±»ä¼¼JMSçš„ç¼–ç¨‹æ¨¡å¼ã€‚Spring Data Redisä½¿ç”¨äº†ä¸€ä¸ªContainerï¼ˆRedisMessageListenerContainerï¼‰æ¥è§£å†³å‘å¸ƒè®¢é˜…æœºåˆ¶ã€‚è¿™ä¸ªContainerä½¿ç”¨ä¸€ä¸ªRedisé“¾æ¥è§£å†³äº†å¤šä¸ªtopicè®¢é˜…çš„é—®é¢˜ã€‚å®ƒæŠŠå…¶ä»–çš„è®¢é˜…ã€å‘å¸ƒè€…éš”ç¦»æˆåŸºæœ¬çš„POJOå¯¹è±¡ï¼Œè€Œä¸ç”¨ä¸Rediså¯¹è±¡æ‰“äº¤é“ã€‚è¿™ç®€åŒ–äº†æ•´ä¸ªç¼–ç¨‹æ¨¡å‹ã€‚
1. ä½¿ç”¨æ–¹æ³• 1.1 Container é¦–å…ˆå®šä¹‰ä¸€ä¸ªContainerã€‚
1 @Bean 2 RedisMessageListenerContainer redisContainer() { 3 RedisMessageListenerContainer container = new RedisMessageListenerContainer(); 4 container.setConnectionFactory(redisConnectionFactory); // æ³¨å…¥RedisConnectionFactory 5 return container; 6 } å…¶ä¸­çš„redisConnectionFactoryæ˜¯é€šè¿‡AutoConfigurationè‡ªåŠ¨åˆ›å»ºçš„å¯¹è±¡ï¼ŒæŒ‰ç…§å®é™…çš„æƒ…å†µé…ç½®spring.redis.*ç›¸å…³é…ç½®å‚æ•°å³å¯åˆ›å»ºã€‚å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚
1.2 å‘å¸ƒ å‘å¸ƒä½¿ç”¨redisTemplateçš„convertAndSendæ–¹æ³•å³å¯ã€‚
1 protected void publish(String channel, String message) { 2 try { 3 redisTemplate.convertAndSend(channel, message); 4 logger.info(&amp;#34;publish success! channel={},message={}&amp;#34;, channel, message); 5 } catch (Exception e) { 6 logger.error(&amp;#34;publish error! channel={},message={}, exception: {}&amp;#34;, channel, message, e); 7 } 8 } channel
1.3 è®¢é˜… è®¢é˜…éœ€è¦æŒ‡å®šchannelå’Œå¯¹åº”çš„Handlerå³å¯ã€‚Handleréœ€è¦å®ç°MessageListeneræ¥å£ã€‚ä¸‹é¢æ˜¯è®¢é˜…å‡½æ•°çš„ç¤ºä¾‹ï¼š
1 protected void subscribe(String channel, MessageListener handle) { 2 try { 3 container.addMessageListener(handle, new ChannelTopic(channel)); 4 logger.info(&amp;#34;subscribe success! channel={}&amp;#34;, channel); 5 } catch (Exception e) { 6 logger.error(&amp;#34;subscribe error! channel={}. Exception: {}&amp;#34;, channel, e); 7 } 8 } ä¸€ä¸ªå®ç°MessageListeneræ¥å£çš„ä¾‹å­å¦‚ä¸‹ï¼š
1 public void onMessage(Message message, byte[] pattern) { 2 long begin = System.currentTimeMillis(); 3 listCardBin = bankcardBinDal.selectAll(); 4 long timeUsed = System.currentTimeMillis() - begin; 5 logger.info(&amp;#34;receive message &amp;amp; init cardBin success! timeUsed={}ms,[{}:{}]&amp;#34;, timeUsed, new String(pattern), message); 6 } æ”¶åˆ°è®¢é˜…æ¶ˆæ¯åçš„å¤„ç†å¯ä»¥åœ¨ä¸Šé¢æ¥å£ä¸­å®ç°ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ PubSub Messaging with Spring Data Redis Spring Data Redis PubSub Documentation </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 06 - Swagger</title>
        <url>https://orchidflower.github.io/2018/07/06/migrating-to-spring-boot-06-swagger/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> éšç€æŠ€æœ¯çš„å‘å±•ï¼Œç°åœ¨çš„Webç³»ç»Ÿæ¶æ„åŸºæœ¬éƒ½ç”±åŸæ¥çš„åç«¯æ¸²æŸ“ï¼ˆä¾‹å¦‚JSPï¼‰ï¼Œå˜æˆäº†ï¼šå‰ç«¯æ¸²æŸ“ã€å‰åç«¯åˆ†ç¦»çš„å½¢æ€ã€‚å‰ç«¯å’Œåç«¯çš„å”¯ä¸€è”ç³»ï¼Œå˜æˆäº†APIæ¥å£ã€‚APIæ–‡æ¡£å˜æˆäº†å‰åç«¯å¼€å‘äººå‘˜è”ç³»çš„çº½å¸¦ï¼Œå˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œswaggerå°±æ˜¯ä¸€æ¬¾è®©ä½ æ›´å¥½çš„ä¹¦å†™APIæ–‡æ¡£çš„æ¡†æ¶ã€‚æ²¡æœ‰APIæ–‡æ¡£å·¥å…·ä¹‹å‰ï¼Œå¤§å®¶éƒ½æ˜¯æ‰‹å†™APIæ–‡æ¡£çš„ï¼Œåœ¨ä»€ä¹ˆåœ°æ–¹ä¹¦å†™çš„éƒ½æœ‰ï¼Œæœ‰åœ¨Wikiä¸Šå†™çš„ï¼Œæœ‰åœ¨Wordé‡Œé¢å†™çš„ï¼Œä¹Ÿæœ‰åœ¨å¯¹åº”çš„é¡¹ç›®ç›®å½•ä¸‹readme.mdä¸Šå†™çš„ï¼Œæ¯ä¸ªå…¬å¸éƒ½æœ‰æ¯ä¸ªå…¬å¸çš„ç©æ³•ï¼Œæ— æ‰€è°“å¥½åã€‚å¦å¤–è¿˜æœ‰ä¸“é—¨é’ˆå¯¹APIæ–‡æ¡£å¼€å‘çš„åº”ç”¨ï¼Œä¾‹å¦‚showdocä¹‹ç±»çš„ã€‚
ä¹¦å†™APIæ–‡æ¡£çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œä½†æ˜¯èƒ½ç§°ä¹‹ä¸ºâ€œæ¡†æ¶â€çš„ï¼Œä¼°è®¡ä¹Ÿåªæœ‰swaggeräº†ã€‚ä½¿ç”¨Swaggeræœ‰ä¸ªå¥½å¤„å°±æ˜¯æ–‡æ¡£ä¸ä»£ç ç»“åˆç´§å¯†ï¼Œæ›´æ–°ä»£ç çš„åŒæ—¶ä¹Ÿä¼šæ›´æ–°æ–‡æ¡£ï¼Œä¸ç”¨æ‹…å¿ƒåŒæ­¥çš„é—®é¢˜ã€‚è€Œä¸”åœ¨Javaä¸­ä½¿ç”¨Swaggerä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚
äº‘è®¤è¯å¹³å°æä¾›çš„Restfulæ¥å£æ˜¯åŸºäºCXFå®ç°çš„ã€‚ç½‘ä¸Šç°æœ‰çš„å…³äºSwaggerçš„æ–‡æ¡£å¤šæ•°æ˜¯åŸºäºSpring MVCçš„ï¼Œå¹¶ä¸é€‚ç”¨äºCXFã€‚ä¸‹é¢æˆ‘å°†é’ˆå¯¹CXF&#43;SpringBootçš„ç»„åˆå¦‚ä½•ä½¿ç”¨Swaggerè¿›è¡Œä»‹ç»ã€‚
1. é›†æˆæ–¹æ³• åˆ†æˆåç«¯ã€å‰ç«¯ä¸¤éƒ¨åˆ†æ¥ä»‹ç»ã€‚Swaggeræ¡†æ¶åŒ…å«å‰ç«¯å’Œåç«¯ä¸¤éƒ¨åˆ†ã€‚å‰ç«¯æŒ‡çš„æ˜¯Swaggerä¸­çš„ç½‘é¡µå’ŒJSéƒ¨åˆ†ï¼Œå®ƒä»åå°è·å–ä¸€ä¸ªjsonæˆ–yamlæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æœ‰æ¥å£ç›¸å…³çš„å®šä¹‰ä¿¡æ¯ï¼›åç«¯åˆ™è´Ÿè´£æ‰«æä»£ç ï¼Œæ ¹æ®æ³¨è§£ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¯¹åº”çš„jsonæˆ–yamlæ–‡ä»¶ã€‚
1.1 åç«¯ åç«¯æŒ‡çš„æ˜¯å¦‚ä½•æ‰«æä»£ç ä¸­çš„swaggeræ ‡è®°ï¼Œç”Ÿæˆå¯¹åº”çš„jsonæ ¼å¼å…ƒæ•°æ®ã€‚è¿™éƒ¨åˆ†ä½¿ç”¨äº†CXFåº“çš„swagger2Featureè¿™ä¸ªç‰¹æ€§ã€‚å…·ä½“å¯ä»¥å‚è€ƒCXFåº“çš„å¸®åŠ©é¡µé¢ã€‚ å…¶åŸç†æ˜¯å¼€å¯Swagger2Featureï¼Œç”±CXFåº“ç”Ÿæˆè¿™ä¸ªjsonå…ƒæ•°æ®ã€‚æ–¹æ³•å°±æ˜¯JAXRSServerFactoryBeanè°ƒç”¨setFeaturesæ–¹æ³•ï¼Œæ·»åŠ ä¸€ä¸ªSwagger2Featureå¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼ˆ@Configurationç±»ï¼‰ï¼š
1@Bean 2public ServletRegistrationBean cxfServlet() { 3 final ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean(new CXFServlet(), &amp;#34;/api/*&amp;#34;); 4 servletRegistrationBean.setLoadOnStartup(1); 5 return servletRegistrationBean; 6} 7 8@Bean(destroyMethod = &amp;#34;shutdown&amp;#34;) 9public SpringBus cxf() { 10 return new SpringBus(); 11} 12 13// æ–°å¢ä»£ç ï¼šå®šä¹‰ä¸€ä¸ªSwaggerFeature 14public Swagger2Feature createSwaggerFeature() { 15 Swagger2Feature swagger2Feature = new Swagger2Feature(); 16 swagger2Feature.setPrettyPrint(true); 17 swagger2Feature.setTitle(&amp;#34;UID API&amp;#34;); 18 swagger2Feature.setContact(&amp;#34;limin.zhang&amp;#34;); 19 swagger2Feature.setDescription(&amp;#34;UID &amp;amp; Admin &amp;amp; CAP API&amp;#34;); 20 swagger2Feature.setVersion(&amp;#34;1.0.0&amp;#34;); 21 swagger2Feature.setBasePath(&amp;#34;/api&amp;#34;); 22 swagger2Feature.setResourcePackage(&amp;#34;com.eveus.cloudauth.api&amp;#34;); 23 return swagger2Feature; 24} 25 26 27@Bean(destroyMethod = &amp;#34;destroy&amp;#34;) 28@DependsOn(&amp;#34;cxf&amp;#34;) 29public Server jaxRsServer() throws Exception{ 30 JAXRSServerFactoryBean factory = new JAXRSServerFactoryBean(); 31 factory.setAddress(&amp;#34;/&amp;#34;); 32 factory.setServiceBeans(Arrays.asList(uidApiController, userIdentityApiService, uidAdminApiService)); 33 ArrayList providers = new ArrayList(); 34 providers.add(corsFilter()); 35 providers.add(fastJsonProvider()); 36 factory.setProviders(providers); 37 factory.setFeatures(Arrays.asList(createSwaggerFeature())); // æ³¨å…¥SwaggerFeature 38 return factory.create(); 39 40} ä»¥ä¸ŠåŠŸèƒ½éœ€è¦ä¸€ä¸ªåº“æ”¯æŒï¼Œéœ€è¦æ·»åŠ åˆ°pom.xmlä¸­ï¼š
1&amp;lt;dependency&amp;gt; 2 &amp;lt;groupId&amp;gt;io.swagger&amp;lt;/groupId&amp;gt; 3 &amp;lt;artifactId&amp;gt;swagger-jaxrs&amp;lt;/artifactId&amp;gt; 4 &amp;lt;version&amp;gt;1.5.7&amp;lt;/version&amp;gt; 5&amp;lt;/dependency&amp;gt; 1.2 å‰ç«¯ å‰ç«¯ä¾ç„¶ä½¿ç”¨springfox-swagger-uiã€‚ä½†æ˜¯å•çº¯çš„springfox-swagger-uiè¿™ä¸ªåº“åªæ˜¯ä¸€ä¸ªå‰ç«¯æ–‡ä»¶åŒ…ã€‚å…¶è¦å·¥ä½œï¼Œè¿˜éœ€è¦åå°æ¥å£é…åˆï¼ˆä»ä¸­è·å–æ¥å£å®šä¹‰jsonæ–‡ä»¶ï¼‰ï¼š
/swagger-resources/configuration/security Configuring swagger-ui security /swagger-resources/configuration/ui Configuring swagger-ui options è¿™äº›æ¥å£ä¾èµ–äºspringfoxå…¶ä»–åº“ã€‚ å› æ­¤æœ€ç»ˆçš„é¡¹ç›®ä¾èµ–æƒ…å†µå¦‚ä¸‹ï¼š
1&amp;lt;!-- Springfox Swagger --&amp;gt; 2&amp;lt;dependency&amp;gt; 3 &amp;lt;groupId&amp;gt;io.springfox&amp;lt;/groupId&amp;gt; 4 &amp;lt;artifactId&amp;gt;springfox-swagger2&amp;lt;/artifactId&amp;gt; 5&amp;lt;/dependency&amp;gt; 6&amp;lt;dependency&amp;gt; 7 &amp;lt;groupId&amp;gt;io.springfox&amp;lt;/groupId&amp;gt; 8 &amp;lt;artifactId&amp;gt;springfox-swagger-ui&amp;lt;/artifactId&amp;gt; 9&amp;lt;/dependency&amp;gt; åŸºæœ¬ä¸Šé…ç½®å®Œè¿™äº›ä¾èµ–é¡¹ä¹‹åï¼ŒSwaggerå°±å¯ä»¥å·¥ä½œäº†ã€‚è¿™é‡Œä¸éœ€è¦å†åƒSpring MVCä½¿ç”¨Swaggerä¸€æ ·ï¼Œå®šä¹‰æ¥å£ä¹‹ç±»çš„ã€‚å› ä¸ºSwaggerå®šä¹‰æ–‡ä»¶å·²ç»é€šè¿‡Swagger2Featureç”Ÿæˆäº†ã€‚
æœ€åä¸€ä¸ªé—®é¢˜æ˜¯jsonæ–‡ä»¶çš„è·¯å¾„é—®é¢˜ï¼šspringfox-swagger-uié»˜è®¤è®¿é—®çš„åå°jsonåœ°å€æ˜¯ /v2/api-docsï¼Œä½¿ç”¨swagger2Featureç”Ÿæˆçš„åœ°å€ä¸º/api/swagger.jsonï¼ˆè¯¥åœ°å€åŸºäºCXFç›‘å¬çš„åœ°å€ï¼Œä¸Šé¢é…ç½®çš„ç›‘å¬åœ°å€æ˜¯/api/*ï¼‰ã€‚è¿™ä¸ªè·¯å¾„å¯ä»¥é€šè¿‡ springfox.documentation.swagger.v2.pathå‚æ•°è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•ä¿®æ”¹æˆswagger2Featureç”Ÿæˆçš„åœ°å€ï¼š
1springfox.documentation.swagger.v2.path: /api/swagger.json è‡³æ­¤å¯ä»¥å·¥ä½œäº†ã€‚è®¿é—®ï¼šhttp://localhost:8080/swagger-ui.htmlå³å¯æ‰“å¼€swaggeræ–‡æ¡£ã€‚
2. å¤šä¸ªJAXRSServerFactoryBean 2.1 æ›´å¤šæ€è€ƒ é¦–å…ˆæ€»ç»“ä¸€ä¸‹CXFå‘å¸ƒRestfulæ¥å£çš„æµç¨‹ï¼š è¦ä½¿ç”¨CXFå‘å¸ƒRestfulæ¥å£ï¼Œåœ¨SpringBootä¸­é¦–å…ˆè¦å®šä¹‰CXFServletï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Servletï¼Œä¸€èˆ¬é€šè¿‡å®šä¹‰ï¼šServletRegistrationBeanå®ç°ã€‚è¿™ä¸€æ­¥å’Œä¹‹å‰åœ¨Springä¸­web.xmlä¸­çš„å¦‚ä¸‹é…ç½®æ˜¯ä¸€æ ·çš„ï¼š
1	&amp;lt;servlet&amp;gt; 2	&amp;lt;servlet-name&amp;gt;CXFService&amp;lt;/servlet-name&amp;gt; 3	&amp;lt;servlet-class&amp;gt;org.apache.cxf.transport.servlet.CXFServlet&amp;lt;/servlet-class&amp;gt; 4	&amp;lt;/servlet&amp;gt; 5 6	&amp;lt;servlet-mapping&amp;gt; 7	&amp;lt;servlet-name&amp;gt;CXFService&amp;lt;/servlet-name&amp;gt; 8	&amp;lt;url-pattern&amp;gt;/api/*&amp;lt;/url-pattern&amp;gt; 9	&amp;lt;/servlet-mapping&amp;gt; ç„¶åå®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªJAXRSServerFactoryBeanï¼Œå®ƒä¼šåˆ›å»ºJaxRsServerï¼Œä»¥å‘å¸ƒRestfulæ¥å£ã€‚è¿™å’Œå¦‚ä¸‹çš„xmlé…ç½®åŠŸèƒ½ç±»ä¼¼ï¼š
1&amp;lt;jaxrs:server id=&amp;#34;didApiServiceJsonServer&amp;#34; address=&amp;#34;/rest&amp;#34;&amp;gt; 2 &amp;lt;jaxrs:serviceBeans&amp;gt; 3 &amp;lt;ref bean=&amp;#34;uidApiService&amp;#34; /&amp;gt; 4 &amp;lt;/jaxrs:serviceBeans&amp;gt; 5 &amp;lt;jaxrs:providers&amp;gt; 6 &amp;lt;ref bean=&amp;#34;jsonProvider&amp;#34; /&amp;gt; 7 &amp;lt;ref bean=&amp;#34;jsonExceptionMapper&amp;#34; /&amp;gt; 8 &amp;lt;/jaxrs:providers&amp;gt; 9&amp;lt;/jaxrs:server&amp;gt; 2.2 å‰©ä½™é—®é¢˜ æœ€åˆå¯»æ‰¾ç”¨äºCXFçš„Swaggeræ–¹æ¡ˆçš„æ—¶å€™ï¼Œä¸€ç›´æ— æ³•è§£å†³çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¤šä¸ªJAXRSServerFactoryBeanå­˜åœ¨çš„æ—¶å€™å¦‚ä½•ç®¡ç†ç®¡ç†APIæ–‡æ¡£ã€‚ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆæœ‰æŠ•æœºå–å·§çš„åœ°æ–¹ï¼šå°†æ‰€æœ‰éœ€è¦å‘å¸ƒçš„å†…å®¹æ•´åˆåˆ°ä¸€ä¸ªJAXRSServerFactoryBeanï¼Œé€šè¿‡ä¸€ä¸ªJAXRSServerFactoryBeanè¿›è¡Œå‘å¸ƒï¼Œè¿™æ ·å°±å¯ä»¥åªç”Ÿæˆä¸€ä¸ªjsonæ–‡ä»¶åŒ…å«æ‰€æœ‰æ¥å£å®šä¹‰äº†ã€‚
ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæ˜¯æœ‰ç¼ºé™·çš„ï¼š
é¦–å…ˆä¸Šè¿°æ”¹é€ æ–¹æ¡ˆæœ‰ä¸ªé—®é¢˜å°±æ˜¯ /api/è¿™ä¸ªè·¯å¾„æ— æ³•æŸ¥çœ‹åˆ°CXFå·²ç»å‘å¸ƒçš„apiåˆ—è¡¨ï¼Œä¼šæŠ¥é”™ã€‚æŒ‰ç…§ä¼ ç»Ÿçš„Springä¸­CXFçš„é…ç½®æ–¹æ³•ï¼Œ/api/*è¿™ä¸ªåœ°å€æ˜¯ç”±CXFServletç›‘å¬çš„ï¼Œè¿™ä¸ªServletå¯ä»¥åˆ—å‡ºæ‰€æœ‰ä½¿ç”¨CXFå‘å¸ƒçš„æ¥å£åˆ—è¡¨ï¼ŒåŒ…æ‹¬SOAPå’ŒRestfulä¸¤ç§ç±»å‹çš„APIã€‚ä½†æ˜¯ä½¿ç”¨å‰é¢çš„ç®€åŒ–é…ç½®æ–¹æ¡ˆåï¼Œå°†JaxRSServerå‘å¸ƒåœ¨/api/ä¸Šã€‚å¯¼è‡´ä¸æ˜¯CXFæœ¬èº«æ‹¦æˆªè¿™ä¸ªè·¯å¾„ï¼Œè€Œæ˜¯ JaxRsServeræ‹¦æˆªäº†ã€‚æ‰€ä»¥è¿˜æ˜¯è¦æ”¹æˆæ¯ä¸ªBeanå•ç‹¬å‘å¸ƒåˆ°ä¸åŒçš„è·¯å¾„ä¸Šï¼Œä¾‹å¦‚ï¼š/api/rest, /api/admin, /api/v1ã€‚
å°è¯•ç€åˆ›å»ºä¸‰ä¸ªSwaggerFeatureï¼Œé…ç½®åˆ°ä¸‰ä¸ªJAXRSServerFactoryBeanä¸­ï¼Œå´å‘ç°ç”Ÿæˆçš„ä¸‰ä¸ªjsonæ–‡ä»¶å†…å®¹æ˜¯ç›¸åŒçš„ï¼Œéƒ½å¯¹åº”æœ€åä¸€ä¸ªè®¾ç½®çš„JAXRSServerFactoryBeanå¯¹åº”çš„æ¥å£å®šä¹‰ã€‚ç»è¿‡æŸ¥æ‰¾ï¼ŒåŸæ¥æ˜¯å› ä¸ºCXFçš„Swagger2Featureç¼“å­˜ç‰¹æ€§å¯¼è‡´çš„ã€‚å…·ä½“çœ‹é™„å½•ä¸­çš„é“¾æ¥ã€‚
Right, those two approaches are very similar. The &amp;lsquo;basePath&amp;rsquo;-based one does implicit Swagger IDs manipulation (scanner / config / &amp;hellip;) by making base path a part of identifier (it triggers when usePathBasedConfig is set). So I think in this regards, we could make this property true by default and cover quite a large number of collisions (there is no need to set Swagger IDs). However, if I understand Åukasz Dywicki correctly, Swagger caching mechanism causing the issues when endpoints are loaded / unloaded dynamically (like in OSGi), in this case Swagger still exposes the API specs even if there are no running endpoints, the fix for this ticket does not address the issue yet but Åukasz Dywicki has a PR.
ä¹Ÿå°±æ˜¯è¯´è¯´ï¼Œå¦‚æœæ²¡æœ‰é…ç½®usePathBasedConfigå‚æ•°ï¼Œä¼šä»¥æœ€åbasePathä¸ºåŸºå‡†æ£€æŸ¥æ˜¯å¦å·²ç»ç”Ÿæˆè¿‡ï¼Œå¦‚æœç”Ÿæˆè¿‡åˆ™ä¸å†é‡æ–°ç”Ÿæˆï¼Œç›´æ¥é‡‡ç”¨ç¼“å­˜ã€‚è§£å†³åŠæ³•æ˜¯ä½¿ç”¨usePathBasedConfigè¿™ä¸ªå‚æ•°ï¼Œç¦ç”¨è¿™ç§é”™è¯¯çš„ç¼“å­˜ç­–ç•¥ã€‚
2.3 æœ€ç»ˆä¿®æ”¹æ–¹æ¡ˆ 2.3.1 ApiConfig 1 @Bean(destroyMethod = &amp;#34;shutdown&amp;#34;) 2 public SpringBus cxf() { 3 return new SpringBus(); 4 } 5 6	// åˆ›å»ºSwaggerFeatureï¼ŒæŒ‡å®šusePathBasedConfigä¸ºtrue 7 public Swagger2Feature createCapSwaggerFeature() { 8 Swagger2Feature swagger2Feature = new Swagger2Feature(); 9 swagger2Feature.setPrettyPrint(true); 10 swagger2Feature.setTitle(&amp;#34;CAP API&amp;#34;); 11 swagger2Feature.setContact(&amp;#34;limin.zhang&amp;#34;); 12 swagger2Feature.setDescription(&amp;#34;CAP API&amp;#34;); 13 swagger2Feature.setVersion(&amp;#34;1.0.0&amp;#34;); 14 swagger2Feature.setBasePath(&amp;#34;/api&amp;#34;); 15 // å…³é”®ä»£ç ï¼šå¦åˆ™swagger2Featureä¼šç¼“å­˜ï¼Œä¸è®¤ä¸ºè¿™æ˜¯åˆ›å»ºäº†ä¸‰ä¸ªä¸åŒçš„å¯¹è±¡ 16 swagger2Feature.setUsePathBasedConfig(true); // è®¾ç½®usePathBasedConfigå‚æ•° 17 swagger2Feature.setResourcePackage(&amp;#34;com.eveus.cloudauth.api.cap&amp;#34;); 18 return swagger2Feature; 19 } 20 21 22 public Swagger2Feature createUidSwaggerFeature() { 23 Swagger2Feature swagger2Feature = new Swagger2Feature(); 24 swagger2Feature.setPrettyPrint(true); 25 swagger2Feature.setTitle(&amp;#34;UID API&amp;#34;); 26 swagger2Feature.setContact(&amp;#34;limin.zhang&amp;#34;); 27 swagger2Feature.setDescription(&amp;#34;UID API&amp;#34;); 28 swagger2Feature.setVersion(&amp;#34;1.0.0&amp;#34;); 29 swagger2Feature.setBasePath(&amp;#34;/api&amp;#34;); 30 swagger2Feature.setUsePathBasedConfig(true); // è®¾ç½®usePathBasedConfigå‚æ•° 31 swagger2Feature.setResourcePackage(&amp;#34;com.eveus.cloudauth.api.uid&amp;#34;); 32 return swagger2Feature; 33 } 34 35 public Swagger2Feature createAdminSwaggerFeature() { 36 Swagger2Feature swagger2Feature = new Swagger2Feature(); 37 swagger2Feature.setPrettyPrint(true); 38 swagger2Feature.setTitle(&amp;#34;Admin API&amp;#34;); 39 swagger2Feature.setContact(&amp;#34;limin.zhang&amp;#34;); 40 swagger2Feature.setDescription(&amp;#34;Admin API&amp;#34;); 41 swagger2Feature.setVersion(&amp;#34;1.0.0&amp;#34;); 42 swagger2Feature.setBasePath(&amp;#34;/api&amp;#34;); 43 swagger2Feature.setUsePathBasedConfig(true); // è®¾ç½®usePathBasedConfigå‚æ•° 44 swagger2Feature.setResourcePackage(&amp;#34;com.eveus.cloudauth.api.admin&amp;#34;); 45 return swagger2Feature; 46 } 47 48 49 @Bean(destroyMethod = &amp;#34;destroy&amp;#34;) 50 @DependsOn(&amp;#34;cxf&amp;#34;) 51 public Server capApiJaxRsServer() throws Exception{ 52 JAXRSServerFactoryBean factory = new JAXRSServerFactoryBean(); 53 factory.setAddress(&amp;#34;/v1&amp;#34;); 54 factory.setServiceBean(uidApiController); 55 ArrayList providers = new ArrayList(); 56 providers.add(corsFilter()); 57 providers.add(fastJsonProvider()); 58 factory.setProviders(providers); 59 factory.setFeatures(Arrays.asList(createUidSwaggerFeature())); // æŒ‡å®šä¸€ä¸ªSwaggerFeature 60 return factory.create(); 61 } 62 63 @Bean(destroyMethod = &amp;#34;destroy&amp;#34;) 64 @DependsOn(&amp;#34;cxf&amp;#34;) 65 public Server uidApiJaxRsServer() throws Exception{ 66 JAXRSServerFactoryBean factory = new JAXRSServerFactoryBean(); 67 factory.setAddress(&amp;#34;/rest&amp;#34;); 68 factory.setServiceBean(userIdentityApiService); 69 ArrayList providers = new ArrayList(); 70 providers.add(corsFilter()); 71 providers.add(fastJsonProvider()); 72 factory.setProviders(providers); 73 factory.setFeatures(Arrays.asList(createUidSwaggerFeature())); // æŒ‡å®šä¸€ä¸ªSwaggerFeature 74 return factory.create(); 75 } 76 77 @Bean(destroyMethod = &amp;#34;destroy&amp;#34;) 78 @DependsOn(&amp;#34;cxf&amp;#34;) 79 public Server adminApiJaxRsServer() throws Exception{ 80 JAXRSServerFactoryBean factory = new JAXRSServerFactoryBean(); 81 factory.setAddress(&amp;#34;/admin&amp;#34;); 82 factory.setServiceBean(uidAdminApiService); 83 ArrayList providers = new ArrayList(); 84 providers.add(corsFilter()); 85 providers.add(fastJsonProvider()); 86 factory.setProviders(providers); 87 factory.setFeatures(Arrays.asList(createAdminSwaggerFeature())); // æŒ‡å®šä¸€ä¸ªSwaggerFeature 88 return factory.create(); 89 } 2.3.2 SwaggerConfig 1 @Primary // å…³é”®ï¼Œå¦åˆ™æŠ¥é”™ 2 @Bean 3 public SwaggerResourcesProvider swaggerResourcesProvider(InMemorySwaggerResourcesProvider defaultResourcesProvider) { 4 return () -&amp;gt; { 5 // å®šä¹‰ä¸åŒçš„APIæ–‡æ¡£åŠè·¯å¾„ 6 SwaggerResource uidResource = new SwaggerResource(); 7 uidResource.setName(&amp;#34;UID Apis&amp;#34;); 8 uidResource.setSwaggerVersion(&amp;#34;2.0&amp;#34;); 9 uidResource.setLocation(&amp;#34;/api/rest/swagger.json&amp;#34;); 10 11 SwaggerResource adminResource = new SwaggerResource(); 12 adminResource.setName(&amp;#34;Admin Apis&amp;#34;); 13 adminResource.setSwaggerVersion(&amp;#34;2.0&amp;#34;); 14 adminResource.setLocation(&amp;#34;/api/admin/swagger.json&amp;#34;); 15 16 SwaggerResource capResource = new SwaggerResource(); 17 capResource.setName(&amp;#34;CAP Apis&amp;#34;); 18 capResource.setSwaggerVersion(&amp;#34;2.0&amp;#34;); 19 capResource.setLocation(&amp;#34;/api/v1/swagger.json&amp;#34;); 20 // è¿”å›ä¸€ä¸ªList 21 List&amp;lt;SwaggerResource&amp;gt; resources = new ArrayList&amp;lt;&amp;gt;(); 22 resources.add(uidResource); 23 resources.add(adminResource); 24 resources.add(capResource); 25 return resources; 26 }; 27 } å› ä¸ºç°åœ¨ç”Ÿæˆäº†å¤šä¸ªæ¥å£å®šä¹‰jsonæ–‡ä»¶ï¼Œé€šè¿‡springfox.documentation.swagger.v2.pathå‚æ•°æ— æ³•é…ç½®å¤šä¸ªè·¯å¾„è®©swagger-uiæ„ŸçŸ¥ã€‚è¿™æ—¶å°±éœ€è¦å®šä¹‰SwaggerResourcesProviderè¿™ä¸ªBeanï¼Œspringfox-swagger-uiè¿™ä¸ªåº“ä¸­çš„jså°è£…äº†å¯¹ä¸Šè¿°é…ç½®çš„é€»è¾‘ï¼Œä¼šè‡ªåŠ¨è·å–å¤šä¸ªæ¥å£å®šä¹‰ã€‚
è‡³æ­¤ï¼ŒåŸºäºSpringBoot&#43;CXFçš„Swaggerä½¿ç”¨æ–¹æ¡ˆå®Œç¾äº†ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ SwaggerFeature / Swagger2Feature Question: what&amp;rsquo;s the preferred way to override the v2 path? Springboot CXF Swagger example Springfox documentation Multiple swagger JSON&amp;rsquo;s in swagger-ui.html Collision by Swagger2Feature in two OSGI bundles </content>
    </entry>
    
     <entry>
        <title>SpringBootä¸­ä½¿ç”¨Jacksonå¯¼è‡´Longå‹æ•°æ®ç²¾åº¦ä¸¢å¤±é—®é¢˜</title>
        <url>https://orchidflower.github.io/2018/06/22/Handling-Bigint-using-Jackson-in-Springboot/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Springboot</tag><tag>Jackson</tag><tag>ç²¾åº¦</tag>
        </tags>
        <content type="html"> æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªbigintç±»å‹æ•°æ®ï¼Œå¯¹åº”javaåå°ç±»å‹ä¸ºLongå‹ï¼Œåœ¨æŸä¸ªæŸ¥è¯¢é¡µé¢ä¸­ç¢°åˆ°äº†é—®é¢˜ï¼šé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚ä¾‹å¦‚æ•°æ®åº“ä¸­å­˜å‚¨çš„æ˜¯ï¼š1475797674679549851ï¼Œæ˜¾ç¤ºå‡ºæ¥å´æˆäº†1475797674679550000ï¼Œåé¢å‡ ä½å…¨å˜æˆäº†0ï¼Œç²¾åº¦ä¸¢å¤±äº†ã€‚
1. åŸå›  è¿™æ˜¯å› ä¸ºJavascriptä¸­æ•°å­—çš„ç²¾åº¦æ˜¯æœ‰é™çš„ï¼Œbigintç±»å‹çš„çš„æ•°å­—è¶…å‡ºäº†Javascriptçš„å¤„ç†èŒƒå›´ã€‚JS éµå¾ª IEEE 754 è§„èŒƒï¼Œé‡‡ç”¨åŒç²¾åº¦å­˜å‚¨ï¼ˆdouble precisionï¼‰ï¼Œå ç”¨ 64 bitã€‚å…¶ç»“æ„å¦‚å›¾ï¼š
å„ä½çš„å«ä¹‰å¦‚ä¸‹ï¼š
1ä½ï¼ˆsï¼‰ ç”¨æ¥è¡¨ç¤ºç¬¦å·ä½ 11ä½ï¼ˆeï¼‰ ç”¨æ¥è¡¨ç¤ºæŒ‡æ•° 52ä½ï¼ˆfï¼‰ è¡¨ç¤ºå°¾æ•° å°¾æ•°ä½æœ€å¤§æ˜¯ 52 ä½ï¼Œå› æ­¤ JS ä¸­èƒ½ç²¾å‡†è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°æ˜¯ Math.pow(2, 53)ï¼Œåè¿›åˆ¶å³ 9007199254740992ã€‚è€ŒBigintç±»å‹çš„æœ‰æ•ˆä½æ•°æ˜¯63ä½ï¼ˆæ‰£é™¤ä¸€ä½ç¬¦å·ä½ï¼‰ï¼Œå…¶æœ€å¤§å€¼ä¸ºï¼šMath.pow(2,63)ã€‚ä»»ä½•å¤§äº 9007199254740992 çš„å°±å¯èƒ½ä¼šä¸¢å¤±ç²¾åº¦ï¼š
19007199254740992 &amp;gt;&amp;gt; 10000000000000...000 // å…±è®¡ 53 ä¸ª 0 29007199254740992 &#43; 1 &amp;gt;&amp;gt; 10000000000000...001 // ä¸­é—´ 52 ä¸ª 0 39007199254740992 &#43; 2 &amp;gt;&amp;gt; 10000000000000...010 // ä¸­é—´ 51 ä¸ª 0 å®é™…ä¸Šå€¼å´æ˜¯ï¼š
19007199254740992 &#43; 1 // ä¸¢å¤± 29007199254740992 &#43; 2 // æœªä¸¢å¤± 39007199254740992 &#43; 3 // ä¸¢å¤± 49007199254740992 &#43; 4 // æœªä¸¢å¤± 2.è§£å†³æ–¹æ³• è§£å†³åŠæ³•å°±æ˜¯è®©JavascriptæŠŠæ•°å­—å½“æˆå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚å¯¹Javascriptæ¥è¯´ï¼Œä¸è¿›è¡Œè¿ç®—ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²å¤„ç†èµ·æ¥æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å½“ç„¶å¦‚æœéœ€è¦è¿›è¡Œè¿ç®—ï¼Œåªèƒ½é‡‡ç”¨å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚ä½¿ç”¨JavaScriptçš„ä¸€äº›å¼€æºåº“bignumberä¹‹ç±»çš„å¤„ç†äº†ã€‚Javaè¿›è¡ŒJSONå¤„ç†çš„æ—¶å€™æ˜¯èƒ½å¤Ÿæ­£ç¡®å¤„ç†longå‹çš„ï¼Œåªéœ€è¦å°†æ•°å­—è½¬åŒ–æˆå­—ç¬¦ä¸²å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ï¼š
1{ 2 ... 3 &amp;#34;bankcardHash&amp;#34;: 1475797674679549851, 4 ... 5} å˜ä¸ºï¼š
1{ 2 ... 3 &amp;#34;bankcardHash&amp;#34;: &amp;#34;1475797674679549851&amp;#34;, 4 ... 5} è¿™æ ·Javascriptå°±å¯ä»¥æŒ‰ç…§å­—ç¬¦ä¸²æ–¹å¼å¤„ç†ï¼Œä¸å­˜åœ¨æ•°å­—ç²¾åº¦ä¸¢å¤±äº†ã€‚åœ¨Springbootä¸­å¤„ç†æ–¹æ³•åŸºæœ¬ä¸Šæœ‰ä»¥ä¸‹å‡ ç§ï¼š
2.1 é…ç½®å‚æ•°write_numbers_as_strings Jacksonæœ‰ä¸ªé…ç½®å‚æ•°WRITE_NUMBERS_AS_STRINGSï¼Œå¯ä»¥å¼ºåˆ¶å°†æ‰€æœ‰æ•°å­—å…¨éƒ¨è½¬æˆå­—ç¬¦ä¸²è¾“å‡ºã€‚å…¶åŠŸèƒ½ä»‹ç»ä¸ºï¼šFeature that forces all Java numbers to be written as JSON strings.ã€‚ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦é…ç½®å‚æ•°å³å¯ï¼š
1spring: 2 jackson: 3 generator: 4 write_numbers_as_strings: true è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ä½¿ç”¨æ–¹ä¾¿ï¼Œä¸éœ€è¦è°ƒæ•´ä»£ç ï¼›ç¼ºç‚¹æ˜¯é¢—ç²’åº¦å¤ªå¤§ï¼Œæ‰€æœ‰çš„æ•°å­—éƒ½è¢«è½¬æˆå­—ç¬¦ä¸²è¾“å‡ºäº†ï¼ŒåŒ…æ‹¬æŒ‰ç…§timestampæ ¼å¼è¾“å‡ºçš„æ—¶é—´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
2.2 æ³¨è§£ å¦ä¸€ä¸ªæ–¹å¼æ˜¯ä½¿ç”¨æ³¨è§£JsonSerializeï¼š
1 @JsonSerialize(using=ToStringSerializer.class) 2 private Long bankcardHash; æŒ‡å®šäº†ToStringSerializerè¿›è¡Œåºåˆ—åŒ–ï¼Œå°†æ•°å­—ç¼–ç æˆå­—ç¬¦ä¸²æ ¼å¼ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯é¢—ç²’åº¦å¯ä»¥å¾ˆç²¾ç»†ï¼›ç¼ºç‚¹åŒæ ·æ˜¯å¤ªç²¾ç»†ï¼Œå¦‚æœéœ€è¦è°ƒæ•´çš„å­—æ®µæ¯”è¾ƒå¤šä¼šæ¯”è¾ƒéº»çƒ¦ã€‚
2.3 è‡ªå®šä¹‰ObjectMapper æœ€åæƒ³åˆ°å¯ä»¥å•ç‹¬æ ¹æ®ç±»å‹è¿›è¡Œè®¾ç½®ï¼Œåªå¯¹Longå‹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè€Œå¯¹å…¶ä»–ç±»å‹çš„æ•°å­—ä¸åšå¤„ç†ã€‚Jacksonæä¾›äº†è¿™ç§æ”¯æŒã€‚æ–¹æ³•æ˜¯å¯¹ObjectMapperè¿›è¡Œå®šåˆ¶ã€‚æ ¹æ®SpringBootçš„å®˜æ–¹å¸®åŠ©ï¼ˆhttps://docs.spring.io/spring-boot/docs/current/reference/html/howto-spring-mvc.html#howto-customize-the-jackson-objectmapperï¼‰ï¼Œæ‰¾åˆ°ä¸€ç§ç›¸å¯¹ç®€å•çš„æ–¹æ³•ï¼Œåªå¯¹ObjectMapperè¿›è¡Œå®šåˆ¶ï¼Œè€Œä¸æ˜¯å®Œå…¨ä»å¤´å®šåˆ¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
1@Bean(&amp;#34;jackson2ObjectMapperBuilderCustomizer&amp;#34;) 2public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilderCustomizer() { 3 Jackson2ObjectMapperBuilderCustomizer customizer = new Jackson2ObjectMapperBuilderCustomizer() { 4 @Override 5 public void customize(Jackson2ObjectMapperBuilder jacksonObjectMapperBuilder) { 6 jacksonObjectMapperBuilder.serializerByType(Long.class, ToStringSerializer.instance) 7 .serializerByType(Long.TYPE, ToStringSerializer.instance); 8 } 9 }; 10 return customizer; 11} é€šè¿‡å®šä¹‰Jackson2ObjectMapperBuilderCustomizerï¼Œå¯¹Jackson2ObjectMapperBuilderå¯¹è±¡è¿›è¡Œå®šåˆ¶ï¼Œå¯¹Longå‹æ•°æ®è¿›è¡Œäº†å®šåˆ¶ï¼Œä½¿ç”¨ToStringSerializeræ¥è¿›è¡Œåºåˆ—åŒ–ã€‚é—®é¢˜ç»ˆäºå®Œç¾è§£å†³ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ Customize the Jackson ObjectMapper Java Code Examples for org.springframework.http.converter.json.Jackson2ObjectMapperBuilder Spring MVCè‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨(å¯è§£å†³Longç±»å‹æ•°æ®ä¼ å…¥å‰ç«¯ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜) Jackson Annotation Examples What Every Computer Scientist Should Know About Floating-Point Arithmetic </content>
    </entry>
    
     <entry>
        <title>Springä½¿ç”¨POIå¯¼å‡ºExcelå†…å­˜æº¢å‡ºé—®é¢˜çš„è§£å†³ï¼ˆç»­ï¼‰</title>
        <url>https://orchidflower.github.io/2018/06/15/Solving-OutOfMemoryException-Happened-when-Exporting-Excel-using-POI-in-Spring-Part2/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>POI</tag><tag>å¯¼å‡ºExcel</tag>
        </tags>
        <content type="html"> ä¸Šç¯‡æ–‡ç« ä»‹ç»äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè§£å†³äº†å¯¼å‡ºExcelè¿‡ç¨‹ä¸­å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚ä½†æ˜¯æœ‰äº›é—®é¢˜è¿˜æ²¡æœ‰ææ˜ç™½ï¼Œé‚£å°±æ˜¯ä¸ºä»€ä¹ˆè¦è¿™æ ·æ‰“å¼€æ•°æ®åº“æ¸¸æ ‡ï¼Ÿä¸ºä»€ä¹ˆfetchSizeå¿…é¡»ä¸ºï¼š-2147483648ï¼Ÿè¿™é‡Œé¢æ¶‰åŠåˆ°æ•°æ®åº“æ¸¸æ ‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¿™ä¸€ç¯‡æ–‡ç« å°†æ·±å…¥ä»‹ç»è¿™æ–¹é¢å†…å®¹ã€‚
åœ¨æ•°æ®åº“ä¸­ï¼Œæ¸¸æ ‡æ˜¯ä¸€ä¸ªååˆ†é‡è¦çš„æ¦‚å¿µã€‚æ¸¸æ ‡æä¾›äº†ä¸€ç§å¯¹ä»è¡¨ä¸­æ£€ç´¢å‡ºçš„æ•°æ®è¿›è¡Œæ“ä½œçš„çµæ´»æ‰‹æ®µï¼Œå°±æœ¬è´¨è€Œè¨€ï¼Œæ¸¸æ ‡å®é™…ä¸Šæ˜¯ä¸€ç§èƒ½ä»åŒ…æ‹¬å¤šæ¡æ•°æ®è®°å½•çš„ç»“æœé›†ä¸­æ¯æ¬¡æå–ä¸€æ¡è®°å½•çš„æœºåˆ¶ã€‚æ¸¸æ ‡æ€»æ˜¯ä¸ä¸€æ¡SQL é€‰æ‹©è¯­å¥ç›¸å…³è”å› ä¸ºæ¸¸æ ‡ç”±ç»“æœé›†ï¼ˆå¯ä»¥æ˜¯é›¶æ¡ã€ä¸€æ¡æˆ–ç”±ç›¸å…³çš„é€‰æ‹©è¯­å¥æ£€ç´¢å‡ºçš„å¤šæ¡è®°å½•ï¼‰å’Œç»“æœé›†ä¸­æŒ‡å‘ç‰¹å®šè®°å½•çš„æ¸¸æ ‡ä½ç½®ç»„æˆã€‚
MySQLæ•°æ®åº“æ¸¸æ ‡é€šå¸¸æœ‰ä¸¤ç§å½¢å¼ï¼šClient Side Cursorï¼ˆå®¢æˆ·ç«¯æ¸¸æ ‡ï¼‰å’ŒServer Side Cursorï¼ˆæœåŠ¡å™¨ç«¯æ¸¸æ ‡ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¸¸æ ‡ä¼šæŠŠæ•´ä¸ªç»“æœé›†è·å–åˆ°å®¢æˆ·ç«¯å†…å­˜ä¸­ï¼Œå¦‚æœç»“æœé›†å¤ªå¤§ï¼Œå°±ä¼šå¼•å‘Out Of Memoryé”™è¯¯ï¼›è€ŒæœåŠ¡å™¨ç«¯æ¸¸æ ‡ä¼šå°†ç»“æœé›†ç¼“å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡å™¨ç«¯åˆ†æ‰¹è·å¾—ç»“æœé›†ã€‚
MySQLé»˜è®¤æ˜¯ä½¿ç”¨å®¢æˆ·ç«¯æ¸¸æ ‡çš„ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºå¤„ç†çš„ç»“æœé›†ä¸ä¼šç‰¹åˆ«å¤§ï¼Œå¯¹å°ç»“æœé›†ä½¿ç”¨å®¢æˆ·ç«¯æ¸¸æ ‡æ•ˆç‡æ›´é«˜ï¼šç»“æœé›†ä¸€æ¬¡æ€§ä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥è‡ªè¡Œå¤„ç†ï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿå¯ä»¥ä¸ºå…¶ä»–å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚ä½†æ˜¯é’ˆå¯¹å¤§ç»“æœé›†ï¼Œé»˜è®¤çš„å®¢æˆ·ç«¯æ¸¸æ ‡å¤„ç†æ–¹å¼æ»¡è¶³ä¸äº†è¦æ±‚ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒMySQLçš„Javaå®¢æˆ·ç«¯åšäº†ä¸€ä¸ªç‰¹æ®Šçš„å¤„ç†ã€‚ä¸‹é¢å‚ç…§å®˜æ–¹å¸®åŠ©çœ‹ä¸€ä¸‹ã€‚
1. å®˜æ–¹å¸®åŠ©è¯´æ˜ 1.1 å®¢æˆ·ç«¯æ¸¸æ ‡ By default, ResultSets are completely retrieved and stored in memory. In most cases this is the most efficient way to operate and, due to the design of the MySQL network protocol, is easier to implement. If you are working with ResultSets that have a large number of rows or large values and cannot allocate heap space in your JVM for the memory required, you can tell the driver to stream the results back one row at a time. To enable this functionality, create a Statement instance in the following manner:
stmt = conn.createStatement(java.sql.ResultSet.TYPE_FORWARD_ONLY, java.sql.ResultSet.CONCUR_READ_ONLY); stmt.setFetchSize(Integer.MIN_VALUE);
1&amp;gt;The combination of a forward-only, read-only result set, with a fetch size of Integer.`MIN_VALUE` serves as a signal to the driver to stream result sets row-by-row. After this, any result sets created with the statement will be retrieved row-by-row. 2 3ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼š 4&amp;gt; ç¼ºçœæƒ…å†µä¸‹ï¼Œç»“æœé›†ä¼šè¢«æ•´ä¸ªçš„æ‹‰å–å¹¶ä¿å­˜åˆ°å®¢æˆ·ç«¯å†…å­˜ä¸­ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ˜¯è¿™æ˜¯æœ€æœ‰æ•ˆçš„æ–¹å¼ï¼Œå¯ä»¥ä¸MySQLçš„ç½‘ç»œåè®®å®Œç¾é…åˆã€‚å¦‚æœä½ éœ€è¦å¤„ç†ä¸€ä¸ªå¤§æ•°é‡çº§çš„ç»“æœé›†æˆ–è€…ä½ æ— æ³•åœ¨ä½ çš„JVMä¸­ç”³è¯·è¶³å¤Ÿçš„Heapå†…å­˜ï¼Œä½ å¯ä»¥å‘Šè¯‰é©±åŠ¨ä½¿ç”¨æµæ–¹å¼è¿”å›ç»“æœé›†ï¼Œä¸€æ¬¡è¿”å›ä¸€æ¡è®°å½•ã€‚ 5 6&amp;gt; è¦å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„ä»£ç æ–¹å¼åˆ›å»ºç»“æœStatementï¼š 7 8&amp;gt; ```java 9stmt = conn.createStatement(java.sql.ResultSet.TYPE_FORWARD_ONLY, 10 java.sql.ResultSet.CONCUR_READ_ONLY); 11stmt.setFetchSize(Integer.MIN_VALUE); ä½¿ç”¨TYPE_FORWARD_ONLYï¼ŒCONCUR_READER_ONLYçš„ç»„åˆåˆ›å»ºä¸€ä¸ªStatementï¼Œå¹¶ä¸”æŒ‡å®šfetchSizeä¸ºInteger.MIN_VALUEï¼Œè¿™ä¼šå‘Šè¯‰MySQLçš„é©±åŠ¨ä½¿ç”¨æµæ–¹å¼å¤„ç†ç»“æœé›†ï¼Œä¸€æ¬¡è¿”å›ä¸€æ¡è®°å½•ã€‚
1.2 -2147483648çš„æ¥å† é‚£ä¹ˆInteger.MIN_VALUEæ˜¯å¤šå°‘å‘¢ï¼Ÿçœ‹ä¸€ä¸‹å®šä¹‰ï¼š
1@Native public static final int MIN_VALUE = 0x80000000; è®¡ç®—ä¸€ä¸‹ï¼Œæ­£å¥½æ˜¯ï¼š-2147483648ã€‚è¿™å°±æ˜¯ä¹‹å‰æåˆ°çš„è¿™ä¸ªæ•°å­—çš„æ¥å†ï¼ŒMySQLé©±åŠ¨éœ€è¦è¿™ä¸ªæ•°å­—æ¥æ˜ç¡®å¼€å¯æµå¤„ç†æ–¹å¼ã€‚å›å¿†ä¸€ä¸‹ä¹‹å‰åšæ–‡è¯´é“çš„ä¿®æ”¹æ–¹å¼ï¼Œå…¶ä¸­çš„fetchSize, resultTypeéƒ½æ˜¯æŒ‰ç…§ä¸Šé¢å¸®åŠ©ä¸­æåˆ°çš„è¦æ±‚è¿›è¡Œè®¾ç½®çš„ï¼š
1&amp;lt;select id=&amp;#34;exportByExample&amp;#34; fetchSize=&amp;#34;-2147483648&amp;#34; parameterType=&amp;#34;com.eveus.admin.po.logs.BankcardAuthNoOTPLogPOExample&amp;#34; resultSetType=&amp;#34;FORWARD_ONLY&amp;#34; resultMap=&amp;#34;BaseResultMap&amp;#34;&amp;gt; 2 select 3 &amp;lt;include refid=&amp;#34;Export_Column_List&amp;#34; /&amp;gt; 4 from UID_BANKCARD_AUTH_NO_OTP_LOG 5 &amp;lt;if test=&amp;#34;_parameter != null&amp;#34;&amp;gt; 6 &amp;lt;include refid=&amp;#34;Example_Where_Clause&amp;#34; /&amp;gt; 7 &amp;lt;/if&amp;gt; 8 &amp;lt;if test=&amp;#34;orderByClause != null&amp;#34;&amp;gt; 9 order by ${orderByClause} 10 &amp;lt;/if&amp;gt; 11&amp;lt;/select&amp;gt; 1.3 å®¢æˆ·ç«¯æ¸¸æ ‡çš„é™åˆ¶ å®¢æˆ·ç«¯æ¸¸æ ‡åœ¨ä½¿ç”¨ä¸­è¿˜æ˜¯æœ‰ä¸€äº›é™åˆ¶æˆ–è€…ä¸è¶³çš„åœ°æ–¹çš„ã€‚æˆ‘ä»¬ç»§ç»­çœ‹å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š
There are some caveats with this approach. You must read all of the rows in the result set (or close it) before you can issue any other queries on the connection, or an exception will be thrown.
The earliest the locks these statements hold can be released (whether they be MyISAM table-level locks or row-level locks in some other storage engine such as InnoDB) is when the statement completes.
If the statement is within scope of a transaction, then locks are released when the transaction completes (which implies that the statement needs to complete first). As with most other databases, statements are not complete until all the results pending on the statement are read or the active result set for the statement is closed.
Therefore, if using streaming results, process them as quickly as possible if you want to maintain concurrent access to the tables referenced by the statement producing the result set.
ç¿»è¯‘ä¸€ä¸‹ï¼š
ä½¿ç”¨è¿™ç§æœºåˆ¶æœ‰ä¸€äº›äº‹æƒ…éœ€è¦æ³¨æ„ï¼šä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“é“¾æ¥ï¼Œä½ å¿…é¡»è¯»å–ç»“æœé›†ä¸­çš„å…¨éƒ¨è®°å½•ï¼ˆæˆ–è€…å…³æ‰ç»“æœé›†ï¼‰æ‰èƒ½å¤Ÿæ‰§è¡Œæ–°çš„æŸ¥è¯¢è¯­å¥ï¼Œå¦åˆ™ä¼šæœ‰å¼‚å¸¸æŠ›å‡ºã€‚ åªæœ‰å½“Statementæ‰§è¡Œå®Œæ¯•çš„æ—¶å€™ï¼Œå…¶æŒæœ‰çš„é”æ‰èƒ½å¤Ÿè¢«é‡Šæ”¾ï¼ˆæ— è®ºæ˜¯MyISAMçš„è¡¨çº§é”è¿˜æ˜¯å…¶ä»–å­˜å‚¨å¼•æ“ï¼Œä¾‹å¦‚InnoDBï¼Œçš„è¡Œçº§é”ï¼‰ã€‚ å¦‚æœè¯¥Statementä½äºä¸€ä¸ªäº‹åŠ¡å½“ä¸­ï¼Œåªæœ‰å½“äº‹åŠ¡å®Œæˆçš„æ—¶å€™ï¼ŒStatementæŒæœ‰çš„é”æ‰ä¼šè¢«é‡Šæ”¾ã€‚è¿™åŒæ—¶æ„å‘³ç€Statementå¿…é¡»å…ˆäºäº‹åŠ¡å®Œæˆã€‚ä¸å¤§å¤šæ•°æ•°æ®åº“ä¸€æ ·ï¼Œåªæœ‰è¯»å–äº†Statementä¸Šçš„æ‰€æœ‰ç»“æœæˆ–å…³é—­äº†è¯­å¥çš„æ´»åŠ¨ç»“æœé›†ï¼ŒStatementæ‰ä¼šå…³é—­ã€‚ å› æ­¤ï¼Œå¦‚æœè¦ä½¿ç”¨æµæ–¹å¼å¤„ç†ç»“æœé›†ï¼Œä¸€å®šè¦è®°ä½å°½å¯èƒ½å¿«çš„å¤„ç†ç»“æœé›†ï¼Œä»¥ä¿è¯å¯¹äº§ç”Ÿç»“æœé›†çš„è¡¨çš„å¹¶å‘è®¿é—®èƒ½åŠ›ã€‚
æ€»ç»“ä¸€ä¸‹å°±æ˜¯ä½¿ç”¨æµæ–¹å¼çš„æ—¶å€™ï¼Œç»“æœé›†æ²¡æœ‰å¤„ç†å®Œæˆ–è€…Statementæ²¡æœ‰å…³é—­çš„æ—¶å€™ï¼Œæ˜¯æœ‰é”å­˜åœ¨çš„ï¼Œå› æ­¤å¤„ç†é€Ÿåº¦ä¸€å®šè¦å¿«ï¼Œå¦åˆ™ä¼šå½±å“å¹¶å‘æ€§èƒ½ã€‚
1.3 æœåŠ¡å™¨ç«¯æ¸¸æ ‡ Another alternative is to use cursor-based streaming to retrieve a set number of rows each time. This can be done by setting the connection property useCursorFetch to true, and then calling setFetchSize(int) with int being the desired number of rows to be fetched each time: å¦ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨åŸºäºæ¸¸æ ‡çš„æµå¤„ç†æ–¹å¼æ¥æ¯æ¬¡è·å–æŒ‡å®šæ•°é‡çš„è®°å½•ã€‚å¯ä»¥é€šè¿‡åœ¨MySQLé“¾æ¥å­—ç¬¦ä¸²ä¸­è®¾ç½®useCursorFetch=trueè¿™ç§å‚æ•°ï¼Œç„¶åè°ƒç”¨setFetchSize(int)å‡½æ•°æ¥è®¾ç½®æœŸæœ›çš„æ¯æ¬¡è¿”å›çš„è®°å½•æ¡æ•°ã€‚
1conn = DriverManager.getConnection(&amp;#34;jdbc:mysql://localhost/?useCursorFetch=true&amp;#34;, &amp;#34;user&amp;#34;, &amp;#34;s3cr3t&amp;#34;); 2stmt = conn.createStatement(); 3stmt.setFetchSize(100); 4rs = stmt.executeQuery(&amp;#34;SELECT * FROM your_table_here&amp;#34;); è¿™å°±æ˜¯æœåŠ¡å™¨ç«¯æ¸¸æ ‡çš„ä½¿ç”¨æ–¹æ³•ï¼šåœ¨MySQLè¿æ¥å­—ç¬¦ä¸²ä¸­å¢åŠ useCursorFetch=trueå‚æ•°ï¼Œç„¶ååœ¨Statementä¸Šæ‰§è¡ŒsetFetchSizeè®¾ç½®æœŸæœ›æ¯æ¬¡å¤„ç†çš„è®°å½•æ•°ã€‚å°±è¿™ä¹ˆç®€å•ã€‚ä½¿ç”¨MyBatisçš„è¯ï¼Œè¿˜æ˜¯éœ€è¦åœ¨Mapper XMLæ–‡ä»¶ä¸­ä½¿ç”¨fetchSizeå‚æ•°æ¥è®¾ç½®æœŸæœ›çš„è®°å½•æ¡æ•°ã€‚ä¾‹å¦‚ï¼š
1&amp;lt;select id=&amp;#34;exportByExample&amp;#34; fetchSize=&amp;#34;100&amp;#34; parameterType=&amp;#34;com.eveus.admin.po.logs.BankcardAuthNoOTPLogPOExample&amp;#34; resultMap=&amp;#34;BaseResultMap&amp;#34;&amp;gt; 2. æ€§èƒ½æµ‹è¯• çœ‹è¿‡å®˜æ–¹æ–‡æ¡£ï¼Œé’ˆå¯¹å¤§ç»“æœé›†ï¼Œå®é™…ä¸Šæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”¨æ¥è§£å†³JVMå†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼š
ä½¿ç”¨å®¢æˆ·ç«¯æ¸¸æ ‡æ–¹å¼çš„æµå¤„ç†æ–¹å¼ï¼› ä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸¸æ ‡æ–¹å¼å¤„ç†ã€‚ é‚£ç©¶ç«Ÿå“ªç§æ–¹å¼æ•ˆç‡æ›´é«˜ï¼Œé€Ÿåº¦æ›´å¿«å‘¢ï¼Ÿå†™ä¸ªæµ‹è¯•è·‘ä¸€ä¸‹å°±çŸ¥é“äº†ï¼š
1Date d1, d2, d3; 2 3BankcardAuthNoOTPLogPOExample example = new BankcardAuthNoOTPLogPOExample(); 4BankcardAuthNoOTPLogPOExample.Criteria criteria = example.createCriteria(); 5criteria.andIdGreaterThan(0L); 6Map&amp;lt;String, Object&amp;gt; readerParams = new HashMap&amp;lt;String, Object&amp;gt;(); 7readerParams.put(&amp;#34;oredCriteria&amp;#34;, example.getOredCriteria()); 8 9MyBatisCursorItemReader&amp;lt;BankcardAuthNoOTPLogPO&amp;gt; reader = new MyBatisCursorItemReader&amp;lt;&amp;gt;(); 10reader.setSqlSessionFactory(sqlSessionFactory); 11reader.setQueryId(&amp;#34;com.eveus.admin.mapper.logs.BankcardAuthNoOTPLogPOCustMapper.exportByExample&amp;#34;); 12reader.setParameterValues(readerParams); 13 14d1 = new Date(); 15reader.open(new ExecutionContext()); // æ‰“å¼€æ¸¸æ ‡ 16d2 = new Date(); 17BankcardAuthNoOTPLogPO logPO = null; 18int rows = 0; 19while (( logPO = reader.read()) != null) { 20 rows&#43;&#43;; 21 if (rows%10000==0) { 22 System.out.println(rows); 23 } 24} 25d3 = new Date(); 26System.out.printf(&amp;#34;Test Result:\n Open Cursor: %d, Read all records: %d\n&amp;#34;, d2.getTime()-d1.getTime(), d3.getTime()-d2.getTime()); 27System.out.println(&amp;#34;Done&amp;#34;); ä¸Šé¢çš„ä¾‹å­ï¼Œåˆ†åˆ«è®°å½•äº†æ¸¸æ ‡æ‰“å¼€æ—¶é—´ï¼Œæ‰€æœ‰è®°å½•å…¨éƒ¨éå†ä¸€éçš„æ—¶é—´ã€‚ä¸‹é¢æ˜¯æµ‹è¯•ç»“æœï¼š
ç¼–å· fetchSize useCursorFetch æ‰“å¼€æ¸¸æ ‡æ—¶é—´ï¼ˆms) éå†ç»“æœé›†æ—¶é—´(ms) å†…å­˜å ç”¨(G) 1 -2147483648 - 82 46466 1.53 2 - - 51641 24835 3.12 3 2000 - 51193 29519 3.09 4 - true 48955 23013 2.88 5 -2147483648 true 90 43334 1.37 6 1000 true 13162 65851 1.49 æ³¨1ï¼šä»¥ä¸Šç»“æœåŸºäºä¸€ä¸ªæ€»è®°å½•æ•°ä¸º2954671çš„è¡¨è¿›è¡Œæµ‹è¯•æ‰€å¾—ï¼› æ³¨2ï¼šfetchSizeå‚æ•°åœ¨MyBatis Mapperæ–‡ä»¶ä¸­è®¾ç½®ï¼› æ³¨3ï¼šuseCursorFetchå‚æ•°åœ¨MySQLé“¾æ¥å­—ç¬¦ä¸²ä¸­è®¾ç½®ï¼›
é€šè¿‡ç»“æœå¯ä»¥ç®€å•åˆ†æå‡ºæ¥ï¼š
fetchSizeå¦‚æœæ˜¯Integer.MIN_VALUEï¼Œåˆ™å¼ºåˆ¶è¿›è¡Œå®¢æˆ·ç«¯æ¸¸æ ‡çš„æµå¤„ç†æ¨¡å¼ï¼ˆæ— è®ºæ˜¯å¦æŒ‡å®šuseCursorFetchå‚æ•°ï¼‰ï¼› è¦ä½¿ç”¨å®¢æˆ·ç«¯æ¸¸æ ‡çš„æµå¤„ç†æ¨¡å¼ï¼Œåˆ™fetchSizeå¿…é¡»ä¸ºInteger.MIN_VALUEï¼› è¦ä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸¸æ ‡ï¼Œåˆ™å¿…é¡»å¯ç”¨useCursorFetchå‚æ•°ï¼Œå¹¶æŒ‡å®šfetchSizeã€‚ 3. å¦‚ä½•é€‰æ‹©ï¼Ÿ æµ‹è¯•ç»“æœåˆ†æï¼š æ ¹æ®ç»“æœï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å°†å…­ç§æµ‹è¯•åœºæ™¯æƒ…å½¢å½’ç»“æˆä¸‰ç§æ¨¡å¼ï¼ˆçŒœæµ‹æ€§è´¨ï¼‰ï¼š
a. å®¢æˆ·ç«¯æ¸¸æ ‡çš„æµå¤„ç†æ¨¡å¼ï¼Œå¯¹åº”æµ‹è¯•ç”¨ä¾‹1ï¼Œ5ï¼› b. æœåŠ¡å™¨ç«¯æ¸¸æ ‡å¤„ç†æ¨¡å¼ï¼Œå¯¹åº”æµ‹è¯•ç”¨ä¾‹6ï¼› c. ä¼ ç»Ÿå®¢æˆ·ç«¯æ¸¸æ ‡å¤„ç†æ¨¡å¼ï¼Œå¯¹åº”å…¶ä»–ä¸‰ç§æµ‹è¯•ç”¨ä¾‹ã€‚
æ¸¸æ ‡æ‰“å¼€é€Ÿåº¦ï¼šå®¢æˆ·ç«¯æ¸¸æ ‡çš„æµå¤„ç†æ¨¡å¼è€—æ—¶æœ€çŸ­ï¼Œä¸åˆ°100msï¼›å…¶æ¬¡æ˜¯æœåŠ¡å™¨ç«¯æ¸¸æ ‡ï¼Œ10ç§’&#43;å·¦å³ï¼›è€Œå¯¹ä¼ ç»Ÿçš„å®¢æˆ·ç«¯æ¸¸æ ‡å¤„ç†æ–¹å¼ï¼Œéœ€è¦æŠŠæ•´ä¸ªç»“æœé›†ç¼“å†²åˆ°å®¢æˆ·ç«¯ï¼Œä¸åªæ˜¯å®¹æ˜“å¼•èµ·å†…å­˜æº¢å‡ºï¼Œé¦–æ¬¡æ‰“å¼€æ¸¸æ ‡çš„æ—¶é—´ä¹Ÿéå¸¸é•¿ï¼Œ50&#43;ç§’å·¦å³ã€‚
è®°å½•é›†éå†é€Ÿåº¦ï¼šä¼ ç»Ÿæ¨¡å¼cé€Ÿåº¦æœ€å¿«ï¼Œåœ¨20-30ç§’ä¹‹é—´ï¼›è€Œæ¨¡å¼aæ¬¡ä¹‹ï¼Œåœ¨40&#43;ç§’å·¦å³ï¼›è€ŒæœåŠ¡å™¨ç«¯æ¸¸æ ‡æ¨¡å¼bæœ€æ…¢ï¼Œ65ç§’äº†ã€‚
å†…å­˜è€—ç”¨ï¼šå†…å­˜å¥½ç”¨åˆ™æ˜¯æ¨¡å¼aã€bå·®ä¸å¤ªå¤šï¼Œæ¨¡å¼cå¥½ç”¨å†…å­˜å¤ªå¤šã€‚
æ‰€ä»¥æœ€ç»ˆçš„ç»“è®ºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿˜çœŸæ˜¯æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆï¼Œæœ€å¥½è¿˜æ˜¯æ ¹æ®è‡ªå·±çš„åœºæ™¯è¿›è¡ŒæŠ‰æ‹©äº†ã€‚å¦å¤–çš„æ–¹å¼å°±æ˜¯è‡ªå·±ä¹Ÿå†™ä¸ªæµ‹è¯•ç¨‹åºå¤šæµ‹æµ‹ï¼Œç»“åˆè‡ªå·±çš„åœºæ™¯æ‰èƒ½å¤Ÿé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆäº†ã€‚
å¯¹è®¤è¯äº‘çš„é—®é¢˜æ¥è¯´ï¼ˆå¯¼å‡ºExcelï¼‰ï¼Œæœ€ç»ˆé€‰æ‹©çš„æ˜¯æ¨¡å¼aï¼ˆå®¢æˆ·ç«¯æ¸¸æ ‡çš„æµå¤„ç†æ–¹å¼ï¼‰ï¼šå…¶æ€»ä½“å¤„ç†é€Ÿåº¦æœ€å¿«ï¼ˆæ‰“å¼€æ¸¸æ ‡å’Œè®°å½•éå†æ—¶é—´ç›¸åŠ ä¹‹å’Œæœ€å°ï¼‰ï¼Œå ç”¨å†…å­˜ä¹Ÿä¸å¤§ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯æœ€æ°å½“çš„æ–¹æ¡ˆäº†ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ JDBC API Implementation Notes How to set fetchSize for iBatis select statement JDBC performance tuning with optimal fetch size MySQL JDBC/MyBatis Streamæ–¹å¼è¯»å–SELECTè¶…å¤§ç»“æœé›† select * causing &amp;quot; OutOfMemoryError: Java heap space&amp;quot; Streaming MySQL Results Using Java 8 Streams and Spring Data JPA MyBatis æºç è§£æï¼šSQL è¯­å¥çš„æ‰§è¡Œæœºåˆ¶ </content>
    </entry>
    
     <entry>
        <title>Springä½¿ç”¨POIå¯¼å‡ºExcelå†…å­˜æº¢å‡ºé—®é¢˜çš„è§£å†³</title>
        <url>https://orchidflower.github.io/2018/06/11/Solving-OutOfMemoryException-Happened-when-Exporting-Excel-using-POI-in-Spring/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>POI</tag><tag>å¯¼å‡ºExcel</tag>
        </tags>
        <content type="html"> äº‘è®¤è¯å¹³å°æä¾›å°†è®¤è¯è®°å½•å¯¼å‡ºä¸ºExcelçš„åŠŸèƒ½ã€‚ä½†æ˜¯å½“ä¸šåŠ¡é‡æ…¢æ…¢å‘å±•èµ·æ¥ä»¥åï¼Œå°±ç¢°åˆ°ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼šéœ€è¦å¯¼å‡ºçš„è®¤è¯è®°å½•å¤ªå¤šï¼Œå¯¼å‡ºExcelçš„æ—¶å€™ç»å¸¸ç¢°åˆ°æœåŠ¡å™¨å†…å­˜æº¢å‡ºé—®é¢˜ã€‚ä¾‹å¦‚å½“è¦å¯¼å‡º30wæ¡è®°å½•çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å†…å­˜å ç”¨ä¼šè¶…è¿‡2Gï¼Œç»§ç»­å¢åŠ Heapç©ºé—´ä¸æ˜¯ä¸€ä¸ªéå¸¸åˆé€‚çš„æ–¹æ¡ˆï¼Œå› ä¸ºæ— æ³•é¢„çŸ¥ä¸€å…±éœ€è¦å¤šå°‘å†…å­˜ã€‚
å› æ­¤ï¼Œè¿™ä¸¤å¤©ç‰¹æ„æ‰¾äº†ä¸€ä¸‹è§£å†³æ–¹æ¡ˆï¼Œç»ˆäºæœ‰äº†è§£å†³æ–¹æ¡ˆã€‚æœ€ç»ˆæ–¹æ¡ˆå¯¼å‡º256wæ¡è®°å½•çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å†…æˆ˜å ç”¨1.6Gï¼Œä¸å†ç»§ç»­å¢åŠ ã€‚
1. POIé¡¹ç›®ç®€ä»‹ ç”¨Javaå¯¼å‡ºExcelå°±æ— æ³•ç»•è¿‡Apache POIé¡¹ç›®ã€‚è¯´èµ·æ¥ï¼ŒPOIé¡¹ç›®è¿™ä¸ªåå­—å¾ˆæœ‰æ„æ€ï¼Œå®ƒæ˜¯â€œPoor Obfuscation Implementationâ€çš„ç¼©å†™ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯â€œåŠ£è´¨çš„å›°æƒ‘çš„å®ç°â€ã€‚ä¸è¿‡è¿™ä¸ªåå­—å®é™…ä¸Šå·²ç»è¢«åºŸå¼ƒæ‰äº†ï¼Œåªèƒ½åœ¨æ—©æœŸçš„æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚è¿™ä¸ªåå­—èµ·æºäºé¡¹ç›®çš„æ—©æœŸï¼Œå› ä¸ºå¾®è½¯æ ¼å¼ä¸å¼€æ”¾ï¼Œæ‰€ä»¥åªèƒ½å¤Ÿé€šè¿‡åå‘å·¥ç¨‹çŒœæµ‹æ ¼å¼çš„å«ä¹‰ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¿™ä¸ªå¹½é»˜çš„ç§°å‘¼ã€‚åˆ°åæ¥å¾®è½¯å¼€æ”¾äº†OOXMLè§„èŒƒï¼Œå®é™…ä¸Šæ ¼å¼å·²ç»æ˜¯å¼€æºçš„æ ‡å‡†äº†ã€‚å¦ä¸€ä¸ªåºŸå¼ƒçš„åŸå› åˆ™æ˜¯å‡ºäºå¸‚åœºè€ƒè™‘ï¼ˆå•†ä¸šç”¨æˆ·å¯¹è¿™ä¸ªåå­—å¯èƒ½ä¼šå¼•èµ·è¿‡å¤šè”æƒ³è€Œä¸æ•¢é‡‡ç”¨ï¼‰ã€‚
æœ‰å…´è¶£çš„å¯ä»¥åˆ°https://en.wikipedia.org/wiki/Apache_POIä¸Šäº†è§£ä¸€äº›å†å²ã€‚
POIé¡¹ç›®æä¾›äº†å¯¹Wordã€Excelã€PowerPointã€Visioç­‰æ–‡ä»¶çš„è¯»å†™æ”¯æŒã€‚æä¾›äº†å¯¹Office 97åˆ°Office2007çš„æ ¼å¼æ”¯æŒã€‚æ—¢æ”¯æŒOOXMLæ ‡å‡†çš„æ–‡æ¡£ï¼ˆ.docx, .xlsx, .pptxï¼‰ï¼Œä¹Ÿæ”¯æŒæ—§æ ¼å¼ï¼ˆ.doc, .xls, .pptï¼‰ã€‚
1.1 Excelç›¸å…³ POIé¡¹ç›®ä¸­åŒ…å«å¤šä¸ªå­é¡¹ç›®ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒæ ¼å¼æ–‡ä»¶çš„è¯»å†™ï¼Œä¸åŒçš„è¯»å†™æœºåˆ¶ç­‰ç­‰ã€‚ä¸Excelç›¸å…³çš„ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå­é¡¹ç›®ï¼š
HSSF (Horrible SpreadSheet Format) è¯»å†™.xlsæ–‡ä»¶ã€‚å¯ä»¥è¯»å†™Excel 97åŠä¹‹åç‰ˆæœ¬ç”Ÿæˆçš„æ–‡ä»¶ã€‚è¿™ä¸ªæ ¼å¼ä¹Ÿè¢«ç§°ä¸ºâ€œBIFF 8 Formatâ€ã€‚å› ä¸ºè¿™ä¸ªæ ¼å¼æ²¡æœ‰å¼€æºï¼Œå› æ­¤æœ‰äº›ç‰¹æ€§æ²¡æœ‰è¢«æ”¯æŒã€‚ XSSF (XML SpreadSheet Format) è¯»å†™.xlsxæ ¼å¼ã€‚ä¹Ÿå°±æ˜¯Office Open XMLæ ¼å¼ã€‚ SXSSFï¼ˆSmall XSSFï¼‰è¯»å†™.xlsxæ ¼å¼ã€‚3.8-beta3æ–°å¢ï¼ŒåŸºäºXSSFå®ç°çš„ä¸€ä¸ªä½å†…å­˜å ç”¨çš„APIã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºæµçš„APIã€‚é€šè¿‡é™åˆ¶APIèƒ½å¤Ÿè®¿é—®çš„è®°å½•è¡Œæ•°æ¥è¾¾åˆ°å‡å°‘å†…å­˜å ç”¨çš„ç›®çš„ã€‚åœ¨è¿™ç§APIä¸­ï¼Œå¯ä»¥åªæœ‰ä¸€éƒ¨åˆ†è¡Œä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå…¶ä»–çš„åˆ™ä¿å­˜åœ¨ç¡¬ç›˜ç¼“å­˜ä¸­ã€‚æ‰€ä»¥ä¼šæœ‰ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚ï¼šä¸åœ¨å†…å­˜ä¸­çš„è¡Œæ— æ³•è¢«è®¿é—®ï¼›Sheet.clone()ä¸è¢«æ”¯æŒï¼›Formulaè®¡ç®—ä¸è¢«æ”¯æŒç­‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—å‡ºäº†å„ä¸ªAPIçš„ä¸€äº›ç‰¹æ€§ã€‚ HSSFã€XSSFéƒ½æ”¯æŒä¸¤ç§ç¼–ç¨‹æ¨¡å‹ï¼ševentmodelï¼ˆç±»ä¼¼äºXMLè§£æä¸­çš„SAXï¼ŒåŸºäºæµçš„è§£æï¼‰ï¼›usermodelï¼ˆç±»ä¼¼äºXMLè§£æä¸­çš„DOMæ¨¡å‹ï¼‰ã€‚
2. Excelå¯¼å‡º å®é™…é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨äº†SXSSFé¡¹ç›®ï¼ˆä½†æ˜¯ä¾ç„¶ä¼šæº¢å‡ºï¼ŒåŸå› ä¸åœ¨Excelè¿™éƒ¨åˆ†ï¼ŒåŸå› ä¸‹é¢åˆ†æï¼‰ã€‚è¿™é‡Œä¾ç„¶ç®€å•çš„ä»‹ç»ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨SXSSFå¯¼å‡ºä¸€ä¸ªExcelã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š
1// åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶ï¼Œåœ¨å†…å­˜ä¸­ä¿å­˜100æ¡è®°å½•ï¼Œå…¶ä½™çš„ä¼šè¢«flushåˆ°ç¡¬ç›˜ä¸Š 2Workbook workbook = new SXSSFWorkbook(100); 3// åˆ›å»ºä¸€ä¸ªSheet 4Sheet workingSheet = workbook.createSheet(&amp;#34;sheet1&amp;#34;); 5// åˆ›å»ºç¬¬ä¸€è¡Œï¼Œç”¨äºæ˜¾ç¤ºæ¯åˆ—æ ‡é¢˜ 6Row row = workingSheet.createRow(0); 7// åˆ›å»ºå•å…ƒæ ¼æ ·å¼ 8Font fontHeader = workbook.createFont(); 9fontHeader.setFontHeightInPoints((short) 10); 10fontHeader.setColor(IndexedColors.BLACK.getIndex()); 11fontHeader.setBoldweight(Font.BOLDWEIGHT_BOLD); 12CellStyle csHeader = workbook.createCellStyle(); 13csHeader.setFont(fontHeader); 14csHeader.setBorderLeft(CellStyle.BORDER_THIN); 15csHeader.setBorderRight(CellStyle.BORDER_THIN); 16csHeader.setBorderTop(CellStyle.BORDER_THIN); 17csHeader.setBorderBottom(CellStyle.BORDER_THIN); 18csHeader.setAlignment(CellStyle.ALIGN_CENTER); 19 20// æ‰‹åŠ¨è®¾ç½®åˆ—å®½ã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¦ä¸ºç¬¬å‡ åˆ—è®¾ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºåˆ—çš„å®½åº¦ï¼Œnä¸ºåˆ—é«˜çš„åƒç´ æ•°ã€‚ 21workingSheet.setColumnWidth(0, (int)(35.7 * 150)); 22Cell cell = row.createCell(0); 23cell.setCellValue(&amp;#34;Title&amp;#34;); 24cell.setCellStyle(csHeader); ä¸ä½¿ç”¨XSSFçš„æ–¹æ³•ç›¸æ¯”ï¼Œå”¯ä¸€æ”¹å˜çš„å°±æ˜¯åˆ›å»ºExcelå¯¹è±¡çš„åœ°æ–¹ï¼šWorkbook workbook = new SXSSFWorkbook(100);ï¼ŒSXSSFéœ€è¦æŒ‡å®šå†…å­˜ä¸­å¯ç”¨çš„è®°å½•æ•°ï¼Œä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­æŒ‡å®šäº†100æ¡è®°å½•ã€‚è¶…å‡º100æ¡çš„è®°å½•å°†è¢«å†™å…¥ç£ç›˜ï¼Œä¸èƒ½å¤Ÿç›´æ¥è®¿é—®ã€‚ä½†æ˜¯å¯¹äºå¯¼å‡ºExcelè¿™ç§åœºæ™¯æ¥è¯´ï¼Œä¸ä¼šæœ‰éšæœºè®¿é—®æ•°æ®çš„è¦æ±‚ï¼Œè¿™æ ·çš„æ–¹å¼æ˜¯æ²¡æœ‰å½±å“çš„ã€‚
3. ä½¿ç”¨æ•°æ®åº“æ¸¸æ ‡ å› ä¸ºä»¥å‰å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†SXSSFé¡¹ç›®ï¼Œå› æ­¤å†…å­˜æº¢å‡ºé—®é¢˜åº”è¯¥ä¸æ˜¯POIé¡¹ç›®å¸¦æ¥çš„ã€‚ç»è¿‡è°ƒæŸ¥ï¼Œå‘ç°è¿™æ˜¯æ•°æ®åº“æ–¹é¢çš„åŸå› ï¼š
å¦‚æœä¸é€‚ç”¨æ¸¸æ ‡ï¼ŒMySQLé»˜è®¤ä¼šå°†ç»“æœé›†æ•´ä¸ªéƒ½ç¼“å­˜çš„å®¢æˆ·ç«¯ï¼Œå¯¹äºå‡ åä¸‡ä¸Šç™¾ä¸‡æ¡è®°å½•ï¼Œè¿™ä¸ªå†…å­˜å ç”¨æ˜¯å·¨å¤§çš„ï¼› MyBatisè¿”å›ç»“æœé›†çš„æ—¶å€™æ˜¯å°†JDBCçš„ResultSetè½¬æ¢æˆå…·ä½“å¯¹è±¡çš„Listï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šå°†æ‰€æœ‰çš„æ•°æ®åº“è®°å½•è½¬æ¢æˆJavaå¯¹è±¡ï¼Œæ›´åŠ å®¹æ˜“å¸¦æ¥å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚ åœ¨ç»“æœé›†æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå°†ç»“æœé›†æ•´ä½“è¿”å›ï¼Œä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚ä½†æ˜¯å½“ç»“æœé›†å˜å¤§çš„æ—¶å€™ï¼Œå†…å­˜å ç”¨å’Œæ€§èƒ½ä¸Šéƒ½ä¼šç¢°åˆ°æå¤§çš„é—®é¢˜ã€‚ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ï¼Œéƒ½éœ€è¦å¯ç”¨æ¸¸æ ‡æ¥è§£å†³ã€‚
3.1 æ•°æ®åº“æ¸¸æ ‡ åœ¨æ•°æ®åº“ä¸­ï¼Œæ¸¸æ ‡æ˜¯ä¸€ä¸ªååˆ†é‡è¦çš„æ¦‚å¿µã€‚æ¸¸æ ‡æä¾›äº†ä¸€ç§å¯¹ä»è¡¨ä¸­æ£€ç´¢å‡ºçš„æ•°æ®è¿›è¡Œæ“ä½œçš„çµæ´»æ‰‹æ®µï¼Œå°±æœ¬è´¨è€Œè¨€ï¼Œæ¸¸æ ‡å®é™…ä¸Šæ˜¯ä¸€ç§èƒ½ä»åŒ…æ‹¬å¤šæ¡æ•°æ®è®°å½•çš„ç»“æœé›†ä¸­æ¯æ¬¡æå–ä¸€æ¡è®°å½•çš„æœºåˆ¶ã€‚æ¸¸æ ‡æ€»æ˜¯ä¸ä¸€æ¡SQLé€‰æ‹©è¯­å¥ç›¸å…³è”ã€‚å› ä¸ºæ¸¸æ ‡ç”±ç»“æœé›†ï¼ˆå¯ä»¥æ˜¯é›¶æ¡ã€ä¸€æ¡æˆ–ç”±ç›¸å…³çš„é€‰æ‹©è¯­å¥æ£€ç´¢å‡ºçš„å¤šæ¡è®°å½•ï¼‰å’Œç»“æœé›†ä¸­æŒ‡å‘ç‰¹å®šè®°å½•çš„æ¸¸æ ‡ä½ç½®ç»„æˆã€‚å½“å†³å®šå¯¹ç»“æœé›†è¿›è¡Œå¤„ç†æ—¶ï¼Œå¿…é¡»å£°æ˜ä¸€ä¸ªæŒ‡å‘è¯¥ç»“æœé›†çš„æ¸¸æ ‡ã€‚
é€šè¿‡MyBatisä½¿ç”¨æ¸¸æ ‡ï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼šSpringBatché¡¹ç›®å¸¦æ¥çš„MyBatisCursorItemReaderï¼›MyBatisæœ¬èº«çš„SqlSession.selectCursoræ–¹æ³•ï¼›ä»¥åŠMyBatisæä¾›çš„ResultHandleræ¥å£ã€‚è¿™å‡ ç§æ–¹æ³•çš„ä¸åŒä¸‹ä¸€ç¯‡åšæ–‡ä¼šæ¶‰åŠåˆ°ã€‚è¿™é‡Œåªè¯´ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Spring Batchæä¾›çš„MyBatisCursorItemReaderã€‚
MyBatisCursorItemReaderæ˜¯Spring Batché¡¹ç›®æä¾›çš„ä¸€ä¸ªBeanï¼Œæä¾›äº†ä½¿ç”¨æ¸¸æ ‡ä»æ•°æ®åº“è¯»å–æ•°æ®çš„åŠŸèƒ½ã€‚éœ€è¦MyBatis 3.4.0æˆ–æ›´æ–°ç‰ˆæœ¬çš„æ”¯æŒã€‚å…¶æœ¬è´¨è¿˜æ˜¯å¯¹SqlSession.selectCursorçš„ä¸€ä¸ªç®€å•å°è£…ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹æºç ã€‚
3.2 å¼•å…¥æ”¯æŒåŒ… 1&amp;lt;dependency&amp;gt; 2 &amp;lt;groupId&amp;gt;org.apache.poi&amp;lt;/groupId&amp;gt; 3 &amp;lt;artifactId&amp;gt;poi-ooxml&amp;lt;/artifactId&amp;gt; 4 &amp;lt;version&amp;gt;3.9&amp;lt;/version&amp;gt; 5&amp;lt;/dependency&amp;gt; 6&amp;lt;!-- MyBatis --&amp;gt; 7&amp;lt;dependency&amp;gt; 8 &amp;lt;groupId&amp;gt;org.mybatis.spring.boot&amp;lt;/groupId&amp;gt; 9 &amp;lt;artifactId&amp;gt;mybatis-spring-boot-starter&amp;lt;/artifactId&amp;gt; 10 &amp;lt;version&amp;gt;1.3.1&amp;lt;/version&amp;gt; 11&amp;lt;/dependency&amp;gt; 12&amp;lt;!-- Spring Batch --&amp;gt; 13&amp;lt;dependency&amp;gt; 14 &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; 15 &amp;lt;artifactId&amp;gt;spring-boot-starter-batch&amp;lt;/artifactId&amp;gt; 16 &amp;lt;version&amp;gt;${springboot.version}&amp;lt;/version&amp;gt; 17&amp;lt;/dependency&amp;gt; 3.3 FetchSize å¦ä¸€ä¸ªè¦æ”¹çš„åœ°æ–¹æ˜¯MyBatisçš„Mapperæ–‡ä»¶ï¼š
1 &amp;lt;select id=&amp;#34;exportByExample&amp;#34; fetchSize=&amp;#34;-2147483648&amp;#34; parameterType=&amp;#34;com.eveus.admin.po.logs.BankcardAuthNoOTPLogPOExample&amp;#34; resultSetType=&amp;#34;FORWARD_ONLY&amp;#34; resultMap=&amp;#34;BaseResultMap&amp;#34;&amp;gt; 2 select 3 &amp;lt;include refid=&amp;#34;Export_Column_List&amp;#34; /&amp;gt; 4 from UID_BANKCARD_AUTH_NO_OTP_LOG 5 &amp;lt;if test=&amp;#34;_parameter != null&amp;#34;&amp;gt; 6 &amp;lt;include refid=&amp;#34;Example_Where_Clause&amp;#34; /&amp;gt; 7 &amp;lt;/if&amp;gt; 8 &amp;lt;if test=&amp;#34;orderByClause != null&amp;#34;&amp;gt; 9 order by ${orderByClause} 10 &amp;lt;/if&amp;gt; 11 &amp;lt;/select&amp;gt; æ³¨æ„å…¶ä¸­çš„fetchSizeæ˜¯æ–°å¢çš„ï¼Œå…¶å€¼å¿…é¡»ä¸º-2147483648ï¼ˆè‡³äºä¸ºä»€ä¹ˆï¼Œå°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ï¼‰ã€‚å¦å¤–ï¼Œè¿˜æ–°å¢äº†é…ç½®é¡¹resultSetTypeï¼Œå…¶å€¼ä¸ºï¼šFORWARD_ONLYã€‚
3.4 å¯¼å‡ºè¿‡ç¨‹æ”¹é€  1// ä½¿ç”¨æ¸¸æ ‡è·å–æ•°æ®ï¼ˆé¿å…ç»“æœé›†å¤ªå¤§å¼•èµ·çš„OOMé”™è¯¯ï¼‰ 2MyBatisCursorItemReader&amp;lt;MatchCompanyLogPO&amp;gt; reader = new MyBatisCursorItemReader&amp;lt;&amp;gt;(); 3reader.setSqlSessionFactory(sqlSessionFactory); 4reader.setQueryId(&amp;#34;com.eveus.admin.mapper.logs.MatchCompanyLogPOCustMapper.exportByExample&amp;#34;); 5Map&amp;lt;String, Object&amp;gt; readerParams = new HashMap&amp;lt;String, Object&amp;gt;(); 6readerParams.put(&amp;#34;oredCriteria&amp;#34;, example.getOredCriteria()); 7// è®¾ç½®å‚æ•° 8reader.setParameterValues(readerParams); 9try { 10 reader.open(new ExecutionContext()); // æ‰“å¼€æ¸¸æ ‡ 11 MatchCompanyLogPO logPO; 12 while (( logPO = reader.read()) != null) { 13 // å†™å…¥Excelæ–‡ä»¶ 14 ... 15 } 16 logger.info(&amp;#34;exportMatchCompanyï¼šæ–‡ä»¶å{}ï¼Œå…±{}æ¡&amp;#34;, fileName, exporter.getNumberOfRows()); 17 logger.info(&amp;#34;exportMatchCompany: Open Cursor: {}, Read all records: {}&amp;#34;, d2.getTime()-d1.getTime(), d3.getTime()-d2.getTime()); 18 ResponseWriteUtil.writeFileStream(exporter.getWorkbook(), fileName, response); 19} catch (Exception e) { 20 logger.error(&amp;#34;exportMatchCompany exception! &amp;#34;, e); 21} 4. è¡¥å…… æ”¹é€ çš„ä»£ç ä¸å¤šï¼Œä½†æ˜¯æ•´ä¸ªæ¢ç´¢çš„æ—¶é—´ç¡®å®ä¸å°‘ã€‚è¿™å¯èƒ½å°±æ˜¯é‡æ„çš„é­…åŠ›å§ã€‚
å¦å¤–ï¼Œåœ¨å¯¼å‡ºè¿‡ç¨‹ä¸­è¿˜å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…ï¼šæœ€å¼€å§‹å¯¼å‡ºExcelçš„æ—¶å€™ï¼Œå‘ç°æœ€å¤šåªèƒ½å¯¼å‡º1048576æ¡è®°å½•ã€‚æœ€åˆç”šè‡³æ€€ç–‘æ˜¯ä¸æ˜¯æ•°æ®åº“æ–¹é¢æœ‰ä»€ä¹ˆé™åˆ¶ã€‚åˆ°æœ€åæ‰å‘ç°åŸæ¥æ˜¯Excelæœ¬èº«çš„é™åˆ¶ï¼šExcelä¸­ä¸€ä¸ªSheetæœ€å¤šæ”¯æŒ1048576æ¡è®°å½•ï¼Œè¡Œå·èŒƒå›´ä¸º0-1048575ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ Invalid row number (-32768) outside allowable range (0..1048575) POIæ“ä½œExcelæ—¶æœ€å¤§è¡Œã€åˆ—æ•°çš„é—®é¢˜åŠå†™å¤§é‡æ•°æ®æ—¶Java heap spaceå†…å­˜æº¢å‡ºè§£å†³ Mapper XML Files Mybatis 3.4.0 Cursorçš„ä½¿ç”¨ ä½¿ç”¨MySQL Server Side Cursorè§£å†³æŸ¥è¯¢æ•°æ®é‡è¿‡å¤§é€ æˆOOM JDBC API Implementation Notes MyBatisä¸­ä½¿ç”¨æµå¼æŸ¥è¯¢é¿å…æ•°æ®é‡è¿‡å¤§å¯¼è‡´OOM Mysqlä¸­ä½¿ç”¨æµå¼æŸ¥è¯¢é¿å…æ•°æ®é‡è¿‡å¤§å¯¼è‡´OOM-åç»­ Mybatis 3.4.0 Cursorçš„ä½¿ç”¨ </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 05 - äº‹åŠ¡ç®¡ç†</title>
        <url>https://orchidflower.github.io/2018/06/01/migrating-to-spring-boot-05-transaction-management/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> Springé¡¹ç›®ä¸­ä½¿ç”¨æ•°æ®åº“çš„æ–¹å¼å¤šç§å¤šæ ·ï¼Œæ³¨å…¥MyBatisã€JDBCã€Hibernateç­‰ç­‰éƒ½æ˜¯æ”¯æŒçš„ã€‚ä¹‹å‰çš„ç³»ç»Ÿæ˜¯åŸºäºMyBatisçš„ã€‚
å…³äºå¦‚ä½•Spring Bootå’ŒMyBatisç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ï¼Œå¯ä»¥å‚è€ƒã€‚æœ‰æ—¶é—´æˆ‘ä¹Ÿä¼šä¸“é—¨å†™ä¸€ç¯‡ä»‹ç»é›†æˆçš„è¿‡ç¨‹ã€‚æœ¬æ–‡è®²çš„å°±æ˜¯MyBatisç§»æ¤åˆ°Spring Bootæ–¹é¢ç¢°åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯äº‹åŠ¡æ§åˆ¶æ–¹é¢çš„ã€‚
1. SpringåŸå§‹é…ç½® åœ¨Springä¸­ï¼Œä¹‹å‰æ˜¯é€šè¿‡XMLæ–¹å¼è¿›è¡Œçš„äº‹åŠ¡é…ç½®ã€‚é€šè¿‡tx:adviceå®šä¹‰äº†äº‹åŠ¡çš„å±æ€§ï¼›ç„¶åé€šè¿‡aop:configå°†äº‹åŠ¡ç»‡å…¥ä¸šåŠ¡ä»£ç ã€‚
1&amp;lt;!-- from the file &amp;#39;context.xml&amp;#39; --&amp;gt; 2&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt; 3&amp;lt;beans xmlns=&amp;#34;http://www.springframework.org/schema/beans&amp;#34; 4 xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34; 5 xmlns:aop=&amp;#34;http://www.springframework.org/schema/aop&amp;#34; 6 xmlns:tx=&amp;#34;http://www.springframework.org/schema/tx&amp;#34; 7 xsi:schemaLocation=&amp;#34; 8 http://www.springframework.org/schema/beans 9 http://www.springframework.org/schema/beans/spring-beans.xsd 10 http://www.springframework.org/schema/tx 11 http://www.springframework.org/schema/tx/spring-tx.xsd 12 http://www.springframework.org/schema/aop 13 http://www.springframework.org/schema/aop/spring-aop.xsd&amp;#34;&amp;gt; 14 15 &amp;lt;!-- this is the service object that we want to make transactional --&amp;gt; 16 &amp;lt;bean id=&amp;#34;fooService&amp;#34; class=&amp;#34;x.y.service.DefaultFooService&amp;#34;/&amp;gt; 17 18 &amp;lt;!-- the transactional advice (what &amp;#39;happens&amp;#39;; see the &amp;lt;aop:advisor/&amp;gt; bean below) --&amp;gt; 19 &amp;lt;tx:advice id=&amp;#34;txAdvice&amp;#34; transaction-manager=&amp;#34;txManager&amp;#34;&amp;gt; 20 &amp;lt;!-- the transactional semantics... --&amp;gt; 21 &amp;lt;tx:attributes&amp;gt; 22 &amp;lt;!-- all methods starting with &amp;#39;get&amp;#39; are read-only --&amp;gt; 23 &amp;lt;tx:method name=&amp;#34;get*&amp;#34; read-only=&amp;#34;true&amp;#34;/&amp;gt; 24 &amp;lt;!-- other methods use the default transaction settings (see below) --&amp;gt; 25 &amp;lt;tx:method name=&amp;#34;*&amp;#34;/&amp;gt; 26 &amp;lt;/tx:attributes&amp;gt; 27 &amp;lt;/tx:advice&amp;gt; 28 29 &amp;lt;!-- ensure that the above transactional advice runs for any execution 30 of an operation defined by the FooService interface --&amp;gt; 31 &amp;lt;aop:config&amp;gt; 32 &amp;lt;aop:pointcut id=&amp;#34;fooServiceOperation&amp;#34; expression=&amp;#34;execution(* x.y.service.FooService.*(..))&amp;#34;/&amp;gt; 33 &amp;lt;aop:advisor advice-ref=&amp;#34;txAdvice&amp;#34; pointcut-ref=&amp;#34;fooServiceOperation&amp;#34;/&amp;gt; 34 &amp;lt;/aop:config&amp;gt; 35 36 &amp;lt;!-- don&amp;#39;t forget the DataSource --&amp;gt; 37 &amp;lt;bean id=&amp;#34;dataSource&amp;#34; class=&amp;#34;org.apache.commons.dbcp.BasicDataSource&amp;#34; destroy-method=&amp;#34;close&amp;#34;&amp;gt; 38 &amp;lt;property name=&amp;#34;driverClassName&amp;#34; value=&amp;#34;oracle.jdbc.driver.OracleDriver&amp;#34;/&amp;gt; 39 &amp;lt;property name=&amp;#34;url&amp;#34; value=&amp;#34;jdbc:oracle:thin:@rj-t42:1521:elvis&amp;#34;/&amp;gt; 40 &amp;lt;property name=&amp;#34;username&amp;#34; value=&amp;#34;scott&amp;#34;/&amp;gt; 41 &amp;lt;property name=&amp;#34;password&amp;#34; value=&amp;#34;tiger&amp;#34;/&amp;gt; 42 &amp;lt;/bean&amp;gt; 43 44 &amp;lt;!-- similarly, don&amp;#39;t forget the PlatformTransactionManager --&amp;gt; 45 &amp;lt;bean id=&amp;#34;txManager&amp;#34; class=&amp;#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&amp;#34;&amp;gt; 46 &amp;lt;property name=&amp;#34;dataSource&amp;#34; ref=&amp;#34;dataSource&amp;#34;/&amp;gt; 47 &amp;lt;/bean&amp;gt; 48 49 &amp;lt;!-- other &amp;lt;bean/&amp;gt; definitions here --&amp;gt; 50 51&amp;lt;/beans&amp;gt; 2. è¿ç§»åˆ°SpringBoot è¿ç§»åˆ°SpringBootè¿˜æ˜¯å€¾å‘äºä½¿ç”¨åŸºäºJavaçš„é…ç½®ï¼Œå› æ­¤æœ€åˆçš„æƒ³æ³•æ˜¯å®Œå…¨è·‘èµ·xmlé…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨å®è·µä¸­å‘ç°äº†ä¸€äº›é™åˆ¶ï¼š&amp;lt;aop:config&amp;gt;æ ‡ç­¾æ— æ³•å®Œæ•´å‡†ç¡®çš„ç¿»è¯‘æˆJavaé…ç½®ã€‚
2.1 é™åˆ¶ é€šè¿‡ä¸Šç½‘æœç´¢ï¼Œå‘ç°è§£å†³æ–¹æ¡ˆå¹¶ä¸å®Œç¾ï¼š
The @Aspect model in AspectJ is designed for pure-Java configuration, and should be used in favor of aop:config when looking to create 100% java-based configuration using Spring&amp;rsquo;s @Configuration model. aop:config cannot properly be translated into the @Configuration model, largely because Java does not support method literals in the language. This leaves us resorting to String-based references to methods, which is not ideal. So the approach that users should consider are:
Continue using aop:config by including the relevant XML snippet using @ImportResource Convert any existing aop:config elmements to use @Aspect style. ä¸Šé¢æ¨èçš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š
ç»§ç»­ä½¿ç”¨xmlé…ç½®ï¼Œç„¶åé€šè¿‡ @ImportResourceæ³¨è§£å¯¼å…¥Javaä»£ç ä¸­ï¼› è½¬æ¢&amp;lt;aop:config&amp;gt;é…ç½®æˆ@Aspectæ³¨è§£ã€‚ 2.2 æœ€ç»ˆæ–¹æ¡ˆ å› ä¸ºæ—¶é—´çš„åŸå› ï¼Œå¯¹@Aspectå½¢å¼çš„é…ç½®æ²¡æœ‰åšæ·±å…¥ç ”ç©¶ã€‚å¦å¤–ä»StackOverflowä¸ŠæŸ¥åˆ°çš„è¯´æ³•æ˜¯ï¼Œtx-adviceå¹¶æ²¡æœ‰åˆé€‚çš„Javaé…ç½®æ–¹æ³•ï¼Œä½¿ç”¨xmlé…ç½®è¿˜æ˜¯æœ€æ–¹ä¾¿çš„ã€‚åªæ˜¯xmlé…ç½®é€šè¿‡@Configurationä¸­çš„@ImportResourceæ³¨è§£å¼•å…¥å³å¯ï¼Œè¿™æ ·è¿˜æ˜¯æ¯”è¾ƒä¼˜é›…ï¼Œæ¯”è¾ƒç¬¦åˆJavaé…ç½®çš„è§„èŒƒæ€§çš„ã€‚å› æ­¤æœ€ç»ˆæ–¹æ¡ˆæ˜¯ä½¿ç”¨äº†éƒ¨åˆ†xmlé…ç½®ï¼Œé€šè¿‡@ImportResourceå¼•å…¥ã€‚
2.2.1 MasterDataSourceConfig 1@Configuration 2public class MasterDataSourceConfig { 3 static final String PACKAGE = &amp;#34;com.eveus.iot.shadow.mapper&amp;#34;; 4 static final String MAPPER_LOCATION = &amp;#34;classpath:mybatis/mapper/**/*.xml&amp;#34;; 5 6 @Bean 7 @Primary 8 @ConfigurationProperties(&amp;#34;spring.datasource&amp;#34;) 9 public DataSourceProperties firstDataSourceProperties() { 10 return new DataSourceProperties(); 11 } 12 13 @Bean(name = &amp;#34;masterDataSource&amp;#34;) 14 @Primary 15 @ConfigurationProperties(prefix = &amp;#34;spring.datasource&amp;#34;) 16 public DataSource dataSource() { 17 return firstDataSourceProperties().initializeDataSourceBuilder().build(); 18 } 19 20 @Bean(name = &amp;#34;masterTransactionManager&amp;#34;) 21 public DataSourceTransactionManager transactionManager() { 22 return new DataSourceTransactionManager(dataSource()); 23 } 24 25 26 @Bean(name = &amp;#34;masterSqlSessionFactory&amp;#34;) 27 public SqlSessionFactory sqlSessionFactory(@Qualifier(&amp;#34;masterDataSource&amp;#34;) DataSource masterDataSource) 28 throws Exception { 29 final SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean(); 30 sessionFactory.setDataSource(masterDataSource); 31 sessionFactory.setMapperLocations(new PathMatchingResourcePatternResolver() 32 .getResources(MasterDataSourceConfig.MAPPER_LOCATION)); 33 return sessionFactory.getObject(); 34 } 35} å®šä¹‰dataSource, transactionManagerã€‚
2.2.2 TransactionConfig 1... 2@Configuration 3@Aspect 4@ComponentScan(&amp;#34;com.eveus.cloudauth&amp;#34;) 5@ImportResource(&amp;#34;classpath:/spring/uid-tx.xml&amp;#34;) 6public class TransactionConfig { 7} å¼•å…¥xmlé…ç½®ã€‚
2.2.3 uid-tx.xml 1&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt; 2&amp;lt;beans xmlns=&amp;#34;http://www.springframework.org/schema/beans&amp;#34; 3 xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34; 4 xmlns:aop=&amp;#34;http://www.springframework.org/schema/aop&amp;#34; 5 xmlns:tx=&amp;#34;http://www.springframework.org/schema/tx&amp;#34; 6 xsi:schemaLocation=&amp;#34;http://www.springframework.org/schema/beans 7 http://www.springframework.org/schema/beans/spring-beans.xsd 8 9 http://www.springframework.org/schema/aop 10 http://www.springframework.org/schema/aop/spring-aop.xsd 11 http://www.springframework.org/schema/tx 12 http://www.springframework.org/schema/tx/spring-tx.xsd&amp;#34;&amp;gt; 13 14 &amp;lt;!-- AOP --&amp;gt; 15 &amp;lt;tx:advice id=&amp;#34;merchantTransactionAdvice&amp;#34; transaction-manager=&amp;#34;masterTransactionManager&amp;#34;&amp;gt; 16 &amp;lt;tx:attributes&amp;gt; 17 &amp;lt;tx:method name=&amp;#34;insert*&amp;#34; propagation=&amp;#34;REQUIRED&amp;#34; /&amp;gt; 18 &amp;lt;tx:method name=&amp;#34;update*&amp;#34; propagation=&amp;#34;REQUIRED&amp;#34; /&amp;gt; 19 &amp;lt;tx:method name=&amp;#34;delete*&amp;#34; propagation=&amp;#34;REQUIRED&amp;#34; /&amp;gt; 20 &amp;lt;tx:method name=&amp;#34;lock*&amp;#34; propagation=&amp;#34;REQUIRED&amp;#34; /&amp;gt; 21 &amp;lt;tx:method name=&amp;#34;unlock*&amp;#34; propagation=&amp;#34;REQUIRED&amp;#34; /&amp;gt; 22 23 &amp;lt;tx:method name=&amp;#34;select*&amp;#34; propagation=&amp;#34;SUPPORTS&amp;#34; /&amp;gt; 24 &amp;lt;tx:method name=&amp;#34;list*&amp;#34; propagation=&amp;#34;SUPPORTS&amp;#34; /&amp;gt; 25 26 &amp;lt;tx:method name=&amp;#34;*&amp;#34; propagation=&amp;#34;SUPPORTS&amp;#34; /&amp;gt; 27 &amp;lt;/tx:attributes&amp;gt; 28 &amp;lt;/tx:advice&amp;gt; 29 &amp;lt;aop:config&amp;gt; 30 &amp;lt;aop:pointcut id=&amp;#34;merchantTransactionPointcut&amp;#34; expression=&amp;#34;execution(* com.eveus.cloudauth.dal.mybatis.MerchantDalImpl.*(..))&amp;#34; /&amp;gt; 31 &amp;lt;aop:advisor pointcut-ref=&amp;#34;merchantTransactionPointcut&amp;#34; advice-ref=&amp;#34;merchantTransactionAdvice&amp;#34; /&amp;gt; 32 &amp;lt;/aop:config&amp;gt; 33	... 34&amp;lt;/beans&amp;gt; å¦‚ä¸Šé…ç½®ä¸­ï¼štransactionManageræ˜¯åœ¨Javaé…ç½®ä¸­å®šä¹‰çš„ã€‚å…¶ä»–çš„å’ŒåŸå…ˆçš„xmlé…ç½®æ²¡æœ‰åŒºåˆ«ã€‚
é™„å½•A. å‚è€ƒèµ„æ–™ Introduce @Configuration-based equivalent to aop:config XML element JavaConfig: Replacing aop:advisor and tx:advice Aspect Oriented Programming with Spring Springäº‹åŠ¡ç®¡ç†ï¼ˆè¯¦è§£&#43;å®ä¾‹ï¼‰ Spring Declarative Transaction Management Example Spring AOP : Replace XML with annotations for transaction management? é›¶xmlé…ç½®Springäº‹åŠ¡ç®¡ç† </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 04 - Redis</title>
        <url>https://orchidflower.github.io/2018/05/24/migrating-to-spring-boot-04-Redis/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> ç›¸æ¯”äºSpringæ¥è¯´ï¼Œåœ¨SpringBootä¸­ä½¿ç”¨Rediså¤§å¹…ç®€åŒ–äº†ã€‚é€šè¿‡ä½¿ç”¨spring-boot-starter-data-redisï¼Œä½¿ç”¨Rediså˜å¾—éå¸¸ç®€å•ã€‚
åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š
æ·»åŠ ä¾èµ– 1&amp;lt;dependency&amp;gt; 2 &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; 3 &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt; 4&amp;lt;/dependency&amp;gt; é…ç½®application.properties/yaml 1spring: 2 redis: 3 host: 192.168.2.230 4 port: 6379 5 password: xxxxxx 6 database: 1 7 timeout: 3000ms æ³¨å…¥RedisTemplateä½¿ç”¨ 1 @Autowired 2 StringRedisTemplate stringRedisTemplate; å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚
1. Redisè‡ªåŠ¨æ³¨å†Œ åˆšå¼€å§‹ä½¿ç”¨spring-boot-starter-data-redisçš„æ—¶å€™å¾ˆå¥‡æ€ªåœ¨propertySourceä¸­çš„é…ç½®å‚æ•°(spring.redis.*ï¼‰æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„ï¼Ÿ
æœ€åˆæ€€ç–‘æ˜¯åœ¨åŒ…spring-boot-starter-data-redisä¸­ï¼Œä½†æ˜¯æŸ¥çœ‹æºç å‘ç°è¿™ä¸ªåŒ…æ²¡æœ‰ä»»ä½•æºç ï¼Œåªæ˜¯ä¸€ä¸ªpomæ–‡ä»¶ï¼Œæä¾›äº†å¯¹ï¼šspring-data-redisã€jedisçš„ä¾èµ–ã€‚
åæ¥æœ‰æ€€ç–‘æ˜¯ä¸æ˜¯åœ¨spring-data-redisåŒ…ä¸­ã€‚ä¸ŠGithubä¸­çœ‹æºç ä¹Ÿæ²¡æœ‰ã€‚
æœ€åæ‰å‘ç°åŸæ¥æ˜¯åœ¨Spring-bootä¸­çš„spring-boot-autoconfigureè¿™ä¸ªåŒ…é‡Œé¢çš„RedisAutoConfigurationè¿™ä¸ªç±»ä¸­ã€‚
1@Configuration 2@ConditionalOnClass({ JedisConnection.class, RedisOperations.class, Jedis.class }) 3@EnableConfigurationProperties(RedisProperties.class) 4public class RedisAutoConfiguration { 5	/** 6	* Redis connection configuration. 7	*/ 8	@Configuration 9	@ConditionalOnClass(GenericObjectPool.class) 10	protected static class RedisConnectionConfiguration {	private final RedisProperties properties; 11	public RedisConnectionConfiguration(RedisProperties properties, 12	ObjectProvider&amp;lt;RedisSentinelConfiguration&amp;gt; sentinelConfiguration, 13	ObjectProvider&amp;lt;RedisClusterConfiguration&amp;gt; clusterConfiguration) { 14	this.properties = properties; 15	this.sentinelConfiguration = sentinelConfiguration.getIfAvailable(); 16	this.clusterConfiguration = clusterConfiguration.getIfAvailable(); 17	} 18	19	@Bean 20	@ConditionalOnMissingBean(RedisConnectionFactory.class) 21	public JedisConnectionFactory redisConnectionFactory() 22	throws UnknownHostException { 23	return applyProperties(createJedisConnectionFactory()); 24	} 25	26	// æ ¹æ®å‚æ•°æƒ…å†µå†³å®šåˆ›å»ºé‚£ç§ç±»å‹çš„Factoryï¼šå¯ä»¥æ˜¯Clusterã€Sentinelæˆ–è€…æ™®é€šæ¨¡å¼ã€‚ 27	private JedisConnectionFactory createJedisConnectionFactory() { 28	JedisPoolConfig poolConfig = this.properties.getPool() != null 29	? jedisPoolConfig() : new JedisPoolConfig(); 30 31	if (getSentinelConfig() != null) { 32	return new JedisConnectionFactory(getSentinelConfig(), poolConfig); 33	} 34	if (getClusterConfiguration() != null) { 35	return new JedisConnectionFactory(getClusterConfiguration(), poolConfig); 36	} 37	return new JedisConnectionFactory(poolConfig); 38	} 39 ... 40 } 41 .... 42} å¯ä»¥çœ‹åˆ°åœ¨AutoConfigurationä¸­å¤§é‡ä½¿ç”¨äº†Conditionç±»å‹çš„æ³¨è§£ã€‚spring-bootä¼šæ ¹æ®å½“å‰ç±»è·¯å¾„ä¸Šå­˜åœ¨çš„ç±»æƒ…å†µä»¥åŠBeanæ˜¯å¦å·²ç»åˆ›å»ºçš„æƒ…å†µå†³å®šæ˜¯å¦è¦åˆ›å»ºBeanã€‚
ä¸Šé¢åªæ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œå±•ç¤ºäº†æ€ä¹ˆæ ¹æ®é…ç½®åˆ›å»ºRedisConnectionFactoryå¯¹è±¡ã€‚
çœŸæ­£ä¸PropertySourceæœ‰å…³çš„ä»£ç åœ¨RedisPropertiesè¿™ä¸ªç±»ä¸­ï¼š
1/** 2 * Configuration properties for Redis. 3 * 4 * @author Dave Syer 5 * @author Christoph Strobl 6 * @author EddÃº MelÃ©ndez 7 * @author Marco Aust 8 */ 9@ConfigurationProperties(prefix = &amp;#34;spring.redis&amp;#34;) 10public class RedisProperties { 11	private int database = 0; 12	private String url; 13	.... çœ‹ä»£ç ï¼Œé€šè¿‡@ConfigurationPropertiesè¿™ä¸ªæ³¨è§£æŒ‡å®šäº†prefixï¼Œä»è€Œå¯ä»¥ä».propertiesæˆ–.yamlç±»å‹çš„é…ç½®æ–‡ä»¶ç›´æ¥è¯»å–redisç›¸å…³çš„é…ç½®å‚æ•°ã€‚
2. è‡ªå®šä¹‰Bean åœ¨RedisAutoConfigurationä¸­ä¼šè‡ªåŠ¨æ ¹æ®å‚æ•°é…ç½®æƒ…å†µå†³å®šåˆ›å»ºé‚£ç§redisçš„é“¾æ¥æ± ã€‚è¿™ä¸€ç‚¹éå¸¸æ–¹ä¾¿ã€‚å¯ä»¥ç›´æ¥åœ¨å…¶ä»–ç±»ä¸­ä½¿ç”¨@Autowiredæ³¨å…¥ï¼šJedisConnectionFactoryç±»å‹çš„å˜é‡ã€‚å¦å¤–ï¼Œè¯¥ç±»è¿˜ä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªBeanï¼š
RedisTemplate&amp;lt;Object, Object&amp;gt; StringRedisTemplate ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹è¿™ä¸¤ä¸ªBeanä¸ä¸€å®šèƒ½å¤Ÿæ»¡è¶³è¦æ±‚ï¼ˆä¾‹å¦‚å…¶åºåˆ—åŒ–æ”¯æŒæ–¹å¼å¯èƒ½ä¸æ»¡è¶³è¦æ±‚ï¼‰ï¼Œè¿™æ—¶å¯ä»¥æ‰‹åŠ¨åˆ›å»ºè€…ç±»Beanã€‚åƒè¿™æ ·ï¼š 1@Configuration 2public class RedisConfig { 3 4 @SuppressWarnings(&amp;#34;SpringJavaInjectionPointsAutowiringInspection&amp;#34;) 5 @Autowired 6 RedisConnectionFactory redisConnectionFactory; 7 8 @Bean(name=&amp;#34;redisSerializer&amp;#34;) 9 public StringRedisSerializer redisSerializer() { 10 return new StringRedisSerializer(); 11 } 12 13 @Bean(name=&amp;#34;redisTemplate&amp;#34;) 14 public RedisTemplate&amp;lt;String, String&amp;gt; redisTemplate() { 15 RedisTemplate&amp;lt;String, String&amp;gt; redisTemplate = new RedisTemplate&amp;lt;String, String&amp;gt;(); 16 redisTemplate.setConnectionFactory(redisConnectionFactory); 17 redisTemplate.setDefaultSerializer(redisSerializer()); 18 return redisTemplate; 19 } 20} ä½ å¯ä»¥è‡ªå·±å®šä¹‰Serializerï¼Œè¾¾åˆ°å®Œå…¨çš„æ§åˆ¶ã€‚ä¸Šé¢åªæ˜¯ä¸ªä¾‹å­ï¼Œå®é™…è°ƒç”¨çš„è¿˜æ˜¯spring-data-redisä¸­çš„StringRedisSerializerã€‚
3. å…³é—­è‡ªåŠ¨æ³¨å†Œ å½“ç„¶ï¼Œå¦‚æœä¸éœ€è¦Spring Bootè‡ªåŠ¨æ³¨å†Œè¿™äº›Beanï¼Œå¯ä»¥ç¦ç”¨Redisçš„AutoConfigurationã€‚æ¯”è¾ƒå¸¸è§çš„æ–¹å¼æ˜¯é€šè¿‡@EnableAutoConfigurationæ³¨è§£ä¸­çš„excludeå‚æ•°æ¥è§£å†³ï¼Œä¾‹å¦‚ï¼š
1@EnableAutoConfiguration(exclude = {RedisAutoConfiguration.class}) æ›´å¤šæ–¹æ³•å¯ä»¥å‚è€ƒé™„å½•ã€‚å…³é—­è‡ªåŠ¨æ³¨å†Œä»¥åå°±å¯ä»¥åƒä»¥å‰ä¸€æ ·è‡ªå®šä¹‰æ‰€æœ‰çš„Beanã€‚
4. IntellijæŠ¥é”™çš„é—®é¢˜ RedisAutoConfigurationä¼šè‡ªåŠ¨åˆ›å»ºRedisConnectionFactoryå’ŒRedisTemplateï¼Œä½†æ˜¯åœ¨intellij ideaä¸­æ£€æµ‹ä¼šæœ‰é—®é¢˜ã€‚åªæœ‰å½“@Autowiredå†™åˆ°Applicationç±»ä¸­çš„æ—¶å€™æ‰ä¸æŠ¥é”™ã€‚æ·»åŠ åˆ°å…¶ä»–@Configurationç±»ä¸­åˆ™ä¼šæŠ¥æ— æ³•autowireé”™è¯¯ï¼š
Could not autowire bean &#39;RedisConnectionFactory&#39;....ã€‚
å®é™…ç¼–è¯‘çš„æ—¶å€™ä¸æŠ¥é”™ï¼Œè¯´æ˜æ˜¯æ­£ç¡®çš„ï¼Œåªæ˜¯IDEæ£€æµ‹çš„é—®é¢˜ã€‚è¿™åº”è¯¥æ˜¯ideaçš„bugï¼Œæˆ–è€…æ”¯æŒè¿˜ä¸å®Œå–„ã€‚å¯ä»¥å‚è€ƒé™„å½•ä¸­çš„èµ„æ–™ã€‚
å¯ä»¥é€šè¿‡æ³¨è§£@SuppressWarningsè¿™ä¸ªæ³¨è§£è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¦‚åŒä¸Šé¢çš„ä»£ç ä¸­æ˜¾ç¤ºçš„é‚£æ ·ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ Autowiring for Bean Class inspection in Spring Boot project Disabling Redis Auto-configuration in Spring Boot applications Spring Data Redisç¤ºä¾‹ Spring Bootå­¦ä¹ ä¹‹æ—…ï¼šï¼ˆå…­ï¼‰springboot æ•´åˆ redis ä»¥åŠ redis é€šç”¨å·¥å…·ç±» spring-data-redisæ³¨å†Œfastjsonåºåˆ—åŒ–å·¥å…· redis-10-spring-boot å¦‚ä½•ä½¿ç”¨RedisTemplateè®¿é—®Redisæ•°æ®ç»“æ„ </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 03 - Servletå’ŒFilter</title>
        <url>https://orchidflower.github.io/2018/05/18/migrating-to-spring-boot-03-Servlet-Filter/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> åŸå…ˆäº‘è®¤è¯ä¸­æœ‰å‡ ä¸ªç‰¹æ®ŠåŠ è½½çš„ç»„ä»¶ï¼š
checkingServletï¼šä¸€ä¸ªServletï¼Œç”¨äºæ£€æŸ¥ç³»ç»Ÿçš„çŠ¶æ€ï¼Œä¸»è¦ç”¨äºè´Ÿè½½å‡è¡¡LBæ£€æµ‹æœåŠ¡æ˜¯å¦æ­£å¸¸ä½¿ç”¨ã€‚è¯¥Servletå®šä¹‰äº†äº†ä¸€ç»„URLï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥ç³»ç»Ÿçš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š/checking/databaseï¼ˆæ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¯ä»¥è®¿é—®ï¼‰ï¼Œ/checking/versionï¼ˆè¿”å›ç³»ç»Ÿç‰ˆæœ¬å·ï¼‰ï¼Œ/checkingï¼ˆæ€»ä½“æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ï¼‰ç­‰ã€‚è¿™äº›åŠŸèƒ½ç†è®ºä¸Šä¸é€‚ç”¨Servletä¹Ÿèƒ½å¤Ÿå®ç°ï¼Œä½†æ˜¯ç”±äºå†å²åŸå› é‡‡ç”¨äº†Servletï¼Œè¿™æ¬¡ä¸€ç›´ä¹Ÿä¸è€ƒè™‘é‡æ–°ç¼–å†™ã€‚ ClientCertificateFromProxyFilterï¼šä¸€ä¸ªFilterï¼Œç”¨äºæ£€æŸ¥è´Ÿè½½å‡è¡¡è½¬å‘è¿‡æ¥çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼Œé…åˆSpring Securityå®ŒæˆåŒå‘SSLçš„è®¤è¯å·¥ä½œã€‚ 1. Springä¸­çš„å¤„ç† ä¹‹å‰ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨Springçš„æ³¨å…¥åŠŸèƒ½ï¼Œå°†å‚æ•°è‡ªåŠ¨æ³¨å…¥Servletä¸­ï¼Œè¿˜ç‰¹åœ°å†™äº†ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œæ¨¡ä»¿Springä¸­çš„DelegatingFilterProxyå®ç°çš„ã€‚æœ‰äº†è¿™ä¸ªè¾…åŠ©ç±»ï¼Œå¯ä»¥å°†Servletå®šä¹‰æˆæ™®é€šçš„Spring Beanï¼Œä»è€Œä½¿ç”¨Springå¸¦æ¥çš„ä¾¿åˆ©ã€‚è¿™ä¸ªç±»çš„ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š
1package com.eveus.website.servlet.support; 2 3import org.springframework.web.context.WebApplicationContext; 4import org.springframework.web.context.support.WebApplicationContextUtils; 5 6import javax.servlet.*; 7import java.io.IOException; 8 9/** 10 * Servletä»£ç†ã€‚ 11 * å°†ä¸€ä¸ªSpringç®¡ç†çš„Beanä½œä¸ºServletçš„ä»£ç†å®ç°ã€‚è¯¥Beanéœ€è¦extends HttpServletï¼Œå¹¶å®ç°ç›¸åº”çš„æ–¹æ³•ã€‚ 12 * 13 * @author limin.zhang 14 * @version $Id: $Id 15 */ 16public class DelegatingServletProxy extends GenericServlet { 17 18 private static final long serialVersionUID = 6485296276572157986L; 19 private String targetBean; 20 private Servlet proxy; 21 22 /** {@inheritDoc} */ 23 @Override 24 public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException { 25 proxy.service(req, res); 26 } 27 28 /** {@inheritDoc} */ 29 @Override 30 public void init() throws ServletException { 31 this.targetBean = getServletName(); 32 getServletBean(); 33 proxy.init(getServletConfig()); 34 } 35 36 private void getServletBean() { 37 WebApplicationContext wac = WebApplicationContextUtils.getRequiredWebApplicationContext(getServletContext()); 38 this.proxy = (Servlet) wac.getBean(targetBean); 39 } 40} DelegatingServletProxyçš„ä½œç”¨ä½œä¸ºä¸€ä¸ªä»£ç†ç±»ï¼Œä¼šè‡ªåŠ¨é€šè¿‡WebApplicationContextUtilså·¥å…·ç±»è·å–åŒåçš„Springå¯¹è±¡ã€‚ç„¶åå°†è¯·æ±‚ä»£ç†ç»™è¿™ä¸ªå¯¹è±¡ã€‚ ä¸ºäº†èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œéœ€è¦åˆå§‹åŒ–ä¸¤ä¸ªåœ°æ–¹ï¼š
1.1 web.xml 1 &amp;lt;servlet&amp;gt; 2 &amp;lt;servlet-name&amp;gt;checkingServlet&amp;lt;/servlet-name&amp;gt; 3 &amp;lt;servlet-class&amp;gt;com.eveus.website.servlet.support.DelegatingServletProxy&amp;lt;/servlet-class&amp;gt; 4 &amp;lt;/servlet&amp;gt; 5 6 &amp;lt;servlet-mapping&amp;gt; 7 &amp;lt;servlet-name&amp;gt;checkingServlet&amp;lt;/servlet-name&amp;gt; 8 &amp;lt;url-pattern&amp;gt;/checking/*&amp;lt;/url-pattern&amp;gt; 9 &amp;lt;/servlet-mapping&amp;gt; é€šè¿‡web.xmlåŠ è½½DelegatingServletProxyè¾…åŠ©ç±»ï¼Œç„¶ååšå¥½mappingã€‚
1.2 spring beané…ç½® 1 &amp;lt;!-- Servlet Bean definition. Will be delegated by DelegatingServletProxy --&amp;gt; 2 &amp;lt;!-- CheckingServlet, used to show server version &amp;amp; check system status --&amp;gt; 3 &amp;lt;bean id=&amp;#34;checkingServlet&amp;#34; class=&amp;#34;com.eveus.website.servlet.CheckingServlet&amp;#34;&amp;gt; 4 &amp;lt;/bean&amp;gt; ç„¶åæŠŠBeanå®šä¹‰æˆæ™®é€šçš„Spring Beanå°±å¯ä»¥ä½¿ç”¨äº†ã€‚
2. SpringBootæ”¹é€  åœ¨Spring booté¡¹ç›®ä¸­ï¼Œé€šå¸¸æ˜¯ä¸å­˜åœ¨web.xmlçš„ã€‚å› æ­¤å¸Œæœ›èƒ½å¤Ÿä¸ä½¿ç”¨web.xmlå®Œæˆé…ç½®ã€‚é€šè¿‡ä»ç½‘ä¸Šæœç´¢èµ„æ–™ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ¡ˆã€‚
2.1 WebApplicationInitializer / SpringBootServletInitializer æœ€å…ˆæ‰¾åˆ°çš„æ–¹æ³•æ˜¯WebApplicationInitializerï¼Œè¿™æ˜¯Servlet 3.0è§„èŒƒå¼•å…¥çš„æ‰©å±•ç‚¹ã€‚è¿™æ˜¯Spring 4ä¹‹åæ–°å¢çš„ä¸€ä¸ªæ¥å£ï¼Œå…¶å®˜æ–¹æ–‡æ¡£ä»‹ç»å¦‚ä¸‹ï¼š
Interface to be implemented in Servlet 3.0&#43; environments in order to configure the ServletContext programmatically â€“ as opposed to (or possibly in conjunction with) the traditional web.xml-based approach. Implementations of this SPI will be detected automatically by SpringServletContainerInitializer, which itself is bootstrapped automatically by any Servlet 3.0 container.
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å®ç°è¯¥æ¥å£å¯ä»¥åœ¨Servlet 3.0&#43;ç¯å¢ƒä¸­ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®ServletContextï¼Œè€Œä¸æ˜¯(æˆ–ç»“åˆ)ä¼ ç»Ÿçš„åŸºäºweb.xmlæ–‡ä»¶é…ç½®ã€‚
é€šå¸¸çš„è¯´æ³•æ˜¯é€šè¿‡å®ç°WebApplicationInitializeræ¥å£çš„onStartæ–¹æ³•ï¼Œå¯ä»¥æ·»åŠ Filterã€Servletç­‰çš„å®šä¹‰ã€‚ç±»ä¼¼è¿™æ ·ï¼š
1 // æ³¨å†ŒFilter 2 @Override 3 public void onStartup(ServletContext servletContext) throws ServletException { 4 servletContext.addFilter(&amp;#34;clientCertificateFromProxyFilter&amp;#34;, new DelegatingFilterProxy(&amp;#34;clientCertificateFromProxyFilter&amp;#34;)) 5 .addMappingForUrlPatterns(null, true, &amp;#34;/api/*&amp;#34;); 6 } ä½†æ˜¯ç»è¿‡æµ‹è¯•å‘ç°è¿™ç§æ–¹æ³•åœ¨springbootä¸­æ— æ•ˆã€‚SpringBootServletInitializeræŒ‰ç…§å®˜æ–¹æ–‡æ¡£æ¥è¯´ï¼Œæ˜¯ç”¨äºæ›¿ä»£WebApplicationInitializerçš„ï¼Œåº”è¯¥èµ·åˆ°åŒæ ·çš„ä½œç”¨ã€‚
åæ¥ç»è¿‡æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œç¡®è®¤è¿™ä¸ªå›è°ƒç‚¹åœ¨åµŒå…¥å®¹å™¨çš„æ¨¡å¼ä¸‹æ˜¯æ— æ•ˆçš„ï¼Œè¢«SpringBootæœ‰æ„å…³é—­äº†ï¼š
Embedded servlet containers do not directly execute the Servlet 3.0&#43; javax.servlet.ServletContainerInitializer interface or Springâ€™s org.springframework.web.WebApplicationInitializer interface. This is an intentional design decision intended to reduce the risk that third party libraries designed to run inside a war may break Spring Boot applications.
If you need to perform servlet context initialization in a Spring Boot application, you should register a bean that implements the org.springframework.boot.web.servlet.ServletContextInitializer interface. The single onStartup method provides access to the ServletContext and, if necessary, can easily be used as an adapter to an existing WebApplicationInitializer.
å…³é—­çš„åŸå› æ˜¯é˜²æ­¢ç¬¬ä¸‰æ–¹åº“å®ç°è¿™ä¸ªæ¥å£åè‡ªåŠ¨æ‰§è¡Œç ´åæ‰“åŒ…åçš„SpringBootåº”ç”¨çš„å¯åŠ¨ã€‚å½“ç„¶è¿™ä¸ªæ¥å£å¯¹waråŒ…æ¨¡å¼è¿˜æ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯é‰´äºæˆ‘ä»¬ç°åœ¨ç”¨çš„æ˜¯åµŒå…¥å®¹å™¨çš„æ¨¡å¼ï¼Œæ‰“åŒ…æˆjaråŒ…ï¼Œæ‰€ä»¥è¿˜å¿…é¡»æ‰¾å…¶ä»–çš„æ–¹æ¡ˆè§£å†³ã€‚
2.2 ç›´æ¥å£°æ˜Bean å®é™…ä¸ŠSpring booté’ˆå¯¹Servletã€Filterç±»å‹çš„Beanè¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ã€‚ä¼šè‡ªåŠ¨è¿›è¡Œæ³¨å†Œï¼š
To add a Servlet, Filter, or Servlet *Listener by using a Spring bean, you must provide a @Bean definition for it. Doing so can be very useful when you want to inject configuration or dependencies. However, you must be very careful that they do not cause eager initialization of too many other beans, because they have to be installed in the container very early in the application lifecycle. (For example, it is not a good idea to have them depend on your DataSource or JPA configuration.) You can work around such restrictions by initializing the beans lazily when first used instead of on initialization.
In the case of Filters and Servlets, you can also add mappings and init parameters by adding a FilterRegistrationBean or a ServletRegistrationBean instead of or in addition to the underlying component.
ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡æŠŠServlet, Filter, æˆ–è€…Servelt *Listeneré¡¶ä¸€ä¸ªæˆJava Beanï¼ŒSpringBootå¯ä»¥åŠ è½½ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰FilterRegistrationBeanã€ServletRegistrationBeanæ¥å¯¹Filterã€Servletè¿›è¡Œä¸€å®šçš„åˆå§‹åŒ–ã€‚
æ‰€ä»¥æœ€åçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹(ä½¿ç”¨ServletRegistrationBeanã€FilterRegistrationBean)ï¼š
1@Configuration 2public class BeanConfig{ 3 4 @Bean(name=&amp;#34;clientCertificateFromProxyFilter&amp;#34;) 5 public ClientCertificateFromProxyFilter clientCertificateFromProxyFilter() { 6 return new ClientCertificateFromProxyFilter(); 7 } 8 9 @Bean(name=&amp;#34;checkingServlet&amp;#34;) 10 public CheckingServlet checkingServlet() { 11 return new CheckingServlet(); 12 } 13 14 ///////////////////// Servlet //////////////////////// 15 @Bean 16 public ServletRegistrationBean cxfServlet() { 17 final ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean(new CXFServlet(), &amp;#34;/api/*&amp;#34;); 18 servletRegistrationBean.setLoadOnStartup(1); 19 return servletRegistrationBean; 20 } 21 22 @Bean(name=&amp;#34;checking&amp;#34;) 23 public ServletRegistrationBean checking() { 24 ServletRegistrationBean registration = new ServletRegistrationBean(checkingServlet()); 25 registration.addUrlMappings(&amp;#34;/checking/*&amp;#34;); 26 return registration; 27 } 28 29 ////////////////////// Filter /////////////////////////// 30 @Bean(name=&amp;#34;certProxy&amp;#34;) 31 public FilterRegistrationBean certProxy() { 32 FilterRegistrationBean registration = new FilterRegistrationBean(clientCertificateFromProxyFilter()); 33 registration.addUrlPatterns(&amp;#34;/api/*&amp;#34;); 34 return registration; 35 } 36} é™„å½•ã€å‚è€ƒèµ„æ–™ How to use Spring&amp;rsquo;s WebApplicationInitializer Spring WebApplicationInitializer and ApplicationContextInitializer confusion SpringBootåˆå§‹æ•™ç¨‹ä¹‹Servletã€Filterã€Listeneré…ç½®(ä¸ƒ) SpringBoot Manual: Convert an Existing Application to Spring Boot </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 02 - å¼‚å¸¸å¤„ç†</title>
        <url>https://orchidflower.github.io/2018/05/15/migrating-to-spring-boot-02-Exception-Handler/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag><tag>AOP</tag>
        </tags>
        <content type="html"> é¦–å…ˆè¯´ä¸€ä¸‹èƒŒæ™¯ä¿¡æ¯ã€‚äº‘è®¤è¯å¹³å°æ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„Springé¡¹ç›®ï¼Œä»ä¸Šåˆ°ä¸‹å¯ä»¥åˆ†ä¸ºï¼šAPIå±‚ï¼ˆå¯¹åº”Spring Controllerï¼‰ã€Serviceå±‚ã€DAOå±‚ï¼ˆMyBatisï¼‰å‡ å±‚ã€‚ä¸ºäº†æ–¹ä¾¿å¤„ç†ï¼Œä»å¼€å‘è§„èŒƒä¸Šæˆ‘ä»¬è¦æ±‚äº†Serviceå±‚çš„å¼‚å¸¸åœ¨Serviceå±‚è‡ªè¡Œå¤„ç†ã€‚
ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œåœ¨æ¥å£å®šä¹‰ä¸Šï¼Œä»APIå±‚è°ƒç”¨Serviceå±‚çš„è¯·æ±‚ä¼šæœ‰ç»Ÿä¸€çš„è¿”å›åŸºç±»ï¼šCommonResultã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š
1public class CommonResult implements Serializable { 2 private static final long serialVersionUID = 1L; 3 4 /** 5 * success è¯·æ±‚æˆåŠŸä¸å¦çš„æ ‡å¿—ã€‚ 6 */ 7 protected boolean success = Boolean.FALSE; 8 /** 9 * resultCode è¿”å›ç ã€‚ 10 */ 11 protected String resultCode = &amp;#34;&amp;#34;; 12 /** 13 * message è¯¦ç»†ä¿¡æ¯ã€‚ 14 */ 15 protected String message = &amp;#34;&amp;#34;; 16 ... 17} æ‰€æœ‰éœ€è¦ä»APIå±‚è°ƒç”¨åˆ°çš„Serviceå±‚çš„è¿”å›å€¼éƒ½æ˜¯è¯¥ç±»æˆ–è€…è¯¥ç±»çš„å­ç±»ã€‚å¦‚æœæ˜¯Serviceå±‚ä¹‹é—´äº’ç›¸è°ƒç”¨ï¼Œåˆ™ä¸å—æ­¤é™åˆ¶ã€‚
æœ¬ç« çš„å†…å®¹ä¸»è¦ä¸AOPæœ‰å…³ã€‚
1. ä¼ ç»ŸSpringä¸­çš„å¤„ç† åŸºæœ¬çš„èƒŒæ™¯ä»‹ç»å®Œæ¯•ã€‚ä¸ºäº†åœ¨Serviceå±‚å¤„ç†å¼‚å¸¸ï¼Œå®ç°äº†ä¸€ä¸ªServiceExceptionHandlerï¼Œä¸“é—¨æ‹¦æˆªå¼‚å¸¸ï¼Œå¹¶æ ¹æ®å¼‚å¸¸ç±»å‹ï¼Œè®¾ç½®è¿”å›å€¼ä¸­çš„ç›¸åº”å­—æ®µï¼›ç„¶åé€šè¿‡AOPåŠŸèƒ½å°†åŠŸèƒ½ç»‡å…¥æ•´ä¸ªæµç¨‹ã€‚
1.1 ServiceExceptionHandler 1public class ServiceExceptionHandler { 2	private static Logger logger = LoggerFactory.getLogger(ServiceExceptionHandler.class); 3 4	/** 5	* å¼‚å¸¸å¤„ç†ã€‚ä½¿ç”¨aop:aroundè¿›è¡Œæ‹¦æˆªï¼Œå½“æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™çš„æ—¶å€™å¯ä»¥æ ¹æ®å¼‚å¸¸ç±»å‹ç”Ÿæˆè¿”å›å€¼ã€‚ 6	* 7	* @param joinPoint a {@link org.aspectj.lang.ProceedingJoinPoint} object. 8	* @throws java.lang.ClassNotFoundException if any. 9	* @throws java.lang.IllegalAccessException if any. 10	* @throws java.lang.InstantiationException if any. 11	* @return a {@link java.lang.Object} object. 12	*/ 13	public Object processAndCatchException(ProceedingJoinPoint joinPoint) throws InstantiationException, IllegalAccessException, ClassNotFoundException { 14	Object result = null; 15	Signature signature = joinPoint.getSignature(); 16	@SuppressWarnings(&amp;#34;rawtypes&amp;#34;) 17	Class returnType = ((MethodSignature) signature).getReturnType(); 18	try { 19	result = joinPoint.proceed(); 20	} catch (DataAccessException e) { 21	logger.error(&amp;#34;Database exception occured: &amp;#34;, e); 22	result = prepareResult(returnType, ResultCode.DATABASE_ERROR); 23	} 24	catch (Exception e) { 25	logger.error(&amp;#34;Unknow exception occured:&amp;#34;, e); 26	result = prepareResult(returnType, ResultCode.UNKNOW_ERROR); 27	} catch (Throwable e) { 28	logger.error(&amp;#34;Unknown throwable occured:&amp;#34;, e); 29	result = prepareResult(returnType, ResultCode.UNKNOW_ERROR); 30	} 31	return result; 32	} 33	34	/** 35	* å‡†å¤‡è¿”å›å€¼ 36	* @param returnType 37	* @param errorCode 38	* @return 39	*/ 40	private Object prepareResult(@SuppressWarnings(&amp;#34;rawtypes&amp;#34;) Class returnType, ResultCode errorCode) { 41	Object result = null; 42	try { 43	result = Class.forName(returnType.getName()).newInstance(); 44	if (!(result instanceof CommonResult)) { 45	logger.error(&amp;#34;Return type is not subclass of CommonResult, please contact developer!!!&amp;#34;); 46	return null; 47	} 48	CommonResult ret = (CommonResult)result; 49	ret.setResultCode(errorCode.getCode()); 50	ret.setMessage(errorCode.getDesc()); 51	ret.setSuccess(false); 52	} catch (InstantiationException | IllegalAccessException | ClassNotFoundException e) { 53	logger.error(&amp;#34;prepareResult failed. &amp;#34;, e); 54	} 55	return result; 56	} 57} 1.2 AOPé…ç½® ç„¶åé€šè¿‡Springçš„AOPé…ç½®ï¼Œå°†å¼‚å¸¸å¤„ç†ç»‡å…¥å¤„ç†è¿‡ç¨‹ä¸­ï¼š
1	&amp;lt;!-- Service Exception Handler --&amp;gt; 2 &amp;lt;bean id=&amp;#34;serviceExceptionHandlerAspect&amp;#34; class=&amp;#34;com.eveus.cloudauth.service.exception.ServiceExceptionHandler&amp;#34; /&amp;gt; 3 &amp;lt;aop:config&amp;gt; 4 &amp;lt;aop:aspect ref=&amp;#34;serviceExceptionHandlerAspect&amp;#34; order=&amp;#34;1&amp;#34;&amp;gt; 5 &amp;lt;aop:pointcut id=&amp;#34;capServicePointcut&amp;#34; expression=&amp;#34;execution(com.eveus.cloudauth.service.bean..* com.eveus.cloudauth.service.impl.*ServiceImpl..*(..))&amp;#34; /&amp;gt; 6 &amp;lt;aop:around pointcut-ref=&amp;#34;capServicePointcut&amp;#34; method=&amp;#34;processAndCatchException&amp;#34;/&amp;gt; 7 &amp;lt;aop:pointcut id=&amp;#34;uidServicePointCut&amp;#34; expression=&amp;#34;execution(com.eveus.cloudauth.service.bean..* com.eveus.cloudauth.service.impl.uid.*ServiceImpl..*(..))&amp;#34; /&amp;gt; 8 &amp;lt;aop:around pointcut-ref=&amp;#34;uidServicePointCut&amp;#34; method=&amp;#34;processAndCatchException&amp;#34;/&amp;gt; 9 &amp;lt;/aop:aspect&amp;gt; 10 &amp;lt;/aop:config&amp;gt; 2. SpringBootä¸­çš„å¤„ç† åœ¨SpringBootä¸­æ¨èçš„æ˜¯åŸºäºJavaçš„é…ç½®ï¼Œä¸å†æ¨èé‡‡ç”¨XMLé…ç½®ã€‚å› æ­¤éœ€è¦ç¨å¾®æ”¹å†™ä¸€ä¸‹é…ç½®æ–¹æ³•ï¼š
2.1 Beané…ç½® 1@Configuration 2public class ServiceConfig { 3 // ç”ŸæˆServiceExceptionHandlerå®ä¾‹ 4 @Bean(name=&amp;#34;serviceExceptionHandler&amp;#34;) 5 public ServiceExceptionHandler serviceExceptionHandler() throws Exception { 6 return new ServiceExceptionHandler(); 7 } 8} Beané…ç½®æ¯”è¾ƒç®€å•ï¼Œåœ¨ä¸€ä¸ª@Configurationæ³¨è§£çš„ç±»ä¸­ç”Ÿæˆè¿”å›ä¸€ä¸ªç±»å¯¹è±¡å³å¯ã€‚
2.2 AOPé…ç½® AOPç›¸å…³çš„é…ç½®å¤§éƒ¨åˆ†å¯ä»¥é€šè¿‡æ³¨è§£å®Œæˆï¼Œä¾‹å¦‚ï¼šaop:aspectä½¿ç”¨@Aspectæ›¿ä»£ï¼›aop:pointcutä½¿ç”¨@Pointcutä»£æ›¿ï¼›aop:aroundä½¿ç”¨@Aroundä»£æ›¿ã€‚è¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥å†™å…¥ServiceExceptionHandlerç±»ã€‚
ç»è¿‡ä¿®æ”¹ï¼Œæ”¹å†™å®Œçš„ServiceExceptionHandlerå¦‚ä¸‹ï¼š
1@Aspect 2@Order(1)	// ä¼˜å…ˆçº§æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚ä¼˜å…ˆçº§è¶Šé«˜è¶Šå…ˆæ‰§è¡Œã€‚æ‰§è¡Œå †æ ˆå¦‚ä¸‹ï¼šé«˜-ä½-serviceProcess-ä½-é«˜ã€‚ 3public class ServiceExceptionHandler { 4	private static Logger logger = LoggerFactory.getLogger(ServiceExceptionHandler.class); 5 6	// æ‹¦æˆªç‚¹å®šä¹‰ã€‚åªæ‹¦æˆªè¿”å›å€¼ä¸º ServiceResult çš„æ–¹æ³•ã€‚ 7	@Pointcut(&amp;#34;execution(com.eveus.cloudauth.service.bean..* com.eveus.cloudauth.service.impl.*ServiceImpl..*(..))&amp;#34;) 8	public void capServiceProcess() {}; 9 10	@Pointcut(&amp;#34;execution(com.eveus.cloudauth.service.bean..* com.eveus.cloudauth.service.impl.uid.*ServiceImpl..*(..))&amp;#34;) 11	public void uidServiceProcess() {}; 12 13 14	/** 15	* å¼‚å¸¸å¤„ç†ã€‚ä½¿ç”¨aop:aroundè¿›è¡Œæ‹¦æˆªï¼Œå½“æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™çš„æ—¶å€™å¯ä»¥æ ¹æ®å¼‚å¸¸ç±»å‹ç”Ÿæˆè¿”å›å€¼ã€‚ 16	* 17	* @param joinPoint a {@link org.aspectj.lang.ProceedingJoinPoint} object. 18	* @throws java.lang.ClassNotFoundException if any. 19	* @throws java.lang.IllegalAccessException if any. 20	* @throws java.lang.InstantiationException if any. 21	* @return a {@link java.lang.Object} object. 22	*/ 23	@Around(&amp;#34;capServiceProcess() || uidServiceProcess()&amp;#34;) 24	public Object processAndCatchException(ProceedingJoinPoint joinPoint) throws InstantiationException, IllegalAccessException, ClassNotFoundException { 25	Object result = null; 26	Signature signature = joinPoint.getSignature(); 27	@SuppressWarnings(&amp;#34;rawtypes&amp;#34;) 28	Class returnType = ((MethodSignature) signature).getReturnType(); 29	try { 30	result = joinPoint.proceed(); 31	} catch (DataAccessException e) { 32	logger.error(&amp;#34;Database exception occured: &amp;#34;, e); 33	result = prepareResult(returnType, ResultCode.DATABASE_ERROR); 34	} 35	catch (Exception e) { 36	logger.error(&amp;#34;Unknow exception occured:&amp;#34;, e); 37	result = prepareResult(returnType, ResultCode.UNKNOW_ERROR); 38	} catch (Throwable e) { 39	logger.error(&amp;#34;Unknown throwable occured:&amp;#34;, e); 40	result = prepareResult(returnType, ResultCode.UNKNOW_ERROR); 41	} 42	return result; 43	} 44	45	/** 46	* å‡†å¤‡è¿”å›å€¼ 47	* @param returnType 48	* @param errorCode 49	* @return 50	*/ 51	private Object prepareResult(@SuppressWarnings(&amp;#34;rawtypes&amp;#34;) Class returnType, ResultCode errorCode) { 52	Object result = null; 53	try { 54	result = Class.forName(returnType.getName()).newInstance(); 55	if (!(result instanceof CommonResult)) { 56	logger.error(&amp;#34;Return type is not subclass of CommonResult, please contact developer!!!&amp;#34;); 57	return null; 58	} 59	CommonResult ret = (CommonResult)result; 60	ret.setResultCode(errorCode.getCode()); 61	ret.setMessage(errorCode.getDesc()); 62	ret.setSuccess(false); 63	} catch (InstantiationException | IllegalAccessException | ClassNotFoundException e) { 64	logger.error(&amp;#34;prepareResult failed. &amp;#34;, e); 65	} 66	return result; 67	} 68} æ³¨æ„ä¸€ä¸‹å…¶ä¸­å‡ ä¸ªæ³¨è§£çš„ä½¿ç”¨æ–¹æ³•ã€‚æ›´å¤šè¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è€ƒï¼šSpring Framework Core: AOPã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ Spring Framework Core: AOP </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 01 - æ’ä»¶åŠ è½½</title>
        <url>https://orchidflower.github.io/2018/05/09/migrating-to-spring-boot-01-loading-plugin/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> é¦–å…ˆç®€å•è¯´ä¸€ä¸‹äº‘å¹³å°çš„ä¸šåŠ¡åŠŸèƒ½ï¼šäº‘å¹³å°ä¸Šæä¾›äº†å¤šç§å¤šæ ·çš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å¯èƒ½æ¥æºäºä¸åŒçš„ä¾›åº”å•†ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºæŸä¸€ç§æœåŠ¡æ¥è¯´ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªä¾›åº”å•†æä¾›ç›¸åŒçš„æœåŠ¡ï¼›è€Œå¯¹äºæŸä¸€ä¸ªä¾›åº”å•†æ¥è¯´ï¼Œå®ƒå¯èƒ½æä¾›å¤šç§æœåŠ¡ã€‚
ä¹‹å‰çš„äº‘å¹³å°ä¸­æœ‰ä¸€ä¸ªæ’ä»¶æœºåˆ¶ï¼Œä½¿ç”¨æ’ä»¶æœºåˆ¶è§£å†³äº†ä¾›åº”å•†ä¸ç³»ç»Ÿçš„è€¦åˆåº¦é—®é¢˜ã€‚ç³»ç»ŸæŠ½è±¡äº†æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åœ¨åˆé€‚çš„æ—¶æœºåŠ è½½æ’ä»¶ä»¥è°ƒç”¨ä¾›åº”å•†çš„æœåŠ¡ã€‚
åŠ è½½ç›¸å…³çš„ä»£ç å¤§æ¦‚ç±»ä¼¼è¿™æ ·ï¼š
1... 2ClassLoader localClassLoader = Thread.currentThread().getContextClassLoader(); 3for (String str : providerClassNames) { 4 try { 5 Class&amp;lt;?&amp;gt; localClass = localClassLoader.loadClass(str); 6 XXXServiceProvider localProvider = (XXXServiceProvider) localClass.newInstance(); 7 localProvider.initial();// åˆå§‹åŒ–æ’ä»¶ 8 } catch (Exception e) { 9	... 10 } 11} 12... providerClassNamesæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å¹¶æ‰€æœ‰æ’ä»¶çš„ä¸»ç±»åå­—ã€‚é€šè¿‡è·å–åˆ°çš„ClassLoaderï¼Œå¯¹æ’ä»¶ä¸»ç±»è¿›è¡ŒåŠ è½½ï¼Œä»è€Œè·å¾—æ’ä»¶å¯¹è±¡ã€‚
ä½†æ˜¯ä¸Šé¢è¿™ä¸ªåŠ è½½æœºåˆ¶æ²¡æœ‰è§£å†³Springè¯¸å¦‚çš„é—®é¢˜ï¼Œä½¿å¾—æ’ä»¶ä»£ç ä¸­æ— æ³•é€šè¿‡@Valueè¿™ç§å½¢å¼æ³¨å…¥é…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªæ’ä»¶ä¸­å¿…é¡»è‡ªè¡Œè¯»å–é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼è¿™æ ·ï¼š
1private void initProperties() { 2 InputStream inputStream = getClass().getResourceAsStream(&amp;#34;/config.properties&amp;#34;); 3 try { 4 Properties prop = new Properties(); 5 prop.load(inputStream); 6 reqUrl = prop.getProperty(&amp;#34;xxx.reqUrl&amp;#34;).trim(); 7 userId = prop.getProperty(&amp;#34;xxx.userId&amp;#34;).trim(); 8	... 9 } catch (IOException e) { 10 logger.error(&amp;#34;init haoduo auth provider error! &amp;#34;, e); 11 } finally { 12 if (inputStream != null) { 13 try { 14 inputStream.close(); 15 } catch (IOException e) { 16 logger.warn(&amp;#34;close config.properties inputStream error! &amp;#34;, e); 17 } 18 } 19 } 20 } è¿™ç§æ–¹å¼ç”¨èµ·æ¥è¿˜æ˜¯æŒºç¹ççš„ï¼Œæ‰€ä»¥å¾ˆå¸Œæœ›æ”¹é€ æˆèƒ½å¤Ÿå’Œæ™®é€šSpringç±»ä¸€æ ·ä½¿ç”¨æ³¨å…¥æ–¹å¼ã€‚
1. æ”¹é€ æ–¹æ¡ˆ è¦å®ç°ä¸Šè¿°ç›®æ ‡ï¼Œåˆç†çš„æ–¹æ¡ˆæ˜¯å°†æ’ä»¶å®šä¹‰æˆSpringçš„Beanã€‚ä½†æ˜¯è€ƒè™‘åˆ°æ’ä»¶çš„ä¸ç³»ç»Ÿçš„è€¦åˆåº¦é—®é¢˜ï¼Œæ‰€ä»¥ä¹Ÿä¸å¤ªè€ƒè™‘ç›´æ¥å°†æ’ä»¶å®šä¹‰æˆBeanï¼Œå†™åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­ã€‚é‚£å‰©ä½™çš„è§£å†³æ–¹æ¡ˆåªèƒ½æ˜¯å°†æ’ä»¶åŠ¨æ€å®šä¹‰æˆBeanã€‚é€šè¿‡åœ¨ç½‘ä¸Šæœç´¢è§£å†³æ–¹æ¡ˆï¼Œæ‰¾åˆ°äº†ä¸¤ç§æ–¹æ¡ˆã€‚
1.1 BeanFactoryPostProcessor æœ€åˆæ‰¾åˆ°çš„æ˜¯BeanFactoryPostProcessoræ–¹æ¡ˆï¼šBeanFactoryPostProcessoråœ¨BeanFactoryåˆ›å»ºæˆåŠŸã€åˆå§‹åŒ–ä¹‹åã€BeançœŸæ­£åˆ›å»ºä¹‹å‰æ‰§è¡Œã€‚ä¸€èˆ¬é€šè¿‡è¯¥å›è°ƒå‡½æ•°ä¸­ä¿®æ”¹Beanå®šä¹‰æˆ–è€…å®šä¹‰æ–°çš„Beanã€‚
ç†è®ºä¸Šè®²å¯ä»¥åœ¨æ­¤èŠ‚ç‚¹åˆ›å»ºæ–°çš„Beanå®šä¹‰ï¼Œä¾‹å¦‚æ ¹æ®æ’ä»¶åˆ—è¡¨åˆ›å»ºå¯¹åº”çš„æ’ä»¶Beanã€‚ä½†æ˜¯é—®é¢˜åœ¨äºè¿™ä¸ªèŠ‚ç‚¹@Valueæ˜¯æ— æ•ˆçš„ï¼ˆ@Valueä¹Ÿæ˜¯ç”±BeanFactoryå¤„ç†çš„ï¼‰ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹Beanè¿˜æ²¡æœ‰åˆ›å»ºï¼Œæ›´åŠ ä¸å¯èƒ½æ³¨å…¥é…ç½®å€¼ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•ä»é…ç½®æ–‡ä»¶ä¸­æ‹¿åˆ°æ’ä»¶åˆ—è¡¨è¿™ä¸€é…ç½®é¡¹ä¿¡æ¯ã€‚
æ–¹æ¡ˆå¤±è´¥ã€‚åœ¨æ­¤ä¸åšè¿‡å¤šæè¿°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒç½‘ä¸Šçš„èµ„æ–™ã€‚
1.2 ç›´æ¥åœ¨åŠ¨æ€åŠ è½½çš„åœ°æ–¹æ³¨å†ŒBean æœ€åæ‰¾åˆ°çš„æ–¹æ¡ˆæ˜¯å…ˆåŠ¨æ€æ³¨å†ŒBeanç„¶ååŠ è½½ï¼Œä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š
1AutowireCapableBeanFactory bf = applicationContext.getAutowireCapableBeanFactory(); 2 for (String str : this.providers) { 3 try { 4 // å®šä¹‰BeanDefinitionï¼Œæ ¹æ®providersåˆ—è¡¨åŠ¨æ€æ·»åŠ Beanå®šä¹‰ 5 String beanName = getSimpleClassName(str); 6 GenericBeanDefinition bd = new GenericBeanDefinition(); 7 bd.setBeanClassName(str); 8 ((DefaultListableBeanFactory)bf).registerBeanDefinition(beanName, bd); 9 // ä½¿ç”¨applicationContextåŠ è½½åˆšåˆšå®šä¹‰çš„Beanï¼Œæ­¤æ—¶åº”è¯¥å®Œæˆäº†@Autowiredçš„æ³¨å…¥å·¥ä½œ 10 XXXServiceProvider localProvider = (XXXServiceProvider) applicationContext.getBean(beanName); 11 localProvider.initial();// åˆå§‹åŒ–æ’ä»¶ 12 logger.info(&amp;#34;XXXServiceProvider {} is added to list.&amp;#34;, localProvider.getProviderName()); 13 } catch (Exception e) { 14	... 15 } 16 } ä¸Šé¢çš„ä»£ç ä½¿ç”¨applicationContextè·å–çš„autowireCapableBeanFactoryï¼Œå…ˆåˆ›å»ºBeanå®šä¹‰ï¼ˆregisterBeanDefinitionï¼‰ï¼Œç„¶åè·å–è¯¥Beanï¼ˆapplicationContext.getBeanï¼‰ã€‚è¿™æ ·å¤„ç†ä¹‹åï¼Œé™¤äº†Beanå®šä¹‰æ˜¯åŠ¨æ€åˆ›å»ºçš„æ„å¤–ï¼Œå°±å’Œä¸€ä¸ªæ™®é€šçš„Spring Beanè¡¨ç°ä¸€è‡´äº†ã€‚
è¯¥æ–¹æ¡ˆå·¥ä½œæ­£å¸¸ã€‚
é™„å½•Aã€å‚è€ƒèµ„æ–™ Spring - Dynamically register beans </content>
    </entry>
    
     <entry>
        <title>è¿ç§»åˆ°SpringBoot 00 - èƒŒæ™¯ä»‹ç»</title>
        <url>https://orchidflower.github.io/2018/05/08/migrating-to-spring-boot-00-background/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Springboot</tag>
        </tags>
        <content type="html"> æœ€è¿‘å› ä¸ºå‘å¸ƒæ–¹é¢çš„åŸå› ï¼Œéœ€è¦å¯¹é¡¹ç›®è¿›è¡Œä¸€æ¬¡æ”¹é€ ï¼Œè¶ç€è¿™æ¬¡æœºä¼šï¼Œå¯¹äº‘å¹³å°é¡¹ç›®è¿›è¡Œäº†å½»åº•çš„é‡æ„ï¼Œè¿ç§»åˆ°äº†Spring Bootä¸Šã€‚æ”¹é€ è¿‡ç¨‹ä¸­ï¼Œä»ä¼ ç»Ÿçš„Springé¡¹ç›®è¿ç§»åˆ°Spring Bootä¸Šï¼Œè¿˜æ˜¯ç¢°åˆ°äº†ä¸€äº›é—®é¢˜çš„ï¼Œä¹Ÿå› æ­¤ç•™ä¸‹äº†è¿™ä¸ªç³»åˆ—çš„ç¬”è®°ã€‚å…¶ä¸­çš„å†…å®¹ï¼Œåº”è¯¥å¯¹å¸Œæœ›æŠŠä¼ ç»Ÿçš„Springé¡¹ç›®è¿ç§»åˆ°Spring Bootçš„äººä¼šæœ‰æ‰€å¸®åŠ©ã€‚
åœ¨æ”¹é€ è¿‡ç¨‹ä¸­ç¢°åˆ°äº†å¾ˆå¤šé—®é¢˜ã€‚è¯¸å¦‚ï¼šæ•°æ®æºï¼ˆå¤šæ•°æ®æºï¼‰ã€äº‹åŠ¡ã€Swaggerã€Redisã€æ—¥å¿—ã€CXFã€Kafkaç­‰ç­‰ã€‚è¿™å°†åœ¨åé¢çš„ç³»åˆ—ä¸­åˆ†åˆ«ä»‹ç»ã€‚
é™äºæ—¶é—´ï¼Œæœ‰äº›æ–¹é¢å¯èƒ½ä»‹ç»å¾—ä¸æ˜¯éå¸¸å……åˆ†ã€‚ä½†æ˜¯å¸Œæœ›è‡ªå·±èƒ½å¤Ÿå°½é‡çš„æŠŠé—®é¢˜ã€è§£å†³æ–¹æ¡ˆæè¿°æ¸…æ¥šï¼Œä¹Ÿç®—æ˜¯ä»¥åçš„ä¸€ä¸ªå‚è€ƒå§ã€‚
é™„å½•ä¸­æ˜¯éƒ¨åˆ†å‚è€ƒèµ„æ–™ï¼Œåé¢æ¯ç¯‡æ–‡ç« ä¼šæœ‰å¯¹åº”ä¸“é¢˜çš„å‚è€ƒèµ„æ–™ï¼Œä»…ä¾›å‚è€ƒã€‚
é™„å½•. å‚è€ƒèµ„æ–™ How to Configure Two DataSources Laziness at extreme: developing JAX-RS services with Spring Boot Spring Boot CXF JAX-WS Starter Spring Integration A Quick Guide to Spring @Value Spring Securityçš„ä½¿ç”¨ Spring security Java Configuration Spring Bootå¦‚ä½•ä½¿ç”¨Spring Securityè¿›è¡Œå®‰å…¨æ§åˆ¶ </content>
    </entry>
    
     <entry>
        <title>Apache HttpClient ä½¿ç”¨ï¼ˆä¸Šï¼‰</title>
        <url>https://orchidflower.github.io/2018/04/23/Apache-HttpClient-Manual/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>HttpClient</tag>
        </tags>
        <content type="html"> HttpClientæ˜¯Apache Jakarta Commonä¸‹çš„å­é¡¹ç›®ï¼Œç”¨æ¥æä¾›é«˜æ•ˆçš„ã€æœ€æ–°çš„ã€åŠŸèƒ½ä¸°å¯Œçš„æ”¯æŒHTTPåè®®çš„å®¢æˆ·ç«¯ç¼–ç¨‹å·¥å…·åŒ…ï¼Œå¹¶ä¸”å®ƒæ”¯æŒHTTPåè®®æœ€æ–°çš„ç‰ˆæœ¬å’Œå»ºè®®ã€‚HttpClientå·²ç»åº”ç”¨åœ¨å¾ˆå¤šçš„é¡¹ç›®ä¸­ï¼Œæ¯”å¦‚Apache Jakartaä¸Šå¾ˆè‘—åçš„å¦å¤–ä¸¤ä¸ªå¼€æºé¡¹ç›®Cactuså’ŒHTMLUnitéƒ½ä½¿ç”¨äº†HttpClientã€‚
ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯4.5ï¼Œæ”¯æŒHTTP 1.0/HTTP 1.1åè®®ã€‚æ­£åœ¨å¼€å‘ä¸­çš„5.0ç‰ˆæœ¬ï¼ˆè¿˜åœ¨Betaé˜¶æ®µï¼‰æ”¯æŒHTTP/2åè®®ã€‚
1. ç‰¹æ€§ åŸºäºæ ‡å‡†ã€çº¯å‡€çš„javaè¯­è¨€ã€‚å®ç°äº†Http1.0å’ŒHttp1.1 ä»¥å¯æ‰©å±•çš„é¢å‘å¯¹è±¡çš„ç»“æ„å®ç°äº†Httpå…¨éƒ¨çš„æ–¹æ³•ï¼ˆGET, POST, PUT, DELETE, HEAD, OPTIONS, and TRACEï¼‰ã€‚ æ”¯æŒHTTPSåè®®ã€‚ é€šè¿‡Httpä»£ç†å»ºç«‹é€æ˜çš„è¿æ¥ã€‚ åˆ©ç”¨CONNECTæ–¹æ³•é€šè¿‡Httpä»£ç†å»ºç«‹éš§é“çš„httpsè¿æ¥ã€‚ Basic, Digest, NTLMv1, NTLMv2, NTLM2 Session, SNPNEGO/Kerberosè®¤è¯æ–¹æ¡ˆã€‚ æ’ä»¶å¼çš„è‡ªå®šä¹‰è®¤è¯æ–¹æ¡ˆã€‚ ä¾¿æºå¯é çš„å¥—æ¥å­—å·¥å‚ä½¿å®ƒæ›´å®¹æ˜“çš„ä½¿ç”¨ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆã€‚ è¿æ¥ç®¡ç†å™¨æ”¯æŒå¤šçº¿ç¨‹åº”ç”¨ã€‚æ”¯æŒè®¾ç½®æœ€å¤§è¿æ¥æ•°ï¼ŒåŒæ—¶æ”¯æŒè®¾ç½®æ¯ä¸ªä¸»æœºçš„æœ€å¤§è¿æ¥æ•°ï¼Œå‘ç°å¹¶å…³é—­è¿‡æœŸçš„è¿æ¥ã€‚ è‡ªåŠ¨å¤„ç†Set-Cookieä¸­çš„Cookieã€‚ æ’ä»¶å¼çš„è‡ªå®šä¹‰Cookieç­–ç•¥ã€‚ Requestçš„è¾“å‡ºæµå¯ä»¥é¿å…æµä¸­å†…å®¹ç›´æ¥ç¼“å†²åˆ°socketæœåŠ¡å™¨ã€‚ Responseçš„è¾“å…¥æµå¯ä»¥æœ‰æ•ˆçš„ä»socketæœåŠ¡å™¨ç›´æ¥è¯»å–ç›¸åº”å†…å®¹ã€‚ åœ¨http1.0å’Œhttp1.1ä¸­åˆ©ç”¨KeepAliveä¿æŒæŒä¹…è¿æ¥ã€‚ ç›´æ¥è·å–æœåŠ¡å™¨å‘é€çš„response codeå’Œ headersã€‚ è®¾ç½®è¿æ¥è¶…æ—¶çš„èƒ½åŠ›ã€‚ å®éªŒæ€§çš„æ”¯æŒhttp1.1 response cachingã€‚ æºä»£ç åŸºäºApache License å¯å…è´¹è·å–ã€‚ 2. ä½¿ç”¨æ–¹æ³• ä¸‹é¢ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹HttpClientçš„ä½¿ç”¨æ–¹æ³•ã€‚
2.1 pom 1 &amp;lt;dependency&amp;gt; 2 &amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt; 3 &amp;lt;artifactId&amp;gt;httpclient&amp;lt;/artifactId&amp;gt; 4 &amp;lt;version&amp;gt;4.5.4&amp;lt;/version&amp;gt; 5 &amp;lt;/dependency&amp;gt; é¦–å…ˆå¼•å…¥ç›¸å…³çš„Mavenåº“ã€‚
2.2 ä»£ç  1String url = &amp;#34;http://www.baidu.com&amp;#34;; 2// 1. ä½¿ç”¨é»˜è®¤çš„é…ç½®çš„httpclient 3CloseableHttpClient client = HttpClients.createDefault(); 4// 2. ä½¿ç”¨GETæ–¹æ³• 5HttpGet httpGet = new HttpGet(url); 6InputStream inputStream = null; 7CloseableHttpResponse response = null; 8try { 9 //3.æ‰§è¡Œè¯·æ±‚ï¼Œè·å–å“åº” 10 response = client.execute(httpGet); 11 //çœ‹è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œè¿™å„¿æ‰“å°çš„æ˜¯httpçŠ¶æ€ç  12 System.out.println(response.getStatusLine().getStatusCode()); 13 14 //4.è·å–å“åº”çš„å®ä½“å†…å®¹ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¦æŠ“å–å¾—ç½‘é¡µå†…å®¹ 15 HttpEntity entity = response.getEntity(); 16 17 //5.å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ä¸Šé¢ 18 //æ–¹æ³•ä¸€ï¼šä½¿ç”¨EntityUtils 19 if (entity != null) { 20 System.out.println(EntityUtils.toString(entity, &amp;#34;utf-8&amp;#34;)); 21 } 22 EntityUtils.consume(entity); 23 24 //æ–¹æ³•äºŒï¼šä½¿ç”¨inputStreamï¼ˆä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼‰ 25 if (entity != null) { 26 inputStream = entity.getContent(); 27 28 BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream)); 29 String line = &amp;#34;&amp;#34;; 30 while ((line = bufferedReader.readLine()) != null) { 31 System.out.println(line); 32 33 } 34 } 35 36} catch (ClientProtocolException e) { 37 e.printStackTrace(); 38} catch (IOException e) { 39 e.printStackTrace(); 40} finally { 41 if (inputStream != null) { 42 try { 43 inputStream.close(); 44 } catch (IOException e) { 45 e.printStackTrace(); 46 } 47 } 48 if (response != null) { 49 try { 50 response.close(); 51 } catch (IOException e) { 52 e.printStackTrace(); 53 } 54 } 55} è¿™æ®µä»£ç çš„ç”¨é€”æ˜¯ä½¿ç”¨GETæ–¹æ³•è·å–ç™¾åº¦é¦–é¡µï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚
2.3 ä»£ç åˆ†æ ä½¿ç”¨HttpClientå‘é€è¯·æ±‚ã€æ¥æ”¶å“åº”å¾ˆç®€å•ï¼Œä¸€èˆ¬éœ€è¦å¦‚ä¸‹å‡ æ­¥å³å¯ã€‚
åˆ›å»ºHttpClientå¯¹è±¡ã€‚ ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯org.apache.http.impl.client.CloseableHtttpClientï¼Œå®ƒæ˜¯HttpClientæ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œåˆ›å»ºè¯¥å¯¹è±¡çš„æœ€ç®€å•æ–¹æ³•æ˜¯ï¼šCloseableHttpClient client = HttpClients.createDefault();ã€‚ HttpClientsæ˜¯åˆ›å»ºCloseableHttpClientçš„å·¥å‚ï¼Œé‡‡ç”¨é»˜è®¤çš„é…ç½®æ¥åˆ›å»ºå®ä¾‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å°±ç”¨è¿™ä¸ªé»˜è®¤å®ä¾‹å°±å¯ä»¥äº†ã€‚ä»¥åæˆ‘ä»¬ä¼šè®¨è®ºå¦‚ä½•è‡ªå®šä¹‰è¿™ä¸ªå¯¹è±¡ã€‚
åˆ›å»ºè¯·æ±‚æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶æŒ‡å®šè¯·æ±‚URLã€‚å¦‚æœéœ€è¦å‘é€GETè¯·æ±‚ï¼Œåˆ›å»ºHttpGetå¯¹è±¡ï¼›å¦‚æœéœ€è¦å‘é€POSTè¯·æ±‚ï¼Œåˆ›å»ºHttpPostå¯¹è±¡ã€‚ å…¶ä»–çš„ç±»å‹è¿˜æœ‰ï¼šHttpHead, HttpPut, HttpDelete, HttpTrace, HttpOptionsç­‰ã€‚åˆ†åˆ«å¯¹åº”ä¸åŒçš„Httpè¯·æ±‚æ–¹æ³•ï¼š
æ–¹æ³• æè¿° æ˜¯å¦åŒ…å«ä¸»ä½“ GET ä»æœåŠ¡å™¨è·å–ä¸€ä»½æ–‡æ¡£ å¦ HEAD åªä»æœåŠ¡å™¨è·å–æ–‡æ¡£çš„é¦–éƒ¨ å¦ POST å‘æœåŠ¡å™¨å‘é€éœ€è¦å¤„ç†çš„æ•°æ® æ˜¯ PUT å°†è¯·æ±‚çš„ä¸»ä½“éƒ¨åˆ†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Š æ˜¯ TRACE å¯¹å¯èƒ½ç»è¿‡ä»£ç†æœåŠ¡å™¨ä¼ é€åˆ°æœåŠ¡å™¨ä¸Šå»çš„æŠ¥æ–‡è¿›è¡Œè¿½è¸ª å¦ OPTIONS å†³å®šå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå“ªäº›æ–¹æ³• å¦ DELETE ä»æœåŠ¡å™¨ä¸Šåˆ é™¤ä¸€ä»½æ–‡æ¡£ å¦ å¦‚æœéœ€è¦å‘é€è¯·æ±‚å‚æ•°ï¼Œå¯è°ƒç”¨HttpGetã€HttpPostå…±åŒçš„setParams(HetpParams params)æ–¹æ³•æ¥æ·»åŠ è¯·æ±‚å‚æ•°ï¼›å¯¹äºHttpPostå¯¹è±¡è€Œè¨€ï¼Œä¹Ÿå¯è°ƒç”¨setEntity(HttpEntity entity)æ–¹æ³•æ¥è®¾ç½®è¯·æ±‚å‚æ•°ã€‚
è°ƒç”¨HttpClientå¯¹è±¡çš„execute(HttpUriRequest request)å‘é€è¯·æ±‚ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªCloseableHttpResponseã€‚
è°ƒç”¨HttpResponseçš„getAllHeaders()ã€getHeaders(String name)ç­‰æ–¹æ³•å¯è·å–æœåŠ¡å™¨çš„å“åº”å¤´ï¼›è°ƒç”¨HttpResponse getEntity()æ–¹æ³•å¯è·å–HttpEntityå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…è£…äº†æœåŠ¡å™¨çš„å“åº”å†…å®¹ã€‚å¯¹getEntityè·å–çš„ç»“æœï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼š æ–¹æ³•ä¸€ï¼šä½¿ç”¨EntityUtilså·¥å…·ç±»æ¥å¤„ç†ã€‚è¯¥ç±»æ˜¯å®˜æ–¹æä¾›çš„ä¸€ä¸ªå¤„ç†å®ä½“çš„å·¥å…·ç±»ï¼ŒtoStingæ–¹æ³•å°†è¿”å›çš„å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®˜ç½‘ä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªï¼Œé™¤éå“åº”å®ä½“ä»ä¸€ä¸ªå¯ä¿¡HTTPæœåŠ¡å™¨å‘èµ·å’Œå·²çŸ¥æ˜¯æœ‰é™é•¿åº¦çš„ã€‚ æ–¹æ³•äºŒï¼šä½¿ç”¨InputStreamæ¥è¯»å–ã€‚å› ä¸ºhttpEntity.getContentæ–¹æ³•è¿”å›çš„å°±æ˜¯InputStreamç±»å‹ã€‚è¿™ç§æ–¹æ³•æ˜¯å®˜ç½‘æ¨èçš„æ–¹å¼ï¼Œéœ€è¦è®°å¾—è¦è‡ªå·±é‡Šæ”¾åº•å±‚èµ„æºã€‚
é‡Šæ”¾è¿æ¥ã€‚æ— è®ºæ‰§è¡Œæ–¹æ³•æ˜¯å¦æˆåŠŸï¼Œéƒ½å¿…é¡»é‡Šæ”¾è¿æ¥ å¦‚æœä½¿ç”¨EntityUtilsæ¥å¤„ç†è¿”å›å€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨EntityUtils.consume(entity)æ¥é‡Šæ”¾èµ„æºã€‚
å¦‚æœä½¿ç”¨InputStreamæ¥å¤„ç†è¿”å›å€¼ï¼Œåˆ™è¦å…³é—­inputStreamç„¶åå…³é—­responseå¯¹è±¡å°±è¡Œäº†ã€‚
1if (inputStream != null) { 2 try { 3 inputStream.close(); 4 } catch (IOException e) { 5 e.printStackTrace(); 6 } 7} 8if (response != null) { 9 try { 10 response.close(); 11 } catch (IOException e) { 12 e.printStackTrace(); 13 } 14} 2.4 å…³äºèµ„æºé‡Šæ”¾ ä½¿ç”¨EntityUtils#consumeè¿™ä¸ªæ–¹æ³•ä¼šè‡ªåŠ¨å…³é—­åº•å±‚çš„inputStreamã€‚å¦‚æœä¸éœ€è¦è¯»å–å…¨éƒ¨çš„å®ä½“ï¼Œåˆ™å¯ä»¥ç›´æ¥å…³é—­responseï¼Œæ¥ç§æ¤å¯¹inputStreamçš„è¯»å–ã€‚æ³¨æ„ï¼šå…³é—­responseä¼šè‡ªåŠ¨å…³é—­å¯¹åº”çš„inputStreamã€‚
1CloseableHttpClient httpclient = HttpClients.createDefault(); 2HttpGet httpget = new HttpGet(&amp;#34;http://localhost/&amp;#34;); 3CloseableHttpResponse response = httpclient.execute(httpget); 4try { 5 HttpEntity entity = response.getEntity(); 6 if (entity != null) { 7 InputStream instream = entity.getContent(); 8 int byteOne = instream.read(); 9 int byteTwo = instream.read(); 10 // Do not need the rest 11 } 12} finally { 13 response.close(); // ç›´æ¥å…³é—­response 14} ä¸æ¨èä½¿ç”¨EntityUtils#toStringæ–¹æ³•ï¼Œå¦‚æœç¡®å®éœ€è¦ï¼Œæœ€å¥½å…ˆè‡ªå·±åˆ¤æ–­é•¿åº¦ï¼šentity.getContentLength()ã€‚è¿™æ˜¯å› ä¸ºtoStringæ–¹æ³•é»˜è®¤æœ€å¤§çš„é•¿åº¦æ˜¯Integer.MAX_VALUEï¼ˆ0x7fffffffï¼‰ã€‚è¿™ä¸ªé•¿åº¦å¤ªå¤§äº†ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚
å¦‚æœå¸Œæœ›é‡å¤ä½¿ç”¨Entityï¼Œå¯ä»¥ä½¿ç”¨ï¼šnew BufferedHttpEntity(entity)åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ç¼“å­˜èµ·æ¥ã€‚
2.5 Entity ç”¨äºç”Ÿæˆè¯·æ±‚çš„Entityçš„ç±»ä¸»è¦æœ‰å››ç§ï¼šStringEntity, ByteArrayEntity, InputStreamEntityå’ŒFileEntityã€‚ ä¾‹å­ï¼šFileEntityï¼š
1File file = new File(&amp;#34;somefile.txt&amp;#34;); 2FileEntity entity = new FileEntity(file, 3 ContentType.create(&amp;#34;text/plain&amp;#34;, &amp;#34;UTF-8&amp;#34;)); 4HttpPost httppost = new HttpPost(&amp;#34;http://localhost/action.do&amp;#34;); 5httppost.setEntity(entity); ä¾‹å­ï¼š
1List&amp;lt;NameValuePair&amp;gt; formparams = new ArrayList&amp;lt;NameValuePair&amp;gt;(); 2formparams.add(new BasicNameValuePair(&amp;#34;param1&amp;#34;, &amp;#34;value1&amp;#34;)); 3formparams.add(new BasicNameValuePair(&amp;#34;param2&amp;#34;, &amp;#34;value2&amp;#34;)); 4UrlEncodedFormEntity entity = new UrlEncodedFormEntity(formparams, Consts.UTF_8); 5HttpPost httppost = new HttpPost(&amp;#34;http://localhost/handler.do&amp;#34;); 6httppost.setEntity(entity); 3. å®ä¾‹ä»£ç  3.1 æ™®é€šGETè¯·æ±‚ 1// åˆ›å»ºHttpclientå¯¹è±¡ 2CloseableHttpClient httpclient = HttpClients.createDefault(); 3// åˆ›å»ºhttp GETè¯·æ±‚ 4HttpGet httpGet = new HttpGet(&amp;#34;http://www.baidu.com/s?wd=java&amp;#34;); 5CloseableHttpResponse response = null; 6try { 7 // æ‰§è¡Œè¯·æ±‚ 8 response = httpclient.execute(httpGet); 9 // åˆ¤æ–­è¿”å›çŠ¶æ€æ˜¯å¦ä¸º200 10 if (response.getStatusLine().getStatusCode() == 200) { 11 ... 12 } 13} 3.2 å¸¦æœ‰å‚æ•°çš„Getè¯·æ±‚ 1// å®šä¹‰è¯·æ±‚çš„å‚æ•° 2URI uri = new URIBuilder(&amp;#34;http://www.baidu.com/s&amp;#34;).setParameter(&amp;#34;wd&amp;#34;, &amp;#34;java&amp;#34;).build(); 3// åˆ›å»ºhttp GETè¯·æ±‚ 4HttpGet httpGet = new HttpGet(uri); 3.3 æ™®é€šçš„POSTè¯·æ±‚ 1// åˆ›å»ºhttp POSTè¯·æ±‚ 2HttpPost httpPost = new HttpPost(&amp;#34;http://www.oschina.net/&amp;#34;); 3 // ä¼ªè£…æµè§ˆå™¨è¯·æ±‚ 4httpPost.setHeader(&amp;#34;User-Agent&amp;#34;, 5 &amp;#34;Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36&amp;#34;); 6// æ‰§è¡Œè¯·æ±‚ 7response = httpclient.execute(httpPost); 3.4 å¸¦æœ‰å‚æ•°çš„Postè¯·æ±‚ 1// åˆ›å»ºhttp POSTè¯·æ±‚ 2HttpPost httpPost = new HttpPost(&amp;#34;http://www.oschina.net/search&amp;#34;); 3 4// è®¾ç½®2ä¸ªpostå‚æ•°ï¼Œä¸€ä¸ªæ˜¯scopeã€ä¸€ä¸ªæ˜¯q 5List&amp;lt;NameValuePair&amp;gt; parameters = new ArrayList&amp;lt;NameValuePair&amp;gt;(); 6parameters.add(new BasicNameValuePair(&amp;#34;scope&amp;#34;, &amp;#34;project&amp;#34;)); 7parameters.add(new BasicNameValuePair(&amp;#34;q&amp;#34;, &amp;#34;java&amp;#34;)); 8// æ„é€ ä¸€ä¸ªformè¡¨å•å¼çš„å®ä½“ 9UrlEncodedFormEntity formEntity = new UrlEncodedFormEntity(parameters); 10// å°†è¯·æ±‚å®ä½“è®¾ç½®åˆ°httpPostå¯¹è±¡ä¸­ 11httpPost.setEntity(formEntity); 12// ä¼ªè£…æµè§ˆå™¨è¯·æ±‚ 13httpPost.setHeader( 14 &amp;#34;User-Agent&amp;#34;, 15 &amp;#34;Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36&amp;#34;); 16 17// æ‰§è¡Œè¯·æ±‚ 18response = httpclient.execute(httpPost); 3.5 é…ç½®è¶…æ—¶æ—¶é—´ç­‰ 1// åˆ›å»ºhttp GETè¯·æ±‚ 2HttpGet httpGet = new HttpGet(&amp;#34;http://www.baidu.com/&amp;#34;); 3 4// æ„å»ºè¯·æ±‚é…ç½®ä¿¡æ¯ 5RequestConfig config = RequestConfig.custom() 6 .setConnectTimeout(1000) // åˆ›å»ºè¿æ¥çš„æœ€é•¿æ—¶é—´ 7 .setConnectionRequestTimeout(500) // ä»è¿æ¥æ± ä¸­è·å–åˆ°è¿æ¥çš„æœ€é•¿æ—¶é—´ 8 .setSocketTimeout(10 * 1000) // æ•°æ®ä¼ è¾“çš„æœ€é•¿æ—¶é—´ 9 .setStaleConnectionCheckEnabled(true) // æäº¤è¯·æ±‚å‰æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨ 10 .build(); 11// è®¾ç½®è¯·æ±‚é…ç½®ä¿¡æ¯ 12httpGet.setConfig(config); å‡ ä¸ªå‡½æ•°çš„å«ä¹‰ï¼š
setConnectionRequestTimeout ä»é“¾æ¥æ± è·å–ä¸€ä¸ªè¿æ¥çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼› setConnectTimeout åˆ›å»ºé“¾æ¥çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼› setSocketTimeout è·å–æ•°æ®çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼› setStaleConnectionCheckEnabled æ£€æŸ¥é“¾æ¥çŠ¶æ€æ˜¯å¦å¯ç”¨ã€‚è¿™ä¸ªé€‰é¡¹ä¼šèŠ±è´¹æœ€é•¿30msæ—¶é—´å·²ç¡®å®šä¸€ä¸ªè¿æ¥æ˜¯å¦å¯ç”¨ã€‚å¯¹æ€§èƒ½è¦æ±‚é«˜çš„åº”ç”¨ä¸è¦å¼€å¯è¿™ä¸ªé€‰é¡¹ã€‚ </content>
    </entry>
    
     <entry>
        <title>Apache HttpClient ä½¿ç”¨ï¼ˆä¸‹ï¼‰</title>
        <url>https://orchidflower.github.io/2018/04/23/Apache-HttpClient-Manual-Part2/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>HttpClient</tag>
        </tags>
        <content type="html"> 4. é“¾æ¥æ±  é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PoolingHttpClientConnectionManageræ¥åˆ›å»ºä¸€ä¸ªé“¾æ¥æ± ã€‚
4.1 å¯¹äºé“¾æ¥æ± çš„ç®¡ç† 1PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager(); 2// è®¾ç½®æœ€å¤§è¿æ¥æ•° 3cm.setMaxTotal(200); 4// è®¾ç½®æ¯ä¸ªä¸»æœºåœ°å€çš„å¹¶å‘æ•° 5cm.setDefaultMaxPerRoute(20); 6// é€šè¿‡PoolingHttpClientConnectionManagerï¼Œæ¥è·å–CloseableHttpClient 7CloseableHttpClient httpClient = HttpClients.custom().setConnectionManager(cm).build(); 8 9// åˆ›å»ºhttp GETè¯·æ±‚ 10HttpGet httpGet = new HttpGet(&amp;#34;http://www.baidu.com/&amp;#34;); 11// æ‰§è¡Œè¯·æ±‚ 12response = httpClient.execute(httpGet); 4.2 å…³é—­é“¾æ¥æ± ä¸­å¤±æ•ˆçš„é“¾æ¥ 1import org.apache.http.conn.HttpClientConnectionManager; 2import org.apache.http.impl.conn.PoolingHttpClientConnectionManager; 3 4//å…³é—­è¿æ¥æ± çš„æ— æ•ˆé“¾æ¥ 5public class ClientEvictExpiredConnections { 6 7 public static void main(String[] args) throws Exception { 8 PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager(); 9 // è®¾ç½®æœ€å¤§è¿æ¥æ•° 10 cm.setMaxTotal(200); 11 // è®¾ç½®æ¯ä¸ªä¸»æœºåœ°å€çš„å¹¶å‘æ•° 12 cm.setDefaultMaxPerRoute(20); 13 // å¼€å¯çº¿ç¨‹ç”¨äºå…³é—­å¤±æ•ˆçš„é“¾æ¥ 14 new IdleConnectionEvictor(cm).start(); 15 } 16 17 public static class IdleConnectionEvictor extends Thread { 18 private final HttpClientConnectionManager connMgr; 19 private volatile boolean shutdown; 20 21 public IdleConnectionEvictor(HttpClientConnectionManager connMgr) { 22 this.connMgr = connMgr; 23 } 24 25 @Override 26 public void run() { 27 try { 28 while (!shutdown) { 29 synchronized (this) { 30 wait(5000); // æ¯éš”5ç§’æ‰§è¡Œä¸€ä¸ªï¼Œå…³é—­å¤±æ•ˆçš„httpè¿æ¥ 31 connMgr.closeExpiredConnections(); // å…³é—­å¤±æ•ˆé“¾æ¥ 32 connMgr.closeIdleConnections(30, TimeUnit.SECONDS); // å…³é—­ç©ºé—²é“¾æ¥ 33 } 34 } 35 } catch (InterruptedException ex) { 36 // ç»“æŸ 37 shutdown(); 38 } 39 } 40 41 public void shutdown() { 42 shutdown = true; 43 synchronized (this) { 44 notifyAll(); 45 } 46 } 47 } 48} 4.4 å…³é—­ ä¸€ä¸ªè¿æ¥å¯ä»¥ä¼˜é›…çš„å…³é—­ï¼šæ¸…ç©ºå‘é€ç¼“å†²åŒºç„¶åå†è¿›è¡Œå…³é—­ã€‚ä¹Ÿå¯ä»¥å¼ºåˆ¶å…³é—­ï¼Œé€šè¿‡è°ƒç”¨shutdownæ–¹æ³•ï¼Œæ­¤æ—¶å‘é€ç¼“å†²åŒºä¸ä¼šè¢«æ¸…ç©ºã€‚ è¦å…³é—­ä¸€ä¸ªæœºé‡Poolingçš„HttpClientï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ï¼š
æ¶ˆè´¹å¹¶å…³é—­è¿”å›çš„responseå¯¹è±¡ å…³é—­HttpClient å…³é—­Connection Manager ä¾‹å¦‚ï¼š
1connManager = new PoolingHttpClientConnectionManager(); 2CloseableHttpClient client = HttpClients.custom().setConnectionManager(connManager).build(); 3HttpGet get = new HttpGet(&amp;#34;http://google.com&amp;#34;); 4CloseableHttpResponse response = client.execute(get); 5 6EntityUtils.consume(response.getEntity()); 7response.close(); 8client.close(); 9connManager.close(); // å…³é—­é“¾æ¥æ±  å¦‚æœç›´æ¥å…³é—­connManagerï¼Œé‚£æ‰€æœ‰ç›¸å…³çš„é“¾æ¥éƒ½ä¼šè¢«å…³é—­ï¼Œèµ„æºä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œä½†æ˜¯å‘é€ç¼“å†²åŒºä¸ä¼šè¢«æ¸…ç©ºï¼ˆflushï¼‰ã€‚
5. è®¿é—®åŒå‘SSLä¿æŠ¤çš„èµ„æº 1	public static HttpClientConnectionManager CONNECTION_MANAGER = null; 2	3	public void init(String keyStoreFile, String keyStorePass, 4	String trustStoreFile, String trustStorePass) throws Exception { 5	System.out.println(&amp;#34;init conection pool...&amp;#34;); 6 7	InputStream ksis = new FileInputStream(new File(keyStoreFile)); 8	InputStream tsis = new FileInputStream(new File(trustStoreFile)); 9 10	KeyStore ks = KeyStore.getInstance(&amp;#34;PKCS12&amp;#34;); 11	ks.load(ksis, keyStorePass.toCharArray()); 12 13	KeyStore ts = KeyStore.getInstance(&amp;#34;JKS&amp;#34;); 14	ts.load(tsis, trustStorePass.toCharArray()); 15 16 // init SSLContext with keystore, truststore 17	SSLContext sslContext = SSLContexts.custom() 18	.loadKeyMaterial(ks, keyStorePass.toCharArray()) 19	.loadTrustMaterial(ts, new TrustSelfSignedStrategy()).build(); 20 21	// init SSLConnectionSocketFactory 22	SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(sslContext, 23 new String[] { &amp;#34;TLSv1&amp;#34; }, 24 null, 25 NoopHostnameVerifier.INSTANCE); // not check common name 26 27	Registry&amp;lt;ConnectionSocketFactory&amp;gt; registry = RegistryBuilder 28	.&amp;lt;ConnectionSocketFactory&amp;gt; create() 29	.register(&amp;#34;http&amp;#34;, PlainConnectionSocketFactory.INSTANCE) 30	.register(&amp;#34;https&amp;#34;, sslsf).build(); 31	ksis.close(); 32	tsis.close(); 33	CONNECTION_MANAGER = new PoolingHttpClientConnectionManager(registry); 34	} 35	36	public String doPost(String url, String params) throws Exception { 37	if (CONNECTION_MANAGER == null) { 38	return null; 39	} 40	CloseableHttpClient httpClient = HttpClients.custom() 41	.setConnectionManager(CONNECTION_MANAGER).build(); 42	HttpPost httpPost = new HttpPost(url); 43 44	httpPost.setEntity(new StringEntity(params, 45	ContentType.APPLICATION_JSON)); 46 47	CloseableHttpResponse resp = httpClient.execute(httpPost); 48	System.out.println(resp.getStatusLine()); 49	InputStream respIs = resp.getEntity().getContent(); 50	String content = convertStreamToString(respIs); 51	EntityUtils.consume(resp.getEntity()); 52	return content; 53	}	54	55	// Get data from InputStream 56	public static String convertStreamToString(InputStream is) { 57	BufferedReader reader = new BufferedReader(new InputStreamReader(is)); 58	StringBuilder sb = new StringBuilder(); 59 60	String line = null; 61	try { 62	while ((line = reader.readLine()) != null) { 63	sb.append(line &#43; &amp;#34;\n&amp;#34;); 64	} 65	} catch (IOException e) { 66	e.printStackTrace(); 67	} finally { 68	try { 69	is.close(); 70	} catch (IOException e) { 71	e.printStackTrace(); 72	} 73	} 74	return sb.toString(); 75	}	ä¸Šé¢çš„ä»£ç é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªPoolingHttpClientConnectionManagerï¼Œç„¶åå®šä¹‰äº†sendPostæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å‘é€Postè¯·æ±‚ã€‚
é™„å½•ã€å‚è€ƒèµ„æ–™ Apache HttpClient Overview HttpClient Tutorial HttpClient Connection Management HttpClient4.3.xä½¿ç”¨-åŸºç¡€ç¯‡ </content>
    </entry>
    
     <entry>
        <title>Springåº”ç”¨å› Session Timeoutè®¾ç½®å¼•èµ·çš„GCé—®é¢˜</title>
        <url>https://orchidflower.github.io/2017/08/29/Spring-Session-Timeout-caused-GC-failure/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>Spring</tag>
        </tags>
        <content type="html"> æœ€è¿‘åœ¨å®¢æˆ·çš„è¦æ±‚ä¸‹ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œäº†å‹æµ‹ã€‚è‡ªå·±å‹æµ‹çš„æ—¶å€™ä¸€åˆ‡æŒ‡æ ‡éƒ½æŒºæ­£å¸¸ã€‚ä½†æ˜¯å®¢æˆ·å´åé¦ˆè¯´å‹æµ‹çš„æ—¶å€™æœ‰æ—¶å€™ä¼šç¢°åˆ°æ€§èƒ½è¡°å‡å¾ˆå‰å®³ï¼Œä¸ç¨³å®šã€‚äºæ˜¯æœ‰äº†ä¸‹é¢è¿™æ¬¡çš„æ’æŸ¥è¿‡ç¨‹ã€‚å®¢æˆ·åé¦ˆè¯´é—®é¢˜æ˜¯å‘ç”Ÿåœ¨å¤šæ¬¡è¿ç»­å‹æµ‹ä¹‹åç¢°åˆ°çš„ï¼Œæ‰€ä»¥è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æµ‹è¯•ã€‚
å…ˆè¯´ä¸€ä¸‹æµ‹è¯•ç¯å¢ƒçš„ä¸€äº›ä¿¡æ¯ï¼šæµ‹è¯•ä¸»æœºæ˜¯é˜¿é‡Œäº‘çš„ECSï¼Œé…ç½®æ˜¯2C &#43; 16Gã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæ•°æ®åº“é‡‡ç”¨çš„æ˜¯Dockeræ­å»ºçš„ï¼Œç‰ˆæœ¬æ˜¯5.6.Xã€‚å¦å¤–ï¼Œè¿™å°æœºå™¨ä¸Šè¿˜å®‰è£…äº†Zookeeper 3.4.X å’ŒKafka 1.0ã€‚ç³»ç»Ÿæœ¬èº«æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Spring &#43; CXFçš„åº”ç”¨ï¼Œæä¾›ç»™å®¢æˆ·ä½¿ç”¨çš„æœåŠ¡æ˜¯æ ‡å‡†çš„Restfulæ¥å£ã€‚
1. é‡ç°é—®é¢˜ å› ä¸ºå®¢æˆ·åé¦ˆæ˜¯å¤šæ¬¡å‹æµ‹ä¹‹åç¢°åˆ°çš„ï¼Œå› æ­¤é¦–å…ˆå°è¯•è¿ç»­å‹æµ‹å¤šæ¬¡çœ‹çœ‹èƒ½ä¸èƒ½é‡ç°é—®é¢˜ã€‚ä¸ºäº†å¯èƒ½å­˜åœ¨çš„æ•°æ®åº“æ€§èƒ½é—®é¢˜ï¼Œä¸´æ—¶ç”³è¯·äº†RDSä½œä¸ºæ•°æ®åº“ï¼›å¦å¤–ä¸ºäº†å°½å¿«å‘ç°é—®é¢˜ï¼Œå°†ç¨‹åºå ç”¨å†…å­˜ç¼©å°åˆ°1Gã€‚è¿™æ¬¡æµ‹è¯•æµ‹å‡ºäº†å®¢æˆ·æ‰€è¯´çš„é—®é¢˜ï¼Œé€šè¿‡jconsoleç›‘æ§ä¹Ÿå‘ç°äº†é—®é¢˜åŸå› ï¼Œåº”è¯¥æ˜¯å› ä¸ºGCå¯¼è‡´çš„ã€‚
çœ‹å›¾è¡¨å¯ä»¥å‘ç°ï¼Œå‹æµ‹5~6åˆ†é’Ÿä¹‹åï¼ŒJavaçš„GCå ç”¨äº†å¤§é‡çš„CPUæ—¶é—´ï¼ˆå·¦ä¸Šå›¾ä¸­çš„è“è‰²çº¿ï¼‰ï¼Œè€Œä¸”å†…å­˜å ç”¨ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼ˆå³ä¸Šå›¾ï¼‰ã€‚
2. è°ƒæ•´å†…å­˜ä½¿ç”¨é‡ æŠŠå†…å­˜å ç”¨è°ƒæ•´åˆ°2Gï¼Œå‘ç°é—®é¢˜è¿˜æ˜¯åŒæ ·å­˜åœ¨ï¼Œåªæ˜¯å‡ºç°é—®é¢˜çš„æ—¶é—´æ™šäº†ï¼Œå‹æµ‹å¼€å§‹15åˆ†é’Ÿä¹‹åæ‰ä¼šå‡ºç°é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´é—®é¢˜æ˜¯åŒæ ·å­˜åœ¨çš„ï¼Œåªæ˜¯å†…å­˜å¤§äº†ä¹‹åï¼ŒæŠŠå‡ºç°é—®é¢˜çš„æ—¶é—´æ‹–åäº†è€Œå·²ã€‚
3. é—®é¢˜æ ¹æº é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å‘ç°äº†é—®é¢˜æ˜¯GCå¯¼è‡´çš„ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿä¸­æœ‰äº›å†…å­˜æ— æ³•ç»™GCå›æ”¶ï¼Œå½“å†…å­˜è¾¾åˆ°Javaè™šæ‹Ÿæœºå¯ä»¥ç”³è¯·çš„ä¸Šé™çš„æ—¶å€™ï¼Œä¼šå‡ºç°é¢‘ç¹çš„GCæ“ä½œï¼Œä»è€Œå¯¼è‡´GCæ“ä½œå ç”¨å¤§é‡CPUæ—¶é—´ï¼Œå¿…ç„¶å¯¼è‡´ç³»ç»Ÿæœ¬èº«çš„TPSä¸‹é™ã€‚
é€šè¿‡åˆ†ædumpæ–‡ä»¶ï¼Œä»¥åŠä¸Šç½‘æœç´¢ï¼Œæœ€ç»ˆç¡®è®¤é—®é¢˜å¯èƒ½å‡ºç°åœ¨Sessionè¶…æ—¶æ—¶é—´è®¾ç½®ä¸Šï¼š åœ¨Java Webå¼€å‘ä¸­ï¼ŒSessionä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šæ–¹ä¾¿ï¼ŒSessionæ˜¯ç”±æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ç»´æŠ¤çš„ã€‚Sessionè¶…æ—¶ç†è§£ä¸ºï¼šæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´åˆ›å»ºäº†ä¸€ä¸ªSessionï¼Œç”±äºå®¢æˆ·ç«¯é•¿æ—¶é—´ï¼ˆä¼‘çœ æ—¶é—´ï¼‰æ²¡æœ‰ä¸æœåŠ¡å™¨äº¤äº’ï¼ŒæœåŠ¡å™¨å°†æ­¤Sessioné”€æ¯ï¼Œå®¢æˆ·ç«¯å†ä¸€æ¬¡ä¸æœåŠ¡å™¨äº¤äº’æ—¶ä¹‹å‰çš„Sessionå°±ä¸å­˜åœ¨äº†ã€‚
è¿™ä¸ªSessioné•¿çŸ­æ˜¯å¯ä»¥è®¾ç½®çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»€ä¹ˆä¹Ÿä¸è®¾ç½®çš„è¯Sessionè¶…æ—¶æ—¶é—´æ˜¯30åˆ†é’Ÿã€‚è®¾ç½®æ–¹æ³•æ˜¯ä¿®æ”¹é¡¹ç›®ä¸­çš„web.xmlï¼Œå¦‚ä¸‹é¢çš„é…ç½®æ˜¯è®¾ç½®sessionæ—¶é—´ä¸º1åˆ†é’Ÿï¼š
1 &amp;lt;session-config&amp;gt; 2 &amp;lt;session-timeout&amp;gt;1&amp;lt;/session-timeout&amp;gt; 3 &amp;lt;/session-config&amp;gt; ä¹‹å‰é¡¹ç›®ä¸­éƒ½æ²¡æœ‰å¯¹sessionæ—¶é—´è¿›è¡Œè®¾ç½®ï¼Œå› æ­¤ä¼šæœ‰å¤§é‡çš„sessionä¿¡æ¯è¢«ç¼“å­˜ï¼Œä¸åˆ°æ—¶é—´æ˜¯æ— æ³•GCçš„ã€‚è€Œé¡¹ç›®æœ¬èº«çš„æœåŠ¡æ˜¯ä¸ä¾èµ–äºsessionçš„ï¼Œå®Œå…¨å¯ä»¥å°†sessionæ—¶é—´è®¾ç½®çš„æ›´çŸ­ä¸€äº›ã€‚
4. è°ƒæ•´sessionæ—¶é—´ä¸º1åˆ†é’Ÿ è¿™ä¸€è½®æµ‹è¯•åŸºæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š
æ•°æ®åº“ä½¿ç”¨RDS å†…å­˜å ç”¨ä½¿ç”¨2G Sessionè®¾ç½®ä¸º1åˆ†é’Ÿ å‹æµ‹ç»“æœå¦‚ä¸‹ï¼š è¿™æ¬¡æ€»å…±å‹æµ‹äº†30åˆ†é’Ÿï¼ŒGCå ç”¨çš„CPUæ—¶é—´ä¹Ÿéå¸¸å°‘ï¼Œå†…å­˜ä¹Ÿè¡¨ç°è‰¯å¥½ï¼Œå¯ä»¥æ­£å¸¸GCå›æ”¶ã€‚
æ€§èƒ½è¡¨ç°ä¸€ç›´ç¨³å®šã€‚
5. æ•°æ®åº“åˆ‡æ¢å›Docker ä¸Šä¸€è½®æµ‹è¯•ç»“æœç»™äº†å¾ˆå¤§çš„ä¿¡å¿ƒï¼Œå› æ­¤å†³å®šæŠŠæ•°æ®åº“åˆ‡æ¢ä¸ºæœ¬æœºçš„Dockerä¸­çš„MySQLï¼Œå…¶ä»–çš„ä¸å˜ï¼š
GCè¡¨ç°æ­£å¸¸ï¼Œå†…å­˜ä¹Ÿå›æ”¶è‰¯å¥½ã€‚
TPSé™ä½äº†ä¸å°‘ï¼Œä¹‹å‰æ˜¯1700&#43;ï¼Œè¿™æ¬¡åªæœ‰1250&#43;äº†ã€‚è¿™ä¸ªä¸€æ–¹é¢æ˜¯æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨ä¸€å°ä¸»æœºä¸Šå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå¦ä¸€æ–¹é¢åº”è¯¥æ˜¯Dockeræœ¬èº«å¸¦æ¥äº†ä¸€äº›æŸè€—ã€‚
6. è°ƒæ•´ä¸º1Gå†…å­˜ å†æŠŠå†…å­˜è°ƒæ•´ä¸º1Gï¼Œå†æµ‹è¯•ä¸€æ¬¡ã€‚
GCå ç”¨æ—¶é—´ç•¥æœ‰ä¸Šå‡ï¼Œä½†æ˜¯æ€»ä½“è¿˜æ˜¯å¾ˆç¨³å®šã€‚
7. ç»“è®º å¦‚æœä½ çš„ç³»ç»Ÿæœ¬èº«ä¸ä¾èµ–äºWebçš„Sessionæœºåˆ¶ï¼Œè¯·æŠŠSessionæ—¶é—´è°ƒå°ä¸€äº›ï¼Œè¿™æ ·åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼ŒGCæ‰èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚
é™„å½•A. å‚è€ƒèµ„æ–™ How to enable session and set session timeout in Spring Security Sessionçš„æœ‰æ•ˆæœŸè®¾ç½® Possible Spring Boot or Spring Security Memory Leak server.sessionTimeout default #2084 </content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨Dockerè¿è¡ŒJenkinsï¼ˆäºŒï¼‰</title>
        <url>https://orchidflower.github.io/2017/08/20/Use-Webhook-between-Gogs-and-Jenkins/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Docker</tag><tag>Jenkins</tag><tag>Gogs</tag><tag>Gitea</tag>
        </tags>
        <content type="html"> Gitea æ˜¯ä¸€æ¬¾ææ˜“æ­å»ºçš„è‡ªåŠ© Git æœåŠ¡ï¼Œæœ€åˆæ˜¯forkå­Gogsé¡¹ç›®ï¼ˆGogs çš„ç›®æ ‡æ˜¯æ‰“é€ ä¸€ä¸ªæœ€ç®€å•ã€æœ€å¿«é€Ÿå’Œæœ€è½»æ¾çš„æ–¹å¼æ­å»ºè‡ªåŠ© Git æœåŠ¡ï¼‰ã€‚Giteaä½¿ç”¨ Go è¯­è¨€å¼€å‘ã€‚ä½¿ç”¨ Go è¯­è¨€å¼€å‘ä½¿å¾— Gitea èƒ½å¤Ÿé€šè¿‡ç‹¬ç«‹çš„äºŒè¿›åˆ¶åˆ†å‘ï¼Œå¹¶ä¸”æ”¯æŒ Go è¯­è¨€æ”¯æŒçš„ æ‰€æœ‰å¹³å°ï¼ŒåŒ…æ‹¬ Linuxã€Mac OS Xã€Windows ä»¥åŠ ARM å¹³å°ã€‚
Giteaå ç”¨èµ„æºå°ï¼Œæ¯”èµ·Gitlabè¿™ç§åºç„¶å¤§ç‰©æ¥è¯´ç®€ç›´æ˜¯ç²¾è‡´å¾—è¦å‘½ã€‚ä½†æ˜¯ä½œä¸ºå°å›¢é˜Ÿçš„é¡¹ç›®ç®¡ç†ç”¨æ¥æ›¿ä»£Gitlabè¿˜æ˜¯åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„ã€‚è€Œä¸”Giteaï¼ˆåŒ…æ‹¬Gogsï¼‰ç¤¾åŒºè¿˜æ˜¯æŒºæ´»è·ƒçš„ï¼Œæ–°åŠŸèƒ½ä¹Ÿåœ¨é€æ¸å¢åŠ ä¸­ï¼Œä¸ªäººå¾ˆçœ‹å¥½å®ƒçš„å‰æ™¯ã€‚
1. æ€ä¹ˆè¿è¡ŒGitea 1.1 ä½¿ç”¨Dockerè¿è¡Œmysql 1version: &amp;#39;2&amp;#39; 2services: 3 mysql: 4 image: mysql:5.7.18 5 volumes: 6 - /opt/docker/gitbox/db:/var/lib/mysql 7 - /opt/docker/gitbox/config:/etc/mysql/conf.d 8 environment: 9 - TZ=Asia/Shanghai 10 - MYSQL_ROOT_PASSWORD=password 11 command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci 12 ports: 13 - 3307:3306 14 hostname: mysql 15 restart: unless-stopped Giteaæ”¯æŒMySQLã€PostgreSQLæˆ–SQliteï¼Œä¸Šé¢æ˜¯ä»¥MySQLä¸ºä¾‹ã€‚ä¹Ÿå¯ä»¥å®‰è£…å…¶ä»–æ•°æ®åº“ã€‚
1.2 åˆ›å»ºæ•°æ®åº“ ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„rootç”¨æˆ·ç™»å½•mysqlï¼Œåˆ›å»ºæ•°æ®åº“ï¼š
1DROP DATABASE IF EXISTS gogs; 2CREATE DATABASE IF NOT EXISTS gogs CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci; 1.3 å®‰è£…Gitea 1version: &amp;#39;2&amp;#39; 2services: 3 gogs: 4 image: gitea/gitea:1.4.0-rc2 5 volumes: 6 - /etc/localtime:/etc/localtime 7 - /opt/docker/gogs/data:/data 8 - /opt/docker/gogs/logs:/app/gogs/log 9 ports: 10 - &amp;#34;10080:3000&amp;#34; 11 - &amp;#34;10022:22&amp;#34; 12 hostname: gogs é€šè¿‡volumeé…ç½®ï¼Œå¯ä»¥å°†logä»¥åŠrepositoryç­‰æ•°æ®ä¿å­˜åˆ°å®¿ä¸»æœºä¸Šã€‚
1.4 é…ç½® ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œä¼šè‡ªåŠ¨è·³å…¥è®¾ç½®ç•Œé¢ã€‚é…ç½®å¥½æ•°æ®åº“ï¼Œåšå¥½å¿…è¦çš„é…ç½®Gogså°±å®‰è£…å¥½äº†ã€‚
2. Webhookçš„ä½¿ç”¨ åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘è¿˜ä¸ä¼šä½¿ç”¨Jenkinsä¸­çš„Gitea pluginï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä½¿ç”¨äº†Gogsçš„pluginã€‚
2.1 Jenkinsä¸­å®‰è£…æ’ä»¶ Gogs pluginã€‚å®‰è£…è¿™ä¸ªæ’ä»¶ä¹‹åå°±å¯ä»¥ä½¿ç”¨Gogsç±»å‹çš„Webhookäº†ã€‚
2.2 é¡¹ç›®é…ç½® åœ¨Jenkinsä¸­é’ˆå¯¹è¦å¯ç”¨Webhookçš„é¡¹ç›®é€‰æ‹©&amp;quot;Use Gogs Secret&amp;quot;ï¼Œè®¾ç½®ä¸€ä¸ªSecretã€‚è¿™ä¸ªSecretå°†ä¿è¯é€šè®¯ä¸­çš„æ•°æ®å®‰å…¨ã€‚
2.3 Giteaä¸­é…ç½® åœ¨Giteaä¸­ä»“åº“è®¾ç½® -&amp;gt; ç®¡ç†Webé’©å­ï¼Œé€‰æ‹©æ·»åŠ ä¸€ä¸ªGogsç±»å‹çš„Webhookï¼Œå…¶ä»–å‚æ•°å¦‚ä¸‹ï¼š
æ¨é€åœ°å€ä¸ºï¼š{jenkins-server-address}/gogs-webhook/?job={job name} æ•°æ®æ ¼å¼ä¸ºï¼šapplication/json å¯†é’¥æ–‡æœ¬è®¾ç½®ä¸ºä¸Šé¢çš„Secretã€‚ å¸Œæœ›è§¦å‘Webé’©å­çš„äº‹ä»¶ï¼šåªæ¨é€å³å¯ã€‚ ç»è¿‡ä»¥ä¸Šé…ç½®ä¹‹åï¼Œå½“æ¨é€äº†æœ€æ–°ä»£ç çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘Jenkinsä¸­çš„æ„å»ºäº‹ä»¶ï¼Œå¯¹ä»£ç è¿›è¡Œæ‰“åŒ…æµ‹è¯•ã€‚
</content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨Dockerè¿è¡ŒJenkinsæœåŠ¡ï¼ˆä¸€ï¼‰</title>
        <url>https://orchidflower.github.io/2017/08/13/How-to-setup-Jenkins-in-Docker/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Jenkins</tag><tag>Docker</tag>
        </tags>
        <content type="html"> 1. Jenkinsæ˜¯ä»€ä¹ˆï¼Ÿ æŸç™¾ç§‘çš„è§£é‡Šæ˜¯ï¼š
Jenkinsæ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·ï¼Œç”¨äºç›‘æ§æŒç»­é‡å¤çš„å·¥ä½œï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¼€æ”¾æ˜“ç”¨çš„è½¯ä»¶å¹³å°ï¼Œä½¿è½¯ä»¶çš„æŒç»­é›†æˆå˜æˆå¯èƒ½ã€‚
è¿™ä¸ªè§£é‡Šå¤§ä½“ä¸Šæ˜¯é è°±çš„ï¼ŒJenkinsçš„æ ¸å¿ƒä½œç”¨å°±æ˜¯ä¸€ä¸ªCIï¼ˆæŒç»­é›†æˆï¼‰å·¥å…·ã€‚CIçš„æ¦‚å¿µæ˜¯ï¼šæŒç»­é›†æˆæŒ‡çš„æ˜¯ï¼Œé¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ã€‚æŒç»­é›†æˆçš„ç›®çš„ï¼Œå°±æ˜¯è®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒé«˜è´¨é‡ã€‚å®ƒçš„æ ¸å¿ƒæªæ–½æ˜¯ï¼Œä»£ç é›†æˆåˆ°ä¸»å¹²ä¹‹å‰ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼Œå°±ä¸èƒ½é›†æˆã€‚è€ŒJenkinsèƒ½å¤Ÿå®Œæˆè¿™äº›è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•çš„å¤§éƒ¨åˆ†å·¥ä½œã€‚
Jenkinsçš„å‰èº«æ˜¯Hudsonã€‚è¿™å…¶ä¸­çš„æ¸Šæºæ¶‰åŠåˆ°Oracleæ”¶è´­Javaå¼•èµ·çš„ç‰ˆæƒçº·äº‰ã€‚æœ‰å…´è¶£çš„å¯ä»¥çœ‹é™„å½•é‡Œé¢çš„ç›¸å…³é“¾æ¥ã€‚
2. ä¸ºä»€ä¹ˆç”¨Docker ä¸ºä»€ä¹ˆç”¨Dockerè¿è¡ŒJenkinsï¼Ÿä¸ªäººæ„Ÿè§‰Dockeré€šè¿‡é•œåƒå°è£…ï¼Œå¯ä»¥å±è”½å¤§é‡çš„æ­å»ºè¿ç»´ç¯å¢ƒçš„çç¢æ“ä½œã€‚è¿ç»´äººå‘˜å¯ä»¥å°†Jenkinsçœ‹æˆä¸€ä¸ªç‹¬ç«‹è½¯ä»¶ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…¶ä¸­çš„ç»†èŠ‚ï¼Œä¾‹å¦‚Javaè¿è¡Œç¯å¢ƒæ€ä¹ˆé…ç½®ã€Jenkinsç›®å½•æ”¾åœ¨å“ªå„¿ç­‰ç­‰é—®é¢˜ã€‚ä½¿ç”¨Dockerå¯ä»¥ç®€å•çš„é…ç½®å‡ ä¸ªè¿è¡Œå‚æ•°ï¼Œå°±å¯ä»¥è¿…é€Ÿçš„å¯ç”¨Jenkinsï¼Œå¤§å¤§é™ä½äº†æ­å»ºçš„éš¾åº¦ã€‚
3. æ­å»ºç›®æ ‡ æ ¹æ®ç›®å‰é¡¹ç›®çš„éœ€æ±‚ï¼Œæ­å»ºè¿™ä¸ªJenkinsç¯å¢ƒéœ€è¦èƒ½å¤Ÿæ”¯æŒå‡ ä¸ªåŠŸèƒ½ï¼š
èƒ½å¤Ÿè¿›è¡ŒDockeré•œåƒæ„å»ºï¼Œè¿è¡Œï¼› èƒ½å¤Ÿæ”¯æŒNodejsç±»å‹é¡¹ç›®ï¼› èƒ½å¤Ÿæ”¯æŒJava Mavenç±»å‹é¡¹ç›®ï¼› 4. æ­å»ºæ­¥éª¤ æ ¹æ®ä¸Šé¢çš„éœ€æ±‚ï¼Œç›´æ¥å…ˆä¸Šæœ€åçš„docker-composeè„šæœ¬ï¼Œåé¢ä¼šé€æ­¥è§£è¯»ï¼š
1version: &amp;#39;2&amp;#39; 2services: 3 jenkins: 4 image: jenkins/jenkins:2.60.3 5 volumes: 6 # let container use same timezone as host 7 - /etc/localtime:/etc/localtime 8 - /etc/timezone:/etc/timezone 9 # jenkins home 10 - /opt/docker/jenkins/jenkins.home:/var/jenkins_home 11 # JDK used for compiling Java project 12 - /usr/local/jdk1.8.0:/usr/local/jdk1.8.0 13 # Maven used for compiling maven project 14 - /usr/local/maven:/usr/local/maven 15 # node.js 6 16 - /usr/local/nodejs6:/usr/local/nodejs6 17 # node.js 8 18 - /usr/local/nodejs8:/usr/local/nodejs8 19 20 # Maven cache directory 21 - /home/sinopoweradmin/.m2:/var/jenkins_home/.m2 22 # Map docker cmd on host to container. used for docker image building 23 #- /var/run/docker.sock:/var/run/docker.sock 24 - /usr/bin/docker:/usr/bin/docker 25 - /usr/lib/x86_64-linux-gnu/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7 26 # Map ssh config into docker 27 - /home/sinopoweradmin/.ssh:/var/jenkins_home/.ssh 28 ports: 29 # main port 30 - &amp;#34;8080:8080&amp;#34; 31 # used for cluster mode 32 - &amp;#34;50000:50000&amp;#34; 33 restart: always 4.1 Dockerå®¹å™¨çš„æ—¶åŒº é»˜è®¤çš„Dockeré•œåƒä¸­æ—¶åŒºè®¾ç½®å¤šæ•°æ˜¯UTCï¼Œä¸æˆ‘ä»¬æœ¬åœ°çš„æ—¶é—´ï¼ˆUTC&#43;8)ä¸ä¸€è‡´ã€‚è¿™ä¼šå¯¼è‡´åœ¨Jenkinsä¸­æ˜¾ç¤ºçš„æ—¶é—´ä¸æœ¬åœ°æ—¶é—´æœ‰8å°æ—¶çš„æ—¶å·®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å°†æœ¬åœ°æ—¶åŒºæ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨ä¸­è§£å†³ï¼š
1 - /etc/localtime:/etc/localtime 2 - /etc/timezone:/etc/timezone 4.2 JDK 8 Jenkinsé•œåƒä¸­æœ‰JDKï¼ˆç”¨æ¥è¿è¡ŒJenkinsæœ¬èº«ï¼‰ã€‚ä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„JDKæ˜¯OpenJDK 1.8ã€‚è€Œæˆ‘ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯Oracleçš„JDK1.8ã€‚å› æ­¤é€‰æ‹©äº†åœ¨æœ¬åœ°å®‰è£…JDK1.8ï¼Œç„¶åæŒ‚è½½åˆ°é•œåƒä¸­å»ã€‚
1# JDK used for compiling Java project 2 - /usr/local/jdk1.8.0:/usr/local/jdk1.8.0 4.3 Maven åœ¨Jenkinsä¸­å¯ä»¥ç›´æ¥å®‰è£…Mavenã€‚ä½†æ˜¯å› ä¸ºGFWçš„åŸå› ï¼Œå®‰è£…ä¼šæ¯”è¾ƒæ…¢ï¼Œè€Œä¸”æœ‰å¯èƒ½å¤±è´¥ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©å’ŒJavaä¸€æ ·çš„æ–¹å¼åœ¨æœ¬åœ°å®‰è£…ç„¶åæŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚
1 # Maven used for compiling maven project 2 - /usr/local/maven:/usr/local/maven 4.4 Nodejs Node.jsçš„å®‰è£…æ–¹æ³•ç±»ä¼¼ï¼š
1 # node.js 6 2 - /usr/local/nodejs6:/usr/local/nodejs6 3 # node.js 8 4 - /usr/local/nodejs8:/usr/local/nodejs8 è¿™é‡ŒæŒ‚è½½äº†ä¸¤ä¸ªç‰ˆæœ¬çš„Node.jsã€‚
4.5 Jenkins Homeå’ŒMaven Cache é€šè¿‡æŒ‚è½½æœ¬åœ°ç›®å½•ï¼Œå°†Jenkins Homeå’ŒMaven Cacheéƒ½æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œè€Œä¸æ˜¯è®©Jenkinsåœ¨å®¹å™¨å†…éƒ¨ç®¡ç†ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯å‡çº§ç‰ˆæœ¬ä¸ä¼šä¸¢å¤±æ•°æ®äº†ã€‚
1 # jenkins home 2 - /opt/docker/jenkins/jenkins.home:/var/jenkins_home 3 # Maven cache directory 4 - /home/sinopoweradmin/.m2:/var/jenkins_home/.m2 4.6 Docker è¦åœ¨Jenkinså†…éƒ¨ä½¿ç”¨Dockeræ„å»ºé•œåƒã€è¿è¡Œdockerå‘½ä»¤ï¼Œå°±éœ€è¦å°†å®¿ä¸»æœºçš„dockerå‘½ä»¤æ˜ å°„åˆ°å®¹å™¨ä¸­ã€‚æ‰€å¹¸dockeræ˜¯ä¸€ä¸ªC/Sæ¶æ„çš„è½¯ä»¶ï¼Œdockerå‘½ä»¤æœ¬èº«å¹¶ä¸å®é™…æ‰§è¡Œå·¥ä½œï¼Œåªæ˜¯è´Ÿè´£å°†å‘½ä»¤å‘é€åˆ°Dockerçš„æœåŠ¡ç¨‹åºä¸­æ‰§è¡Œã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦å°†dockerå‘½ä»¤æœ¬èº«æ˜ å°„åˆ°å®¹å™¨ä¸­å³å¯ã€‚ç„¶åé€šè¿‡æ·»åŠ -Hå‚æ•°æŒ‡å®šå®¿ä¸»æœºä½œä¸ºDockeræœåŠ¡ä¸»æœºå³å¯æ‰§è¡Œdockerç›¸å…³ä»»åŠ¡ã€‚å…·ä½“çš„ä»¥åä¼šè®²è§£ã€‚
1 # Map docker cmd on host to container. used for docker image building 2 #- /var/run/docker.sock:/var/run/docker.sock 3 - /usr/bin/docker:/usr/bin/docker 4 - /usr/lib/x86_64-linux-gnu/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7 4.7 ssh 1 # Map ssh config into docker 2 - /home/sinopoweradmin/.ssh:/var/jenkins_home/.ssh è¿™ä¸€æ®µå…³äºsshçš„é…ç½®æ˜¯å°†è¿è¡Œdockerç”¨æˆ·ä¸»ç›®å½•ä¸­çš„.sshç›®å½•æ˜ å°„åˆ°Jenkinså®¹å™¨ä¸­ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸¤è€…å…±äº«äº†åŒæ ·çš„sshå¯†é’¥ä»¥åŠknown_hostsä¿¡æ¯ï¼šåªè¦èƒ½å¤Ÿåœ¨å®¿ä¸»æœºä¸Šé€šè¿‡SSHè¯ä¹¦ç™»å½•çš„ä¸»æœºä¹Ÿå°±å¯ä»¥åœ¨Jenkinså®¹å™¨ä¸­ç™»å½•ã€‚ï¼ˆæœ‰å…³SSHè¯ä¹¦æ— å¯†ç ç™»å½•çš„å†…å®¹è¯·å‚è€ƒä»¥å‰çš„æ–‡ç« ï¼‰ã€‚
5. è¿è¡Œ ä½¿ç”¨docker-composeè¿è¡Œå°±å¯ä»¥å¯åŠ¨Jenkinsäº†ã€‚
5.1 åˆå§‹åŒ–å¯†ç  Jenkinsç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆåˆå§‹åŒ–å¯†ç ã€‚é€šè¿‡docker logs -f jenkins_jenkins_1æŸ¥çœ‹æ—¥å¿—å¯ä»¥æ‰¾åˆ°è¿™ä¸ªå¯†ç ã€‚æˆ–è€…è¿›å…¥JENKINS_HOMEä¸­æ‰¾åˆ°ç›¸å…³æ–‡ä»¶ä¹Ÿå¯ä»¥æ‰¾åˆ°è¿™ä¸ªå¯†ç ã€‚
6. ä¸€äº›è¯´æ˜ Jenkinsé•œåƒæ¨èä¸è¦é€‰ç”¨Alpineç‰ˆæœ¬çš„é•œåƒï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°ä¸€äº›å…¼å®¹æ€§é—®é¢˜ã€‚ä¾‹å¦‚å‡ºç°dockerå‘½ä»¤æ— æ³•æ‰§è¡Œçš„é—®é¢˜ã€‚ å…³äºå¦‚ä½•åœ¨Jenkinsä¸­åˆ›å»ºã€æ‰§è¡ŒJobä»¥åä¼šç»§ç»­å†™åšæ–‡è¯´æ˜ã€‚ é™„å½•A. é™„å½• æŒç»­é›†æˆï¼Œé€‰Jenkinsè¿˜æ˜¯Hudson (Jenkinsä¸Hudsonçš„æ¸Šæº) </content>
    </entry>
    
     <entry>
        <title>Shellè„šæœ¬ä¸­çš„ä¸€äº›ç‰¹æ®Šå˜é‡</title>
        <url>https://orchidflower.github.io/2017/08/05/Some-special-parameters-in-Shell/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag><tag>Shell</tag><tag>Bash</tag>
        </tags>
        <content type="html"> Shellè„šæœ¬çš„ä¸€äº›å‚æ•°æ€»æ˜¯æ„Ÿè§‰è®°ä¸ä½ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡åæŸ¥ã€‚
1. å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ $0 å½“å‰è„šæœ¬çš„æ–‡ä»¶å &amp;mdash; &amp;mdash; $n ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯$1ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯$2ã€‚ $# ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°ã€‚ $* ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚ $@ ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚è¢«åŒå¼•å·(&amp;quot; &amp;ldquo;)åŒ…å«æ—¶ï¼Œä¸ $* ç¨æœ‰ä¸åŒï¼Œä¸‹é¢å°†ä¼šè®²åˆ°ã€‚ $? ä¸Šä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œæˆ–å‡½æ•°çš„è¿”å›å€¼ã€‚ $$ å½“å‰Shellè¿›ç¨‹IDã€‚å¯¹äº Shell è„šæœ¬ï¼Œå°±æ˜¯è¿™äº›è„šæœ¬æ‰€åœ¨çš„è¿›ç¨‹IDã€‚ 2. $*/$@çš„åŒºåˆ« $* å’Œ $@ éƒ½è¡¨ç¤ºä¼ é€’ç»™å‡½æ•°æˆ–è„šæœ¬çš„æ‰€æœ‰å‚æ•°ï¼Œä¸è¢«åŒå¼•å·(&amp;rdquo; &amp;ldquo;)åŒ…å«æ—¶ï¼Œéƒ½ä»¥&amp;rdquo;$1&amp;quot; &amp;ldquo;$2&amp;rdquo; â€¦ &amp;ldquo;$n&amp;rdquo; çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚
ä½†æ˜¯å½“å®ƒä»¬è¢«åŒå¼•å·(&amp;quot; &amp;ldquo;)åŒ…å«æ—¶ï¼Œ&amp;quot;$*&amp;rdquo; ä¼šå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä»¥&amp;quot;$1 $2 â€¦ $n&amp;quot;çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ï¼›&amp;quot;$@&amp;quot; ä¼šå°†å„ä¸ªå‚æ•°åˆ†å¼€ï¼Œä»¥&amp;quot;$1&amp;quot; &amp;ldquo;$2&amp;rdquo; â€¦ &amp;ldquo;$n&amp;rdquo; çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚
é™„å½•. å‚è€ƒèµ„æ–™ Shellç‰¹æ®Šå˜é‡ï¼šShell $0, $#, $*, $@, $?, $$å’Œå‘½ä»¤è¡Œå‚æ•° </content>
    </entry>
    
     <entry>
        <title>xargsä½¿ç”¨å¤æ‚å‚æ•°</title>
        <url>https://orchidflower.github.io/2017/07/30/How-to-using-argument-in-xargs/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag><tag>Shell</tag>
        </tags>
        <content type="html"> ä¸€èˆ¬æƒ…å†µä¸‹xargsåªå¤„ç†ä¸€ä¸ªå‚æ•°ï¼Œå› æ­¤å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œæœ€åçš„rmä¼šè‡ªåŠ¨è¡¥é½ä¸€ä¸ªå‚æ•°ï¼š
1find . | grep hello | xargs rm ä½†æ˜¯æœ‰æ—¶å€™éœ€è¦å¤šä¸ªå‚æ•°æ‰èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥è¿™æ ·ï¼š
1ls -1 2016*.log | xargs -I % -t tar czvf %.tar.gz % --remove-files ä¸Šè¿°å‘½ä»¤çš„æ„æ€æ˜¯å°†å½“å‰ç›®å½•ä¸­æ‰€æœ‰2016*.logæ–‡ä»¶ä½¿ç”¨taræ‰“åŒ…æˆtar.gzæ–‡ä»¶ï¼Œå¹¶åˆ é™¤æºæ–‡ä»¶ã€‚å…¶ä¸­ï¼š
xargs -I å‚æ•°æŒ‡å®šäº†%ä½œä¸ºå ä½ç¬¦ã€‚å®ƒå°†æŒ‡ä»£lså‘½ä»¤è¿”å›çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚ç„¶ååœ¨åé¢çš„å‘½ä»¤ä¸­ï¼Œä½¿ç”¨%ä»£æ›¿äº†å‚æ•°å€¼ï¼› xargs -t å‚æ•°ä½œç”¨æ˜¯æ‰“å°å‘½ä»¤è¡Œ å…¶ä»–å‚æ•°è¯´æ˜ï¼š
tar &amp;ndash;remove-files å‚æ•°çš„ä½œç”¨æ˜¯å‹ç¼©å®Œæˆä¹‹ååˆ é™¤æºæ–‡ä»¶ é™„å½•. å‚è€ƒèµ„æ–™ xargs ä¸­å¤„ç†å¤šä¸ªå‚æ•°çš„ç”¨æ³• </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•æ— å¯†ç ç™»å½•SSH</title>
        <url>https://orchidflower.github.io/2017/07/23/How-to-login-without-password-over-SSH/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag><tag>SSH</tag>
        </tags>
        <content type="html"> æˆ‘ä»¬åœ¨ç”¨Jenkinsåšå‘å¸ƒå·¥å…·çš„æ—¶å€™ï¼Œç»å¸¸ç”¨åˆ°çš„åŠŸèƒ½æ˜¯é€šè¿‡SSHé€šé“å®Œæˆå„ç§åŠŸèƒ½ã€‚ä¾‹å¦‚ä½¿ç”¨scpå‘½ä»¤æ‹·è´å®‰è£…åŒ…åˆ°æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ssh -tå‘½ä»¤æ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„è„šæœ¬ç­‰ã€‚
è¿™æ—¶å°±éœ€è¦é…ç½®æ— å¯†ç ç™»å½•ï¼Œå¦åˆ™æ— æ³•åšåˆ°è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ã€‚å¦‚æœæ¯æ¬¡éƒ½æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼Œæƒ³æƒ³éƒ½ä¸ç°å®ã€‚è¦å®ç°æ— å¯†ç ç™»å½•ï¼Œéœ€è¦é…ç½®å¥½SSHå…è®¸è¯ä¹¦ç™»å½•ã€‚
å…¶åŸç†æ˜¯ä½¿ç”¨äº†å…¬é’¥ä½“ç³»ï¼Œå‡è®¾æœ‰æœåŠ¡å™¨Serverï¼Œç”¨æˆ·åœ¨æœåŠ¡å™¨Clientä¸Šï¼Œç”¨æˆ·åœ¨æœåŠ¡å™¨Clientä¸Šæœ‰ç§é’¥Private Keyï¼Œåœ¨æœåŠ¡å™¨Serverä¸Šæœ‰å¯¹åº”çš„å…¬é’¥Public Keyã€‚è¿™æ ·è®¿é—®çš„æ—¶å€™Serverå°±èƒ½å¤Ÿé€šè¿‡å…¬é’¥ä½“ç³»è¿›è¡ŒéªŒè¯ï¼šè¦æ±‚ç”¨æˆ·ä½¿ç”¨å…¶ç§é’¥è¿›è¡Œç­¾åï¼Œä»è€Œç¡®ä¿ç”¨æˆ·æ‹¥æœ‰ç§é’¥ï¼Œä»¥æ­¤éªŒè¯ç”¨æˆ·èº«ä»½ã€‚å¦‚ä¸‹å›¾ï¼š
1. æœåŠ¡å™¨é…ç½® é»˜è®¤SSHçš„é…ç½®å·²ç»å…è®¸é€šè¿‡è¯ä¹¦ç™»å½•ã€‚ä½†æ˜¯ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæœ‰äº›é…ç½®å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ï¼ˆéå¿…é¡»ï¼Œè¯·æ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰ï¼š
1PermitRootLogin # é»˜è®¤yesï¼Œæ”¹æˆnoï¼ˆç¦ç”¨rooté€šè¿‡sshç™»å½•ï¼‰ 2PasswordAuthentication # é»˜è®¤yesï¼Œæ”¹ä¸ºnoï¼ˆç¦ç”¨ä½¿ç”¨å¯†ç è®¤è¯ç™»å½•ï¼Œå¿…é¡»æœ‰è¯ä¹¦æ‰èƒ½ç™»å½•ï¼‰ 2. å¯†é’¥ç”Ÿæˆ ç”¨æˆ·å¯†é’¥çš„ç”Ÿæˆä½¿ç”¨ssh-keygenå‘½ä»¤å³å¯ã€‚æ³¨æ„ï¼šè¯¥å‘½ä»¤æœ€å¥½åœ¨Clientç«¯ç”Ÿæˆï¼Œå› ä¸ºç§é’¥è¯ä¹¦éœ€è¦ç¡®ä¿å®‰å…¨æ€§ï¼Œä¸è¦æ³„éœ²ï¼Œå¦åˆ™æ”»å‡»è€…ä¹Ÿå°±æ‹¥æœ‰äº†åŒæ ·çš„æƒé™ã€‚
1ssh-keygen -t rsa ssh-keygenå¯ä»¥ç”Ÿæˆå¤šç§ç®—æ³•ç±»å‹çš„å¯†é’¥ï¼Œä¾‹å¦‚rsa, dsaç­‰ã€‚ä¸€èˆ¬é€‰æ‹©rsaå³å¯ã€‚å…¶ç”Ÿæˆçš„è¯ä¹¦è·¯å¾„ä¿å­˜åœ¨~/.sshæ–‡ä»¶å¤¹ä¸‹ã€‚æŒ‰ç…§ç®—æ³•ç±»å‹è¿›è¡Œå‘½åï¼Œå¦‚æœä½¿ç”¨RSAç®—æ³•ï¼Œåˆ™ç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶ä¸ºï¼š
1id_rsa ç§é’¥æ–‡ä»¶ã€‚ç¡®ä¿å…¶æ–‡ä»¶è®¿é—®æ¨¡å¼ä¸º600ï¼ˆåªå…è®¸å½“å‰ç”¨æˆ·è®¿é—®ï¼‰ 2id_rsa.pub å…¬é’¥æ–‡ä»¶ 3. å…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š å…¬é’¥éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¹¶æ·»åŠ åˆ°Serverä¸ŠæŸä¸ªç”¨æˆ·çš„~/.ssh/authorized_keysæ–‡ä»¶ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªã€‚
4. ä½¿ç”¨ ä¸Šè¿°é…ç½®å¥½åï¼Œå°±å¯ä»¥ä½¿ç”¨sshç›¸å…³çš„å‘½ä»¤è¿›è¡Œæ— å¯†ç æ“ä½œäº†ã€‚ä¾‹å¦‚ï¼š
1scp abc.tar.gz root@192.168.50.81:~ 2ssh -t root@192.168.50.81 bash /root/deploy.sh abc.tar.gz </content>
    </entry>
    
     <entry>
        <title>åœ¨aliaså‘½ä»¤ä¸­ä½¿ç”¨å•å¼•å·</title>
        <url>https://orchidflower.github.io/2017/07/16/How-to-using-single-quota-in-alias-command/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Linux</tag><tag>Shell</tag>
        </tags>
        <content type="html"> Linuxä¸­çš„aliaså‘½ä»¤å¯ä»¥å°†ä¸€æ¡å¤æ‚çš„å‘½ä»¤ç¼©çŸ­ä¸ºä¸€ä¸ªç®€å•çš„æŒ‡ä»¤ï¼Œå®é™…å·¥ä½œä¸­ç»å¸¸ä¼šç”¨åˆ°ã€‚ä½¿ç”¨aliasçš„æ—¶å€™å‘½ä»¤æœ¬èº«éœ€è¦ä½¿ç”¨å•å¼•å·åŒ…æ‹¬èµ·æ¥ã€‚ä½†æ˜¯å¦‚æœå‘½ä»¤æœ¬èº«ä¸­åŒ…å«å•å¼•å·æ€ä¹ˆåŠå‘¢ï¼Ÿ
ä¾‹å¦‚ï¼Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š
1ps -ef | grep shadowsocks/server.py | grep -v grep | awk &amp;#39;{print $2}&amp;#39; å…¶ä½œç”¨æ˜¯è·å–ä»»åŠ¡çš„pidã€‚å…¶ä¸­ç”¨åˆ°çš„awkçš„å‚æ•°éœ€è¦ç”¨åˆ°å•å¼•å·ã€‚aliasä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ï¼Œä½†æ˜¯å¦‚æœç”¨åŒå¼•å·ï¼Œå…¶ä¸­çš„å†…å®¹ä¼šè¢«è½¬ä¹‰è§£é‡Šæˆå…·ä½“è·å¾—çš„å€¼ã€‚è€Œä¸æ˜¯å‘½ä»¤æœ¬èº«ã€‚
è¿™æ—¶å¯ä»¥ä½¿ç”¨ &#39;&amp;quot;&#39;&amp;quot;&#39; æ›¿ä»£å•å¼•å·ã€‚è§£é‡Šä¸€ä¸‹ï¼š
&amp;rsquo; ä½¿ç”¨å•å¼•å·ç»“æŸç¬¬ä¸€æ®µï¼› &amp;quot; å¼€å¯ç¬¬äºŒæ®µï¼Œè¿™é‡Œä½¿ç”¨åŒå¼•å·ï¼› &amp;rsquo; å•å¼•å·æœ¬èº«ï¼› &amp;quot; ç»“æŸç¬¬äºŒæ®µï¼Œä½¿ç”¨åŒå¼•å·ï¼› &amp;rsquo; å¼€å¯ç¬¬ä¸‰æ®µï¼Œä½¿ç”¨å•å¼•å·ã€‚ æ‰€ä»¥æœ€åçš„è¯­å¥å‘½ä»¤å¦‚ä¸‹ï¼š
1alias stopssr=&amp;#39;pid=`ps -ef | grep shadowsocks/server.py | grep -v grep | awk &amp;#39;&amp;#34;&amp;#39;&amp;#34;&amp;#39;{print $2}&amp;#39;&amp;#34;&amp;#39;&amp;#34;&amp;#39;`;if [ -n &amp;#34;$pid&amp;#34; ]; then kill -9 $pid; fi&amp;#39; é™„å½•A. å‚è€ƒèµ„æ–™ How to escape single-quotes within single-quoted strings? </content>
    </entry>
    
     <entry>
        <title>å¦‚ä½•åœ¨Macä¸Šæ·»åŠ ä¸€ä¸ªè™šæ‹ŸIP</title>
        <url>https://orchidflower.github.io/2017/07/09/How-to-add-one-virtual-IP-on-Mac/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Mac</tag>
        </tags>
        <content type="html"> æœ€è¿‘å¿™ç€ç³»ç»Ÿé‡æ„ï¼Œå› ä¸ºç»å¸¸å¤„äºç§»åŠ¨åŠå…¬çš„çŠ¶æ€ï¼Œè®¿é—®å…¬å¸çš„æœåŠ¡å™¨ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥ä¸€äº›åŸºç¡€æœåŠ¡éƒ½æ˜¯æ­å»ºåœ¨æœ¬æœºä¸Šã€‚ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™ç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯ç½‘ç»œåœ°å€åˆ‡æ¢å¯¼è‡´çš„ï¼šIPåœ°å€æ€»æ˜¯ä¸å›ºå®šã€‚æœ‰äº›æœåŠ¡ï¼ˆä¾‹å¦‚FastDFSï¼‰éœ€è¦æœ‰æ˜ç¡®çš„IPåœ°å€æ¥ç»‘å®šæœåŠ¡ã€‚ä¸å›ºå®šçš„IPåœ°å€ä¼šç»™è¿™äº›æœåŠ¡å¸¦æ¥éº»çƒ¦ï¼Œéœ€è¦ä¿®æ”¹é…ç½®é‡å¯æœåŠ¡ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•æ˜¯èƒ½å¤Ÿç»™Macåˆ†é…ä¸€ä¸ªå›ºå®šçš„IPï¼Œä¸ç®¡æ€ä¹ˆåˆ‡æ¢ç½‘ç»œä¸€ç›´å­˜åœ¨ã€‚å¹¸å¥½è¿™ä¸ªæ˜¯å¯ä»¥è§£å†³çš„ï¼Œè€Œä¸”å¹¶ä¸å¤æ‚ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š
1ifconfig lo0 alias 192.168.255.199 å…¶åŸç†æ˜¯ç»™ç½‘ç»œè®¾å¤‡loopbackå¢åŠ ä¸€ä¸ªaliasã€‚loopbackè®¾å¤‡ä¸€ç›´å­˜åœ¨ï¼Œè€Œä¸”ä¸en0è®¾å¤‡ç‹¬ç«‹ï¼Œå¯ä»¥ä¸€ç›´å­˜åœ¨ã€‚
åˆ é™¤æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š
1ifconfig lo0 -alias 192.168.255.199 è¿™æ ·ç»ˆäºå¯ä»¥æœ‰ä¸ªå›ºå®šIPç”¨æ¥ç»‘å®šæœåŠ¡äº†ã€‚
é™„å½•A. å‚è€ƒèµ„æ–™ Virtual network interface in Mac OS X </content>
    </entry>
    
     <entry>
        <title>Let&#39;s Encryptå…è´¹è¯ä¹¦çš„ä½¿ç”¨</title>
        <url>https://orchidflower.github.io/2017/07/02/How-to-use-Let-s-Encrypt/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>å…è´¹è¯ä¹¦</tag><tag>Linux</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ å› ä¸ºäº‘è®¤è¯æœåŠ¡çš„å•†æˆ·è®¤è¯ä½“ç³»æ˜¯åŸºäºåŒå‘SSLçš„ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰å¯ç”¨SSLè¯ä¹¦ï¼Œåˆ™æ•´ä¸ªè®¤è¯ä½“ç³»å¿…é¡»é‡æ„ã€‚ç›®å‰çš„ç°çŠ¶æ˜¯ç”³è¯·SSLè¯ä¹¦è´¹ç”¨æ¯”è¾ƒé«˜ï¼ˆä¸€å¹´2-3wï¼‰ï¼Œè€Œä¸”å‘¨æœŸæ¯”è¾ƒé•¿ï¼Œèµ¶ä¸ä¸Šç›®å‰çš„æµ‹è¯•è¿›åº¦ã€‚æ‰€ä»¥åªèƒ½ä½¿ç”¨å…è´¹è¯ä¹¦æ¥æ”¯æ’‘ä¸€ä¸‹äº†ã€‚
å…è´¹è¯ä¹¦æœåŠ¡æä¾›å•†æ®æˆ‘æ‰€çŸ¥æœ‰å‡ ä¸ªï¼šLet&#39;s Encrypt, StartSSL, StarComã€‚ä½†æ˜¯StartSSL, StarComå‰ä¸€é˜µå­è¢«Chromeã€Firefoxç­‰è®¾ç½®ä¸ºä¸å¯ä¿¡ï¼ˆç­¾åæµç¨‹ä¸è§„èŒƒï¼Œä¸ç¬¦åˆå®‰å…¨ç›‘ç®¡è¦æ±‚ä¹‹ç±»çš„åŸå› ï¼‰ï¼Œå› æ­¤ç›®å‰å¯é€‰çš„åªæœ‰let&#39;s encryptã€‚
Let&#39;s Encryptæ˜¯å›½å¤–ä¸€ä¸ªå…¬å…±çš„å…è´¹ SSL é¡¹ç›®ï¼Œç”± Linux åŸºé‡‘ä¼šæ‰˜ç®¡ï¼Œå®ƒçš„æ¥å¤´ä¸å°ï¼Œç”±Mozillaã€æ€ç§‘ã€Akamaiã€IdenTrustå’ŒEFFç­‰ç»„ç»‡å‘èµ·ï¼Œç›®çš„å°±æ˜¯å‘ç½‘ç«™è‡ªåŠ¨ç­¾å‘å’Œç®¡ç†å…è´¹è¯ä¹¦ï¼Œä»¥ä¾¿åŠ é€Ÿäº’è”ç½‘ç”± HTTP è¿‡æ¸¡åˆ° HTTPSã€‚
2. è‡ªåŠ¨åŒ–ç”³è¯·åŸç† Let&#39;s Encrypt æ¯æ¬¡ç”³è¯·çš„è¯ä¹¦æœ‰æ•ˆæœŸè™½ç„¶åªæœ‰90å¤©ï¼Œä½†æ˜¯å®ƒæ”¯æŒè‡ªåŠ¨åŒ–çš„ç”³è¯·ï¼šæ•´ä¸ªç”³è¯·è¿‡ç¨‹ä¸åƒä¼ ç»Ÿçš„CAæœ‰å¾ˆé•¿çš„å®¡æ‰¹è¿‡ç¨‹ï¼Œå¯ä»¥åšåˆ°è‡ªåŠ¨åŒ–çš„ç”³è¯·éƒ¨ç½²ï¼Œæ‰€ä»¥å®Œå…¨èƒ½å¤Ÿæ»¡è¶³ä½¿ç”¨çš„éœ€æ±‚ã€‚Let&#39;s Encrypt å®šä¹‰äº†è§„èŒƒACMEï¼ˆAutomatic Certificate Management Environmentï¼‰ã€‚åªè¦æŒ‰ç…§è§„èŒƒå®šä¹‰ï¼Œç”¨æˆ·å®Œå…¨å¯ä»¥è‡ªå·±ç¼–å†™ç¨‹åºæˆ–è„šæœ¬å®ç°æ•´ä¸ªè¯ä¹¦ç”³è¯·çš„è¿‡ç¨‹ï¼Œæˆä¸ºAgentã€‚å®˜æ–¹æœ‰è‡ªå·±çš„å®ç°ï¼šCertbotã€‚å¦å¤–è¿˜æœ‰å¤§é‡çš„å¼€æºå®ç°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜ç½‘ã€‚
Let&#39;s Encryptå’ŒACMEè§„èŒƒçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿè‡ªåŠ¨åŒ–ç”³è¯·è¯ä¹¦ï¼Œå®Œå…¨ä¸ç”¨äººå·¥å‚ä¸ã€‚è¿™æ˜¯é€šè¿‡ä¸€ä¸ªç¬¦åˆACMEè§„èŒƒAgentæ¥å®Œæˆçš„ã€‚
2.1 åŸŸåéªŒè¯ Let&#39;s Encryptæ˜¯é€šè¿‡è¯ä¹¦æ¥è¯†åˆ«ä¸€ä¸ªåŸŸåç®¡ç†è€…çš„ã€‚ç¬¬ä¸€æ¬¡è¿è¡ŒAgentçš„æ—¶å€™ï¼ŒAgentä¼šç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶å°†å…¬é’¥æäº¤ç»™Let&#39;s Encryptã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºä¼ ç»ŸCAä¸­çš„åœ¨CAåˆ›å»ºå•†æˆ·çš„è¿‡ç¨‹ã€‚
ç„¶åé€šè¿‡ä¸€äº›æ–¹æ³•ï¼ŒAgentå‘Let&#39;s Encryptè¯ä¹¦è¿™ä¸ªè¯ä¹¦çš„æ‹¥æœ‰è€…æ‹¥æœ‰å¯¹æŒ‡å®šåŸŸåçš„æ§åˆ¶æƒã€‚è¿™æ˜¯é€šè¿‡æŒ‘æˆ˜åº”ç­”æ–¹å¼å®ç°ï¼šé’ˆå¯¹æŒ‡å®šåŸŸåLet&#39;s Encryptç”Ÿæˆä¸€ä¸ªæŒ‘æˆ˜å€¼ï¼Œç„¶åACME Clientå°†è¿™ä¸ªå€¼éƒ¨ç½²åˆ°æŒ‡å®šä½ç½®ï¼ŒLet&#39;s EncryptéªŒè¯éƒ¨ç½²çš„å€¼æ˜¯å¦æ­£ç¡®ã€‚ACMEè§„èŒƒä¸­å®šä¹‰äº†å‡ ç§éªŒè¯æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š
http-01 å°†åº”ç­”å€¼ä¿å­˜æˆæ–‡ä»¶ï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡ç‰¹å®šçš„URLè®¿é—®åˆ°ï¼› dns-01 å°†åº”ç­”å€¼é…ç½®åˆ°TXTç±»å‹çš„DNSè®°å½•ä¸­ï¼› åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒAgentä¼šä½¿ç”¨ç®¡ç†è€…çš„ç§é’¥å¯¹æŒ‘æˆ˜å€¼è¿›è¡Œç­¾åï¼Œå¹¶æŠŠç­¾åå€¼å­˜æ”¾åˆ°æŒ‡å®šçš„ä½ç½®ï¼ˆæ–‡ä»¶æˆ–DNSè®°å½•ä¸­ï¼‰ã€‚å®Œæˆä¹‹åAgenté€šçŸ¥Let&amp;rsquo;s Encryptè¿›è¡ŒéªŒè¯ã€‚éªŒè¯ä¹‹åå°±å¯ä»¥ç¡®è®¤æŒ‡å®šè¯ä¹¦æ‹¥æœ‰å¯¹æŒ‡å®šåŸŸåçš„æ§åˆ¶æƒã€‚è¿™ä¸ªè¯ä¹¦å’Œç§é’¥è¢«ç§°ä¸ºæˆæƒå¯†é’¥å¯¹ï¼ˆauthorized key pairï¼‰ã€‚
2.2 åŸŸåç”³è¯·æˆ–åŠé”€ æœ‰äº†æˆæƒå¯†é’¥å¯¹ä¹‹åï¼Œå…·ä½“çš„ç”³è¯·è¿‡ç¨‹å°±ç®€å•äº†ï¼Œåªè¦å‘é€å¯¹åº”çš„æ¶ˆæ¯ç»™Let&amp;rsquo;s Encryptå³å¯ã€‚
è¯ä¹¦ç”³è¯·æ—¶ï¼ŒAgentç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªPKCS#10 CSRï¼ŒåŒæ—¶ç”¨æˆæƒå¯†é’¥å¯¹ä¸­çš„ç§é’¥å¯¹CSRè¿›è¡Œç­¾åï¼Œä»¥æ­¤è¯æ˜è¿™æ¬¡ç”³è¯·æ˜¯è¢«æˆæƒçš„ã€‚Let&amp;rsquo;s Encryptæ”¶åˆ°è¯·æ±‚ä¹‹åéªŒè¯ç­¾åï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±ç­¾å‘è¯ä¹¦ï¼š è¯ä¹¦åŠé”€ä¸ä¸Šé¢ç±»ä¼¼ã€‚Agentå¯¹åŠé”€è¯·æ±‚è¿›è¡Œç­¾åï¼Œç„¶åå‘é€è¯·æ±‚ç»™Let&amp;rsquo;s Encryptå®Œæˆè¯·æ±‚ã€‚ 3. ç”³è¯·è¿‡ç¨‹ åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨å®˜æ–¹çš„å®¢æˆ·ç«¯Certbotï¼Œå› ä¸ºå®ƒé›†æˆåº¦å¤ªé«˜ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªæœåŠ¡å ç”¨80ç«¯å£ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘å®é™…ä½¿ç”¨è¿‡çš„æœ‰ä¸¤ä¸ªï¼šacme-tiny.pyå’Œle-dnsã€‚
3.1 acme-tiny.py acme-tiny.py æ˜¯ä¸€ä¸ªPythonçš„è„šæœ¬ã€‚å®ƒä½¿ç”¨çš„æ˜¯http-01çš„éªŒè¯æ–¹å¼ï¼Œä¸éœ€è¦å ç”¨ç«¯å£ï¼Œé€šè¿‡ä¸httpæœåŠ¡å™¨ï¼ˆä¾‹å¦‚nginxã€apacheç­‰ï¼‰ååŒå·¥ä½œå®ŒæˆéªŒè¯å·¥ä½œã€‚å…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒå…¶è¯´æ˜æ–‡ä»¶ã€‚ç®€å•è¯´ä¸€ä¸‹ä¼˜ç¼ºç‚¹ã€‚
ä¼˜ç‚¹æ˜¯è„šæœ¬å¾ˆå°ï¼Œå®Œæˆçš„åŠŸèƒ½ä¹Ÿè¶³å¤Ÿå•ä¸€ï¼Œå› æ­¤è‡ªç”±åº¦æ¯”è¾ƒé«˜ã€‚å½“ä½ çš„ç½‘ç«™ä½¿ç”¨Apacheæˆ–Nginxå‘å¸ƒçš„æ—¶å€™ï¼Œé€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥ä½¿ç”¨èµ·æ¥ã€‚ä½†æ˜¯å¦‚æœä½ çš„ç½‘ç«™æ¶æ„æ¯”è¾ƒå¤æ‚ï¼Œä¾‹å¦‚åˆ†å¸ƒåœ¨å¤šå°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œéœ€è¦è´Ÿè½½å‡è¡¡æ—¶ï¼Œä½¿ç”¨acme-tinyå°±ä¸åŒåˆé€‚äº†ã€‚
3.2 le-dns å› ä¸ºæˆ‘çš„ç½‘ç«™éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå› æ­¤ä½¿ç”¨http-01çš„éªŒè¯æ–¹æ³•å¾ˆéš¾å®Œæˆï¼ˆéœ€è¦éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨ä¸Šå»ï¼‰ã€‚å› æ­¤æ¯”è¾ƒåˆé€‚çš„éªŒè¯æ–¹æ³•æ˜¯ä½¿ç”¨dns-01éªŒè¯ã€‚
è¦å®ç°è‡ªåŠ¨åŒ–çš„dns-01éªŒè¯ï¼Œå°±éœ€è¦èƒ½å¤Ÿç¨‹åºåŒ–çš„æ“æ§DNSè®°å½•ï¼Œä¹Ÿå°±éœ€è¦è„šæœ¬èƒ½å¤Ÿè®¿é—®DNSæœåŠ¡å•†çš„æœåŠ¡ï¼Œè¿™å°±éœ€è¦æ ¹æ®ä¸åŒçš„DNSæœåŠ¡å•†è¿›è¡Œå®šåˆ¶å¼€å‘ã€‚æˆ‘ä¸€ç›´ä½¿ç”¨DNSPodçš„åŸŸåæœåŠ¡ï¼Œè€Œle-dnsä¹Ÿæ”¯æŒDNSPodï¼Œæ‰€ä»¥æœ€åé€‰å®šäº†å®ƒã€‚
3.2.1 å®‰è£… le-dnsæ˜¯åŸºäºletsencrypt.shçš„ï¼Œæ˜¯çº¯ç²¹çš„bashè„šæœ¬ï¼Œæ²¡æœ‰å…¶ä»–ä¾èµ–é¡¹ã€‚å®‰è£…èµ·æ¥å¾ˆç®€å•ï¼š
1wget https://github.com/xdtianyu/scripts/raw/master/le-dns/le-dnspod.sh 2wget https://github.com/xdtianyu/scripts/raw/master/le-dns/dnspod.conf 3chmod &#43;x le-dnspod.sh 3.2.2 ä¿®æ”¹é…ç½® ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶dnspod.confï¼š
1TOKEN=&amp;#34;YOUR_TOKEN_ID,YOUR_API_TOKEN&amp;#34; 2RECORD_LINE=&amp;#34;é»˜è®¤&amp;#34; 3DOMAIN=&amp;#34;example.com&amp;#34; 4CERT_DOMAINS=&amp;#34;example.com www.example.com im.example.com&amp;#34; 5#ECC=TRUE å…¶ä¸­çš„TOKENæ˜¯åœ¨DNSPodä¸­ç”³è¯·åˆ°çš„API Tokenï¼ˆhttps://www.dnspod.cn/console/user/security)ï¼Œæ³¨æ„æ ¼å¼ä¸Šåˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ DOMAINä¸ºè¦ç”³è¯·è¯ä¹¦çš„æ ¹åŸŸåï¼›CERT_DOMAINSæ˜¯è¦ç”³è¯·çš„åŸŸåï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚
3.2.3 è·å–è¯ä¹¦ è¿è¡Œ./le-dnspod.sh dnspod.confå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†ã€‚ç”Ÿæˆçš„è¯ä¹¦åœ¨certsç›®å½•ä¸‹å¯¹åº”çš„åŸŸåç›®å½•ä¸­ã€‚
3.2.4 å‡ ç‚¹å¿ƒå¾— 3.2.4.1 è¯ä¹¦é•¿åº¦ é»˜è®¤æƒ…å†µä¸‹ï¼Œç”³è¯·çš„è¯ä¹¦å¯†é’¥é•¿åº¦ä¸º4096ï¼Œå¦‚æœæƒ³ä¿®æ”¹æˆ2048ï¼Œå¯ä»¥ä¿®æ”¹le-dnspod.shåŒç›®å½•ä¸‹çš„letsencrypt.shä¸­çš„KEYSIZEå‚æ•°ã€‚
3.2.4.2 åœ¨Nginxä¸­çš„ç›¸å…³é…ç½®å‚è€ƒ 1server { 2 listen 443; 3 ssl_certificate /etc/nginx/keys/cap.eveus.com/fullchain.pem; 4 ssl_certificate_key /etc/nginx/keys/cap.eveus.com/privkey.pem; 5 ... 6} æ³¨æ„ï¼šssl_certificateä½¿ç”¨çš„fullchain.pemã€‚å¦‚æœä½¿ç”¨cert.pemï¼Œåœ¨æŸäº›å¹³å°ä¸Šï¼ˆä¾‹å¦‚æ‰‹æœºä¸Šï¼‰ä¼šæŠ¥è¯ä¹¦ä¸å—ä¿¡ä»»ã€‚
3.2.4.3 æˆæƒå¯†é’¥å¯¹ æˆæƒå¯†é’¥å¯¹æ˜¯å¯ä»¥é‡æ–°ç”Ÿæˆçš„ã€‚å¦‚æœä»¥å‰çš„å¯†é’¥å¯¹ä¸¢å¤±äº†ï¼Œå¯ä»¥é‡æ–°é€šè¿‡å·¥å…·ç”Ÿæˆï¼Œåªè¦é€šè¿‡äº†åŸŸåæ§åˆ¶æƒéªŒè¯ï¼Œé‚£å°±æˆä¸ºæ–°çš„æˆæƒå¯†é’¥å¯¹äº†ã€‚
é™„å½•. å‚è€ƒèµ„æ–™ Automatic Certificate Management Environment (ACME) protocol ACME Client Implementations Let&amp;rsquo;s Encrypt: How It Works acme-tiny.py on Github le-dns on Github lesencrypt.sh o Github </content>
    </entry>
    
     <entry>
        <title>Kafkaä»‹ç»ä¸ä½¿ç”¨</title>
        <url>https://orchidflower.github.io/2017/06/25/How-to-use-Kafka/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>Kafka</tag><tag>Zookeeper</tag>
        </tags>
        <content type="html"> Apache Kafkaæ˜¯åˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€‚å®ƒæœ€åˆç”±LinkedInå…¬å¸å¼€å‘ï¼Œä¹‹åæˆä¸ºApacheé¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚Kafkaæ˜¯ä¸€ç§å¿«é€Ÿã€å¯æ‰©å±•çš„ã€è®¾è®¡å†…åœ¨å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œåˆ†åŒºçš„å’Œå¯å¤åˆ¶çš„æäº¤æ—¥å¿—æœåŠ¡ã€‚ Apache Kafkaä¸ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼Œæœ‰ä»¥ä¸‹ä¸åŒï¼š
å®ƒè¢«è®¾è®¡ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ˜“äºå‘å¤–æ‰©å±•ï¼› å®ƒåŒæ—¶ä¸ºå‘å¸ƒå’Œè®¢é˜…æä¾›é«˜ååé‡ï¼› å®ƒæ”¯æŒå¤šè®¢é˜…è€…ï¼Œå½“å¤±è´¥æ—¶èƒ½è‡ªåŠ¨å¹³è¡¡æ¶ˆè´¹è€…ï¼› å®ƒå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå› æ­¤å¯ç”¨äºæ‰¹é‡æ¶ˆè´¹ï¼Œä¾‹å¦‚ETLï¼Œä»¥åŠå®æ—¶åº”ç”¨ç¨‹åºã€‚ å…³äºKafkaçš„ä»‹ç»ç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸å±•å¼€ï¼Œä¸»è¦è¯´æ˜ä¸€ä¸‹å¦‚ä½•æ­å»ºé›†ç¾¤ã€‚ä¸‹é¢ä»¥æ­å»ºä¸‰å°èŠ‚ç‚¹çš„é›†ç¾¤ä¸ºä¾‹å­ã€‚ä¸‰å°æœåŠ¡å™¨çš„IPä¸ºï¼š192.168.50.76, 192.168.50.77, 192.168.50.78ã€‚
1. Zookeeperæ­å»º ä»¥ä¸‹æ“ä½œåœ¨zookeeperä¸»ç›®å½•ä¸‹ã€‚
1.1 é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶./conf/zoo.cfgï¼ˆå¯ä»¥åœ¨./conf/zoo_sample.confåŸºç¡€ä¸Šä¿®æ”¹ï¼‰ï¼š
1tickTime=2000 2initLimit=10 3syncLimit=5 4# ä¿®æ”¹æˆåˆé€‚çš„è·¯å¾„ 5dataDir=/opt/tools/zookeeper_data 6clientPort=2181 7# é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦å†™åœ¨è¿™å„¿ï¼Œå¹¶ä¿è¯ç«¯å£åœ¨é›†ç¾¤ä¹‹å†…ç•…é€š 8server.1=192.168.50.76:2888:3888 9server.2=192.168.50.77:2888:3888 10server.3=192.168.50.78:2888:3888 1.2 å¯åŠ¨åœæ­¢ å¯åŠ¨å‘½ä»¤ï¼š
1./bin/zkServer.sh start åœæ­¢å‘½ä»¤ï¼š
1./bin/zkServer.sh stop 2. Kafka ä»¥ä¸‹æ“ä½œåœ¨Kafkaä¸»ç›®å½•ä¸‹è¿›è¡Œã€‚
2.1 é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶./config/server.propertiesï¼š
1# æ¯å°èŠ‚ç‚¹ä¸Šè¿™ä¸ªå€¼ä¸èƒ½ç›¸åŒï¼Œä¾‹å¦‚ç¬¬ä¸€å°ç”¨1ï¼Œç¬¬äºŒå°ç”¨2ï¼Œç¬¬ä¸‰å°ç”¨3 2broker.id=1 3port=9092 4# å…è®¸åˆ é™¤topicã€‚æ‰§è¡Œåˆ é™¤æ—¶topicå°†è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œé‡å¯åæ­£å¼åˆ é™¤æ–‡ä»¶ 5delete.topic.enable=true 6# ä¿®æ”¹æˆkeysç›®å½• 7log.dirs=/opt/tools/kafka_data 8# ç»‘å®šæœåŠ¡çš„IPã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™æ‰€æœ‰IPéƒ½ä¼šè¢«ç»‘å®šç«¯å£ã€‚æ–°ç‰ˆæ”¹æˆlisteners 9host.name=192.168.50.76 10# æ³¨å†Œåˆ°zookeeperä¸­çš„ä¸»æœºåï¼Œé¡»ç¡®ä¿é€šè¿‡å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥åœ°å€è®¿é—®åˆ°Kafkaã€‚æ–°ç‰ˆæ”¹æˆadvertised.listeners 11advertised.host.name=192.168.50.76 12# é›†ç¾¤ä½¿ç”¨çš„zookeeperä¸»æœº 13zookeeper.connect=192.168.50.76:2181,192.168.50.77:2181,192.168.50.78:2181 2.1 å¯åŠ¨åœæ­¢ 1bin/kafka-server-start.sh config/server.properties 2bin/kafka-server-stop.sh config/server.properties 2.2 åˆ›å»ºtopic 1./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test partitionsæŒ‡å®šåˆ†åŒºæ•°ï¼›replication-factoræŒ‡å®šå‰¯æœ¬æ•°ã€‚
é™„å½•. å‚è€ƒèµ„æ–™ kafkaå­¦ä¹ ç¬”è®°ï¼šçŸ¥è¯†ç‚¹æ•´ç† </content>
    </entry>
    
     <entry>
        <title>åœ¨Ubuntu 16.04 LTSä¸Šè®¾ç½®DOCKER_OPTS</title>
        <url>https://orchidflower.github.io/2017/06/22/Using-DOCKER-OPTS-on-Ubuntu-16-04-LTS/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Docker</tag><tag>Ubuntu</tag>
        </tags>
        <content type="html"> ä¹‹å‰ä¸€ç›´ä½¿ç”¨Ubuntu 14.04æ¥è·‘Dockerã€‚ä»Šå¤©åœ¨16.04 LTSä¸Šè·‘Dockerçš„æ—¶å€™å‘ç°è®¾ç½®DOCKER_OPTSçš„æ—¶å€™æœ‰äº›åŒºåˆ«ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚
1. ç—‡çŠ¶ ä¹‹å‰åœ¨Ubuntu 14.04 LTSä¸Šéƒ½æ˜¯é€šè¿‡ä¿®æ”¹/etc/default/dockeræ–‡ä»¶æ¥è®¾ç½®DOCKER_OPTSå‚æ•°çš„ï¼Œè­¬å¦‚åƒä¸‹é¢è¿™ä¸ªé…ç½®ï¼š
1# Docker Upstart and SysVinit configuration file 2DOCKER_OPTS=&amp;#34;-H unix:///var/run/docker.sock -H tcp://0.0.0.0:2345&amp;#34; æ˜¯é€šè¿‡ä½¿ç”¨-H tcp://0.0.0.0:2345å‚æ•°ï¼Œå¼€å¯Dockerçš„Remote APIç«¯å£ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡è¿œç¨‹è®¿é—®DockeræœåŠ¡ã€‚
ä»Šå¤©åœ¨16.04 LTSç‰ˆæœ¬ä¸Šå‘ç°è¿™æ ·ä¿®æ”¹ä¸èµ·ä½œç”¨ã€‚å…·ä½“è¡¨ç°æ˜¯å§‹ç»ˆæ²¡æœ‰ç»‘å®šåˆ°ç«¯å£2345ä¸Šï¼Œè¿™ä¸ªå‚æ•°æ ¹æœ¬å°±æ²¡æœ‰èµ·ä½œç”¨ã€‚
2. åŸå›  è¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› æ˜¯/etc/default/dockerè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨äºSysVinitå¯åŠ¨æœºåˆ¶çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚è€ŒUbuntu 16.04 LTSä½¿ç”¨systemdæ›¿ä»£äº†initä½œä¸ºæœåŠ¡å¯åŠ¨è¿›ç¨‹ã€‚æ–°çš„å¯åŠ¨æœºåˆ¶ä¸ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚
3. è§£å†³åŠæ³• è§£å†³åŠæ³•å°±æ˜¯ä¿®æ”¹systemdçš„å¯åŠ¨è„šæœ¬ï¼Œå¼•å…¥è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚æ‰“å¼€/lib/systemd/system/docker.serviceè¿™ä¸ªæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š
1EnvironmentFile=-/etc/default/docker 2ExecStart=/usr/bin/dockerd $DOCKER_OPTS -H fd:// ä¸Šè¿°ä¿®æ”¹é€šè¿‡EnvironmentFileæŒ‡å®šäº†ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆå†…å®¹å‚è€ƒä¸Šé¢ï¼‰ã€‚ç„¶ååœ¨ExecStartä¸­ä½¿ç”¨äº†åœ¨ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­å®šä¹‰çš„DOCKER_OPTSç¯å¢ƒå˜é‡ã€‚è¿™æ ·ä¿®æ”¹ä»¥åï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹/etc/default/dockeræ–‡ä»¶æ¥ä¿®æ”¹DOCKER_OPTSå˜é‡äº†ã€‚
ä¿®æ”¹ä¸Šè¿°æ–‡ä»¶ä¹‹åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆï¼š
1sudo systemctl daemon-reload 2sudo service docker restart é™„å½• Ubuntu 16.04 DOCKER_OPTS </content>
    </entry>
    
     <entry>
        <title>åœ¨Macä¸Šè¿è¡ŒSOAPUI 5.3.0</title>
        <url>https://orchidflower.github.io/2017/06/21/Running-SOAPUI-5-3-0-on-Mac-OSX/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>SOAPUI</tag><tag>Mac</tag><tag>SOAP</tag>
        </tags>
        <content type="html"> 0. å‰è¨€ Macä¸Šæ‰¾ä¸åˆ°ç‰¹åˆ«å¥½çš„SOAP Webserviceæµ‹è¯•å·¥å…·ã€‚ä»¥å‰ç”¨è¿‡SOAP UIï¼Œæ„Ÿè§‰å¾ˆå¥½ã€‚ä½†æ˜¯SOAP UIåœ¨Macä¸Šå®‰è£…æœ‰äº›é—®é¢˜ã€‚ç‰¹æ­¤è®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ã€‚
SoapUIç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯5.3.0ï¼Œç›®å‰å·²ç»å¼€æºã€‚SmartBearåœ¨SOAP UIä¹‹åå‘å¸ƒäº†æ–°ç‰ˆæœ¬æ›´åä¸ºSOAPUI NGã€‚SOAPUI NGä½“ç§¯å¤§äº†å¾ˆå¤šï¼Œè€Œä¸”åŠŸèƒ½æ›´åŠ ç¹çï¼Œä¸ªäººæ„Ÿè§‰è¿˜ä¸å¦‚ä»¥å‰çš„ç‰ˆæœ¬å¥½ç”¨ã€‚SoapUIä»¥å‰æ”¶è´¹ï¼Œåˆ°äº†5.2.1ä»¥åç‰ˆæœ¬å°±å¼€æºå¹¶ä¸”å…è´¹äº†ã€‚
SoapUIåœ¨Macä¼šå‡ºç°æ— å“åº”çš„ç°è±¡ï¼šç•Œé¢èƒ½å¤Ÿæ‰“å¼€ï¼Œä½†æ˜¯ç”»é¢å¡ä½ï¼Œé¼ æ ‡æ˜¾ç¤ºæˆæ—‹è½¬å½©çƒï¼Œæ— æ³•æ“ä½œã€‚è¦æ­£å¸¸ä½¿ç”¨éœ€è¦ä¿®æ”¹ä¸€ä¸‹æ‰è¡Œã€‚
1. å®‰è£…è¿‡ç¨‹ å› ä¸ºSoapUIæ˜¯Javaç¨‹åºï¼Œæ‰€ä»¥æˆ‘å®‰è£…çš„æ˜¯zipåŒ…ã€‚ä¸ä½¿ç”¨å®ƒçš„å®‰è£…æ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚ä¸‹è½½åœ°å€ï¼šhttps://www.soapui.org/downloads/soapui.htmlã€‚ä¸‹è½½å…¶Macç‰ˆæœ¬çš„zipåŒ…å³å¯ã€‚
è§£å‹ä¹‹åï¼Œæ‰¾åˆ°/bin/soapui.shï¼Œå¤åˆ¶æˆsoapui.commandã€‚ç„¶åæ‰“å¼€soapui.commandï¼Œä¿®æ”¹ï¼š
1if [ $SOAPUI_HOME != &amp;#34;&amp;#34; ] 2then 3 JAVA_OPTS=&amp;#34;$JAVA_OPTS -Dsoapui.ext.libraries=$SOAPUI_HOME/bin/ext&amp;#34; 4 JAVA_OPTS=&amp;#34;$JAVA_OPTS -Dsoapui.ext.listeners=$SOAPUI_HOME/bin/listeners&amp;#34; 5 JAVA_OPTS=&amp;#34;$JAVA_OPTS -Dsoapui.ext.actions=$SOAPUI_HOME/bin/actions&amp;#34; 6	JAVA_OPTS=&amp;#34;$JAVA_OPTS -Djava.library.path=$SOAPUI_HOME/bin&amp;#34; 7	JAVA_OPTS=&amp;#34;$JAVA_OPTS -Dwsi.dir=$SOAPUI_HOME/wsi-test-tools&amp;#34; 8#uncomment to disable browser component 9 #JAVA_OPTS=&amp;#34;$JAVA_OPTS -Dsoapui.browser.disabled=true&amp;#34; 10fi å°†æœ€åä¸€ä¸ªæ³¨é‡Šæ‰“å¼€å³å¯ã€‚
2. å‡ ä¸ªå¿ƒå¾— ä½¿ç”¨JDK 6å·²ç»æ— æ³•è¿è¡ŒSoapUI 5.3.0äº†ã€‚è‡³å°‘éœ€è¦JDK7ï¼› è¿è¡ŒSoapUIä¼šè‡ªåŠ¨åˆ‡æ¢GPUåˆ°ç‹¬ç«‹æ˜¾å¡ï¼Œç›®å‰æ²¡æœ‰å¥½çš„è§£å†³åŠæ³•ï¼› ä¸Šé¢çš„ä¿®æ”¹æ–¹æ³•ä¸­-Dsoapui.browser.disabled=trueæ·»åŠ åˆ°JAVA_OPTSå¼€å§‹éƒ¨åˆ†å±…ç„¶ä¸ç®¡ç”¨ï¼Œå¿…é¡»æ·»åŠ åˆ°æœ€åï¼› é™„å½•ä¸­æåˆ°éœ€è¦ä¿®æ”¹soapui-settings.xmlï¼Œå®è·µè¯æ˜å¹¶ä¸éœ€è¦ï¼› soapui-settings.xmlä¼šè‡ªåŠ¨åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•åˆ›å»ºã€‚ é™„å½•A. å‚è€ƒèµ„æ–™ Installing SoapUI on Mac Fix for soapUI freezing on Mac OS X Lion </content>
    </entry>
    
     <entry>
        <title>åœ¨Macä¸Šå¦‚ä½•å®‰è£…FastDFS</title>
        <url>https://orchidflower.github.io/2017/06/18/How-to-install-FastDFS-on-Mac/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Mac</tag><tag>FastDFS</tag>
        </tags>
        <content type="html"> é¡¹ç›®ä¸­ç”¨åˆ°äº†FastDFSæ¥åšæ–‡ä»¶å­˜å‚¨ã€‚æœ€è¿‘é‡æ„çš„æ—¶å€™ï¼Œå› ä¸ºç»å¸¸å¤„äºç§»åŠ¨åŠå…¬çš„çŠ¶æ€ï¼Œæ‰€ä»¥è®¿é—®å…¬å¸çš„æœåŠ¡å™¨ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æ„Ÿè§‰æœ‰å¿…è¦åœ¨æœ¬æœºä¸Šæ­å»ºä¸€å¥—FastDFSçš„æµ‹è¯•ç¯å¢ƒã€‚
FastDFSæ˜¯ä»€ä¹ˆï¼Ÿ
FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚ç‰¹åˆ«é€‚åˆä»¥æ–‡ä»¶ä¸ºè½½ä½“çš„åœ¨çº¿æœåŠ¡ï¼Œå¦‚ç›¸å†Œç½‘ç«™ã€è§†é¢‘ç½‘ç«™ç­‰ç­‰ã€‚ FastDFSä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚ FastDFSé‡Œé¢æœ‰ä¸¤ç§è§’è‰²ï¼šTrackerã€Storageã€‚Trackerä¸»è¦åšè°ƒåº¦å·¥ä½œï¼Œåœ¨è®¿é—®ä¸Šèµ·è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚Storageå­˜å‚¨èŠ‚ç‚¹å­˜å‚¨æ–‡ä»¶ï¼Œå®Œæˆæ–‡ä»¶ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½ï¼šå­˜å‚¨ã€åŒæ­¥å’Œæä¾›å­˜å–æ¥å£ï¼ŒFastDFSåŒæ—¶å¯¹æ–‡ä»¶çš„meta dataè¿›è¡Œç®¡ç†ã€‚æ‰€è°“æ–‡ä»¶çš„meta dataå°±æ˜¯æ–‡ä»¶çš„ç›¸å…³å±æ€§ï¼Œä»¥é”®å€¼å¯¹ï¼ˆkey value pairï¼‰æ–¹å¼è¡¨ç¤ºï¼Œå¦‚ï¼šwidth=1024ï¼Œå…¶ä¸­çš„keyä¸ºwidthï¼Œvalueä¸º1024ã€‚æ–‡ä»¶meta dataæ˜¯æ–‡ä»¶å±æ€§åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ã€‚
1. Dockeræ–¹å¼ å› ä¸ºä¹‹å‰ç”¨Dockerç”¨çš„æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨Dockeræ¥è¿è¡ŒFastDFSã€‚ä¸Šhub.docker.ioä¸Šæ‰¾äº†æ‰¾é•œåƒï¼Œæœ€åé€‰æ‹©äº†luhuiguo/fastdfsè¿™ä¸ªé•œåƒã€‚å¾ˆå¿«å†™äº†ä¸€ä¸ªdocker-composeè„šæœ¬ï¼š
1version: &amp;#39;3.3&amp;#39; 2services: 3 tracker: 4 image: luhuiguo/fastdfs 5 ports: 6 - &amp;#34;22122:22122&amp;#34; 7 command: 8 - tracker 9 volumes: 10 # let container use same timezone as host 11 - /etc/localtime:/etc/localtime 12 - /opt/docker/fastdfs/tracker:/var/fdfs 13 storage: 14 image: luhuiguo/fastdfs 15 ports: 16 - &amp;#34;23000:23000&amp;#34; 17 links: 18 - tracker 19 command: 20 - storage 21 environment: 22 TRACKER_SERVER: 192.168.255.199:22122 23 GROUP_NAME: group1 24 volumes: 25 - /etc/localtime:/etc/localtime 26 - /opt/docker/fastdfs/storage:/var/fdfs æ‰§è¡Œèµ·æ¥ï¼Œçœ‹èµ·æ¥ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚ä½†æ˜¯ä½¿ç”¨ç¨‹åºè®¿é—®çš„æ—¶å€™å´å¤±è´¥äº†ã€‚æŠ›å‡ºäº†å¼‚å¸¸ï¼šjava.net.SocketTimeoutException: connect timed outã€‚é€šè¿‡è·Ÿè¸ªä»£ç å‘ç°äº†åŸå› ï¼šä½¿ç”¨dockerçš„æ—¶å€™ï¼Œstorageå‘trackeræ±‡æŠ¥çš„åœ°å€æ˜¯dockerå†…éƒ¨çš„åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€åœ¨Macæœ¬æœºæ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ã€‚é€šè¿‡ä»£ç è®¿é—®Trackerçš„æ—¶å€™è¿”å›çš„åœ°å€å°±æ˜¯dockerå†…éƒ¨çš„åœ°å€ï¼Œè‡ªç„¶ä¼šå‡ºç°SocketTimeoutExceptionäº†ã€‚
1.1 network hostæ¨¡å¼ å› ä¸ºçŸ¥é“dockeræœ‰hostè¿™ä¸€ç½‘ç»œæ¨¡å¼ï¼Œå¯ä»¥ä½¿dockerå®¹å™¨ä½¿ç”¨ä¸å®¿ä¸»æœºä¸€æ ·çš„ç½‘ç»œã€‚æ„Ÿè§‰ä¸Šè¿™æ ·æˆ–è®¸å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œè€Œä¸”é•œåƒçš„è¯´æ˜ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹ã€‚äºæ˜¯åŠ ä¸Šäº†network_mode: hostã€‚ä½†æ˜¯å¯åŠ¨ä¹‹åå‘ç°è¿˜æ˜¯ä¸€æ ·çš„é”™è¯¯ã€‚ç»è¿‡æœç´¢æ‰¾åˆ°äº†åŸå› ï¼š
**Macä¸Šçš„Dockerå®é™…ä¸Šæ˜¯é€šè¿‡è™šæ‹ŸåŒ–æ–¹å¼è¿è¡Œåœ¨Macç³»ç»Ÿä¸Šçš„ã€‚é€šè¿‡xhyveæŠ€æœ¯æ¨¡æ‹Ÿå‡ºæ¥ä¸€å°Linuxä¸»æœºï¼Œç„¶ååœ¨å…¶ä¸­è·‘Dockerè¿›ç¨‹ã€‚å½“ä½¿ç”¨hostæ¨¡å¼è·‘çš„æ—¶å€™ï¼Œdockerä½¿ç”¨çš„æ˜¯è¿™ä¸ªè™šæ‹Ÿå‡ºæ¥çš„Linuxä¸»æœºçš„ç½‘ç»œä½œä¸ºHostç½‘ç»œï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨Macä¸»æœºçš„ç½‘ç»œã€‚å› æ­¤ä¾ç„¶æ— æ³•è¿æ¥æ˜¯æ­£å¸¸çš„ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Macä¸»æœºä¸Šï¼Œhostè¿™ç§ç½‘ç»œæ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚
2. æœ¬æœºç¼–è¯‘æ‰§è¡Œ æ—¢ç„¶ä½¿ç”¨Dockeræ— æ³•è¿è¡ŒFastDFSï¼Œé‚£åªèƒ½é€šè¿‡ç¼–è¯‘æºç æ¥è¿è¡Œäº†ã€‚æœ€æ–°ç‰ˆæœ¬çš„FastDFSå·²ç»å¯ä»¥ç›´æ¥åœ¨Macä¸Šç¼–è¯‘äº†ï¼ˆä¸éœ€è¦ä¿®æ”¹æºç ï¼‰ã€‚å› æ­¤è¿™ç§æ–¹æ³•ä¹Ÿä¸éš¾ã€‚ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š
2.0 å…³é—­ç³»ç»Ÿä¿æŠ¤ ä»OSX 10.11å¼€å§‹ï¼ŒMacå¯¹å…³é”®ç›®å½•è¿›è¡Œäº†ä¿æŠ¤ï¼ˆä¾‹å¦‚ï¼š/bin, /usr/binç­‰ï¼‰ã€‚è€Œè¦ç¼–è¯‘FastDFSå´æ˜¯è¦å®‰è£…æ–‡ä»¶åˆ°/usr/binç­‰ç›®å½•ä¸‹ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦ç¦ç”¨ç³»ç»Ÿä¿æŠ¤ã€‚å…³é—­çš„æ–¹æ³•å¦‚ä¸‹ï¼š
é‡å¯ç³»ç»Ÿï¼Œé‡å¯çš„è¿‡ç¨‹ä¸­æŒ‰ä½Command&#43;Rè¿›å…¥Recoveryæ¨¡å¼ï¼› ä»èœå•ä¸­é€‰æ‹©â€œç»ˆç«¯â€æˆ–â€œTerminalâ€è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼› è¾“å…¥å‘½ä»¤csrutil disableå…³é—­ä¿æŠ¤æ¨¡å¼ï¼Œç„¶åè¾“å…¥rebooté‡å¯ç³»ç»Ÿå³å¯ã€‚ 2.1 libfastcommon FastDFSä¾èµ–äºlibfastcommonï¼Œå› æ­¤éœ€è¦é¦–å…ˆç¼–è¯‘ã€å®‰è£…libfastcommonï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š
1unzip libfastcommon-1.0.35.zip 2cd libfastcommon-1.0.35 3./make.sh 4./make.sh install 2.2 fastdfs FastDFSæºç é€šè¿‡Githubä¸‹è½½ã€‚ä¸‹é¢ä»¥æœ€æ–°çš„5.10ä¸ºä¾‹ã€‚ç¼–è¯‘ã€å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š
1unzip fastdfs-5.10.zip 2cd fastdfs-5.10 3./make.sh 4./make.sh install å®‰è£…æˆåŠŸåï¼ŒFastDFSç›¸å…³çš„å¯æ‰§è¡Œæ–‡ä»¶è¢«å®‰è£…åˆ°/usr/binç›®å½•ä¸‹ã€‚ç›¸å…³çš„é…ç½®æ–‡ä»¶è¢«æ”¾åœ¨/etc/fdfsä¸‹ï¼Œè¿™å’Œåœ¨Linuxä¸Šå®‰è£…çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚
2.3 å¯åŠ¨tracker ä¸‹é¢é¦–å…ˆå¯åŠ¨TrackeræœåŠ¡ã€‚é¦–å…ˆå‡†å¤‡å­˜å‚¨æ•°æ®çš„ç›®å½•ï¼ŒTrackerå°†ä¼šåœ¨è¯¥ç›®å½•ä¸­ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯ä»¥åŠæ—¥å¿—æ–‡ä»¶ï¼š
1mkdir -p /opt/tools/fastdfs/tracker 2chown -R cap:cap /opt/tools/fastdfs/tracker ç„¶åå‡†å¤‡é…ç½®æ–‡ä»¶ï¼Œä»sampleæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä»¥ä¾¿ä¿®æ”¹ï¼š
1cd /etc/fdfs 2cp tracker.conf.sample tracker.conf ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶/etc/fdfs/tracker.confï¼Œåœ¨Macä¸Šå•æœºå®‰è£…åªéœ€è¦ä¿®æ”¹base_pathï¼Œä¿®æ”¹æˆä¸Šé¢åˆšåˆšåˆ›å»ºçš„ç›®å½•ï¼š
1base_path=/opt/tools/fastdfs/tracker ç„¶åå¯åŠ¨fastdfsï¼Œå¯åŠ¨å®Œæˆä¹‹ååº”è¯¥å ç”¨äº†22122ç«¯å£ï¼š
1/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf 2netstat -nl | grep 22122 å¯åŠ¨æœåŠ¡ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š
1/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start åœæ­¢æœåŠ¡å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š
1/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop 2.4 å¯åŠ¨storage é¦–å…ˆè¿˜æ˜¯å‡†å¤‡ç›®å½•ä¾›StorageèŠ‚ç‚¹ä½¿ç”¨ï¼š
1mkdir -p /opt/tools/fastdfs/storage 2chown -R cap:cap /opt/tools/fastdfs/storage å‡†å¤‡é…ç½®æ–‡ä»¶ï¼š
1cp storage.conf.sample storage.conf ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š
1# åŸºæœ¬è·¯å¾„ï¼Œæ—¥å¿—ç­‰å­˜å‚¨åœ¨è¯¥ç›®å½•ä¸‹ 2base_path=/opt/tools/fastdfs/storage 3# å­˜å‚¨ç›®å½•ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªã€‚FastDFSä¼šæŒ‰ç…§è°ƒåº¦æ–¹æ³•ä½¿ç”¨è¿™äº›ä¸åŒçš„ç›®å½•ã€‚é»˜è®¤ä½¿ç”¨Round Robinè°ƒåº¦æ–¹æ³•ã€‚ 4store_path0=/opt/tools/fastdfs/storage 5# å¦‚æœéƒ¨ç½²é›†ç¾¤çš„è¯ï¼Œåªè¦å¤šå†™å‡ ä¸ªtracker_serverå°±å¯ä»¥äº†ã€‚ 6tracker_server=192.168.255.199:22122 å¯åŠ¨æœåŠ¡å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š
1/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start åœæ­¢æœåŠ¡å‘½ä»¤ï¼š
1/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop é™„å½•A. å‚è€ƒèµ„æ–™ FastDFS FastDFS on Github FastDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé›†ç¾¤å®‰è£…ä¸é…ç½® Unable to connect to container using host network from host How to turn off system integrity protection on OS X </content>
    </entry>
    
     <entry>
        <title>Nginxé…ç½®å¯¼è‡´çš„SSLè¯ä¹¦è®¤è¯å¤±è´¥</title>
        <url>https://orchidflower.github.io/2017/06/03/SSL-Authentication-Failure-caused-by-Nginx-Proxy/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Nginx</tag><tag>SSL</tag><tag>è¯ä¹¦</tag>
        </tags>
        <content type="html">  æ³¨ï¼š è¿™æ˜¯åœ¨ä¹‹å‰åšå®¢ä¸Šå‘è¿‡çš„æ–‡ç« ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ç»å¸¸ä¼šæœ‰äººç¢°åˆ°ï¼Œç‰¹æ„è½¬è´´è¿‡æ¥ã€‚
1. èƒŒæ™¯ ç›®å‰å…¬å¸å¯¹å¤–å¼€æ”¾äº†ä¸€ä¸ªäº‘æœåŠ¡å¹³å°ï¼Œæä¾›ä¸€äº›åŠŸèƒ½ä¾›å•†æˆ·æ¥å…¥ä½¿ç”¨ã€‚æ•´ä¸ªé¡¹ç›®çš„æ¶æ„æ˜¯åŸºäºSpring &#43; MyBatisçš„ã€‚å¦å¤–ï¼Œå•†æˆ·ç«¯çš„æœåŠ¡æ¥å£æ˜¯åŸºäºSOAP WebServiceçš„ï¼Œè¿™éƒ¨åˆ†ä½¿ç”¨CXFå®ç°ã€‚ å®‰å…¨æ–¹é¢é‡‡ç”¨äº†Spring Securityï¼Œå¯ä»¥å¯¹å•†æˆ·æä¾›è¯ä¹¦è®¤è¯æˆ–å¯†ç è®¤è¯ã€‚ä½†æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç›®å‰åªå¼€æ”¾äº†è¯ä¹¦è®¤è¯ã€‚ä¸ºäº†ä½¿ç”¨è¯ä¹¦è®¤è¯å•†æˆ·ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªç­¾åçš„CAï¼Œç”¨æ¥ç”Ÿæˆå•†æˆ·ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚åœ¨éªŒè¯ä¸Šï¼Œä½¿ç”¨NginxéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦æ˜¯å¦æ˜¯æŒ‡å®šCAäº§ç”Ÿçš„ã€‚å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢è¢«ä½œåºŸçš„è¯ä¹¦ï¼ˆä¾‹å¦‚ç»™å•†æˆ·é¢å‘äº†æ–°è¯ä¹¦åï¼ŒåŸè¯ä¹¦åº”è¯¥ä½œåºŸï¼Œä½†æ˜¯åŸè¯ä¹¦ä¹Ÿæ˜¯ç”±æŒ‡å®šCAäº§ç”Ÿçš„ï¼‰å†æ¬¡ä½¿ç”¨ï¼Œåœ¨ä»£ç å±‚é¢å¯¹è¯ä¹¦è¿›è¡Œäº†è¿›ä¸€æ­¥çš„éªŒè¯ï¼ˆè¿™ä¸€ç‚¹æ˜¯é€šè¿‡Nginxå°†å®¢æˆ·ç«¯è¯ä¹¦ä½œä¸ºHeaderä¼ é€’åˆ°Javaåå°å®ç°çš„ï¼Œæœ‰æ—¶é—´ä»¥åå†è®²ï¼‰ã€‚
2. éƒ¨ç½²æ¶æ„ äº‘æœåŠ¡å¹³å°éƒ¨ç½²åœ¨aliyunä¸Šï¼Œå¤§è‡´ä¸Šç»“æ„æ˜¯è¿™æ ·çš„ï¼ˆåªæ¶‰åŠåˆ°äº†ç½‘ç»œè®¿é—®å±‚é¢çš„ä¸œè¥¿ï¼‰ï¼š
1å•†æˆ· -https-&amp;gt; aliyunè´Ÿè½½å‡è¡¡ -tcpè½¬å‘-&amp;gt; Nginx -http-&amp;gt; Jetty --&amp;gt; ClientCertificateFromProxyFilter å•†æˆ·è®¿é—®äº‘æœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨æˆ‘ä»¬æä¾›çš„å®¢æˆ·ç«¯è¯ä¹¦æ¥å»ºç«‹httpsé“¾æ¥ã€‚aliyunçš„LBåªè´Ÿè´£TCPè½¬å‘ï¼Œä¸å¯¹åè®®è¿›è¡Œåˆ†æã€‚å› æ­¤ä»aliyunåˆ°Nginxä¹‹é—´å®é™…çš„æ•°æ®æµæ˜¯httpsæ•°æ®æµã€‚Nginxæ¥å—åˆ°è¯·æ±‚åï¼ŒéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦æ˜¯å¦æ­£ç¡®ï¼Œå¹¶å°†å®¢æˆ·ç«¯è¯ä¹¦è®¾ç½®ä¸ºHTTPè¯·æ±‚ä¸­çš„Headerå˜é‡ï¼Œç„¶åè¯·æ±‚åå°çš„JettyæœåŠ¡å™¨ã€‚ æˆ‘ä»¬ä»£ç ä¸­å®ç°äº†ä¸€ä¸ªFilterï¼ˆClientCertificateFromProxyFilterï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯æ£€æŸ¥è¿‡æ¥çš„HTTPè¯·æ±‚ä¸­æœ‰æ²¡æœ‰å˜é‡SSL_CLIENT_CERTï¼Œå¦‚æœæœ‰åˆ™æŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªCertificateå¯¹è±¡ï¼Œæ·»åŠ åˆ°HTTPè¯·æ±‚ä¸­ï¼Œä»è€Œå°†ä¸€ä¸ªHTTPè¯·æ±‚æ¨¡æ‹Ÿæˆä¸€ä¸ªHTTPSè¯·æ±‚ï¼Œè¿™æ ·Spring Securityå°±èƒ½å¤Ÿè¿›è¡Œè¯ä¹¦è®¤è¯äº†ã€‚
3. é—®é¢˜ åœ¨ä¸Šçº¿ä¹‹å‰ï¼ŒæŒ‰ç…§ä»¥å¾€çš„ç»éªŒï¼Œæˆ‘ä»¬æµ‹è¯•äº†é€šè¿‡æµè§ˆå™¨è®¿é—®å—ä¿æŠ¤çš„èµ„æºæ¥æµ‹è¯•HTTPSæ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚å› ä¸ºæå‰åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥äº†å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå› æ­¤æµè§ˆå™¨ä¸Šèƒ½å¤Ÿå¼¹å‡ºå¯¹è¯æ¡†é€‰æ‹©å®¢æˆ·ç«¯è¯ä¹¦ï¼Œé€‰æ‹©ä¹‹åå°±èƒ½å¤Ÿè®¿é—®æŒ‡å®šçš„èµ„æºäº†ã€‚
æˆ‘ä»¬æ¨èå•†æˆ·ä½¿ç”¨CXFä½œä¸ºæ¥å…¥æ–¹å¼ï¼Œä¸€èˆ¬çš„ä»£ç å¦‚ä¸‹ï¼š
1&amp;lt;jaxws:client id=&amp;#34;uidService&amp;#34; 2	serviceClass=&amp;#34;com.xwf.cloudauth....&amp;#34; 3	address=&amp;#34;https://.../api/UidApiService&amp;#34;&amp;gt; 4&amp;lt;/jaxws:client&amp;gt; 5&amp;lt;http-conf:conduit name=&amp;#34;*.http-conduit&amp;#34;&amp;gt; 6	&amp;lt;http-conf:tlsClientParameters disableCNCheck=&amp;#34;true&amp;#34;&amp;gt; 7	&amp;lt;sec:keyManagers keyPassword=&amp;#34;123456&amp;#34;&amp;gt; 8	&amp;lt;sec:keyStore type=&amp;#34;PKCS12&amp;#34; password=&amp;#34;123456&amp;#34; resource=&amp;#34;...com.p12&amp;#34;/&amp;gt; 9	&amp;lt;/sec:keyManagers&amp;gt; 10	&amp;lt;sec:trustManagers&amp;gt; 11	&amp;lt;sec:keyStore type=&amp;#34;JKS&amp;#34; password=&amp;#34;changeit&amp;#34; resource=&amp;#34;cacerts&amp;#34; /&amp;gt; 12	&amp;lt;/sec:trustManagers&amp;gt; 13	&amp;lt;/http-conf:tlsClientParameters&amp;gt; 14	&amp;lt;http-conf:client Connection=&amp;#34;Keep-Alive&amp;#34; 15	MaxRetransmits=&amp;#34;1&amp;#34; AllowChunking=&amp;#34;false&amp;#34; /&amp;gt; 16&amp;lt;/http-conf:conduit&amp;gt; ä½†æ˜¯å•†æˆ·å®é™…æ¥å…¥çš„æ—¶å€™å´ç¢°åˆ°äº†é—®é¢˜ï¼š
1Caused by: org.apache.cxf.transport.http.HTTPException: HTTP response &amp;#39;401: Full authentication is required to access this resource&amp;#39; when communicating with https://... 2	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:1549) 3	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:1504) 4	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:1310) 5	at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:56) 6	at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:628) 7	at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62) 8	... 38 more 4. è§£å†³è¿‡ç¨‹ 401é”™è¯¯ä»£è¡¨æœªæˆæƒï¼Œæ‰€ä»¥é¦–å…ˆæ€€ç–‘æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ä¸æ­£ç¡®ã€‚
4.1 åˆ‡æ¢åˆ°æœ¬åœ°æµ‹è¯• æ”¶åˆ°å®¢æˆ·åé¦ˆä¹‹åï¼Œé¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯è¯ä¹¦å‘æ”¾çš„ä¸æ­£ç¡®ï¼Œæ¯•ç«Ÿå·²ç»é€šè¿‡æµè§ˆå™¨é€šè¿‡äº†æµ‹è¯•ã€‚ é¦–å…ˆåœ¨æœ¬åœ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œäº†æµ‹è¯•ã€‚å› ä¸ºä¹‹å‰æµ‹è¯•åå¢ƒä¸­é…ç½®çš„è¿æ¥æœåŠ¡çš„ä»£ç ä¸­å¯ç”¨äº†ç”¨æˆ·åå¯†ç è®¤è¯ï¼Œå› æ­¤é¦–å…ˆåšçš„æ˜¯å°†ç”¨æˆ·åã€å¯†ç è®¤è¯éƒ¨åˆ†å±è”½æ‰ï¼Œç„¶åè¿›è¡Œæµ‹è¯•ï¼Œç»“æœè¿˜çœŸå‘ç°äº†é—®é¢˜ã€‚ è¿™ä¸‹å­æœ‰ç‚¹ç€æ€¥äº†ï¼Œæ‹…å¿ƒæœ‰å¤§çš„bugå­˜åœ¨ã€‚æ¯•ç«Ÿäº§å“å·²ç»ä¸Šçº¿ï¼Œç¢°åˆ°è¿™ç§bugå¯æ¯”è¾ƒéº»çƒ¦äº†ã€‚
4.2 æœ¬åœ°é—®é¢˜çš„è§£å†³ ç»è¿‡æ·»åŠ æ—¥å¿—ã€æ–­ç‚¹åœ¨æœ¬åœ°ç¯å¢ƒè¿›è¡Œäº†è°ƒè¯•ï¼Œæ‰¾åˆ°äº†æœ¬åœ°æŠ¥401é”™è¯¯çš„åŸå› ï¼šæœ¬åœ°ç¯å¢ƒä¸­çš„è¯ä¹¦æ˜¯è¢«åºŸå¼ƒæ‰çš„äº†ï¼Œæœ¬åœ°ç¯å¢ƒè¯ä¹¦é‡å‘åå¹¶æ²¡æœ‰åŒæ­¥åˆ°æœ¬åœ°SVNä¸­ï¼Œå› æ­¤æ‰ä¼šå‡ºç°401é”™è¯¯ã€‚è¯ä¹¦é€šè¿‡äº†Nginxçš„éªŒè¯ï¼Œä½†æ˜¯è¢«Javaå±‚çš„ä»£ç æ‹¦æˆªæ‰ï¼ˆå› ä¸ºå®¢æˆ·æäº¤è¿‡æ¥çš„ä»£ç ä¸æ•°æ®åº“ä¸­ç”¨æˆ·ç›¸å…³çš„è¯ä¹¦ä¸ä¸€è‡´ï¼‰ã€‚ é€šè¿‡å°†æœ¬åœ°è¯ä¹¦æ›¿æ¢ä¹‹åï¼Œé—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚åŸæ¥æœ¬åœ°ç¯å¢ƒåªæ˜¯è™šæƒŠä¸€åœºã€‚
4.3 å‘å¸ƒè°ƒè¯•ç‰ˆæœ¬ æœ¬åœ°ç¯å¢ƒé—®é¢˜è§£å†³ä¹‹åï¼Œæ›´åŠ æ€€ç–‘ç”Ÿäº§ç¯å¢ƒçš„é—®é¢˜æ¥æºäºè¯ä¹¦ä¸åŒ¹é…ã€‚ä½†æ˜¯ç»è¿‡ä»”ç»†åˆ†æå®¢æˆ·è¯ä¹¦æ–‡ä»¶åŠæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œå‘ç°å¹¶ä¸èƒ½å¤Ÿæ”¯æŒè¿™ç§æƒ³æ³•ã€‚ æ²¡æœ‰åŠæ³•çš„æƒ…å†µä¸‹ï¼Œåªå¥½åœ¨ä»£ç ä¸­ï¼ˆä¸»è¦æ˜¯ClientCertificateFromProxyFilterï¼‰æ·»åŠ äº†æ›´å¤šçš„è°ƒè¯•ä¿¡æ¯ï¼Œä¸´æ—¶å‘å¸ƒäº†è°ƒè¯•ç‰ˆæœ¬ã€‚å†æ¬¡æµ‹è¯•ï¼Œå‘ç°åœ¨ClientCertificateFromProxyFilterä¸­æ²¡æœ‰æ”¶åˆ°SSL_CLIENT_CERTè¿™ä¸ªå˜é‡ã€‚åˆæ­¥æ–­å®šé—®é¢˜å‡ºåœ¨Nginxè½¬å‘ä¸Šï¼ˆä»Nginxåˆ°Jettyæ²¡æœ‰è½¬å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼‰ã€‚
4.4 Wireshark ç¡®å®šé—®é¢˜å‡ºåœ¨Nginxå±‚ä¹‹åäº‹æƒ…é™·å…¥äº†åƒµå±€ï¼Œå› ä¸ºå®åœ¨ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ç§æƒ…å†µã€‚ å› ä¸ºå‰ä¸€é˜µå­ç ”ç©¶è¿‡SSLæ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå½“æ—¶ä½¿ç”¨è¿‡Wiresharkè¿›è¡Œè¿‡ç½‘ç»œæŠ“åŒ…ã€‚å½“äº‹æƒ…é™·å…¥åƒµå±€çš„æ—¶å€™ï¼Œæƒ³èµ·æ¥å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•åˆ†æä¸€ä¸‹åè®®ã€‚ç»è¿‡æŠ“åŒ…ï¼Œæ¯”å„ä¸ªç¯å¢ƒï¼ˆæµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒ/æµè§ˆå™¨åŠJavaç¯å¢ƒï¼‰ï¼Œå‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼ŒåŸæ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸ŠJavaæ ¹æœ¬æ²¡æœ‰å‘é€å®¢æˆ·ç«¯è¯ä¹¦åˆ°Nginxä¸Šå»ï¼
4.5 åè®®åˆ†æ æ²¡æœ‰åŠæ³•çš„æƒ…å†µä¸‹ï¼Œåªå¥½å›å¤´åˆå»åˆ†æSSLåè®®ï¼š
SSLæˆ‘æ¡æ‰‹è¿‡ç¨‹ SSLåè®®ï¼ˆHTTPSï¼‰æ¡æ‰‹ã€å·¥ä½œæµç¨‹åˆ†æï¼ˆåŒå‘HTTPSåˆ†æï¼‰ ä½¿ç”¨Wiresharkè§‚å¯ŸSSL/TLSæ¡æ‰‹è¿‡ç¨‹-åŒå‘è®¤è¯ã€å•é¡¹è®¤è¯ å‘ç°åœ¨åŒå‘è®¤è¯è¿‡ç¨‹ä¸­ï¼Œåœ¨server hello doneç»“æŸä¹‹å‰ï¼ŒæœåŠ¡å™¨åº”è¯¥å‘é€certificate request åˆ°å®¢æˆ·ç«¯ã€‚è¿™æ ·å®¢æˆ·ç«¯æ‰èƒ½å¤Ÿå†³å®šå‘é€å®¢æˆ·ç«¯è¯ä¹¦åˆ°æœåŠ¡å™¨è¿›è¡Œè®¤è¯ã€‚ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Javaè®¿é—®çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æ²¡æœ‰å‘é€è¯¥è¯·æ±‚ï¼›ä½†æ˜¯å¥‡æ€ªçš„æ˜¯å½“ä½¿ç”¨æµè§ˆå™¨è®¿é—®çš„æ—¶å€™ï¼Œè¿™ä¸ªè¯·æ±‚åˆå‡ºç°äº†ã€‚
4.6 SNI å†æ¬¡é™·å…¥äº†åƒµå±€ã€‚åŒæ ·çš„HTTPSè¯·æ±‚ä¸ºä»€ä¹ˆä¼šå¯¼è‡´ä¸åŒçš„è®¤è¯é¡ºåºå’Œç»“æœå‘¢ï¼Ÿç»è¿‡æ¼«é•¿çš„ï¼Œæ¼«æ— ç›®çš„çš„æœç´¢åï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€ç‚¹çœ‰ç›®ã€‚åŸæ¥è¿™æ˜¯ä¸€ä¸ªå…¼å®¹æ€§é—®é¢˜ï¼šSNIã€‚ è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹SNIçš„æ¦‚å¿µï¼š
SNIï¼ˆServer Name Indicationï¼‰æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªæœåŠ¡å™¨ä½¿ç”¨å¤šä¸ªåŸŸåå’Œè¯ä¹¦çš„SSL/TLSæ‰©å±•ã€‚ä¸€å¥è¯ç®€è¿°å®ƒçš„å·¥ä½œåŸç†å°±æ˜¯ï¼Œåœ¨è¿æ¥åˆ°æœåŠ¡å™¨å»ºç«‹SSLè¿æ¥ä¹‹å‰å…ˆå‘é€è¦è®¿é—®ç«™ç‚¹çš„åŸŸåï¼ˆHostnameï¼‰ï¼Œè¿™æ ·æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªåŸŸåè¿”å›ä¸€ä¸ªåˆé€‚çš„è¯ä¹¦ã€‚ç›®å‰ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨éƒ½å·²ç»å¾ˆå¥½åœ°æ”¯æŒSNIæ‰©å±•ï¼ŒOpenSSL 0.9.8å·²ç»å†…ç½®è¿™ä¸€åŠŸèƒ½ã€‚
æˆ‘ä»¬çš„äº‘è®¤è¯å¹³å°åå°æœ‰å¾ˆå¤šå°æœåŠ¡å™¨ï¼Œé…ç½®äº†å¤šä¸ªåŸŸåï¼Œä½†æ˜¯å¯¹å¤–çš„å‡ºå£æ˜¯å”¯ä¸€çš„ï¼Œéƒ½æ˜¯ä½¿ç”¨Nginxä½œä¸ºä»£ç†/åå‘ä»£ç†çš„ã€‚è¿™æ ·å°±ç”¨åˆ°äº†SNIæŠ€æœ¯ï¼Œåœ¨ä¸€å°æœºå™¨ä¸ŠåŒæ—¶å¯¹å¤šä¸ªåŸŸåæä¾›æœåŠ¡ã€‚å½“æµè§ˆå™¨è®¿é—®çš„æ—¶å€™ï¼Œå› ä¸ºæµè§ˆå™¨æ”¯æŒSNIæŠ€æœ¯ï¼Œå› æ­¤ä¼šæä¾›åŸŸåç»™Nginxï¼Œè¿™æ ·Nginxèƒ½å¤Ÿä»é…ç½®å¥½çš„å¤šä¸ªåŸŸåé…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°éœ€è¦çš„è¯ä¹¦åŠå®¢æˆ·ç«¯è¯ä¹¦CAé…ç½®ä¿¡æ¯è¿›è¡ŒéªŒè¯ã€‚ ä½†æ˜¯å½“Javaè®¿é—®çš„æ—¶å€™ï¼Œå°±ç¢°åˆ°äº†é—®é¢˜ï¼šå› ä¸ºJavaä¸èƒ½å¤Ÿè‡ªåŠ¨æ”¯æŒSNIåè®®ï¼ˆJava8ä¸­æä¾›äº†SNIçš„æ”¯æŒï¼Œä½†æ˜¯éœ€è¦æ‰‹å·¥ç¼–ç ï¼‰ï¼Œå› æ­¤åœ¨ä¸Šé¢çš„Springé…ç½®ä¸­ï¼Œå¹¶æ²¡æœ‰åŠæ³•æŠŠåŸŸåå‘é€ç»™Nginxï¼Œå› æ­¤Nginxä¸çŸ¥é“ä½¿ç”¨å“ªä¸ªé…ç½®ä¸­çš„è¯ä¹¦åŠå®¢æˆ·ç«¯è¯ä¹¦CAé…ç½®ä¿¡æ¯ã€‚
4.7 è§£å†³æ–¹æ³• åæ¥ä»ç½‘ä¸Šæ‰¾åˆ°äº†è¿™æ ·ä¸€ç¯‡æ–‡ç« ï¼šUsing nginx and client certificate!ï¼Œè¿™æ‰æœ€ç»ˆæ˜ç™½äº†æ€ä¹ˆè§£å†³é—®é¢˜ã€‚
Nginxæœ‰ä¸€ä¸ªdefault serverçš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯è¯´å½“å‡ºç°ä¸æ”¯æŒSNIåè®®çš„å®¢æˆ·ç«¯æ—¶ï¼Œå°†ä½¿ç”¨default serverçš„é…ç½®è¿›è¡ŒéªŒè¯ã€‚å½“æ²¡æœ‰é…ç½®default serverçš„æ—¶å€™ï¼ŒNginxå°†ä½¿ç”¨æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼ˆç»è¿‡æµ‹è¯•ï¼Œåº”è¯¥æ˜¯æŒ‰ç…§å­—æ¯é¡ºåºæ’åºçš„ï¼‰ã€‚ è€Œåœ¨æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸­ï¼Œç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æŒ‡å®šå®¢æˆ·ç«¯è¯ä¹¦CAï¼ï¼
1server { 2 listen 443; 3 server_name ...xwf-id.com; 4 ssl on; 5 ssl_certificate /etc/nginx/keys/xwfserver.pem; 6 ssl_certificate_key /etc/nginx/keys/xwfserver.key; 7 ssl_session_timeout 5m; 8 ssl_verify_client off; 9 10 location / { 11 proxy_buffer_size 8k; 12 proxy_buffers 8 64k; 13 proxy_buffering on; 14 proxy_pass http://prm_admin; 15 proxy_set_header Host $host; 16 proxy_set_header X-Real-IP $remote_addr; 17 proxy_set_header X-Forwarded-Host $host; 18 proxy_set_header X-Forwarded-Server $host; 19 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 20 } 21} æ‰€ä»¥å½“Javaè®¿é—®çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦æä¾›å®¢æˆ·ç«¯è¯ä¹¦ã€‚ã€‚ã€‚
4.8 å®‰å…¨è€ƒè™‘ æœ€åï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªdefault serveræ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
1server { 2 listen 443 default_server; 3 server_name a; 4 ssl on; 5 ssl_certificate /etc/nginx/keys/xwfserver.pem; 6 ssl_certificate_key /etc/nginx/keys/xwfserver.key; 7 ssl_session_timeout 5m; 8 ssl_client_certificate /etc/nginx/keys/ca-certs.pem; 9 ssl_verify_client optional_no_ca; 10 11 location / { 12 return 200; 13 } 14} è¿™é‡Œéœ€è¦è¯´æ˜çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå› ä¸ºæˆ‘ä»¬æœåŠ¡å™¨ä¸Šæœ‰ä¸¤ä¸ªæœåŠ¡å™¨è¦è¿›è¡Œå®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ï¼Œå› æ­¤æœ‰ä¸¤ä¸ªè‡ªç­¾åçš„CAå­˜åœ¨ã€‚ä¸ºäº†è§£å†³èƒ½å¤ŸéªŒè¯ä¸¤ä¸ªè¯ä¹¦CAç­¾åçš„è¯ä¹¦ï¼Œåœ¨/etc/nginx/keys/ca-certs.pemä¸­éœ€è¦åŒæ—¶åŒ…å«ä¸¤ä¸ªCAè¯ä¹¦ã€‚ ä½†æ˜¯è¿™ä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„é£é™©ï¼šä½¿ç”¨ç½‘ç«™Aè¯ä¹¦è®¤è¯çš„ç”¨æˆ·æœ‰å¯èƒ½è®¿é—®åˆ°ç½‘ç«™Bçš„å†…å®¹ï¼
ä½†æ˜¯å› ä¸ºæˆ‘ä»¬ç›®å‰çš„ä½“ç³»ä¸­ï¼Œä½¿ç”¨ClientCertificateFromProxyFilterå¯¹è¯ä¹¦æœ‰æ•ˆæ€§è¿›è¡Œäº†è¿›ä¸€æ­¥çš„éªŒè¯ï¼Œæ‰€ä»¥è¿™ä¸€é—®é¢˜åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ²¡æœ‰å¯¼è‡´é£é™©ã€‚å¦‚æœå…¶ä»–ç³»ç»Ÿä¸­è¦ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Œéœ€è¦å¯¹è¿™éƒ¨åˆ†çš„é£é™©æ€§æŠ•å…¥å…³æ³¨ã€‚
5. æ€»ç»“ é—®é¢˜ç»ˆäºè§£å†³äº†ï¼Œçœ‹çœ‹æ—¶é—´å·²ç»æ˜¯å‡Œæ™¨5ç‚¹äº†ã€‚æ€»ç»“ä¸€ä¸‹ç»éªŒæ•™è®­ï¼š
é€šè¿‡è¿™æ¬¡äº‹æ•…ï¼Œå¯¹SSLé€šè®¯çš„æ¡æ‰‹è¿‡ç¨‹æœ‰äº†è¿›ä¸€æ­¥çš„äº†è§£ã€‚ å¯¹Wiresharkä¹Ÿæœ‰äº†æ›´è¿›ä¸€æ­¥çš„äº†è§£ã€‚ ä»¥åäº§å“ä¸Šçº¿çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦ä½¿ç”¨çœŸæ­£çš„ä»£ç è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä»Šæ—©å‘ç°è¿™ä¸ªJavaçš„SNIå…¼å®¹æ€§é—®é¢˜äº†ã€‚ </content>
    </entry>
    
     <entry>
        <title>DelegatingFilterProxyæºç åˆ†æ</title>
        <url>https://orchidflower.github.io/2017/06/02/The-source-code-of-DelegatingFilterProxy/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Spring</tag><tag>Security</tag><tag>Java</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ 1&amp;lt;filter&amp;gt; 2	&amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt; 3	&amp;lt;filter-class&amp;gt;org.springframework.web.filter.DelegatingFilterProxy&amp;lt;/filter-class&amp;gt; 4&amp;lt;/filter&amp;gt; 5 6&amp;lt;filter-mapping&amp;gt; 7	&amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt; 8	&amp;lt;url-pattern&amp;gt;/documentation/*&amp;lt;/url-pattern&amp;gt; 9&amp;lt;/filter-mapping&amp;gt; ç”¨è¿‡Spring Securityçš„äººéƒ½ä¼šç†Ÿæ‚‰ä»¥ä¸Šä»£ç ï¼Œä¸€èˆ¬æ•™ç¨‹ä¸Šéƒ½ä¼šè¯´æ˜ï¼Œä½¿ç”¨Spring Securityå°±éœ€è¦åœ¨web.xmlä¸­æŒ‡å®šä»¥ä¸Šä»£ç ã€‚ä»è¿™ä¸ªé…ç½®ä¸­ï¼Œå¯èƒ½ä¼šç»™æˆ‘ä»¬é€ æˆä¸€ä¸ªé”™è§‰ï¼Œä»¥ä¸ºDelegatingFilterProxyç±»å°±æ˜¯springSecurityçš„å…¥å£ï¼Œä½†å…¶å®è¿™ä¸ªç±»ä½äºspring-webè¿™ä¸ªjarä¸‹é¢ï¼Œè¯´æ˜è¿™ä¸ªç±»æœ¬èº«æ˜¯å’ŒspringSecurityæ— å…³ã€‚
2. çœŸç›¸ DelegatingFilterProxyç±»ç»§æ‰¿äºæŠ½è±¡ç±»GenericFilterBean,é—´æ¥åœ°implement äº†javax.servlet.Filteræ¥å£ï¼ŒServletå®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨Filterçš„initæ–¹æ³•,GenericFilterBeançš„ä½œç”¨ä¸»è¦æ˜¯å¯ä»¥æŠŠFilterçš„åˆå§‹åŒ–å‚æ•°è‡ªåŠ¨åœ°setåˆ°ç»§æ‰¿äºGenericFilterBeanç±»çš„Filterä¸­å»ã€‚åœ¨å…¶initæ–¹æ³•çš„å¦‚ä¸‹ä»£ç å°±æ˜¯åšäº†è¿™ä¸ªäº‹ï¼š
1PropertyValues pvs = new FilterConfigPropertyValues(filterConfig, this.requiredProperties); 2BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(this); 3ResourceLoader resourceLoader = new ServletContextResourceLoader(filterConfig.getServletContext()); 4bw.registerCustomEditor(Resource.class, new ResourceEditor(resourceLoader, this.environment)); 5initBeanWrapper(bw); 6bw.setPropertyValues(pvs, true); å¦å¤–åœ¨initæ–¹æ³•ä¸­è°ƒç”¨äº†initFilterBean()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯GenericFilterBeanç±»æ˜¯ç‰¹åœ°ç•™ç»™å­ç±»æ‰©å±•ç”¨çš„ï¼š
1Override 2protected void initFilterBean() throws ServletException { 3	synchronized (this.delegateMonitor) { 4	if (this.delegate == null) { 5	// If no target bean name specified, use filter name. 6	if (this.targetBeanName == null) { 7	this.targetBeanName = getFilterName(); 8	} 9	// Fetch Spring root application context and initialize the delegate early, 10	// if possible. If the root application context will be started after this 11	// filter proxy, we&amp;#39;ll have to resort to lazy initialization. 12	WebApplicationContext wac = findWebApplicationContext(); 13	if (wac != null) { 14	this.delegate = initDelegate(wac); 15	} 16	} 17	} 18} å¯ä»¥çœ‹å‡ºä¸Šè¿°ä»£ç é¦–å…ˆçœ‹Filteræ˜¯å¦æä¾›äº†targetBeanNameåˆå§‹åŒ–å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰æä¾›åˆ™ç›´æ¥ä½¿ç”¨filterçš„nameåšä¸ºbeanName,äº§ç”Ÿäº†beanNameåï¼Œç”±äºæˆ‘ä»¬åœ¨web.xmlçš„filterçš„nameæ˜¯springSecurityFilterChain,ä»springçš„IOCå®¹å™¨ä¸­å–å‡ºbeançš„ä»£ç æ˜¯initDelegateæ–¹æ³•ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•ä»£ç ï¼š
1protected Filter initDelegate(WebApplicationContext wac) throws ServletException { 2 Filter delegate = wac.getBean(getTargetBeanName(), Filter.class); 3 if (isTargetFilterLifecycle()) { 4 delegate.init(getFilterConfig()); 5 } 6 return delegate; 7} é€šè¿‡è·Ÿè¸ªä»£ç ï¼Œå‘ç°å–å‡ºçš„beanæ˜¯org.springframework.security.FilterChainProxyï¼Œè¯¥ç±»ä¹Ÿæ˜¯ç»§æ‰¿äºGenericFilterBean,å–å‡ºbeanåï¼Œåˆ¤æ–­targetFilterLifecycleå±æ€§æ˜¯falseè¿˜æ˜¯true,å†³å®šæ˜¯å¦è°ƒç”¨è¯¥ç±»çš„initæ–¹æ³•ã€‚è¿™ä¸ªFilterChainProxy beanå®ä¾‹æœ€ç»ˆè¢«ä¿å­˜åœ¨DelegatingFilterProxyç±»çš„delegateå±æ€§é‡Œ,
ä¸‹é¢çœ‹ä¸€ä¸‹DelegatingFilterProxyç±»çš„doFilteræ–¹æ³• ï¼š
1public void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain) 2 throws ServletException, IOException { 3 4 // Lazily initialize the delegate if necessary. 5 Filter delegateToUse = null; 6 synchronized (this.delegateMonitor) { 7 if (this.delegate == null) { 8 WebApplicationContext wac = findWebApplicationContext(); 9 if (wac == null) { 10 throw new IllegalStateException(&amp;#34;No WebApplicationContext found: no ContextLoaderListener registered?&amp;#34;); 11 } 12 this.delegate = initDelegate(wac); 13 } 14 delegateToUse = this.delegate; 15 } 16 17 // Let the delegate perform the actual doFilter operation. 18 invokeDelegate(delegateToUse, request, response, filterChain); 19 } çœŸæ­£è¦å…³æ³¨invokeDelegate(delegateToUse, request, response, filterChain);è¿™å¥ä»£ç ,åœ¨ä¸‹é¢å¯ä»¥çœ‹å‡ºDelegatingFilterProxyç±»å®é™…æ˜¯ç”¨å…¶delegateå±æ€§å³org.springframework.security.FilterChainProxyå®ä¾‹çš„doFilteræ–¹æ³•æ¥å“åº”è¯·æ±‚ã€‚
1protected void invokeDelegate( 2 Filter delegate, ServletRequest request, ServletResponse response, FilterChain filterChain) 3 throws ServletException, IOException { 4 5 delegate.doFilter(request, response, filterChain); 6 } ä»¥ä¸Šå°±æ˜¯DelegatingFilterProxyç±»çš„ä¸€äº›å†…éƒ¨è¿è¡Œæœºåˆ¶ï¼Œå…¶å®ä¸»è¦ä½œç”¨å°±æ˜¯ä¸€ä¸ªä»£ç†æ¨¡å¼çš„åº”ç”¨,å¯ä»¥æŠŠservlet å®¹å™¨ä¸­çš„filteråŒspringå®¹å™¨ä¸­çš„beanå…³è”èµ·æ¥ã€‚
æ­¤å¤–è¿˜è¦æ³¨æ„ä¸€ä¸ªDelegatingFilterProxyçš„ä¸€ä¸ªåˆå§‹åŒ–å‚æ•°ï¼štargetFilterLifecycle ,å…¶é»˜è®¤å€¼ä¸ºfalse ã€‚ ä½†å¦‚æœè¢«å…¶ä»£ç†çš„filterçš„init()æ–¹æ³•å’Œdestry()æ–¹æ³•éœ€è¦è¢«è°ƒç”¨æ—¶ï¼Œéœ€è¦è®¾ç½®targetFilterLifecycleä¸ºtrueã€‚å…·ä½“å¯è§DelegatingFilterProxyä¸­çš„å¦‚ä¸‹ä»£ç ï¼š
1protected void initFilterBean() throws ServletException { 2 synchronized (this.delegateMonitor) { 3 if (this.delegate == null) { 4 // If no target bean name specified, use filter name. 5 if (this.targetBeanName == null) { 6 this.targetBeanName = getFilterName(); 7 } 8 // Fetch Spring root application context and initialize the delegate early, 9 // if possible. If the root application context will be started after this 10 // filter proxy, we&amp;#39;ll have to resort to lazy initialization. 11 WebApplicationContext wac = findWebApplicationContext(); 12 if (wac != null) { 13 this.delegate = initDelegate(wac); 14 } 15 } 16 } 17 } 18 19 20protected Filter initDelegate(WebApplicationContext wac) throws ServletException { 21 Filter delegate = wac.getBean(getTargetBeanName(), Filter.class); 22 if (isTargetFilterLifecycle()) { //æ³¨æ„è¿™è¡Œ 23 delegate.init(getFilterConfig()); 24 } 25 return delegate; 26 } 3. ç»“è®º DelegatingFilterProxyæ˜¯Spring-webä¸­çš„ä¸€ä¸ªé€šç”¨Filterï¼Œå®ƒå¯ä»¥è¾¾åˆ°å¦‚ä¸‹ç›®çš„ï¼Œè§£å†³å¦‚ä¸‹é—®é¢˜ï¼š é€šè¿‡Delegateæ¨¡å¼ï¼Œå°†Filterçš„åŠŸèƒ½è½¬ç§»åˆ°ä¸€ä¸ªSpringç®¡ç†çš„Beanä¸Šå»ï¼Œè¿™æ ·è¿™ä¸ªBeanå°±å¯ä»¥å®ç°FilteråŠŸèƒ½ï¼Œè€Œä¸”åˆäº«å—äº†Springå¸¦æ¥çš„å¥½å¤„ã€‚ å¦å¤–ï¼šè¿™ä¸ªBeanéœ€è¦å®ç°Filteræ¥å£ã€‚
4. ç»“è®º2 å½“ä¸æŒ‡å®štargetBeanNameçš„æ—¶å€™ï¼ŒDelegatingFilterProxyä¼šä½¿ç”¨FilterNameæ¥æŸ¥æ‰¾æŒ‡å®šçš„Beanå¹¶å®Œæˆåˆå§‹åŒ–ã€‚è¿™ä¹Ÿè§£é‡Šäº†ï¼Œä½¿ç”¨Spring Securityçš„æ—¶å€™ï¼Œè¦æ±‚çš„FilterNameä¸€å®šè¦æ˜¯ï¼šspringSecurityFilterChainã€‚
</content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨Docker&#43;Apache2&#43;WebSVNæ­å»ºSVNæœåŠ¡å™¨</title>
        <url>https://orchidflower.github.io/2017/05/26/Running-SVN-Server-using-Docker-Apache2-WebSVN/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Docker</tag><tag>SVN</tag><tag>WebSVN</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ è™½ç„¶ç°åœ¨çš„SVNå·²ç»ç”¨çš„è¶Šæ¥è¶Šå°‘ï¼Œå¾ˆå¤šäººéƒ½åˆ‡æ¢åˆ°äº†Gitä¸Šã€‚ä½†æ˜¯ä»¥å‰çš„ä¸€äº›å†å²é¡¹ç›®è¿˜æ˜¯éœ€è¦SVNæ”¯æŒçš„ã€‚ ä¹‹å‰çš„SVNæœåŠ¡å™¨æ˜¯ç›´æ¥æ­å»ºåœ¨ä¸€å°UbuntuæœåŠ¡å™¨ä¸Šçš„ã€‚å½“æ—¶ä¸€èµ·æ­å»ºäº†WebSVNã€‚ä¹Ÿæ›¾ç»ç ”ç©¶è¿‡æ€ä¹ˆæ­å»ºWebSVNï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿä¸èƒ½å¤Ÿå·¥ä½œäº†ï¼Œæ—¶é—´é•¿ä¹…äº†ä¹Ÿå¿˜äº†æ€ä¹ˆæ­å»ºäº†ã€‚æ‰€ä»¥æƒ³ç ”ç©¶ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨Dockeræ¥å®Œæˆä¸€æ ·çš„å·¥ä½œã€‚
2. æ„å»ºè¿‡ç¨‹ SVNæ­å»ºéœ€è¦Apacheé…åˆã€‚è€ŒWebSVNéœ€è¦PHPçš„é…åˆã€‚è¿™æ¬¡æ„å»ºé•œåƒæ˜¯ä»¥Ubuntu 14.04.5ä¸ºåŸºç¡€çš„ã€‚ç„¶ååœ¨é•œåƒåŸºç¡€ä¸Šå®‰è£…Apache2,Subversion,WebSVNç­‰å†…å®¹ã€‚
2.1 Dockerfile 1FROM ubuntu:14.04.5 2RUN sed -i &amp;#34;s/archive/cn.archive/g&amp;#34; /etc/apt/sources.list \ 3 &amp;amp;&amp;amp; apt-get update \ 4 &amp;amp;&amp;amp; apt-get install -y apache2 subversion libapache2-svn websvn \ 5 &amp;amp;&amp;amp; sed -i &amp;#34;s/&amp;#39;UTF-8&amp;#39;, &amp;#39;ISO/&amp;#39;GBK&amp;#39;, &amp;#39;UTF-8&amp;#39;, &amp;#39;ISO/g&amp;#34; /usr/share/websvn/include/command.php \ 6 &amp;amp;&amp;amp; apt-get autoclean &amp;amp;&amp;amp; apt-get clean &amp;amp;&amp;amp; apt-get autoremove \ 7 &amp;amp;&amp;amp; a2enmod auth_digest 8ENV SERVER_NAME=localhost \ 9 APACHE_RUN_USER=www-data \ 10 APACHE_RUN_GROUP=www-data \ 11 APACHE_PID_FILE=/var/run/apache2/apache2.pid \ 12 APACHE_RUN_DIR=/var/run/apache2 \ 13 APACHE_LOCK_DIR=/var/lock/apache2 \ 14 APACHE_LOG_DIR=/var/log/apache2 \ 15 APACHE_LOG_LEVEL=warn 16COPY buildtime/apache2-foreground /usr/local/bin/ 17COPY buildtime/default.conf /etc/apache2/sites-available/000-default.conf 18CMD [&amp;#34;apache2-foreground&amp;#34;] æ„å»ºå‘½ä»¤ï¼šdocker build . -t svnbase
2.2 è§£è¯» FROM æŒ‡å®šäº†åŸºç¡€é•œåƒ RUN æŒ‡å®šäº†æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ ENV è®¾ç½®äº†è¿è¡ŒApacheæ‰€éœ€è¦çš„ä¸€äº›ç¯å¢ƒå˜é‡ COPY å°†ä¸€äº›é¢„å…ˆå†™å¥½çš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ï¼› CMD æŒ‡å®šäº†é•œåƒçš„å¯åŠ¨å‘½ä»¤ã€‚ å…¶ä¸­çš„RUNå‘½ä»¤æœ€å¤æ‚ï¼Œå®Œæˆäº†æœ€é‡è¦çš„ä¸€éƒ¨åˆ†å·¥ä½œã€‚æˆ‘ä»¬é€æ¡è§£è¯»ã€‚
2.2.1 ä¿®æ”¹Ubuntuæºåœ°å€ å›½å†…çš„ç½‘ç»œç¯å¢ƒå¯¼è‡´äº†ç›´æ¥ä½¿ç”¨åŸºç¡€é•œåƒä¸­çš„æºä¸‹è½½åŒ…ä¼šéå¸¸æ…¢ï¼Œå› æ­¤æœ‰å¿…è¦åˆ‡æ¢åˆ°å›½å†…çš„é•œåƒåœ°å€ã€‚è¿™ä¸ªæ˜¯é€šè¿‡ç¼–è¾‘/etc/apt/sources.listæ–‡ä»¶å®Œæˆçš„ã€‚ä½¿ç”¨å‘½ä»¤ï¼š
1sed -i &amp;#34;s/archive/cn.archive/g&amp;#34; /etc/apt/sources.list å®Œæˆäº†å¯¹è¿™ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ã€‚å…¶åšæ³•å°±æ˜¯å°†archive.ubuntu.comè¿™ä¸ªåŸŸåæ›¿æ¢ä¸ºï¼šcn.archive.ubuntu.comã€‚
2.2.2 å®‰è£…ç›¸å…³ç»„ä»¶ è¿™éƒ¨åˆ†åŒ…å«å¦‚ä¸‹å‡ æ¡æŒ‡ä»¤ï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒåŸºç¡€ï¼Œä¸åšè¿‡å¤šè§£è¯»ã€‚
1apt-get update \ 2 &amp;amp;&amp;amp; apt-get install -y apache2 subversion libapache2-svn websvn 2.2.3 ä¿®å¤WebSVNçš„ä¸­æ–‡ç¼–ç é—®é¢˜ é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebSVNåªæ”¯æŒUTF-8ç¼–ç çš„æºæ–‡ä»¶ã€‚å¦‚æœæºç ä¸­æœ‰GBKç¼–ç çš„ï¼Œä¼šæ˜¾ç¤ºä¸ºä¹±ç ã€‚é€šè¿‡ç½‘ä¸ŠæŸ¥æ‰¾ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æºç è§£å†³ã€‚å‚è€ƒèµ„æ–™ï¼šä¸­æ–‡è§£å†³åŠæ³•1
1sed -i &amp;#34;s/&amp;#39;UTF-8&amp;#39;, &amp;#39;ISO/&amp;#39;GBK&amp;#39;, &amp;#39;UTF-8&amp;#39;, &amp;#39;ISO/g&amp;#34; /usr/share/websvn/include/command.php 2.2.4 æ¸…ç†ç¼“å­˜ï¼Œå‡å°é•œåƒä½“ç§¯ ä¸‹é¢çš„å‘½ä»¤æ¸…ç†apt-getç”Ÿæˆçš„ç¼“å­˜ï¼Œä»è€Œå‡å°é•œåƒçš„ä½“ç§¯ã€‚
1apt-get autoclean &amp;amp;&amp;amp; apt-get clean &amp;amp;&amp;amp; apt-get autoremove 2.3 å…¶ä»–æ–‡ä»¶ 2.3.1 apache2-foreground ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬å¯åŠ¨ApacheæœåŠ¡ï¼Œå¹¶æ˜¾ç¤ºlogæ–‡ä»¶å†…å®¹ã€‚æ³¨æ„ï¼šå•çº¯çš„ä½¿ç”¨service startä¼šå¯¼è‡´é•œåƒå¾ˆå¿«é€€å‡ºã€‚
1#!/bin/bash 2set -e 3 4# Apache gets grumpy about PID files pre-existing 5rm -f /var/run/apache2/apache2.pid &amp;amp;&amp;amp; service apache2 start &amp;amp;&amp;amp; tail -f /var/log/apache2/access.log &amp;amp;&amp;amp; service apache2 stop 2.3.2 default.conf 1&amp;lt;VirtualHost *:80&amp;gt; 2 ServerName 127.0.0.1 3 4 ServerAdmin webmaster@localhost 5 DocumentRoot /var/www/html 6 7 &amp;lt;Location /svnrep&amp;gt; 8 DAV svn 9 SVNParentPath /opt/scmroot/svn/svnrep 10 SVNListParentPath on 11 AuthType Digest 12 AuthName &amp;#34;SVN Access&amp;#34; 13 AuthUserFile /opt/scmroot/svndigest 14 Require valid-user 15 &amp;lt;/Location&amp;gt; 16 17 Alias /websvn /usr/share/websvn 18 19 &amp;lt;Directory /usr/share/websvn&amp;gt; 20 DirectoryIndex index.php 21 Options FollowSymLinks 22 Order allow,deny 23 Allow from all 24 &amp;lt;IfModule mod_php5.c&amp;gt; 25 php_flag magic_quotes_gpc Off 26 php_flag track_vars On 27 &amp;lt;/IfModule&amp;gt; 28 AuthType Digest 29 AuthName &amp;#34;SVN Access&amp;#34; 30 AuthUserFile /opt/scmroot/svndigest 31 Require valid-user 32 &amp;lt;/Directory&amp;gt; 33 34 ErrorLog ${APACHE_LOG_DIR}/error.log 35 CustomLog ${APACHE_LOG_DIR}/access.log combined 36&amp;lt;/VirtualHost&amp;gt; åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬æŒ‡å®šäº†å‡ ä¸ªç‰¹å®šçš„è·¯å¾„ï¼Œè¿™å‡ ä¸ªè·¯å¾„éœ€è¦åœ¨è¿è¡Œé•œåƒçš„æ—¶å€™æŒ‚è½½è¦†ç›–ï¼š
/opt/scmroot/svnrep SVNä»“åº“å­˜æ”¾çš„è·¯å¾„ï¼› /opt/scmroot/svndigest è®¿é—®SVNä»“åº“çš„ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚éœ€è¦ä½¿ç”¨htdigestæ–‡ä»¶ç”Ÿæˆã€‚ AuthName æŒ‡å®šäº†Digestè®¤è¯ä¸­çš„realmã€‚åœ¨åˆ›å»ºsvndigestçš„æ—¶å€™éœ€è¦ä½¿ç”¨åŒæ ·çš„å€¼â€œSVN Accessâ€ã€‚ 3. ä½¿ç”¨ 3.1 docker-compose.yaml æˆ‘ä»¬ä½¿ç”¨Docker-composeæ¥ä½¿ç”¨è¿™ä¸ªé•œåƒã€‚
1version: &amp;#39;2&amp;#39; 2services: 3 apache: 4 image: svnbox 5 volumes: 6 # let container use same timezone as host 7 - /etc/localtime:/etc/localtime 8 - /opt/docker/svnbox/runtime/svnrep:/opt/scmroot/svnrep 9 - /opt/docker/svnbox/runtime/svndigest:/opt/scmroot/svndigest 10 - /opt/docker/svnbox/runtime/svn_deb_conf.inc:/etc/websvn/svn_deb_conf.inc 11 - /opt/docker/svnbox/runtime/index.html:/var/www/index.html 12 ports: 13 - &amp;#34;85:80&amp;#34; 14 restart: always 15 hostname: apache 3.2 è§£è¯» image æŒ‡å®šäº†é•œåƒï¼› volumes æŒ‡å®šäº†è¦æŒ‚è½½çš„æœ¬åœ°ç›®å½•ã€‚å…¶ä¸­ï¼š svnrep æ˜¯å­˜æ”¾æ‰€æœ‰SVNä»“åº“çš„ç›®å½•ï¼› svndigest æ˜¯å­˜æ”¾ç”¨æˆ·ä¿¡æ¯çš„æ–‡ä»¶ã€‚ä½¿ç”¨htdigestå‘½ä»¤åˆ›å»ºï¼ˆè€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œé€‰æ‹©äº†Digestè®¤è¯ï¼Œè€Œä¸é‡‡ç”¨Basicè®¤è¯ï¼‰ã€‚ svn_deb_conf.inc WebSVNé…ç½®æ–‡ä»¶ã€‚ä¸»è¦å¯ä»¥ç”¨æ¥æ·»åŠ SVNä»“åº“ï¼Œä»¥ä¾›WebSVNè®¿é—®ã€‚ index.html æ˜¯è¿™ä¸ªApacheéœ€è¦çš„é¦–é¡µæ–‡ä»¶ã€‚ 3.3 å…¶ä»–æ–‡ä»¶ 3.3.1 svn_deb_conf.inc 1&amp;lt;?php 2// ä½¿ç”¨æ—¥å¿—æ›¿ä»£æ˜¾ç¤ºAgeã€‚ç¼ºçœæƒ…å†µä¸‹WebSVNæ˜¾ç¤ºä¸€ä¸ªAgeä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¿®æ”¹äººï¼Œä¿®æ”¹æ—¶é—´ï¼ˆæ˜¯è·ä»Šå¤šå°‘å¤©è¿™ç§ä¿®æ”¹æ—¶é—´ï¼‰ 3$config-&amp;gt;setShowAgeInsteadOfDate(false); 4// flatView æ¨¡å¼åªæ˜¾ç¤ºå½“å‰ç›®å½•çš„æ–‡ä»¶ã€‚è€Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…ˆæ˜¯ä¸€ä¸ªç›®å½•æ ‘ï¼Œç‚¹å‡»ç›®å½•å°†åœ¨å½“å‰é¡µé¢å±•å¼€å½“å‰ç›®å½•çš„å†…å®¹ã€‚ 5//$config-&amp;gt;useFlatView(); 6// æ‰©å±•Tabé”®ä¸º4ä¸ªç©ºæ ¼ 7$config-&amp;gt;expandTabsBy(4); 8// åœ¨æ—¥å¿—è§†å›¾æ˜¾ç¤ºä¿®æ”¹çš„å†…å®¹ï¼ˆå“ªäº›æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼‰ 9$config-&amp;gt;setLogsShowChanges(true); 10// æ·»åŠ è¦è¢«WebSVNæµè§ˆçš„SVNä»“åº“ã€‚ä¸æ·»åŠ çš„å°±ä¸æ˜¾ç¤ºã€‚ 11$config-&amp;gt;addRepository(&amp;#34;AuthServer&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/AuthServer&amp;#34;); 12$config-&amp;gt;addRepository(&amp;#34;CodeConvert&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/CodeConvert&amp;#34;); 13$config-&amp;gt;addRepository(&amp;#34;eCodeHSM&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/eCodeHSM&amp;#34;); 14$config-&amp;gt;addRepository(&amp;#34;eCodeHSM_ezTokenPIN&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/eCodeHSM_ezTokenPIN&amp;#34;); 15$config-&amp;gt;addRepository(&amp;#34;HSMCardManager&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/HSMCardManager&amp;#34;); 16$config-&amp;gt;addRepository(&amp;#34;Software&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/Software&amp;#34;); 17$config-&amp;gt;addRepository(&amp;#34;vcproj&amp;#34;, &amp;#34;file:///opt/scmroot/svn/svnrep/vcproj&amp;#34;); 18$config-&amp;gt;setEnscriptPath(&amp;#34;/usr/bin&amp;#34;); 19$config-&amp;gt;setSedPath(&amp;#34;/bin&amp;#34;); 20$config-&amp;gt;useEnscript(); 21?&amp;gt; è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å¯¹WebSVNè¿›è¡Œäº†è¿›ä¸€æ­¥çš„é…ç½®ã€‚å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ä½¿ç”¨addRepositoryæ·»åŠ æœ¬åœ°SVNä»“åº“ï¼ˆå¦‚æœä¸æ·»åŠ ï¼ŒWebSVNæ˜¯æ— æ³•æµè§ˆSVNä»“åº“çš„ï¼‰ã€‚å¦å¤–ä¸€äº›é…ç½®å¯ä»¥çœ‹æºç ä¸­çš„æ³¨é‡Šã€‚
3.3.2 index.html è¿™ä¸ªæ˜¯é¦–é¡µï¼Œå¯ä»¥éšä¾¿ç¼–è¾‘å†…å®¹ã€‚
1&amp;lt;html&amp;gt; 2&amp;lt;head&amp;gt; 3&amp;lt;/head&amp;gt; 4&amp;lt;body&amp;gt; 5&amp;lt;/body&amp;gt; 6&amp;lt;/html&amp;gt; 3.3.3 svndigest ä½¿ç”¨htdigestå‘½ä»¤åˆ›å»ºã€‚ä¾‹å¦‚ï¼š
1$ htdigest -c svndigest &amp;#34;SVN Access&amp;#34; test 2Adding user test in realm SVN Access 3New password: 4Re-type new password: 4. æ€ä¹ˆè®¿é—® å¯åŠ¨ä¹‹åï¼Œä½¿ç”¨ï¼š
http://[server-ip]:85/svnre/&amp;hellip; è®¿é—®SVNï¼› http://[server-ip]:85/websvn è®¿é—®WebSVNã€‚ é™„å½•. å‚è€ƒèµ„æ–™ docker-svnbox on Github WebSVN(2.3.3)æŸ¥çœ‹æ–‡ä»¶ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ³• apt-getæŒ‡ä»¤çš„autoclean,clean,autoremoveçš„åŒºåˆ« Package management with APT WebSVN(2.3.3)æŸ¥çœ‹æ–‡ä»¶ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ³•&amp;#160;&amp;#x21a9;&amp;#xfe0e;
</content>
    </entry>
    
     <entry>
        <title>åœ¨Tomcatä¸­ä½¿ç”¨ThreadLocalä»¥åŠSession</title>
        <url>https://orchidflower.github.io/2017/05/04/ThreadLocal-and-Session-in-Tomcat/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Tomcat</tag><tag>Java</tag><tag>å¹¶å‘</tag>
        </tags>
        <content type="html"> æœ€è¿‘è¿è¥åŒäº‹åœ¨ç®¡ç†å¹³å°ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ä¸Šç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼šç™»å½•ä¹‹åä¼šè«åå…¶å¦™åœ°å˜æˆæœªç™»å½•çŠ¶æ€ï¼Œè¢«è¸¢å›ç™»å½•é¡µé¢ã€‚
ç®¡ç†å¹³å°ä½¿ç”¨çš„Spring MVCæ¡†æ¶å®ç°çš„åå°æ¥å£ï¼ŒReactå®ç°çš„å‰å°é¡µé¢ã€‚ä¹‹å‰å¼•å…¥Reactçš„æ—¶å€™å·²ç»åšè¿‡å‰åç«¯åˆ†ç¦»ã€‚ä½†æ˜¯å½“æ—¶è€ƒè™‘åˆ°æŠ€æœ¯æ ˆçš„åŸå› ï¼Œæ²¡æœ‰å¯¹ç™»å½•ä½“ç³»è¿›è¡Œå½»åº•æ”¹é€ ï¼Œæ²¡æœ‰å¼•å…¥AccessTokenæ¥ç»´æŠ¤ç™»å½•çŠ¶æ€ï¼Œä¾ç„¶ä¿ç•™äº†Javaçš„Sessionæœºåˆ¶ã€‚è€ƒè™‘åˆ°ç®¡ç†å¹³å°å±äºå†…éƒ¨ä½¿ç”¨ï¼Œè®¿é—®é‡ä¸å¤§ï¼Œå› æ­¤ç›´æ¥åœ¨Nginxå±‚ä½¿ç”¨iphashè¿›è¡Œäº†Sessionç²˜æ»ï¼Œç¡®ä¿åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚æ€»æ˜¯è¢«åŒä¸€ä¸ªçš„åå°Tomcatå¤„ç†ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„sessionæœºåˆ¶ä¿æŒç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚
æ’æŸ¥è¿‡ç¨‹ä¸­ï¼Œç”±äºè¸¢å‡ºç™»å½•æƒ…å†µæ¯”è¾ƒéšæœºï¼Œæ‰€ä»¥æœ€åˆæ€€ç–‘æ˜¯è¶…æ—¶æ—¶é—´è®¾ç½®æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€ç›´æ— æ³•é‡ç°é”™è¯¯ã€‚ä¸€ç›´è€½æäº†å¥½å‡ å¤©ï¼Œå¾ˆå¹¸è¿çš„ï¼Œæ˜¨å¤©æµ‹è¯•çš„åŒå­¦ç»ˆäºæ‰¾åˆ°äº†é‡ç°çš„æ­¥éª¤ï¼šåœ¨ç®¡ç†å¹³å°æ‰§è¡ŒæŸä¸ªæ•°æ®å¯¼å‡ºæ“ä½œï¼Œå¯¼å‡ºæ“ä½œè€—æ—¶æ¯”è¾ƒé•¿ï¼Œåœ¨æ“ä½œæ²¡æœ‰ç»“æŸçš„æ—¶å€™ç‚¹å‡»å…¶ä»–é“¾æ¥ï¼Œå°±ä¼šå‡ºç°æœªç™»å½•è¸¢å›ç™»å½•é¡µé¢çš„æƒ…å†µã€‚
1. SessionContext ç»è¿‡æ£€æŸ¥ä»£ç ï¼Œå‘ç°å‡ºç°ç™»å½•å¼‚å¸¸é—®é¢˜çš„æ—¶å€™è¿”å›çš„é”™è¯¯ç æ˜¯ï¼šLOGIN_OVERTIMEï¼Œç¡®å®æ˜¯è¶…æ—¶çš„è¿”å›ä»£ç ã€‚ä½†æ˜¯æµ‹è¯•ä¸­å‘ç°å³ä½¿åˆšåˆšç™»å½•ï¼ŒæŒ‰ç…§ä¸Šé¢æ“ä½œä¹Ÿä¼šå‡ºç°é—®é¢˜ï¼Œæ˜¾ç„¶çœŸæ­£çš„åŸå› ä¸æ˜¯è¶…æ—¶ã€‚
æ²¡åŠæ³•ï¼Œå¼€å§‹æ‰’ä»£ç ï¼Œå…ˆæ‰¾åˆ°è¿”å›é”™è¯¯ç çš„åœ°æ–¹ï¼š
1private BaseResult isLogon() { 2 BaseResult result = new BaseResult(); 3 UserVO user = SessionContext.getSessionContext().getCurrentUser(); 4 if (user != null) { 5 result.setSuccess(true); 6 } else { 7 result.setCode(ResultCode.LOGIN_OVERTIME.getCode()); 8 result.setMsg(&amp;#34; &amp;#34;); 9 //result.setMsg(ResultCode.LOGIN_OVERTIME.getDesc()); 10 } 11 return result; 12} é€»è¾‘å¾ˆç®€å•ï¼Œè·å–å½“å‰çš„SessionContextï¼Œå¦‚æœcurrentUserä¸ä¸ºç©ºåˆ™è®¤ä¸ºå·²ç»ç™»å½•ï¼Œå¦åˆ™æ²¡æœ‰ç™»å½•ã€‚
ç»§ç»­çœ‹SessionContextï¼š
1public class SessionContext { 2 private transient static final ThreadLocal&amp;lt;SessionContext&amp;gt; SESSION_CONTEXT = new ThreadLocal&amp;lt;SessionContext&amp;gt;(); 3 4 private HttpServletRequest request; 5 private HttpServletResponse response; 6 ... 7 public UserVO getCurrentUser() { 8 return (UserVO) request.getSession().getAttribute(&amp;#34;currUser&amp;#34;); 9 } 10 11 public void setCurrentUser(UserVO user) { 12 request.getSession().setAttribute(&amp;#34;currUser&amp;#34;, user); 13 } 14 15 public void initSession(HttpServletRequest request, HttpServletResponse response) { 16 this.request = request; 17 this.response = response; 18 } 19 ...	20 public static SessionContext getSessionContext() { 21 if (SESSION_CONTEXT.get() == null) { 22 SessionContext sc = new SessionContext(); 23 SESSION_CONTEXT.set(sc); 24 } 25 return SESSION_CONTEXT.get(); 26 } 27} ä¸Šé¢çš„ä»£ç çš„ç›®çš„æ˜¯ä½¿ç”¨ThreadLocalä¿å­˜SessionContextå¯¹è±¡ã€‚è€ŒSessionContextå¯¹è±¡æ˜¯é€šè¿‡initSessionå‡½æ•°æ³¨å…¥äº†requestã€responseååˆ›å»ºçš„ã€‚getCurrentUserè·å–çš„æ˜¯å®é™…ä¸Šæ˜¯SessionContextå¯¹åº”çš„requestå¯¹è±¡ä¸­çš„å†…å®¹ã€‚
2. é—®é¢˜åŸå›  æ‰’åˆ°ä»¥ä¸Šä»£ç ï¼Œç»ˆäºå‘ç°é—®é¢˜å‡ºåœ¨å“ªå„¿äº†ï¼šå› ä¸ºTomcatä½¿ç”¨çš„æ˜¯çº¿ç¨‹æ± ï¼ˆThreadPoolï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹æ± å†…çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ï¼Œå¹¶ä¸èƒ½å¤Ÿä¿è¯æ¯æ¬¡webè¯·æ±‚éƒ½ä½¿ç”¨åŒæ ·çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼›ä¹Ÿæ— æ³•ä¿è¯ä¸€ä¸ªçº¿ç¨‹åªä¸ºä¸€ä¸ªç”¨æˆ·æœåŠ¡ã€‚æ‰€ä»¥åœ¨Webå®¹å™¨ç¯å¢ƒä¸­ä½¿ç”¨ThreadLocalè¦ç‰¹åˆ«å°å¿ƒï¼Œæœ€å¥½æ˜¯ä¸ç”¨ï¼Œå®ƒå’Œæœ¬åœ°ç¯å¢ƒä¸­çš„ThreadLocalè¿˜æ˜¯æœ‰å¾ˆå¤šå·®å¼‚çš„ã€‚å…·ä½“åˆ°ä¹‹å‰çš„é—®é¢˜ï¼šå½“ä¸€ä¸ªæ“ä½œèŠ±è´¹æ—¶é—´å¾ˆé•¿çš„æ—¶å€™ï¼Œæ“ä½œè¿˜æ²¡æœ‰ç»“æŸï¼Œçº¿ç¨‹ä¾ç„¶ç¹å¿™ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼ŒTomcatä¼šå¯ç”¨æ–°çš„çº¿ç¨‹æ¥å—å¤„ç†ï¼Œä½†æ˜¯æ–°çš„çº¿ç¨‹ThreadLocalä¸­æ˜¾ç„¶æ²¡æœ‰å¯¹åº”çš„SessionContextï¼Œè‡ªç„¶ä¼šè¢«åˆ¤å®šä¸ºæœªç™»å½•ã€‚
3. ä¿®å¤æ–¹æ³• è¿™éƒ¨åˆ†ä»£ç æ˜¯ä¹‹å‰åŒäº‹é—ç•™ä¸‹æ¥çš„ï¼Œé™äºæ—¶é—´åŸå› ï¼Œä¸€ç›´æ²¡æœ‰ä»”ç»†çœ‹ï¼ŒåŸæ¥éšè—ç€è¿™ç§bugã€‚å¦‚æœè¦ä¿®å¤äº†ï¼Œæ–¹æ³•å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç§ï¼š
å°±æ˜¯å¼•å…¥AccessTokenæœºåˆ¶ã€‚ç”¨æˆ·ç™»å½•ä¹‹ååˆ†é…AccessTokenï¼Œè¯¥AccessTokenä½¿ç”¨Redisç­‰å¤–éƒ¨å­˜å‚¨è¿›è¡Œä¿å­˜ã€‚å› ä¸ºTokenæ¯æ¬¡éƒ½è·Ÿéšè¯·æ±‚å‘é€è¿‡æ¥ï¼Œè¿™æ ·å°±å¯ä»¥æ‘†è„±sessionç²˜æ»çš„é™åˆ¶ï¼› å¦‚æœä¿æŒç°æœ‰çš„sessionç²˜æ»é…ç½®çš„è¯ï¼Œå¯ä»¥è€ƒè™‘å¼•å…¥redisï¼Œé€šè¿‡request.getSession().getId()è·å¾—çš„sessionIdä½œä¸ºä¸»é”®ä¿å­˜currentUserç­‰ä¿¡æ¯ã€‚æˆ‘ä»¬çŸ¥é“Tomcatä¸­SessionIDæ˜¯é€šè¿‡Cookieä¼ é€’çš„ï¼ˆJSESSIONIDï¼‰ï¼ŒåŒæ—¶åœ¨Tomcatä¸­ä¹Ÿå¼€è¾Ÿäº†ä¸€å—å†…å­˜ä¿å­˜Sessionç›¸å…³çš„ä¿¡æ¯ã€‚å› ä¸ºé…ç½®äº†Sessionç²˜æ»ï¼Œæ‰€ä»¥åŒä¸€ä¸ªç”¨æˆ·æ¥çš„è¯·æ±‚ï¼Œæ€»æ˜¯è½¬å‘åˆ°åŒä¸€å°Tomcatä¸Šå¤„ç†ã€‚æ‰€ä»¥æ ¹æ®è¯·æ±‚æºå¸¦çš„Cookieå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„sessionIdï¼Œä¹Ÿèƒ½å¤Ÿæ‰¾åˆ°Tomcatä¸­å¯¹åº”çš„Sessionæ•°æ®ï¼Œä»è€Œæ‰¾åˆ°å½“å‰ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚ 4. å†…å­˜æ³„éœ² å¦å¤–ï¼Œä¸Šé¢çš„ä»£ç ä¸­å®é™…ä¸Šæ˜¯æœ‰å†…å­˜æ³„éœ²é—®é¢˜çš„ï¼šrequestã€responseå¯¹è±¡è¢«èµ‹å€¼åˆ°SessionContextå¯¹è±¡ï¼Œç„¶åè¢«æ³¨å…¥åˆ°äº†ThreadLocalä¸­ã€‚è€ŒTomcatçš„çº¿ç¨‹æ± å¯¹è±¡æ˜¯æŒä¹…å¯¹è±¡ï¼Œä¸ä¼šå¾ˆå¿«è¢«é‡Šæ”¾ã€‚å› æ­¤è¿™ä¸¤ä¸ªå¯¹è±¡å¾ˆéš¾è¢«é‡Šæ”¾æ‰ã€‚å½“è®¿é—®é‡è¶Šå¤§ï¼Œå†…å­˜æ¶ˆè€—ä¼šè¶Šå¿«ã€‚åªæ˜¯ç›®å‰çš„ç®¡ç†å¹³å°è®¿é—®é‡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥é—®é¢˜ä¸çªå‡ºï¼Œä¸€ç›´æ²¡æœ‰å‘ç°ã€‚
æ€»ä¹‹ï¼šåœ¨å¹¶å‘çŠ¶æ€ä¸‹ä½¿ç”¨Tomcatçš„ThreadLocalæ˜¯ä¸å¯é çš„ã€‚æœ€å¥½çš„åŠæ³•æ˜¯æ…ç”¨ã€‚
</content>
    </entry>
    
     <entry>
        <title>Java SSLæ¡æ‰‹è®°å½•åˆ†æ</title>
        <url>https://orchidflower.github.io/2017/04/28/Java-SSL-Handshake-Log/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Java</tag><tag>SSL</tag>
        </tags>
        <content type="html"> å…¬å¸é¡¹ç›®å½“ä¸­ç»å¸¸ä½¿ç”¨CXFåº“è¿æ¥WebServiceæœåŠ¡ï¼Œè€Œä¸”æˆ‘ä»¬è‡ªå·±æä¾›çš„æœåŠ¡ä¹Ÿæ˜¯åŸºäºCXFçš„SOAPæœåŠ¡ï¼Œç»å¸¸éœ€è¦æŒ‡å¯¼å®¢æˆ·æ€ä¹ˆè¿æ¥æˆ‘ä»¬çš„æœåŠ¡ã€‚CXFåº“æ•´ä¸ªä½“ç³»æ¶æ„æ¯”è¾ƒåºå¤§ï¼Œç›¸å…³çš„ç±»ã€çŸ¥è¯†ç‚¹éƒ½æ¯”è¾ƒå¤šã€‚å°¤å…¶æ˜¯è¿æ¥SSLåŒå‘è®¤è¯æœåŠ¡çš„æ—¶å€™ï¼Œç»å¸¸ç¢°åˆ°é—®é¢˜ã€‚
ä½¿ç”¨åŒå‘SSLè®¤è¯çš„æ—¶å€™ï¼Œåœ¨Springä¸­é…ç½®èµ·æ¥éå¸¸ç®€å•ï¼Œä½†æ˜¯ä¸€æ—¦å‡ºé”™å°±æ¯”è¾ƒéš¾æ‰¾é—®é¢˜ã€‚ç»è¿‡å¤šæ¬¡å°è¯•ï¼Œæœ€åå‘ç°è¿˜æ˜¯åˆ†æSSLæ¡æ‰‹è®°å½•æ¯”è¾ƒé è°±ï¼Œæ¯”è¾ƒå®¹æ˜“æ‰¾å‡ºçœŸæ­£çš„é—®é¢˜æ‰€åœ¨ã€‚ç‰¹æ­¤è®°å½•ä¸€ä¸‹è‡ªå·±çš„ä¸€äº›å¿ƒå¾—ï¼Œä»¥ä½œå¤‡å¿˜å¹¶å¸Œæœ›èƒ½å¤Ÿå¸®åˆ°å…¶ä»–äººã€‚
1. Springä¸­çš„é…ç½® ä½¿ç”¨CXFè¿æ¥SOAP WebServiceï¼Œåœ¨Springä¸­é…ç½®èµ·æ¥éå¸¸ç®€å•ã€‚
1.1 springé…ç½® 1... 2&amp;lt;context:property-placeholder location=&amp;#34;classpath:config.properties&amp;#34; /&amp;gt; 3 4&amp;lt;jaxws:client id=&amp;#34;devicelinkService&amp;#34; 5 serviceClass=&amp;#34;com.service.api_3_0.ApiCustomerService30&amp;#34; 6 address=&amp;#34;${devicelink.url}&amp;#34;&amp;gt; 7&amp;lt;/jaxws:client&amp;gt; 8 9&amp;lt;http-conf:conduit name=&amp;#34;${devicelink.serveraddress}/.*&amp;#34;&amp;gt; 10 &amp;lt;!-- å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ç›¸å…³é…ç½® //--&amp;gt; 11 &amp;lt;http-conf:tlsClientParameters disableCNCheck=&amp;#34;true&amp;#34;&amp;gt; 12 &amp;lt;sec:keyManagers keyPassword=&amp;#34;${cert.file.pwd}&amp;#34;&amp;gt; 13 &amp;lt;sec:keyStore type=&amp;#34;PKCS12&amp;#34; password=&amp;#34;${cert.file.pwd}&amp;#34; resource=&amp;#34;${cert.file}&amp;#34;/&amp;gt; 14 &amp;lt;/sec:keyManagers&amp;gt; 15 &amp;lt;sec:trustManagers&amp;gt; 16 &amp;lt;sec:keyStore type=&amp;#34;JKS&amp;#34; password=&amp;#34;changeit&amp;#34; resource=&amp;#34;cacerts&amp;#34; /&amp;gt; 17 &amp;lt;/sec:trustManagers&amp;gt; 18 &amp;lt;/http-conf:tlsClientParameters&amp;gt; 19 20 &amp;lt;http-conf:client Connection=&amp;#34;Keep-Alive&amp;#34; 21 MaxRetransmits=&amp;#34;1&amp;#34; AllowChunking=&amp;#34;false&amp;#34;/&amp;gt; 22 &amp;lt;!-- å¦‚æœæœåŠ¡æ”¯æŒBasicè®¤è¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é…ç½® //--&amp;gt; 23 &amp;lt;!-- 24 &amp;lt;http-conf:authorization&amp;gt; 25 &amp;lt;sec:UserName&amp;gt;${devicelink.username}&amp;lt;/sec:UserName&amp;gt; 26 &amp;lt;sec:Password&amp;gt;${devicelink.password}&amp;lt;/sec:Password&amp;gt; 27 28 &amp;lt;sec:AuthorizationType&amp;gt;Basic&amp;lt;/sec:AuthorizationType&amp;gt; 29 &amp;lt;/http-conf:authorization&amp;gt; 30 //--&amp;gt; 31&amp;lt;/http-conf:conduit&amp;gt; 32... å‡ ä¸ªé…ç½®é¡¹ï¼š
jaxws:client ç”¨æ¥å£°æ˜ä¸€ä¸ªSpring Beanã€‚å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨@Autowiredå¼•ç”¨ï¼› http-conf:conduit ç”¨æ¥é…ç½®è®¤è¯ç›¸å…³çš„å†…å®¹ï¼› http-conf:tlsClientParameters é…ç½®SSLè®¤è¯ç›¸å…³çš„å†…å®¹ã€‚å¯ä»¥é…ç½®Java SSLç”¨çš„keyManager/trustManagerï¼› http-conf:authorization é…ç½®Basicè®¤è¯ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥æŒ‡å®šBasicè®¤è¯æ‰€éœ€çš„ç”¨æˆ·åã€å¯†ç ç­‰ã€‚ ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨äº†å‡ ä¸ªå˜é‡ï¼Œä»–ä»¬æ˜¯é€šè¿‡context:property-placeholderå¼•å…¥çš„propertyæ–‡ä»¶å®šä¹‰çš„ã€‚åŒ…æ‹¬ï¼š
deviceLink.url æœåŠ¡è®¿é—®åœ°å€ deviceLink.serveraddress æœåŠ¡å™¨åœ°å€ cert.file è¯ä¹¦åœ°å€ cert.file.pwd è¯ä¹¦å¯†ç  deviceLink.username è®¿é—®æœåŠ¡çš„ç”¨æˆ·å deviceLink.password è®¿é—®æœåŠ¡çš„å¯†ç  1.2 config.properties è¿™æ˜¯propertiesæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ï¼Œé€šè¿‡context:property-placeholderé…ç½®è¢«å¼•å…¥Springé…ç½®ä¸­ã€‚
1devicelink.serveraddress=http://server.address 2devicelink.url=http://server.address/api/CustomerApi30 3devicelink.username=... 4devicelink.password=... 5cert.file.pwd=... 6cert.file=....p12 ä½¿ç”¨CXFçš„ç›¸å…³é…ç½®å°±æ˜¯è¿™ä¹ˆå¤šï¼Œç¡®å®æ¯”è¾ƒç®€å•ã€‚è¿™æ˜¯å› ä¸ºCXFéšè—äº†å¾ˆå¤šå®ç°çš„ç»†èŠ‚ã€‚ä½†æ˜¯è¿™ä¹Ÿå¸¦æ¥éš¾ä»¥æ’é”™çš„å¼Šç«¯ã€‚ä¸‹é¢å°†ä»‹ç»ä¸€ä¸‹å¦‚ä½•é€šè¿‡SSLæ¡æ‰‹æ—¥å¿—æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ã€‚
2. æ¡æ‰‹è¿‡ç¨‹ é€šå¸¸çš„æ¡æ‰‹è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š Java SSLä¹Ÿæ˜¯åŒæ ·çš„æ­¥éª¤ã€‚ç²—ç•¥åˆ†ä¸ºä¸‰æ­¥ï¼š
ClientHello ServerHello KeyExchange æ¡æ‰‹ç»“æŸ 3. æ‰“å¼€SSLæ¡æ‰‹æ—¥å¿— é¦–å…ˆè¯´ä¸€ä¸‹å¦‚ä½•æ‰“å¼€SSLæ¡æ‰‹æ—¥å¿—ã€‚æ–¹æ³•æ˜¯åœ¨Javaå¯åŠ¨å‘½ä»¤è¡Œä¸­å¢åŠ -Djavax.net.debug=SSLæˆ–è€…-Djavax.net.debug=ALLå³å¯æ‰“å¼€SSLæ¡æ‰‹æ—¥å¿—ã€‚
4. æ—¥å¿—åˆ†æ Javaçš„æ¡æ‰‹æ—¥å¿—ä¸­ï¼Œä½¿ç”¨***ä½œä¸ºæ¯ä¸€æ®µå†…å®¹çš„åˆ†éš”ç¬¦ã€‚ä½¿ç”¨è¿™ä¸ªåˆ†éš”ç¬¦å¯ä»¥æŠŠå‡ æ­¥å†…å®¹å¤§ä½“ä¸Šåˆ†éš”å¼€ï¼Œæ‰€ä»¥é˜…è¯»èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚
4.0. å‡†å¤‡é˜¶æ®µ 4.0.1 æ‰¾åˆ°å®¢æˆ·ç«¯è¯ä¹¦ å½“é…ç½®äº†å®¢æˆ·ç«¯è¯ä¹¦çš„æ—¶å€™ï¼Œé¦–å…ˆæ‰“å°çš„å°±æ˜¯æ‰¾åˆ°äº†keyã€‚å¦‚ä¸‹ï¼š
1found key for : did.xwf-id.com key 2chain [0] = [ 3[ 4 ... å¦‚æœæ²¡æœ‰é…ç½®å®¢æˆ·ç«¯è¯ä¹¦ï¼Œæˆ–è€…é…ç½®æœ‰é—®é¢˜ï¼Œåˆ™ä¸ä¼šæœ‰è¿™ä¸€éƒ¨åˆ†æ—¥å¿—å‡ºç°ã€‚
4.0.2 æ·»åŠ ä¿¡ä»»è¯ä¹¦ ç„¶åå°±æ˜¯ä»ç³»ç»Ÿä¸­æ·»åŠ å¯ä¿¡ä»»çš„CAè¯ä¹¦ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæ·»åŠ å¾ˆå¤šè¯ä¹¦è¿›æ¥ã€‚æ¥æºä¸»è¦æœ‰ä¸¤ä¸ªï¼š
$JAVA_HOME/jre/lib/security/cacerts ç¨‹åºä¸­é…ç½®çš„trustStoreæŒ‡å®šçš„è¯ä¹¦åº“ 1adding as trusted cert: 2 Subject: CN=Equifax Secure Global eBusiness CA-1, O=Equifax Secure Inc., C=US 3... 4.1. ClientHello å‡†å¤‡é˜¶æ®µä¸ç®—æ˜¯æ­£å¼çš„SSLæ¡æ‰‹è¿‡ç¨‹ï¼Œåªæ˜¯åˆ›å»ºäº†SSLæ¡æ‰‹éœ€è¦çš„ç¯å¢ƒï¼ˆContextï¼‰ã€‚ä»ClientHelloå¼€å§‹ï¼ŒSSLæ¡æ‰‹æ­£å¼å¼€å§‹ï¼š
1*** ClientHello, TLSv1 2RandomCookie: ... 3Session ID: {} 4Cipher Suites: [TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,...] 5Compression Methods: { 0 } 6Extension elliptic_curves, curve names: {secp256r1, ...} 7Extension ec_point_formats, formats: [uncompressed] 4.2. ServerHello ClientHelloæ¶ˆæ¯è¢«å‘é€ç»™æœåŠ¡æä¾›æ–¹ï¼Œç„¶åæ”¶åˆ°çš„æ¶ˆæ¯å°±æ˜¯æœåŠ¡å™¨è¿”å›çš„ServerHelloæ¶ˆæ¯æŠ¥æ–‡ã€‚åœ¨Javaçš„SSLæ¡æ‰‹æ—¥å¿—ä¸­æ˜¯çœ‹ä¸åˆ°æœåŠ¡å™¨ä¸Šçš„å¤„ç†æµç¨‹çš„ï¼Œèƒ½çœ‹åˆ°çš„åªæ˜¯Javaå¤„ç†è¿™ä¸ªæŠ¥æ–‡çš„è§£æè¿‡ç¨‹ã€‚è¿™ä¸ªä¸€å®šè¦æ¸…æ¥šï¼šæ—¥å¿—ä¸­æ˜¾ç¤ºçš„éƒ½æ˜¯è°ƒç”¨è€…å¤„ç†çš„æ—¥å¿—ï¼Œå¹¶ä¸æ˜¯æœåŠ¡å™¨ç«¯çš„å®é™…å¤„ç†é¡ºåºï¼Œæ‰€ä»¥é¡ºåºå¯èƒ½å’ŒæœåŠ¡å™¨ç«¯ä¸ä¸€è‡´ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚
é¦–å…ˆæ˜¾ç¤ºçš„æ˜¯Serveré€‰ä¸­çš„åŠ å¯†ç®—æ³•ï¼Œè¿™é‡Œæ˜¯TLS_ECDHE_RSA_WITH_AES_256_CBC_SHAï¼š
1*** ServerHello, TLSv1 2RandomCookie: GMT: -1611070835 bytes = { ...} 3Cipher Suite: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA 4Compression Method: 0 5Extension renegotiation_info, renegotiated_connection: &amp;lt;empty&amp;gt; 6Extension ec_point_formats, formats: [uncompressed, ansiX962_compressed_prime, ansiX962_compressed_char2] æ”¶åˆ°ServerHelloä¹‹åï¼Œå°±å¼€å§‹æ ¹æ®æ”¶åˆ°çš„å†…å®¹åˆ›å»ºSessionï¼Œè¯ä¹¦éªŒè¯ã€äº¤æ¢å¯†é’¥ç­‰æ“ä½œäº†ã€‚
4.2.1 åˆå§‹åŒ–Session åˆå§‹åŒ–Sessionï¼š
1*** 2%% Initialized: [Session-1, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA] 3... 4.2.2 ç½‘ç«™è¯ä¹¦é“¾ ä»ä¹‹å‰æ·»åŠ çš„CAè¯ä¹¦ä¸­æ‰¾åˆ°äº†è¯ä¹¦é“¾ï¼Œè¯´æ˜æœåŠ¡å™¨è¯ä¹¦æ˜¯åˆæ³•çš„ï¼š
1*** Certificate chain 2chain [0] = [ 3[ 4 Version: V3 5 Subject: CN=*.xwf-id.com, OU=IT DEPT, O=&amp;#34;Iraid Finance Information &amp;amp; Technology (Shanghai) Co.,Ltd&amp;#34;, L=Shanghai, ST=Shanghai, C=CN 6 Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11 7... 8] 9chain [1] = [ 10[ 11 Version: V3 12 Subject: CN=Symantec Class 3 Secure Server CA - G4, OU=Symantec Trust Network, O=Symantec Corporation, C=US 13 Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11 14 ... 15] ç„¶åå°±æç¤ºæ‰¾åˆ°äº†å¯ä¿¡ä»»çš„è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢chain [1]ä¸­å¯¹åº”çš„è¯ä¹¦ï¼š
1*** 2Found trusted certificate: 3[ 4[ 5 Version: V3 6 Subject: CN=Symantec Class 3 Secure Server CA - G4, OU=Symantec Trust Network, O=Symantec Corporation, C=US 7 Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11 8... å¦‚æœæœåŠ¡æä¾›æ–¹çš„è¯ä¹¦æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œé‚£ä¹ˆè¦æ³¨æ„æ—¥å¿—ä¸­æ˜¯å¦å‡ºç°äº†ä¸Šè¿°æ—¥å¿—ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½æ¡æ‰‹å¤±è´¥ã€‚éœ€è¦å°†æä¾›æ–¹çš„è¯ä¹¦æ·»åŠ åˆ°trustManagerä¸­å¯¹åº”çš„è¯ä¹¦åº“ä¸­æ¥è§£å†³é—®é¢˜ã€‚
4.2.3 ECDH ServerKeyExchange å¯†é’¥äº¤æ¢ç®—æ³•åˆå§‹åŒ–ï¼Œè¿™é‡Œæ˜¯ECDHç®—æ³•çš„ï¼š
1*** ECDH ServerKeyExchange 2Server key: Sun EC public key, 256 bits 3 public x coord: 43374987853469150916971894311198082576230263269301289184949927385170106253395 4 public y coord: 92135670098354144912439154833828289482869500140098079447653500663810560580845 5 parameters: secp256r1 [NIST P-256, X9.62 prime256v1] (1.2.840.10045.3.1.7) 4.2.4 CertificateRequest ServerHelloDoneæŠ¥æ–‡ä¸­åŒ…å«äº†æœåŠ¡å™¨å¯ä»¥æ¥å—çš„å®¢æˆ·ç«¯è¯ä¹¦çš„CAåˆ—è¡¨ã€‚å®¢æˆ·ç«¯éœ€è¦æ ¹æ®è¿™ä¸ªCAåˆ—è¡¨ä»æœ¬åœ°ç­›é€‰å¯ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚
1*** CertificateRequest 2Cert Types: RSA, DSS, ECDSA 3Cert Authorities: 4&amp;lt;EMAILADDRESS=mailadmin@xwf-id.com, CN=devborgen.xwf-id.com, OU=Operation Department, O=iRaid, L=Shanghai, ST=Shanghai, C=CN&amp;gt; 5&amp;lt;EMAILADDRESS=mailadmin@xwf-id.com, CN=devcap.xwf-id.com, OU=Development Department, O=iRaid, L=Shanghai, ST=Shanghai, C=CN&amp;gt; å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ï¼Œåˆ™æ²¡æœ‰ä¸Šè¿°å†…å®¹ã€‚
4.2.5 ServerHelloDone ServerHelloä¿¡æ¯è§£æå®Œæ¯•ã€‚
1*** ServerHelloDone 2[read] MD5 and SHA1 hashes: len = 4 30000: 0E 00 00 00 .... 4matching alias: did.xwf-id.com key 5*** Certificate chain 6chain [0] = [ 7[ 8[ 9 Version: V3 10 Subject: CN=did.xwf-id.com 11 Signature Algorithm: SHA1withRSA, OID = 1.2.840.113549.1.1.5 12 ... ä¸Šé¢ä»£è¡¨æ‰¾åˆ°äº†å®¢æˆ·ç«¯è¯ä¹¦ã€‚å¦‚æœæœåŠ¡å™¨ç«¯å¼€å¯äº†å¼ºåˆ¶è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œè€Œæœ¬åœ°æ²¡æœ‰é…ç½®ï¼Œåˆ™ä¼šå‡ºç°è¿™æ ·çš„æç¤ºï¼š
1*** ServerHelloDone 2[read] MD5 and SHA1 hashes: len = 4 30000: 0E 00 00 00 .... 4Warning: no suitable certificate found - continuing without client authentication 5*** Certificate chain 6&amp;lt;Empty&amp;gt; å‡ºç°äº†ä¸Šè¿°æç¤ºï¼Œå°±éœ€è¦æ£€æŸ¥keyManagerä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼ŒæŸ¥æŸ¥ä¸ºä»€ä¹ˆæ‰¾ä¸åˆ°å®¢æˆ·ç«¯è¯ä¹¦äº†ã€‚
4.3. ClientKeyExchange æœ€åä¸€æ­¥å°±æ˜¯å¯†é’¥äº¤æ¢ï¼š
1*** 2*** ECDHClientKeyExchange 3ECDH Public value: { ... } 4... 5*** CertificateVerify 6... 7*** Finished 8verify_data: { 234, 76, 169, 101, 128, 33, 222, 63, 185, 227, 150, 56 } 9... è‡³æ­¤æ¡æ‰‹ç»“æŸï¼Œç”Ÿæˆäº†sessionå¹¶è¿›è¡Œäº†ç¼“å­˜ã€‚
1*** 2%% Cached client session: [Session-1, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA] é€šè¿‡ä¸Šé¢çš„æ—¥å¿—åˆ†æï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‘ç°ç»å¸¸ç¢°åˆ°çš„é—®é¢˜ï¼Œä¹Ÿå®¹æ˜“å®šä½é—®é¢˜ç©¶ç«Ÿå‡ºåœ¨å“ªå„¿ã€‚
é™„å½•A. å‚è€ƒèµ„æ–™ æ·±å…¥ç ”ç©¶SSLã€ç¬¬äºŒç«  part-1ã€‘-SSLæ¡æ‰‹åè®®çš„ç ”ç©¶ SSL/TLS æ¡æ‰‹ä¼˜åŒ–è¯¦è§£ é™„å½•B. è¡¥å……çŸ¥è¯†-è¯ä¹¦é“¾ é…ç½®æœåŠ¡ç«¯è¯ä¹¦é“¾æ—¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š1ï¼‰è¯ä¹¦æ˜¯åœ¨æ¡æ‰‹æœŸé—´å‘é€çš„ï¼Œç”±äº TCP åˆå§‹æ‹¥å¡çª—å£çš„å­˜åœ¨ï¼Œå¦‚æœè¯ä¹¦å†…å®¹å¤ªé•¿å¯èƒ½ä¼šäº§ç”Ÿé¢å¤–çš„å¾€è¿”å¼€é”€ï¼›2ï¼‰å¦‚æœé…ç½®çš„è¯ä¹¦æ²¡åŒ…å«ä¸­é—´è¯ä¹¦ï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ–¹æ³•æ˜¯æš‚åœéªŒè¯å¹¶æ ¹æ®ç«™ç‚¹è¯ä¹¦æŒ‡å®šçš„çˆ¶è¯ä¹¦ URL è‡ªå·±è·å–ä¸­é—´è¯ä¹¦ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿé¢å¤–çš„ DNS è§£æã€å»ºç«‹ TCP è¿æ¥ç­‰å¼€é”€ï¼Œéå¸¸å½±å“æ€§èƒ½ã€‚
åŸºäºæ­¤ï¼Œé…ç½®è¯ä¹¦é“¾çš„çš„æœ€ä½³å®è·µæ˜¯åªåŒ…å«ç«™ç‚¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦ï¼Œä¸è¦åŒ…å«æ ¹è¯ä¹¦ï¼Œä½†ä¸è¦æ¼æ‰ä¸­é—´è¯ä¹¦ã€‚å¤§éƒ¨åˆ†è¯ä¹¦éƒ½æ˜¯ã€Œç«™ç‚¹è¯ä¹¦ â€“ ä¸­é—´è¯ä¹¦ â€“ æ ¹è¯ä¹¦ã€è¿™æ ·ä¸‰çº§ï¼Œè¿™æ—¶æœåŠ¡ç«¯åªéœ€è¦å‘é€å‰ä¸¤ä¸ªè¯ä¹¦ï¼ˆç«™ç‚¹è¯ä¹¦ - ä¸­é—´è¯ä¹¦ï¼‰å³å¯ã€‚ä½†ä¹Ÿæœ‰çš„è¯ä¹¦æœ‰å››çº§ï¼Œé‚£å°±éœ€è¦å‘é€ç«™ç‚¹è¯ä¹¦å¤–åŠ ä¸¤ä¸ªä¸­é—´è¯ä¹¦äº†ã€‚
</content>
    </entry>
    
     <entry>
        <title>é€šè¿‡Zabbixç›‘æ§ä¸šåŠ¡æ•°æ®ï¼ˆç»­ï¼‰</title>
        <url>https://orchidflower.github.io/2017/04/20/Monitoring-data-in-mysql-using-Zabbixpart2/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Zabbix</tag>
        </tags>
        <content type="html"> æ˜¨å¤©é…ç½®å¥½æŠ¥è­¦æ¡ä»¶ä¹‹åï¼Œä»Šå¤©æ—©ä¸Šæ£€æŸ¥å‘ç°æ˜¨å¤©æ™šä¸Šå‘å‡ºäº†æŠ¥è­¦ã€‚ä½†æ˜¯çœ‹ä¸Šå»åƒæ˜¯è¯¯æŠ¥ã€‚ åœ¨å‡Œæ™¨2:44:02è§¦å‘äº†è­¦æŠ¥ï¼Œç„¶ååœ¨2:44:32è­¦æŠ¥è§£é™¤ï¼ŒæŒç»­æ—¶é—´30ç§’ã€‚å¦‚ä¸‹ä¸¤å›¾ï¼š ä»æ„Ÿè§‰ä¸Šåƒæ˜¯è¯¯æŠ¥ã€‚
1. è¯¯æŠ¥æ’é™¤ 1.1 æŠ¥è­¦æ¡ä»¶ æ˜¨å¤©è®¾ç½®å¥½çš„æŠ¥è­¦æ¡ä»¶å¦‚ä¸‹ï¼š
CODE_ALLã€CODE_100åœ¨æœ€è¿‘30ç§’é’Ÿæœ‰æ•°æ®ï¼› æœ€è¿‘300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰CODE_ALLæ€»è®¡å¤§äº30ï¼› CODE_100/CODE_ALL&amp;lt;0.7 1.2 æ”¶åˆ°çš„æ•°æ® è¦ç¡®å®šæŠ¥è­¦æ˜¯å¦æ­£ç¡®ï¼Œå°±éœ€è¦æŸ¥çœ‹å½“æ—¶æ”¶åˆ°çš„æ•°æ®æƒ…å†µã€‚æ‰€ä»¥ä»Zabbixçš„æœ€æ–°æ•°æ®ï¼ˆLatest Dataï¼‰ä¸­æŸ¥çœ‹æœ€è¿‘æ”¶åˆ°çš„æ•°æ®ã€‚æ‰¾åˆ°çš„æ•°æ®å¦‚ä¸‹ï¼š é¦–å…ˆæ˜¯ERROR_CODE_100çš„æ•°æ®ï¼š ç„¶åçœ‹ERROR_CODE_ALLçš„æ•°æ®ï¼š 1.3 ç–‘é—® æŒ‰ç…§ä¹‹å‰çš„æ¡ä»¶æ¥è¯´ï¼Œè¡¨è¾¾å¼å¤„ç†çš„æ•°æ®åº”è¯¥æ˜¯ä»2ï¼š40åˆ°2ï¼š44è¿™5åˆ†é’Ÿçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯(2&#43;3&#43;6&#43;4&#43;6)/(2&#43;5&#43;7&#43;5&#43;7)=80%ï¼Œæ˜æ˜¾ä¸ç¬¦åˆè¦æ±‚å•Šï¼Œæ€ä¹ˆä¼šæŠ¥è­¦å‘¢ï¼Ÿ
ä½†æ˜¯ä»”ç»†ä¸€çœ‹ï¼ŒåŸæ¥æ˜¯è¿™æ ·å•Šï¼åœ¨è¿™5åˆ†é’Ÿä¹‹å‰CODE_ALLæ”¶åˆ°çš„æœ€åä¸€æ¡æ•°æ®æ—¶é—´æ˜¯2:39:02ï¼ŒæŒ‰ç…§300ç§’çš„æ—¶é—´è·¨åº¦ï¼Œè¿™ä¸€æ¡è®°å½•ä¹Ÿæ˜¯ç¬¦åˆè¡¨è¾¾å¼è¦æ±‚çš„ã€‚æ‰€ä»¥å®é™…ä¸Šè¿›è¡Œè¿ç®—çš„è¡¨è¾¾å¼å˜æˆäº†ï¼š(2&#43;3&#43;6&#43;4&#43;6)/(2&#43;5&#43;7&#43;5&#43;7&#43;6)=65.6%ã€‚è¿™æ ·ç¡®å®å°±è§¦å‘äº†è­¦æŠ¥ã€‚
1.4 è§£å†³ ä½¿ç”¨300ç§’è¿™ç§æ—¶é—´è·¨åº¦ä¼šå‡ºç°å¤šä½¿ç”¨ä¸€æ¡æ•°æ®çš„æƒ…å†µï¼Œè¿™æ˜¯ä¸€å¼€å§‹æ²¡æœ‰æƒ³åˆ°çš„ï¼Œå¯¹Zabbixçš„è¿ä½œæœºåˆ¶äº†è§£çš„ä¸å¤Ÿé€å½»ã€‚å¯¹äºè¿™ç§æ—¶æ•ˆæ€§è¦æ±‚æ¯”è¾ƒå¼ºçš„æŠ¥è­¦æ¡ä»¶ï¼Œä½¿ç”¨Zabbixè¿˜æ˜¯è¦æ¯”è¾ƒä»”ç»†è€ƒè™‘é€»è¾‘æ˜¯å¦æœ‰æ¼æ´çš„ã€‚ æƒ³äº†æƒ³ï¼Œæ—¢ç„¶æ—¶é—´è·¨åº¦ä¸å¥½æŒæ¡ï¼Œå¯ä»¥é™åˆ¶ä¸ºä½¿ç”¨æ”¶åˆ°çš„è®°å½•æ¡æ•°è¿›è¡Œé™åˆ¶ã€‚æ‰€ä»¥æœ€åæ”¹æˆçš„æ¡ä»¶å¦‚ä¸‹ï¼Œè¿™å‡ å¤©å†å…³æ³¨ä¸€ä¸‹æ˜¯å¦å·¥ä½œç¬¦åˆé¢„æœŸï¼š 2. ä¸‰ç§æ¨¡å¼çš„ç¤ºæ„å›¾ Zabbix Itemçš„ç±»å‹æ¯”è¾ƒå¤šï¼Œç†è§£èµ·æ¥å¯èƒ½æœ‰äº›ç»•ã€‚æ‰€ä»¥ç‰¹æ„ç”»å¼ å›¾ï¼Œåº”è¯¥ä¼šæœ‰åŠ©äºç†è§£çš„æ›´æ¸…æ¥šã€‚
</content>
    </entry>
    
     <entry>
        <title>é€šè¿‡Zabbixç›‘æ§ä¸šåŠ¡æ•°æ®</title>
        <url>https://orchidflower.github.io/2017/04/19/Monitoring-data-in-mysql-in-Zabbix/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Zabbix</tag>
        </tags>
        <content type="html"> ä¸ºäº†äº‹ååˆ†ææœåŠ¡è´¨é‡ï¼Œæˆ‘ä»¬çš„äº‘è®¤è¯ç³»ç»Ÿå°†å•†æˆ·è®¿é—®è®°å½•ä¿å­˜åˆ°äº†æ•°æ®åº“ä¸­ï¼ˆMySQLï¼‰ã€‚åœ¨æ—¥å¿—ä¸­æˆ‘ä»¬è®°å½•äº†å•†æˆ·æ¯æ¬¡è®¿é—®çš„è¿”å›ç»“æœï¼Œè€—è´¹æ—¶é—´ç­‰ä¿¡æ¯ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯æˆ‘ä»¬å¯ä»¥åˆ†æå‘ç°æœåŠ¡ä»€ä¹ˆæ—¶å€™æ€§èƒ½æ¯”è¾ƒä½ï¼Œä»€ä¹ˆæ—¶å€™å¤„ç†æ•ˆæœæ¯”è¾ƒå·®ã€‚
ä¹‹å‰é€šè¿‡å†™è„šæœ¬ï¼Œæ¯å°æ—¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œä¸€æ¬¡ç»Ÿè®¡ï¼Œå¹¶æ ¹æ®æƒ…å†µï¼ˆå¦‚é”™è¯¯æ¯”ä¾‹è¿‡é«˜ç­‰ï¼‰å‘é€é‚®ä»¶é€šçŸ¥ç»™ç›¸å…³äººå‘˜ã€‚ä½†æ˜¯è¿™å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š
å“åº”ä¸åŠæ—¶ï¼šå› ä¸ºä¸€å°æ—¶æ‰ç»Ÿè®¡ä¸€æ¬¡ï¼Œæ‰€ä»¥æ»åæ•ˆåº”å¤ªæ˜æ˜¾ï¼Œç»å¸¸é—®é¢˜å·²ç»å‘ç”Ÿå¾ˆä¹…æŠ¥è­¦æ‰å‘é€å‡ºæ¥ï¼› æŠ¥è­¦æ¡ä»¶æ›´æ–°ä¸æ–¹ä¾¿ï¼šæŠ¥è­¦æ¡ä»¶åªèƒ½é€šè¿‡è„šæœ¬ç¼–å†™äººå‘˜å®ç°ï¼Œä¿®æ”¹èµ·æ¥ä¸æ–¹ä¾¿ã€‚ é‰´äºæ­¤ï¼Œä¸€ç›´æƒ³å¯¹è¿™ä¸ªæŠ¥è­¦ä½“ç³»è¿›è¡Œæ”¹é€ ï¼Œæœ€åé€‰æ‹©é€šè¿‡Zabbixå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚
1. èƒŒæ™¯ä»‹ç» Zabbixè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå…·ä½“æ€ä¹ˆæ“ä½œç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹ã€‚è¿™é‡Œä¼šä»‹ç»æˆ‘åœ¨ä½¿ç”¨ä¸­ç¢°åˆ°çš„é—®é¢˜ï¼Œä»¥åŠå¯¹åº”çš„è§£å†³åŠæ³•ï¼Œä¸æ¶‰åŠå…·ä½“æ“ä½œã€‚
è¿™æ¬¡æ”¹é€ ä¸»è¦å¯¹è¿”å›å€¼è¿›è¡Œåˆ¤æ–­ã€‚ç®€å•ä»‹ç»ä¸€ä¸‹æ•°æ®ï¼šæ¯æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ªè¿”å›å€¼å­—æ®µERROR_CODEï¼Œå…¶å¯èƒ½çš„å€¼ä¸ºï¼š
100 æœåŠ¡å¤„ç†æˆåŠŸï¼› 441 æœåŠ¡å¤„ç†å¤±è´¥ï¼ˆæœåŠ¡å¤±è´¥ï¼Œä½†æ˜¯å¦‚æœæ¯”ä¾‹è¿‡é«˜ï¼Œå¯èƒ½æœ‰éšå«çš„é—®é¢˜å‘ç”Ÿã€‚ä¾‹å¦‚å•†æˆ·æäº¤çš„ä¿¡æ¯æœ‰é—®é¢˜ï¼Œç¼–ç é”™è¯¯å¯¼è‡´é—®é¢˜ç­‰ï¼‰ï¼› 442 æœ‰å¼‚å¸¸å‘ç”Ÿï¼› 443 æœ‰è¶…æ—¶å‘ç”Ÿã€‚ è¿™æ¬¡å¸Œæœ›è¾¾åˆ°çš„ç›®æ ‡ä¸ºï¼š å½“æˆåŠŸæ¯”ä¾‹è¿‡ä½ï¼ˆä¾‹å¦‚ä½äº70%ï¼‰çš„æ—¶å€™ï¼Œè§¦å‘æŠ¥è­¦ï¼›å¦å¤–æ£€æŸ¥é¢‘åº¦è¦æé«˜ï¼ˆä¾‹å¦‚1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼Œä¸å†1å°æ—¶ä¸€æ¬¡ï¼‰ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿå‘ç°é—®é¢˜ã€‚ä½†æ˜¯å…·ä½“çš„æŠ¥è­¦æ¡ä»¶è¿˜è¦è€ƒè™‘è®¿é—®é‡ç­‰è¦ç´ ï¼šä¾‹å¦‚æ™šä¸Šè®¿é—®é‡å¾ˆå°‘ï¼Œç»å¸¸1åˆ†é’Ÿåªæœ‰å‡ æ¡ï¼Œè¿™æ—¶å¾ˆå®¹æ˜“å‡ºå‘70%è¿™ä¸ªè­¦æˆ’çº¿ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘è¿‡æ»¤è¿™ç§æƒ…å†µã€‚
2. ä½¿ç”¨Zabbix å®šä¸‹äº†ç›®æ ‡ï¼Œæœ€åˆæ„Ÿè§‰å®ç°èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œæ‰€ä»¥é€šè¿‡ä¿®æ”¹Zabbix agentï¼Œåˆ›å»ºäº†å‡ ä¸ªItemï¼Œåˆ†åˆ«ç”¨æ¥é‡‡é›†æ¯åˆ†é’Ÿçš„ç¼–ç 100ã€441ã€442ã€443çš„è®°å½•æ•°é‡ã€ä»¥åŠæˆåŠŸç‡ï¼ŒZabbixä¸­åˆ›å»ºå¯¹åº”çš„Itemã€‚ç„¶ååˆ›å»ºTriggerï¼Œåˆ¤æ–­æˆåŠŸç‡æ˜¯å¦å°äº70å³å¯ã€‚
ä½†æ˜¯è¿™æ ·ä½¿ç”¨èµ·æ¥å‘ç°æœ‰é—®é¢˜ï¼šä»æ•°æ®åº“ä¸­è·å–ä¸Šè¿°è®°å½•æ•°ä»¥åŠæˆåŠŸç‡çš„è„šæœ¬æ‰§è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼Œå¶å°”ä¼šå‡ºç°æ‰§è¡Œè¶…æ—¶çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®é‡‡é›†ä¸­æ–­ï¼ˆZabbixæ— æ³•é‡‡é›†åˆ°æ•°æ®ï¼‰ï¼Œå½±å“åˆ¤æ–­æ•ˆæœã€‚è™½ç„¶åæ¥å‘ç°è„šæœ¬æœ¬èº«ä¼˜åŒ–æœ‰é—®é¢˜ï¼Œç»è¿‡ä¼˜åŒ–é€Ÿåº¦æœ‰æ‰€æå‡ï¼Œä½†æ˜¯è¿™ç§é•¿æ—¶é—´çš„æ“ä½œç†åº”ä½¿ç”¨Zabbix Agent Activeæ¨¡å¼æ¥å¤„ç†ã€‚æœ€åå†³å®šåˆ‡æ¢åˆ°Zabbix agent(active)ã€‚
3. ä½¿ç”¨Zabbix Agent active Zabbix agentå’ŒZabbix agent(active)çš„åŒºåˆ«åœ¨äºåè€…ä¼šä¸»åŠ¨ä»Serveræ‹‰å–è¦ç›‘æ§çš„é¡¹ç›®ï¼ŒæˆåŠŸé‡‡é›†ä¹‹åæäº¤ç»™Serverï¼Œç›¸å½“äºä¸¤æ­¥æ“ä½œï¼›è€Œå‰è€…åˆ™æ˜¯Serverç›´æ¥å‘å‘½ä»¤ç»™Agentï¼Œå¹¶ç­‰å¾…è¿”å›ï¼Œç›¸å½“äºä¸€æ­¥æ“ä½œã€‚Activeæ¨¡å¼å°±æ˜¯ä¸ºäº†è§£å†³éƒ¨åˆ†é‡‡é›†é¡¹è€—æ—¶æ—¶é—´é•¿è€Œè®¾è®¡çš„ã€‚
åˆ‡æ¢åˆ°Active Agentæ¯”è¾ƒç®€å•ï¼Œåªè¦åœ¨/etc/zabbix/zabbix_agentd.confä¸­æŒ‡å®šé…ç½®å³å¯ï¼š
1# æŒ‡å®šZabbixæœåŠ¡å™¨åœ°å€ 2ServerActive=192.168.251.11 3# é…ç½®å½“å‰ä¸»æœºçš„Hostnameï¼Œéœ€è¦ä¸Zabbixä¸­é…ç½®çš„ä¸»æœºåå¯¹åº”ï¼Œå¦åˆ™ä¼šæ— æ³•è·å–ç›‘æ§é¡¹ 4Hostname=192.168.61.53 ç„¶ååœ¨Zabbixä¸­æŠŠå¯¹åº”Itemé¡¹æ”¹æˆZabbix agent(active)å³å¯ã€‚
è¿™æ ·é…ç½®ä¸‹æ¥ï¼Œè§£å†³äº†ä¸Šé¢çš„è€—æ—¶è¿‡é•¿é—®é¢˜ã€‚ä½†æ˜¯å®é™…ä½¿ç”¨ä¸­åˆå‘ç°äº†æ–°é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜è·Ÿæˆ‘ä»¬é‡‡ç”¨çš„æŠ¥è­¦åˆ¤æ–­æ¡ä»¶æœ‰å…³ã€‚æ‰€ä»¥å…ˆä»‹ç»ä¸€ä¸‹æŠ¥è­¦æ¡ä»¶çš„æ€è·¯ï¼šè¦è§¦å‘è­¦æŠ¥ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
æœ€è¿‘5åˆ†é’Ÿå†…æˆåŠŸç‡ä½äº70%ï¼ˆä¸æ˜¯åªåˆ¤æ–­å½“å‰1åˆ†é’Ÿï¼Œå› ä¸ºè€ƒè™‘å•åˆ†é’Ÿå¯èƒ½æœ‰é‡‡æ ·ä¸å¤Ÿçš„é—®é¢˜ï¼‰ï¼› æœ€è¿‘5åˆ†é’Ÿè®¿é—®æ€»é‡ä¸ä½äº50ï¼ˆå¦‚æœè¿‡ä½ï¼Œå› ä¸ºé‡‡æ ·æ¡æ•°æœ‰é™ï¼Œæ‰€ä»¥å¯èƒ½è¯¯åˆ¤ï¼‰ã€‚ è¦æ»¡è¶³ä¸Šé¢è¿™ç§åˆ¤æ–­ï¼Œä¸Šé¢çš„æ•°æ®é‡‡é›†æ–¹å¼æœ‰å¾ˆå¤§çš„é—®é¢˜ï¼š
æ•°æ®ä¸æ˜¯åŒæ—¶é‡‡é›†çš„ï¼šZabbixæ— æ³•é©±åŠ¨AgentåŒæ—¶é‡‡é›†ä¸€æ‰¹Itemï¼ŒAgentåªèƒ½ä¸€ä¸ªä¸€ä¸ªçš„è¿›è¡Œé‡‡é›†ã€‚è¿™å°±å¯¼è‡´å‡ ä¸ªItemå¹¶ä¸æ˜¯åŒä¸€æ—¶æœŸçš„æ•°æ®ã€‚ä¾‹å¦‚æœ‰å¯èƒ½è¿™æ ·ï¼šé”™è¯¯ç 100çš„ä¿¡æ¯æ˜¯0ç‚¹æ•´é‡‡é›†çš„ï¼Œè€Œé”™è¯¯ç 441çš„ä¿¡æ¯å¯èƒ½æ˜¯0ç‚¹0åˆ†10ç§’é‡‡é›†çš„ï¼Œé”™è¯¯ç 442çš„ä¿¡æ¯é‡‡é›†çš„æ—¶é—´å¯èƒ½æ˜¯0ç‚¹0åˆ†30ç§’ã€‚æ‹¿ä¸åŒæ—¶é—´ç‚¹é‡‡é›†çš„æ•°æ®å»è®¡ç®—æˆåŠŸç‡æ˜¯ä¸æ­£ç¡®çš„ï¼› å¦‚æœå•çº¯çš„é‡‡ç”¨æ¯åˆ†é’Ÿçš„æˆåŠŸç‡è¿›è¡Œå¹³å‡ï¼ˆavgï¼‰ï¼Œä¹Ÿæ˜¯ä¸å‡†ç¡®çš„ï¼Œå› ä¸ºæ¯åˆ†é’Ÿçš„è®¿é—®é‡æ˜¯ä¸ä¸€æ ·çš„ã€‚æ­£ç¡®çš„ç®—æ³•æ˜¯æˆåŠŸç‡ä¸è®¿é—®é‡è¿›è¡ŒåŠ æƒå¹³å‡ã€‚ä½†æ˜¯ä¸Šè¿°é‡‡é›†æ–¹æ³•æ˜¾ç„¶æ»¡è¶³ä¸äº†è¿™ç§è®¡ç®—è¦æ±‚ã€‚ 4. ä½¿ç”¨Zabbix Trapper ç»è¿‡é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œå‘ç°å¯ä»¥ä½¿ç”¨Zabbix Trapperè¿™ç§æ¨¡å¼æ¥è§£å†³é—®é¢˜ã€‚
Trapperç±»å‹çš„Itemä¸€èˆ¬ç¿»è¯‘ä¸ºæ•æ‰å™¨ï¼Œå¯èƒ½ç†è§£èµ·æ¥æœ‰äº›å›°éš¾ï¼Œå…¶æ ¸å¿ƒçš„ç”¨æ³•æ˜¯Zabbixåˆ›å»ºæ­¤ç§ç±»å‹çš„Itemï¼Œä½†æ˜¯ä¸ä¼šä¸»åŠ¨å»è¿›è¡Œæ•°æ®é‡‡é›†ã€‚è€Œä¸ç®¡æ˜¯Agentã€Agentï¼ˆactiveï¼‰å®é™…ä¸Šéƒ½æ˜¯Zabbixåœ¨ä¸»åŠ¨æ”¶é›†æ•°æ®ï¼Œåªæ˜¯ä¸»åŠ¨çš„æœ‰å¯èƒ½æ˜¯Zabbix Serverï¼ˆå¯¹åº”Zabbix Agentç±»å‹ï¼‰æˆ–è€…Zabbix Agentï¼ˆå¯¹åº”Zabbix Agent activeç±»å‹ï¼‰ã€‚ä½†æ˜¯å¯¹Zabbix Trapperç±»å‹ï¼ŒZabbixåªæ˜¯å‡†å¤‡å¥½äº†æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼Œç­‰å¾…æ•°æ®çš„åˆ°æ¥ã€‚
ä½¿ç”¨Trapperç±»å‹ï¼Œæ•°æ®é‡‡é›†çš„å·¥ä½œç”±ä½¿ç”¨è€…æ¥å®ç°ã€‚æ•°æ®é‡‡é›†å®Œæˆåï¼Œå¯ä»¥é€šè¿‡zabbix_senderå‘é€åˆ°Zabbix Serverä¸­ã€‚ç„¶åServerå°±å¯ä»¥å¯¹å„ç§Triggerè¿›è¡Œåˆ¤æ–­äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒTrapperç±»å‹å°†æ•°æ®é‡‡é›†åŠŸèƒ½äº¤ç»™äº†ä½¿ç”¨è€…ã€‚
æˆ‘é‡‡ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡cronå®šæ—¶æ‰§è¡Œï¼ˆæ¯åˆ†é’Ÿï¼‰ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬è´Ÿè´£é‡‡é›†æ•°æ®å¹¶å‘é€ç»™Zabbixã€‚è„šæœ¬å†…å®¹å¤§ä½“å¦‚ä¸‹ï¼Œå¯ä¾›å‚è€ƒï¼š
1# è·å–å½“å‰æ—¶é—´ 2DATE_NOW=`date &#43;&amp;#39;%Y-%m-%d %H:%M&amp;#39;` 3# è·å–ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ 4DATE_LAST=`cat /tmp/last.access.txt` 5if [ -z &amp;#34;$DATE_LAST&amp;#34; ]; then 6 # å¦‚æœæ²¡æœ‰ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ï¼Œä¸Šæ¬¡æ‰§è¡Œæ—¶é—´å‡å®šä¸º5åˆ†é’Ÿå‰ 7 DATE_LAST=`date -d&amp;#39;-5 minute&amp;#39; &#43;&amp;#39;%Y-%m-%d %H:%M&amp;#39;` 8fi 9# ä¿å­˜ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ 10echo $DATE_NOW &amp;gt; /tmp/last.access.txt 11# è·å–ç»Ÿè®¡ä¿¡æ¯ 12sql=&amp;#34;select count(id) as error_all, count(if(error_code=100,id,null)) as error_100,count(if(error_code=441,id,null)) as error_441,count(if(error_code=442, id, null)) as error_442,coun 13t(if(error_code=443,id,null)) as error_443,count(if(error_code=100,id,null))/count(id)*100 as percent from xwf_logs.uid_bankcard_auth_no_otp_log where ACCESS_TIME&amp;lt;&amp;#39;${DATE_NOW}&amp;#39; and AC 14CESS_TIME&amp;gt;=&amp;#39;${DATE_LAST}&amp;#39;&amp;#34; 15result=`${MYSQL_CONN_READ} -e &amp;#34;${sql}&amp;#34;` 16error_all=`echo $result | awk &amp;#39;{print $7}&amp;#39;` 17error_100=`echo $result | awk &amp;#39;{print $8}&amp;#39;` 18error_441=`echo $result | awk &amp;#39;{print $9}&amp;#39;` 19error_442=`echo $result | awk &amp;#39;{print $10}&amp;#39;` 20error_443=`echo $result | awk &amp;#39;{print $11}&amp;#39;` 21error_per=`echo $result | awk &amp;#39;{print $12}&amp;#39;` 22# å‘é€åˆ°Zabbixä¸­ 23echo Data was sent at: $DATE_NOW 24zabbix_sender -z $ZABBIX_SERVER -p $ZABBIX_PORT -s $HOST_NAME -k uid.logs[ERROR_CODE_ALL] -o $error_all 25zabbix_sender -z $ZABBIX_SERVER -p $ZABBIX_PORT -s $HOST_NAME -k uid.logs[ERROR_CODE_100] -o $error_100 26zabbix_sender -z $ZABBIX_SERVER -p $ZABBIX_PORT -s $HOST_NAME -k uid.logs[ERROR_CODE_441] -o $error_441 27zabbix_sender -z $ZABBIX_SERVER -p $ZABBIX_PORT -s $HOST_NAME -k uid.logs[ERROR_CODE_442] -o $error_442 28zabbix_sender -z $ZABBIX_SERVER -p $ZABBIX_PORT -s $HOST_NAME -k uid.logs[ERROR_CODE_443] -o $error_443 29zabbix_sender -z $ZABBIX_SERVER -p $ZABBIX_PORT -s $HOST_NAME -k uid.logs[ERROR_CODE_100_PERCENT] -o $error_per 30echo Data was sent successfully. 31echo ---------------------------------------------- ä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨ä¸€æ¡è¯­å¥è®¡ç®—æ‰€æœ‰çš„æŒ‡æ ‡ï¼Œè¿™æ ·åŠå‡è½»äº†MySQLçš„å‹åŠ›ï¼Œä¹Ÿä¿è¯äº†æ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªæ˜¯ç®€å•é‡‡é›†å‡ºæ¥çš„ã€‚å¦å¤–ï¼Œé€šè¿‡ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶/tmp/last.access.txtä¿å­˜ä¸Šæ¬¡æ•°æ®é‡‡é›†çš„æ—¶é—´ç‚¹ï¼Œä¿è¯äº†å³ä½¿å®šæ—¶ä»»åŠ¡è§¦å‘æœ‰æ‰€å˜åŒ–ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®æ²¡æœ‰é‡‡é›†åˆ°ã€‚
Triggerä¸­çš„æ¡ä»¶è®¾ç½®æˆè¿™æ ·ï¼š ä¹Ÿå°±æ˜¯æœ€è¿‘5åˆ†é’Ÿå†…è®¿é—®é‡&amp;gt;50å¹¶ä¸”æˆåŠŸç‡ä½äº70%å°±è§¦å‘æŠ¥è­¦ã€‚
5. è§£å†³è¯¯æŠ¥ 5.1 æ•°æ®æäº¤é¡ºåº é…ç½®å®Œæˆä¹‹åï¼Œè¿è¡Œä¸€æ®µæ—¶é—´å‘ç°ç»å¸¸è¯¯æŠ¥ï¼šæ˜æ˜æ£€æŸ¥æ•°æ®ä¸ç¬¦åˆæ¡ä»¶ï¼Œä½†æ˜¯å°±æ˜¯ä¼šè§¦å‘ä¸€ä¸ªçŠ¶æ€OKçš„æŠ¥è­¦é€šçŸ¥ï¼ŒæŒç»­æ—¶é—´ï¼ˆDurationï¼‰ä¸º0ï¼Œæ²¡æœ‰å¯¹åº”çš„PROBLEMçŠ¶æ€çš„æŠ¥è­¦ã€‚è¿™çœŸæ˜¯éå¸¸å¥‡æ€ªã€‚
è¿™ä¸ªé—®é¢˜è€—è´¹äº†å¾ˆé•¿æ—¶é—´ï¼Œç»è¿‡ä»”ç»†ç ”è¯»Zabbixçš„å®˜æ–¹æ‰‹å†Œï¼Œå‘ç°é‡Œé¢æœ‰è¿™ä¹ˆä¸€æ®µ Triggersï¼š
Trigger status (the expression) is recalculated every time Zabbix server receives a new value that is part of the expression. ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“Triggerçš„è¡¨è¾¾å¼ä¾èµ–äºå¤šä¸ªItemï¼ˆä¾‹å¦‚ä¸Šé¢çš„ä¾èµ–äºALLå’Œ100ä¸¤ä¸ªItemï¼‰çš„æ—¶å€™ï¼Œå½“æ¯ä¸€ä¸ªItemçš„æ–°å€¼åˆ°æ¥çš„æ—¶å€™ï¼ŒZabbixéƒ½ä¼šå¯¹Triggerè¿›è¡Œé‡æ–°è®¡ç®—ã€‚Zabbixä¸ä¼šç­‰åˆ°å¤šä¸ªæ•°æ®éƒ½é½å…¨ä¹‹åå†è¿›è¡Œåˆ¤æ–­ã€‚
è¿”å›å¤´çœ‹ä¸Šé¢çš„è„šæœ¬ï¼Œå…ˆæäº¤äº†ALLï¼Œç„¶åæäº¤äº†100ã€‚è¿™æ ·Zabbixå…ˆæ‹¿åˆ°äº†æ–°çš„ALLå€¼ï¼Œ**ç„¶åå°±ä¼šæ‹¿æœ€è¿‘çš„5åˆ†é’Ÿçš„ERROR_CODE_100çš„å€¼ï¼ˆè¿™æ—¶å®é™…ä¸Šåªæœ‰4ä¸ªï¼Œæœ€æ–°çš„æ•°æ®æœåŠ¡å™¨è¿˜æ²¡æœ‰æ”¶åˆ°ï¼‰ï¼Œå’Œæœ€è¿‘5åˆ†é’Ÿçš„ERROR_CODE_ALLçš„å€¼ï¼ˆ5ä¸ªï¼‰ä¸€èµ·è®¡ç®—æˆåŠŸç‡ï¼Œæ˜¾ç„¶è¿™æ ·å¾ˆå®¹æ˜“è§¦å‘ä½äº70%è¿™ä¸ªæ¡ä»¶ã€‚æ‰€ä»¥Zabbixå°±è®¤ä¸ºè¿™ä¸ªTriggerå¤„äºPROBLEMçŠ¶æ€ã€‚ä½†æ˜¯å½“100çš„æ•°æ®ä¹Ÿæ”¶åˆ°ä¹‹åï¼ŒZabbixå†æ¬¡é‡æ–°è®¡ç®—ï¼Œåˆå‘ç°çŠ¶æ€å®é™…ä¸Šæ˜¯OKçš„ã€‚**æ‰€ä»¥å°±å‡ºç°ä¸Šé¢é‚£ç§åå¤å‡ºç°OKæŠ¥è­¦çš„æƒ…å†µã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆæ²¡æœ‰å¯¹åº”çš„PROBLEMæŠ¥è­¦ï¼Œå¯èƒ½æ˜¯Zabbixæœ¬èº«è¿›è¡Œäº†é™åˆ¶ï¼Œä¸å‘é€è¿™ç§Durationå¾ˆçŸ­çš„PRBLEMçŠ¶æ€ã€‚æœ‰æ—¶é—´çœ‹çœ‹æºç ç¡®è®¤ä¸€ä¸‹ã€‚
æœ€å…ˆæƒ³åˆ°çš„è§£å†³åŠæ³•æ˜¯å°†è„šæœ¬ä¸­çš„æ•°æ®æäº¤é¡ºåºæ¢ä¸€ä¸‹ï¼Œå°†100çš„æ•°æ®å…ˆæäº¤ï¼Œç„¶åæ˜¯ALLã€‚ä½†æ˜¯å®é™…ä¸Šè¿™æ ·ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼Œå®ƒä¼šå¯¼è‡´Triggerä»PRBLEMçŠ¶æ€é”™è¯¯çš„å˜æˆOKçŠ¶æ€ï¼ˆ5ä¸ª100æ•°æ®å’Œ4ä¸ªALLæ•°æ®è®¡ç®—æˆåŠŸç‡ï¼‰ã€‚æ‰€ä»¥æœ€åçš„è§£å†³åŠæ³•æ˜¯è¿™æ ·ï¼š å°±æ˜¯åˆ¤æ–­æœ€è¿‘30ç§’ä¹‹å†…ALLå’Œ100çš„æ•°æ®æœ‰æ²¡æœ‰ï¼Œæ²¡æœ‰å°±è®¤ä¸ºæ•°æ®ä¸å…¨ï¼Œè®¤ä¸ºçŠ¶æ€æ­£å¸¸ã€‚åªæœ‰å½“ä¸¤è€…æ•°æ®éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œæ‰è®¡ç®—æ¯”ä¾‹æ˜¯å¦å°äº70%ã€‚
5.2 Recoveryæ¡ä»¶ ä»”ç»†åˆ†æä¸€ä¸‹å°±ä¼šå‘ç°ï¼Œä¸Šé¢çš„åˆ¤æ–­æ¡ä»¶åœ¨TriggerçŠ¶æ€ä¸ºPROBLEMçš„æ—¶å€™è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼šå½“ALLæˆ–è€…100çš„æ•°æ®æ²¡æœ‰æ”¶åˆ°çš„æ—¶å€™ï¼Œä¸è¿›è¡Œè®¡ç®—ç™¾åˆ†æ¯”ï¼Œä¸Šé¢çš„Expressè¢«åˆ¤æ–­æ²¡æœ‰é—®é¢˜ï¼ŒTriggerå°±ä¼šè¢«åˆ¤å®šä¸ºOKã€‚ä½†æ˜¯å½“æ•°æ®é½å…¨ä¹‹åï¼Œè®¡ç®—ç™¾åˆ†æ¯”ä¹‹åå‘ç°è¿˜æ˜¯æœ‰é—®é¢˜ã€‚è¿™æ ·å°±å¯¼è‡´äº†çŠ¶æ€åå¤åˆ‡æ¢ï¼Œé¢‘ç¹çš„å‘é€PRBLEMã€OKçš„æŠ¥è­¦ä¿¡æ¯ã€‚
è¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æ˜¯å¢åŠ Recovery Expressionåˆ°Triggerä¸­ã€‚è¿™ä¸ªExpressionçš„ä½œç”¨æ˜¯å½“Triggerå¤„äºPROBLEMçŠ¶æ€çš„æ—¶å€™ï¼Œå³ä½¿åˆ¤æ–­ExpressionçŠ¶æ€æ²¡æœ‰é—®é¢˜ï¼ˆFALSEï¼‰ï¼Œè¿˜éœ€è¦åˆ¤æ–­Recovery Expressionè£…ä¸ªè¡¨è¾¾å¼ï¼Œåªæœ‰å®ƒåˆ¤æ–­ä¸ºTRUEçš„æ—¶å€™æ‰è§£é™¤æŠ¥è­¦çŠ¶æ€ã€‚
æœ€åå¢åŠ Recovery Expressionï¼Œå†…å®¹å¦‚ä¸‹ï¼š åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œä¼šåˆ¤æ–­æˆåŠŸç‡é«˜äºç­‰äº70%æ‰è®¤ä¸ºçŠ¶æ€æ¢å¤ã€‚
6. å¿ƒå¾— Zabbixæä¾›çš„åŸºæœ¬åŠŸèƒ½èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ï¼ŒåŒæ—¶å®ƒè¿˜æä¾›äº†å¾ˆå¥½çš„æ‰©å±•æ–¹æ³•ã€‚ä¾‹å¦‚è¿™é‡Œç”¨åˆ°çš„Trapperï¼Œå¯ä»¥è®©ç”¨æˆ·è‡ªç”±çš„é‡‡é›†æ•°æ®ï¼Œè€ŒZabbixä¸“å¿ƒå¹²å¥½å®ƒçš„TriggeråŠŸèƒ½ï¼Œå„å¸å…¶èŒï¼Œé…åˆé«˜æ•ˆã€‚ å®˜æ–¹æ–‡æ¡£ä½œä¸ºæƒå¨èµ„æ–™ä¸€å®šè¦çœ‹ï¼Œå¾ˆå¤šç–‘éš¾é—®é¢˜ï¼Œå¯ä»¥åœ¨é‡Œé¢æ‰¾åˆ°æƒå¨è§£ç­”ã€‚ é™„å½•A. å‚è€ƒèµ„æ–™ Zabbix Trigger expression Zabbix Supported trigger functions Zabbix Sender </content>
    </entry>
    
     <entry>
        <title>åœ¨LinodeèŠ‚ç‚¹ä¸Šå¼€å¯BBRç®—æ³•</title>
        <url>https://orchidflower.github.io/2017/04/17/Enable-BBR-on-Linode/</url>
        <categories>
          <category>ç¿»å¢™</category>
        </categories>
        <tags>
          <tag>Linode</tag><tag>Shadowsocks</tag><tag>BBR</tag>
        </tags>
        <content type="html"> BBRæ˜¯Googleå¼€æºçš„TCPæ‹¥å µæ§åˆ¶ç®—æ³•ï¼Œä¸2016å¹´9æœˆå¼€æºã€‚BBRçš„ç›®çš„æ˜¯è¦å°½é‡è·‘æ»¡å¸¦å®½, å¹¶ä¸”å°½é‡ä¸è¦æœ‰æ’é˜Ÿçš„æƒ…å†µ, å…¶ä½¿ç”¨æ•ˆæœå¹¶ä¸æ¯”é€Ÿé”å·®ã€‚
Linux kernel 4.9&#43; å·²æ”¯æŒ tcp_bbrã€‚æˆ‘åœ¨Linodeå®‰è£…äº†4.10.10å†…æ ¸ï¼Œå¯ä»¥å¼€å¯BBRã€‚ä½†æ˜¯Linodeè‡ªå¸¦çš„4.9æ— æ³•å¼€å¯ã€‚
1. BBRç®€ä»‹ å…³äºå…¶å…·ä½“åŸç†åŠå„ç§åˆ†æå¯ä»¥çœ‹çŸ¥ä¹ä¸Šçš„è®¨è®ºè´´ï¼Œå¾ˆæœ‰æŠ€æœ¯å«é‡ã€‚è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚BBRè¯•å›¾è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š
åœ¨æœ‰ä¸€å®šä¸¢åŒ…ç‡çš„ç½‘ç»œé“¾è·¯ä¸Šå……åˆ†åˆ©ç”¨å¸¦å®½ã€‚éå¸¸é€‚åˆé«˜å»¶è¿Ÿã€é«˜å¸¦å®½çš„ç½‘ç»œé“¾è·¯ï¼š æ ‡å‡†TCPç®—æ³•åœ¨åªè¦æœ‰ä¸‡åˆ†ä¹‹ä¸€çš„ä¸¢åŒ…ç‡æƒ…å†µä¸‹ï¼Œå¸¦å®½å°±åªå‰© 30%ï¼›åƒåˆ†ä¹‹ä¸€ä¸¢åŒ…ç‡æ—¶åªå‰© 10%ï¼›æœ‰ç™¾åˆ†ä¹‹ä¸€çš„ä¸¢åŒ…ç‡æ—¶å‡ ä¹å°±å¡ä½äº†ã€‚è€Œ TCP BBR åœ¨ä¸¢åŒ…ç‡ 5% ä»¥ä¸‹å‡ ä¹æ²¡æœ‰å¸¦å®½æŸå¤±ï¼Œåœ¨ä¸¢åŒ…ç‡ 15% çš„æ—¶å€™ä»æœ‰ 75% å¸¦å®½ã€‚
é™ä½ç½‘ç»œé“¾è·¯ä¸Šçš„ buffer å ç”¨ç‡ï¼Œä»è€Œé™ä½å»¶è¿Ÿã€‚éå¸¸é€‚åˆæ…¢é€Ÿæ¥å…¥ç½‘ç»œçš„ç”¨æˆ· å»¶è¿Ÿè¶Šé«˜çš„ç”¨æˆ·ï¼Œé‡‡ç”¨ TCP BBR åçš„å»¶è¿Ÿä¸‹é™æ¯”ä¾‹è¶Šé«˜ï¼ŒåŸæ¥éœ€è¦ 10 ç§’çš„ç°åœ¨åªè¦ 2 ç§’äº†ã€‚
2. å¯ç”¨BBR ç›®å‰VPSä¾›åº”å•†çš„é»˜è®¤å†…æ ¸åº”è¯¥è¿˜æ²¡æœ‰è¿™ä¹ˆæ–°ã€‚å³ä½¿æ˜¯Linodeæä¾›äº†4.9.15ï¼Œä½†æ˜¯åº”è¯¥æ²¡æœ‰ç¼–è¯‘tcp_bbræ¨¡å—è¿›å»ï¼Œæ‰€ä»¥ç…§æ ·æ— æ³•å¼€å¯BBRåŠŸèƒ½ã€‚å› æ­¤å¯ç”¨BBRéœ€è¦é¦–å…ˆå®‰è£…æ–°å†…æ ¸ï¼Œç„¶åå¼€å¯ç›¸å…³é…ç½®å³å¯ã€‚
2.1 æ›´æ–°å†…æ ¸ å¯ç”¨BBRéœ€è¦æ›¿æ¢å†…æ ¸ã€‚æˆ‘ç”¨çš„VPSæ˜¯Linodeçš„ã€‚è€ŒLinodeæä¾›äº†ä¸€ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹å¼æ¥åˆ‡æ¢å†…æ ¸ï¼Œå¤§å¤§é™ä½äº†æ–°æ‰‹æ“ä½œçš„é£é™©ã€‚å®ƒå¯ä»¥åœ¨ç®¡ç†åå°é€‰æ‹©éœ€è¦å¯åŠ¨çš„å†…æ ¸ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥æ–°å®‰è£…ä¸€ä¸ªå†…æ ¸ï¼Œè€Œä¸ç”¨åˆ é™¤åŸæœ‰å†…æ ¸ï¼Œåœ¨ç®¡ç†åå°é€‰æ‹©GRUB2å¯åŠ¨æˆ‘ä»¬æ–°å®‰è£…çš„å†…æ ¸å³å¯ï¼Œæ–¹ä¾¿åˆå®‰å…¨ã€‚è¿™æ ·å°±æœ‰æœºä¼šåˆ‡æ¢å›åŸæœ‰çš„å†…æ ¸ï¼Œè€Œä¸ç”¨é‡æ–°å®‰è£…æ•´ä¸ªç³»ç»Ÿã€‚
æˆ‘åœ¨Linodeçš„èŠ‚ç‚¹ä½¿ç”¨çš„Ubuntu 16.04LTSã€‚è¿™ä¸ªç‰ˆæœ¬é»˜è®¤å†…æ ¸å¯ä»¥é€‰æ‹©åˆ°4.9.15ã€‚ä½†æ˜¯ä¾ç„¶ä¸æ”¯æŒBBRã€‚å› æ­¤éœ€è¦å®‰è£…æ–°å†…æ ¸ã€‚
å®‰è£…æ–¹æ³•æ¯”è¾ƒç®€å•ï¼š
1wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.10.10/linux-image-4.10.10-041010-generic_4.10.10-041010.201704120813_amd64.deb 2dpkg -i linux-image-4.10.10-041010-generic_4.10.10-041010.201704120813_amd64.deb è¿™æ ·å°±å®‰è£…äº†æ–°ç‰ˆæœ¬çš„å†…æ ¸ã€‚
ç„¶ååœ¨Linodeç®¡ç†æ§åˆ¶å°é‡Œé¢é€‰æ‹©Boot Settingsä¸­çš„Kernelé€‰æ‹©GRUB 2å³å¯ã€‚é€‰æ‹©ä¹‹åï¼Œé‡å¯æœºå™¨å³å¯ã€‚ 2.2 å¯ç”¨BBR é‡å¯ä¹‹åé¦–å…ˆæŸ¥çœ‹å†…æ ¸æ˜¯å¦æ­£ç¡®ï¼š
1root@localhost:~# uname -a 2Linux localhost 4.10.10-041010-generic #201704120813 SMP Wed Apr 12 12:15:07 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux è¡¨æ˜å·²ç»å‡çº§åˆ°äº†4.10.10ç‰ˆæœ¬çš„å†…æ ¸ã€‚
ç„¶åæŸ¥çœ‹æ˜¯å¦ç¼–è¯‘äº†tcp_bbræ¨¡å—ï¼š
1root@localhost:~# lsmod | grep tcp_bbr 2tcp_bbr 6015 13 å¦‚æœæ²¡æœ‰å¯ç”¨bbråˆ™ä¸Šé¢æ²¡æœ‰è¾“å‡ºæˆ–è€…æŠ¥é”™ã€‚
ä¸Šé¢æ¡ä»¶éƒ½æ»¡è¶³ä¹‹åå°±å¯ä»¥å¼€å¯BBRäº†ã€‚
1echo &amp;#34;net.core.default_qdisc=fq&amp;#34; &amp;gt;&amp;gt; /etc/sysctl.conf 2echo &amp;#34;net.ipv4.tcp_congestion_control=bbr&amp;#34; &amp;gt;&amp;gt; /etc/sysctl.conf 3sysctl -p ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å¯ç”¨æˆåŠŸï¼š
1root@localhost:~# sysctl net.ipv4.tcp_available_congestion_control 2sysctl net.ipv4.tcp_congestion_controlnet.ipv4.tcp_available_congestion_control = bbr cubic reno 3root@localhost:~# sysctl net.ipv4.tcp_congestion_control 4net.ipv4.tcp_congestion_control = bbr å¦‚æœç»“æœéƒ½æœ‰bbr, åˆ™è¯æ˜ä½ çš„å†…æ ¸å·²å¼€å¯BBRã€‚
2.3 æ•ˆæœ åœ¨æˆ‘çš„Linode fremonèŠ‚ç‚¹ä¸Šï¼Œå¼€å¯ä¹‹åå¤§æ¦‚èƒ½å¸¦æ¥å‡ å€çš„å·®è·ã€‚å¼€å¯åå¯ä»¥çœ‹1440pï¼Œ1080på¾ˆæµç•…ã€‚ BBRæœ‰ç‚¹ä¸è¶³çš„åœ°æ–¹æ˜¯ä½¿ç”¨ä¸­æ€»æ˜¯è¦ç¼“å†²ä¸€æ®µæ—¶é—´ç„¶åæ‰èƒ½å¤Ÿè¾¾åˆ°æ…¢é€Ÿï¼Œä¸ä¼šä¸€ä¸‹å­è¾¾åˆ°ã€‚å¯èƒ½æ˜¯å› ä¸ºæˆ‘è¿™è¾¹ç½‘ç»œå»¶è¿Ÿæœ‰ç‚¹å¤§ï¼Œæ¯•ç«Ÿæœ‰250-300msäº†ã€‚
é™„å½•A. å‚è€ƒèµ„æ–™ Linux Kernel 4.9 ä¸­çš„ BBR ç®—æ³•ä¸ä¹‹å‰çš„ TCP æ‹¥å¡æ§åˆ¶ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ Google BBR on Github Ubuntu kernel mainline 4.10.10 Kernel </content>
    </entry>
    
     <entry>
        <title>åœ¨VSCodeä¸­ä¸ºVue.jså¼€å‘å¯ç”¨é™æ€ç±»å‹æ£€æŸ¥Flow</title>
        <url>https://orchidflower.github.io/2017/04/11/Using-flow-js-for-vue-in-VSCode/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Vue.js</tag><tag>Flow</tag><tag>é™æ€ç±»å‹</tag>
        </tags>
        <content type="html"> ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavascriptæ˜¯ä¸€ç§å¼±ç±»å‹ï¼ˆæˆ–è€…ç§°ä¸ºåŠ¨æ€ç±»å‹ï¼‰è¯­è¨€ï¼Œå³å˜é‡çš„ç±»å‹æ˜¯ä¸ç¡®å®šçš„ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„tempä¸€å¼€å§‹æ˜¯å­—ç¬¦ä¸²ï¼Œåæ¥åˆå˜æˆäº†æ•°å­—ï¼š
1temp = &amp;#39;hello&amp;#39;; 2temp = 5; å¼±ç±»å‹è¯­è¨€å˜é‡ç±»å‹å®Œå…¨ç”±å½“æ—¶çš„å€¼å†³å®šï¼Œæ‰€ä»¥ç§°ä¸ºâ€œå¼±ç±»å‹â€ã€‚è¿™æ ·è®¾è®¡æœ‰å…¶å¥½å¤„ï¼Œå¯ä»¥å†™å‡ºéå¸¸ç®€æ´çš„ä»£ç ã€‚ä½†æ˜¯åœ¨æ„å»ºå¤§å‹é¡¹ç›®çš„æ—¶å€™ï¼Œæ— æ³•åœ¨ç¼–è¯‘æœŸå‘ç°é—®é¢˜ä¼šå¯¼è‡´å¾ˆéš¾å‘ç°é—®é¢˜ï¼Œåè€Œä¼šä¸ºç¨‹åºå‘˜å¸¦æ¥éå¸¸å¤§çš„è´Ÿæ‹…ã€‚è¿™å®é™…ä¸Šé™åˆ¶äº†JSé¡¹ç›®çš„è§„æ¨¡ï¼Œæ— æ³•å¼€å‘è¿‡äºå¤æ‚çš„é¡¹ç›®ã€‚
1. å¼ºç±»å‹è§£å†³æ–¹æ¡ˆ ä¸€ç›´æœ‰äººåœ¨å°è¯•ä¸ºJavascriptå¢åŠ å¼ºç±»å‹ç³»ç»Ÿçš„æ”¯æŒã€‚ç›®å‰çœ‹æ¥æ¯”è¾ƒæµè¡Œçš„æœ‰ä¸¤ç§æ–¹æ¡ˆï¼šTypescriptå’ŒFlow.jsã€‚
1.1 Typescript TypeScriptæ˜¯ä¸€ç§ç”±å¾®è½¯å¼€å‘çš„è‡ªç”±å’Œå¼€æºçš„ç¼–ç¨‹è¯­è¨€ã€‚å®ƒæ˜¯JavaScriptçš„ä¸€ä¸ªè¶…é›†ï¼Œè€Œä¸”æœ¬è´¨ä¸Šå‘è¿™ä¸ªè¯­è¨€æ·»åŠ äº†å¯é€‰çš„é™æ€ç±»å‹å’ŒåŸºäºç±»çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚åœ¨ç¼–è¯‘æœŸä¼šå»æ‰ç±»å‹å’Œç‰¹æœ‰è¯­æ³•ï¼Œç”Ÿæˆçº¯ç²¹çš„Javascriptä»£ç ã€‚ç”±äºæœ€ç»ˆæ‰§è¡Œçš„è¿˜æ˜¯Javascriptï¼Œæ‰€ä»¥Typescriptä¸ä¼šå¸¦æ¥å…¼å®¹æ€§é—®é¢˜ã€‚TypeScript æ˜¯ JavaScript çš„è¶…é›†ï¼Œè¿™æ„å‘³ç€ä»–æ”¯æŒæ‰€æœ‰çš„ JavaScript è¯­æ³•ã€‚å¹¶åœ¨æ­¤ä¹‹ä¸Šå¯¹ JavaScript æ·»åŠ äº†ä¸€äº›æ‰©å±•ï¼Œå¦‚ class / interface / module ç­‰ã€‚è¿™æ ·ä¼šå¤§å¤§æå‡ä»£ç çš„å¯é˜…è¯»æ€§ã€‚
ç›®å‰ç‰ˆæœ¬æ˜¯2.2ã€‚å®˜æ–¹ç½‘å€ä¸ºï¼šhttps://www.typescriptlang.org/ã€‚
Typescriptå¸¦æ¥çš„å¥½å¤„é‡ç‚¹æœ‰ï¼š
é™æ€ç±»å‹æ£€æŸ¥ï¼› IDEæ™ºèƒ½æç¤ºï¼› ä»£ç é‡æ„ï¼› å¯è¯»æ€§ã€‚ Angular 2.0æ¡†æ¶å·²ç»é‡‡ç”¨äº†Typescriptè¯­è¨€é‡å†™ã€‚
1.2 Flow Flowæ˜¯Facebookå‡ºå“çš„ï¼Œé’ˆå¯¹JavaScriptçš„é™æ€ç±»å‹æ£€æŸ¥å·¥å…·ï¼Œç›®å‰ç‰ˆæœ¬v0.43.1ã€‚å…¶ä»£ç æ‰˜ç®¡åœ¨githubä¹‹ä¸Šï¼Œå¹¶éµå®ˆBSDå¼€æºåè®®ã€‚å®˜ç½‘åœ°å€ï¼šhttp://flow.orgã€‚åŒä¸ºFacebookå‡ºå“ï¼ŒReacté‡‡ç”¨äº†Flowã€‚å¦å¤–ï¼ŒVue.jsä¹Ÿé‡‡ç”¨äº†Flowä½œä¸ºé™æ€æ£€æŸ¥çš„å·¥å…·ã€‚
1.3 æ¯”è¾ƒ ç›¸å¯¹æ¥è¯´ï¼ŒFlowçš„ä»£ç ä¾µå…¥æ€§æ¯”è¾ƒå°ä¸€äº›ã€‚å¹¶ä¸”å¯ä»¥é€šè¿‡babel-plugin-transform-flow-strip-typesè½¬ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°å»é™¤Flowç‰¹æ€§çš„ä»£ç ã€‚å¦ä¸€ç‚¹æ¥è¯´ï¼Œä»£ç å¯ä»¥éƒ¨åˆ†åˆ‡æ¢é‡‡ç”¨ï¼Œæˆæœ¬æ¯”è¾ƒä½ï¼Œèƒ½å¤Ÿä½¿ç”¨Babel&#43;ESLint&#43;Webpackè¿™ç§æ¯”è¾ƒæˆç†Ÿçš„ä½“ç³»ã€‚è¿™æ–¹é¢çš„è®¨è®ºå¯ä»¥å‚è€ƒé™„å½•ä¸­çš„ Vue 2.0 ä¸ºä»€ä¹ˆé€‰ç”¨ Flow è¿›è¡Œé™æ€ä»£ç æ£€æŸ¥è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ TypeScriptï¼Ÿ ï¼Œé‡Œé¢æœ‰Vue.jså¼€å‘è€…å°¤é›¨æºªå…³äºè¿™æ–¹é¢çš„æ€è€ƒä¸å›ç­”ã€‚
æˆ‘æ¯”è¾ƒè®¤åŒä»¥ä¸Šè§‚ç‚¹ï¼ŒFlowä»£ç ä¾µå…¥æ€§æ¯”è¾ƒå°ï¼Œå¯ä»¥ä¿è¯ä»£ç æ¯”è¾ƒç¬¦åˆESçš„å‘å±•è§„å¾‹ï¼Œå…å¾—å—åˆ¶äºå…·ä½“å‚å•†çš„æŠ€æœ¯ã€‚æ‰€ä»¥æœ€åå¼€å‘ä¸­é€‰æ‹©äº†åœ¨Vue.jså¼€å‘ä¸­ä½¿ç”¨FlowæŠ€æœ¯ã€‚å½“ç„¶ï¼Œæˆ‘åœ¨åå°å¼€å‘ï¼ˆNode.jsï¼‰ç›¸å…³ä»£ç ä¸­ä¹Ÿå¼•å…¥äº†Flowã€‚ä¸è¿‡è¿™éƒ¨åˆ†é…ç½®æ¯”è¾ƒå®¹æ˜“ï¼Œä¸‹é¢ä¼šé¡ºå¸¦æåˆ°ã€‚
2. å·¥å…·é“¾ç®€ä»‹ Javascriptå¼€å‘å¯¹å·¥å…·é“¾çš„ä½¿ç”¨è¶Šæ¥è¶Šé‡ï¼Œé€šå¸¸å‰ç«¯å¼€å‘éƒ½ä¼šç”¨åˆ°è¯¸å¦‚ï¼šWebpackã€Babelã€ESLintç­‰å·¥å…·ã€‚å…ˆç®€å•ä»‹ç»ä¸€ä¸‹å„å·¥å…·çš„ä¸»è¦ç”¨é€”ï¼š
Babelï¼š ç¼–è¯‘å·¥å…·ã€‚é‰´äºæ‰§è¡Œç¯å¢ƒï¼ˆæµè§ˆå™¨ã€Nodeï¼‰ä¸JSè§„èŒƒï¼ˆES6ã€ES7ç­‰ï¼Œæˆ–è€…Reactã€Vue.jsç­‰å®šä¹‰çš„è§„èŒƒï¼‰ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œä¸èƒ½å¤Ÿç›´æ¥åœ¨æ‰§è¡Œç¯å¢ƒè¿è¡Œæˆ‘ä»¬å†™çš„ä»£ç ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ç¼–è¯‘å·¥å…·å°†æˆ‘ä»¬å†™çš„ä»£ç ç¼–è¯‘æˆæ‰§è¡Œç¯å¢ƒå¯ä»¥ç†è§£çš„ä»£ç ï¼Œè¿™å°±æ˜¯Babelçš„ä½œç”¨ã€‚ Webpackï¼š æ‰“åŒ…å·¥å…·ã€‚èƒ½å¤Ÿå°†å„ç§èµ„æºï¼ˆJSã€JSXï¼‰ã€æ ·å¼ï¼ˆCSSã€LESSã€SASSï¼‰ã€å›¾ç‰‡ç­‰éƒ½ä½œä¸ºæ¨¡å—æ¥å¤„ç†ï¼Œå¹¶æœ€ç»ˆæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå³è§£å†³äº†ä»£ç ä¾èµ–é—®é¢˜ï¼Œä¹Ÿæé«˜äº†åŠ è½½é€Ÿåº¦ï¼› ESLintï¼š ä»£ç é—®é¢˜æ£€æŸ¥å·¥å…·ã€‚Linterç±»çš„å·¥å…·éƒ½æ˜¯é€šè¿‡æ‰«æä»£ç ï¼Œé€šè¿‡å·²æœ‰çš„è§„åˆ™å‘ç°ä»£ç ä¸­å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚è€ŒESLintå°±æ˜¯é’ˆå¯¹JSä»£ç çš„Linterå·¥å…·ã€‚ 3. ç¯å¢ƒé…ç½® 3.1 ç›®æ ‡åŠæ€è·¯ è¿™æ¬¡é…ç½®çš„ç›®æ ‡æ˜¯ï¼šåœ¨VSCodeä¸­å¯ä»¥é€šè¿‡Flowå‘ç°ä»£ç ä¸­çš„é—®é¢˜ï¼Œèƒ½å¤Ÿæ”¯æŒ.jsã€.vueæ–‡ä»¶ï¼›åœ¨Webpackä¸­é…ç½®èƒ½å¤Ÿå¯¹Flowç›¸å…³ä»£ç æ­£ç¡®ç¼–è¯‘ã€‚
è¿™æ¬¡é…ç½®çš„æ ¸å¿ƒæ€è·¯æ˜¯åˆ©ç”¨ESLintçš„æ’ä»¶æœºåˆ¶ï¼Œé€šè¿‡æ’ä»¶eslint-plugin-flowå®ç°å¯¹Flowæ”¯æŒã€‚è€ŒVSCodeæœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ESLintæ’ä»¶ï¼Œå¯ä»¥åœ¨æ‰“å¼€æ–‡ä»¶çš„æ—¶å€™è‡ªåŠ¨å¯¹æ–‡ä»¶å†…å®¹è¿›è¡ŒLintæ“ä½œï¼Œä»è€Œæç¤ºå‡ºå„ç§æ½œåœ¨é—®é¢˜ã€‚è¿™æ ·é€šè¿‡é…ç½®ESLintçš„è§„åˆ™ï¼Œä¸å…‰å¯ä»¥å®ç°æ™®é€šLinté—®é¢˜çš„å‘ç°ï¼Œè¿˜å¯ä»¥å®ç°Flowç›¸å…³é—®é¢˜çš„å‘ç°ï¼šä¾‹å¦‚å¯ä»¥è¦æ±‚å˜é‡å¿…é¡»æœ‰ç±»å‹ç­‰ã€‚
ä¸‹é¢æŒ‰ç…§é¡ºåºæè¿°å„ä¸ªæ­¥éª¤éœ€è¦åšçš„æ›´æ”¹ã€‚
3.2 Flow é¦–å…ˆå°±æ˜¯å®‰è£…Flowã€‚è™½ç„¶å¯ä»¥å°†Flowå®‰è£…åˆ°å…¨å±€ï¼Œä½†æ˜¯ä¸ºäº†ä»¥åæ–¹ä¾¿ç®¡ç†ï¼Œæ¨èå®‰è£…åˆ°é¡¹ç›®æœ¬èº«ã€‚
1npm install flow-bin --save-dev 3.2.1 .flowconfig åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œå¢åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶.flowconfigï¼Œä¸‹é¢çš„é…ç½®æ˜¯æˆ‘ç°åœ¨ç”¨çš„ã€‚Flowé»˜è®¤ä¼šæ‰«ææ•´ä¸ªå·¥ç¨‹ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œé€šè¿‡ ignore é…ç½®å¿½ç•¥ä¸éœ€è¦æ£€æµ‹çš„ä»£ç ã€‚å…¶ä»–é…ç½®é¡¹ä»¥åä¼šä¸“é—¨å†™ä¸ªä»‹ç»ã€‚
1[ignore] 2.*/node_modules/.* 3 4[include] 5./src/.*/*.vue 6 7[libs] 8 9[options] 3.2.2 éªŒè¯ ç°åœ¨å¯ä»¥éªŒè¯ä¸€ä¸‹äº†ã€‚åœ¨ä»£ç å¼€å§‹çš„åœ°æ–¹å¢åŠ æ³¨é‡Šï¼š/* @flow */ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤è¿›è¡Œæ£€æŸ¥ï¼š
1$ ./node_modules/.bin/flow src/utils.js 2... 3src/utils.js:8 4 8: module.exports.toHex = function(source) { 5 ^^^^^^ parameter `source`. Missing annotation 6... å¯ä»¥çœ‹åˆ°å·²ç»èƒ½å¤Ÿæ£€æŸ¥å‡ºæ¥é—®é¢˜äº†ã€‚
3.3 eslint ç„¶åå®‰è£…eslintæ’ä»¶ï¼ˆå¦‚æœä½ çš„é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨äº†eslintï¼Œé‚£è¿™æ­¥å¯ä»¥çœç•¥ï¼‰ï¼š
1# eslint 2npm install eslint --save-dev 3# parser babel-eslint 4npm install babel-eslint --save-dev 5# flowtype plugin 6npm install eslint-plugin-flowtype --save-dev 7# html plugin (used for .vue) 8npm install eslint-plugin-html --save-dev 9# vue plugin &amp;amp; vue rules config 10npm install eslint-plugin-vue eslint-config-vue --save-dev eslint-plugin-flowtype å°±æ˜¯ç”¨æ¥è¿›è¡ŒFlowæ£€æµ‹ç”¨çš„æ’ä»¶ã€‚eslint-plugin-htmlï¼Œeslint-plugin-vueä¸¤ä¸ªæ’ä»¶æ˜¯ä¸ºäº†æ£€æŸ¥.vueæ–‡ä»¶ç”¨çš„ã€‚eslint-config-vueæ˜¯vueæ£€æµ‹æ–¹é¢çš„ä¸€äº›è§„åˆ™ï¼Œä½¿ç”¨è¿™ä¸ªæˆ‘ä»¬å¯ä»¥å¿«é€Ÿä¸Šæ‰‹ï¼Œä¸ç”¨é€æ¡é…ç½®vueç›¸å…³çš„è§„åˆ™ã€‚
3.3.1 .eslintrc.json eslintä¾èµ–äºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¹‹å‰ç‰ˆæœ¬å«.eslintrcï¼Œæœ€è¿‘ç‰ˆæœ¬çš„eslintæ”¯æŒå¤šç§æ ¼å¼çš„é…ç½®ï¼Œå¯ä»¥æ˜¯json/yaml/jsç­‰ï¼Œå¯¹åº”çš„é…ç½®æ–‡ä»¶ä¹Ÿéœ€è¦æ·»åŠ å¯¹åº”çš„æ–‡ä»¶åç¼€ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯jsonæ ¼å¼ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
1{ 2 &amp;#34;parser&amp;#34;: &amp;#34;babel-eslint&amp;#34;, 3 &amp;#34;plugins&amp;#34;: [ 4 &amp;#34;html&amp;#34;, 5 &amp;#34;flowtype&amp;#34; 6 ], 7 &amp;#34;extends&amp;#34;: [ 8 &amp;#34;eslint:recommended&amp;#34;, 9 &amp;#34;plugin:flowtype/recommended&amp;#34;, 10 &amp;#34;vue&amp;#34; 11 ], 12 &amp;#34;rules&amp;#34;: { 13 &amp;#34;indent&amp;#34;: 0, 14 &amp;#34;semi&amp;#34;: 0, 15 &amp;#34;camelcase&amp;#34;: 0, 16 &amp;#34;no-console&amp;#34;: 0 17 } 18} pluginsä¸­æŒ‡å®šçš„æ˜¯eslintçš„æ’ä»¶ï¼šhtmlå¼•å…¥vueä¸­htmlå†…å®¹çš„lintï¼›flowtypeå¼•å…¥çš„æ˜¯Flowæ–¹é¢çš„lintï¼› extendsä¸­æŒ‡å®šçš„æ˜¯ESLintçš„Rulesé›†åˆã€‚é€šå¸¸æˆ‘ä»¬ä¼šåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€äº›å·²ç»æˆç†Ÿçš„Lintè§„åˆ™é›†åˆï¼Œå®ƒä»¬ç»è¿‡å®è·µè¯æ˜æ˜¯æœ‰æ•ˆçš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›è¿™ç§è§„åˆ™çš„é›†åˆï¼Œç„¶åé€šè¿‡åé¢çš„rulesé…ç½®å¾®è°ƒä¸€äº›ä¸åŒçš„åœ°æ–¹ã€‚è¿™æ ·å¯ä»¥å‡å°‘å¾ˆå¤šé…ç½®çš„å·¥ä½œé‡ã€‚ä¸Šé¢é…ç½®ä¸­æŒ‡å®šäº†ä¸‰ä¸ªé›†åˆã€‚ å„ä¸ªå…¬å¸æˆ–è€…å„ä¸ªé¡¹ç›®éƒ½ä¼šæœ‰ä¸€äº›ä¾‹å¤–ï¼ŒæŒ‡å®šäº†ä¸Šé¢çš„æ¨èè§„åˆ™é›†ä¹‹åå¯ä»¥é€šè¿‡rulesè¿›è¡Œå¾®è°ƒã€‚ 3.3.2 .eslintignore eslinté»˜è®¤ä¼šæ‰«æé¡¹ç›®ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œé€šè¿‡.eslintignoreå¯ä»¥å°†ä¸éœ€è¦æ£€æŸ¥çš„å†…å®¹å±è”½æ‰ã€‚ä¾‹å¦‚ï¼šnode_modulesä¸­çš„ç¬¬ä¸‰æ–¹åº“ï¼›distä¸‹é¢çš„Babelç¼–è¯‘åçš„æ–‡ä»¶ç­‰ã€‚
1# node_modules 2node_modules/* 3 4# flow-typed: flow typed libdefs 5flow-typed/* 6 7# vendor: vendor library 8**/vendor/*.js 9 10# dist: generated by babel compiliation 11dist/* 3.4 VSCode åœ¨VSCodeä¸­æˆ‘ä»¬éœ€è¦å®‰è£…ESLintè¿™ä¸ªæ’ä»¶ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œæœç´¢â€œESLintâ€ï¼Œå®‰è£…ESLintè¿™ä¸ªæ’ä»¶å°±å¯ä»¥äº†ã€‚
3.4.1 settings.json å®‰è£…ESLintä¹‹åè¿˜éœ€è¦è¿›è¡Œä¸€äº›è®¾ç½®ï¼Œå…³é—­VSCodeæœ¬èº«çš„Javascriptæ ¡éªŒæœºåˆ¶ï¼Œå¦å¤–è¿˜éœ€è¦é…ç½®ä¸€ä¸‹ï¼Œå¦åˆ™ä¼šå¯¹.vueæ–‡ä»¶æ— æ•ˆã€‚é…ç½®å¦‚ä¸‹ï¼ˆé€‰æ‹©é¦–é€‰é¡¹-è®¾ç½®å³å¯ï¼‰ï¼š
1... 2	&amp;#34;javascript.validate.enable&amp;#34;: false, 3 &amp;#34;eslint.validate&amp;#34;: [ 4 &amp;#34;javascript&amp;#34;, 5 &amp;#34;javascriptreact&amp;#34;, 6 &amp;#34;html&amp;#34;, 7 &amp;#34;vue&amp;#34; 8 ] 9 ... å®Œæˆä¸Šè¿°é…ç½®ä¹‹åï¼ŒVSCodeä¸­çš„ESLintå°±é…ç½®å®Œæ¯•äº†ã€‚é‡å¯ä¸€ä¸‹VSCodeï¼Œéšä¾¿æ‰“å¼€ä¸€ä¸ªjsæ–‡ä»¶æˆ–è€….vueæ–‡ä»¶ï¼Œåº”è¯¥å°±èƒ½å¤Ÿçœ‹åˆ°é…ç½®åçš„æ•ˆæœäº†ã€‚
3.5 Webpack é¦–å…ˆæ˜¯å®‰è£…Flowéœ€è¦çš„æ’ä»¶ã€‚Flowä»£ç ä¼šåœ¨Babelç¼–è¯‘çš„æ—¶å€™å®Œå…¨å»é™¤æ‰ï¼Œä»è€Œå˜æˆçº¯ç²¹çš„Javascriptä»£ç ã€‚
1npm install babel-plugin-transform-flow-strip-types --save-dev 2npm install babel-plugin-syntax-flow --save-dev 3npm install babel-plugin-transform-class-properties --save-dev 3.5.1 .babelrc ç„¶ååœ¨.babelrcä¸­å¼•å…¥è¿™å‡ ä¸ªæ’ä»¶å³å¯ï¼š
1 &amp;#34;plugins&amp;#34;: [ 2 ... 3 &amp;#34;babel-plugin-transform-class-properties&amp;#34;, 4 &amp;#34;babel-plugin-syntax-flow&amp;#34;, 5 &amp;#34;babel-plugin-transform-flow-strip-types&amp;#34; 6 ... 7 ] 4. ä¸€äº›å¤±è´¥çš„æ–¹æ¡ˆ 4.1 vscode-flow-ide &amp;amp; flow-language-support è¿™ä¸¤ä¸ªæ˜¯VSCodeçš„æ’ä»¶ï¼Œçœ‹ä»‹ç»èƒ½å¤Ÿç›´æ¥å¯¹JSæ–‡ä»¶è¿›è¡ŒFlowæ–¹é¢çš„Lintå·¥ä½œï¼Œèƒ½å¤Ÿå‘ç°Flowæ–¹é¢çš„é—®é¢˜ã€‚ä½†æ˜¯ä½¿ç”¨ä¸­å‘ç°æ— æ³•å¯¹.vueæ–‡ä»¶è¿›è¡Œè¿™ç§å·¥ä½œï¼Œæ‰€ä»¥æœ€åæ”¾å¼ƒæ‰äº†ã€‚
4.2 eslint-plugin-flowtype-errors è¿™ä¸ªæ’ä»¶ä¹Ÿæ˜¯ä¸eslinté…åˆçš„ã€‚é…ç½®æ¯”eslint-plugin-flowtypeç®€å•ã€‚ä½†æ˜¯å®ƒæ²¡æœ‰åŠæ³•è‡ªå®šä¹‰Rulesã€‚å…¶ä¸­æœ‰ä¸ªè§„åˆ™ç”¨äºæ£€æµ‹requireæ¨¡å—æ˜¯å¦å­˜åœ¨çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸ä¼šå¯¹ç¬¬ä¸‰æ–¹åº“è¿›è¡ŒFlowæ‰«æï¼Œæ‰€æœ‰Flowæ— æ³•çŸ¥é“ç¬¬ä¸‰æ–¹åº“ï¼ˆä¾‹å¦‚element-uiï¼‰æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µã€‚è¿™æ—¶å°±ä¼šæŠ¥å‡ºRequired module not foundè¿™ä¸ªæç¤ºï¼Œç½‘ä¸Šç›®å‰ä¹Ÿæ²¡æœ‰å¥½çš„è§£å†³åŠæ³•ã€‚éœ€è¦æ‰‹å†™libdefæ–‡ä»¶æˆ–è€…ä½¿ç”¨flow-typedå·¥å…·ç”Ÿæˆlibdefæ–‡ä»¶æ¥è§£å†³ã€‚æœ€åå‘ç°ä½¿ç”¨èµ·æ¥åå€’éº»çƒ¦äº†ã€‚æ‰€ä»¥æœ€åæ”¾å¼ƒæ‰ï¼Œåˆ‡æ¢åˆ°eslint-plugin-flowtypeã€‚
é™„å½• å¼ºç±»å‹ JavaScript çš„è§£å†³æ–¹æ¡ˆ Vue 2.0 ä¸ºä»€ä¹ˆé€‰ç”¨ Flow è¿›è¡Œé™æ€ä»£ç æ£€æŸ¥è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ TypeScriptï¼Ÿ </content>
    </entry>
    
     <entry>
        <title>Node.js ä½¿ç”¨Rediså‘å¸ƒè®¢é˜…æ¨¡å¼</title>
        <url>https://orchidflower.github.io/2017/03/30/Nodejs-using-redis-publish-subscribe/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Node.js</tag><tag>Redis</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ æœ€è¿‘åœ¨ç”¨Node.jsåšä¸€ä¸ªç®¡ç†ç³»ç»Ÿçš„æ—¶å€™ç¢°åˆ°äº†ä¸€ä¸ªåœºæ™¯ï¼šä¸ºäº†è®¿é—®æ€§èƒ½ï¼Œç³»ç»Ÿåœ¨å†…å­˜ä¸­ï¼ˆä¸æ˜¯Redisï¼‰ç¼“å­˜äº†ä¸€äº›å¸¸ç”¨æ•°æ®ï¼Œä¾‹å¦‚ç³»ç»Ÿèœå•æ ‘ä¹‹ç±»çš„ã€‚ä½†æ˜¯ä»€ä¹ˆæ—¶å€™åˆ·æ–°è¿™äº›ç¼“å­˜å°±æˆäº†é—®é¢˜ã€‚å½“ç„¶åœ¨å•æœåŠ¡å™¨æ¨¡å¼ä¸‹ä¹Ÿä¸æ˜¯å¤§é—®é¢˜ï¼Œåªè¦åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™åˆ é™¤å†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®å³å¯ã€‚ä½†æ˜¯è¿™ä¸€æ–¹æ³•åœ¨åˆ†å¸ƒå¼æœåŠ¡ä¸­å°±æ— æ•ˆäº†ï¼šåŒæ—¶ä¼šæœ‰å¤šä¸ªè¿™ç§ç³»ç»Ÿåœ¨è·‘ï¼Œä½†æ˜¯åªæœ‰ä¸€å°æœåŠ¡å™¨æ¥åˆ°äº†å¤„ç†è¯·æ±‚ï¼Œå…¶ä»–æœåŠ¡å™¨æ ¹æœ¬æ²¡æœ‰åŠæ³•åˆ·æ–°å†…å­˜ä¸­çš„æ•°æ®ã€‚ å½“ç„¶æœ‰äººä¼šè¯´å°†ç¼“å­˜æ”¾åˆ°Redisä¸­ä¸å°±è§£å†³é—®é¢˜äº†ï¼Ÿä½†æ˜¯å¦‚æœæ•°æ®é‡ç¨å¤§ä¸€äº›ï¼Œè€Œä¸”è®¿é—®é¢‘ç¹ã€æ›´æ–°å´ä¸é¢‘ç¹ï¼Œæ”¾åˆ°Redisä¸­æ¯æ¬¡è®¿é—®éƒ½ä¼šå¯¹Rediså¸¦æ¥ä¸å°çš„å‹åŠ›ï¼Œæ˜¾å¾—å¾ˆæ²¡æœ‰å¿…è¦ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªç„¶å°±å¯ä»¥ä½¿ç”¨Redisçš„å‘å¸ƒè®¢é˜…æœºåˆ¶æ¥è§£å†³é—®é¢˜äº†ï¼šå½“æ•°æ®æ›´æ–°ä¹‹åï¼Œåªè¦å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯åˆ°Redisï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ‰§è¡Œåˆ·æ–°ç¼“å­˜çš„æ“ä½œäº†ã€‚
2. Rediså‘å¸ƒè®¢é˜…æœºåˆ¶ä»‹ç» Redis å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ã€‚æœ‰ä¸¤ç±»å‚ä¸è€…ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚å‘å¸ƒè€…å’Œè®¢é˜…è€…é€šè¿‡é¢‘é“ï¼ˆChannelï¼‰è¿›è¡Œæ²Ÿé€šã€‚å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°æŒ‡å®šé¢‘é“ä¸Šï¼Œè®¢é˜…è€…è®¢é˜…ç‰¹å®šçš„é¢‘é“ï¼Œè·å–å‘å¸ƒè€…å‘å¸ƒçš„æ¶ˆæ¯ã€‚
ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ channel1 ï¼Œä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ â€”â€” client2 ã€ client5 å’Œ client1 ä¹‹é—´çš„å…³ç³»ï¼š å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ PUBLISH å‘½ä»¤å‘é€ç»™é¢‘é“ channel1 æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š 3. ä»£ç ç¤ºä¾‹ ä½¿ç”¨Node.jsè°ƒç”¨Redisçš„å‘å¸ƒè®¢é˜…æœºåˆ¶éå¸¸ç®€å•ã€‚æˆ‘ç”¨çš„Rediså®¢æˆ·ç«¯æ˜¯ï¼šnode_redisã€‚
åŸºæœ¬ä¸ŠæŠŠæ‰€æœ‰åŠŸèƒ½éƒ½å°è£…åˆ°äº†cache-serviceä¸­ã€‚å‘å¸ƒè€…ã€è®¢é˜…è€…çš„ä»£ç åŸºæœ¬ä¸Šä¸Redisæ— å…³äº†ï¼Œç†è®ºä¸Šå¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–åŒç±»çš„æœåŠ¡ä¸Šå»ã€‚ æ³¨ï¼šä»£ç ä½¿ç”¨ES2017çš„ç‰¹æ€§ï¼ˆawait/asyncï¼‰ã€‚
3.1 cache-services.js 1// è®¢é˜…æ¥å£ 2// channel éœ€è¦è®¢é˜…çš„channel 3// callback å¤„ç†è®¢é˜…çš„æ¶ˆæ¯çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä¸ºasync function 4exports.subscribe = async function(channel, callback) { 5 // è¯»å–redisé…ç½®ä¿¡æ¯ 6 var redisConfig = config.get(&amp;#34;redis&amp;#34;); 7 var options = { 8 host: redisConfig.host, 9 port: redisConfig.port, 10 user: redisConfig.user, 11 password: redisConfig.password, 12 db: redisConfig.database 13 }; 14 // åˆ›å»ºredis client 15 var subClient = redis.createClient(options); 16 // æ·»åŠ è®¢é˜…ç›‘å¬å¤„ç†å‡½æ•° 17 subClient.on(&amp;#34;message&amp;#34;, async function(channel, message) { 18 logger.info(format.vsprintf(&amp;#34;Received subscribe message, channel [%s] message [%s]&amp;#34;, [channel, message])); 19 // è°ƒç”¨å›è°ƒå‡½æ•° 20 await callback(channel, message); 21 }); 22 // å¼€å§‹è®¢é˜… 23 subClient.subscribe(&amp;#34;channel_update_permissions&amp;#34;); 24 // è®¢é˜…æˆåŠŸ 25 subClient.on(&amp;#34;ready&amp;#34;, function() { 26 logger.info(format.vsprintf(&amp;#39;Redis [%s:%s/%s] is connected and ready for subscribe channel [%s] use.&amp;#39;, [redisConfig.host, redisConfig.port, redisConfig.database, channel])); 27 }); 28 // é”™è¯¯å¤„ç† 29 redisClient.on(&amp;#34;error&amp;#34;, function (err) { 30 logger.error(&amp;#34;Subscribe channel [&amp;#34;&#43;channel&#43;&amp;#34;] encountered error. Error:&amp;#34; &#43; err); 31 }); 32 // å°†clientåŠ åˆ°å…¨å±€mapä¸­ï¼Œä»¥å¤‡åç”¨ 33 subscribeClients.set(channel, subClient); 34}; 35 36// è°ƒç”¨publishåŠŸèƒ½ã€‚ä½¿ç”¨æ™®é€šredis clientå³å¯ 37exports.publish = async function(channel, message) { 38 await redisClient.publish(channel, message); 39}; è¯´æ˜ï¼šæŒ‰ç…§node_rediså®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œè°ƒç”¨äº†subscribeçš„å®¢æˆ·ç«¯å°†è¿›å…¥è®¢é˜…æ¨¡å¼ï¼Œæ— æ³•æ‰§è¡Œå…¶ä»–æ“ä½œã€‚å› æ­¤è¿™é‡Œæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„redisè¿æ¥ï¼Œå¹¶ä¸”è®¾ç½®äº†ä¸€ä¸ªå†…éƒ¨è¡¨ï¼Œç”¨äºä¿å­˜è¿™äº›åˆ›å»ºçš„é“¾æ¥ã€‚
When a client issues a SUBSCRIBE or PSUBSCRIBE, that connection is put into a &amp;ldquo;subscriber&amp;rdquo; mode. At that point, only commands that modify the subscription set are valid and quit (and depending on the redis version ping as well). When the subscription set is empty, the connection is put back into regular mode.
3.2 è°ƒç”¨è®¢é˜…åŠŸèƒ½ï¼Œç›‘å¬äº‹ä»¶ã€‚åœ¨å¿…è¦çš„æ—¶å€™è‡ªåŠ¨åŠ è½½æƒé™è¡¨ 1// åŠ è½½æƒé™è¡¨ 2async function initPermssionTable() { 3} 4 5// ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨åŠ è½½æƒé™è¡¨ 6(async function() { 7 permissionTable = await initPermssionTable(); 8 logger.info(&amp;#34;Permission table initialized.&amp;#34;); 9 cacheServices.subscribe(&amp;#34;channel_update_permissions&amp;#34;, async function(channel, message) { 10 logger.info(&amp;#34;Try to reload permission table....&amp;#34;); 11 permissionTable = await initPermssionTable(); 12 logger.info(&amp;#34;Permission table reloaded successfully!&amp;#34;); 13 }); 14})(); 3.3 å‘å¸ƒé€šçŸ¥ 1 ... 2 // æ›´æ–°å…¨å±€æƒé™è¡¨ï¼Œé€šè¿‡redis.publishå®ç° 3 await cacheServices.publish(&amp;#34;channel_update_permissions&amp;#34;, &amp;#34;anything&amp;#34;); 4 ... é™„å½•A. å‚è€ƒèµ„æ–™ Node.js Redis on Github Redis å‘å¸ƒè®¢é˜… Redis Pub/Sub: Howto Guide </content>
    </entry>
    
     <entry>
        <title>Docker for Macç£ç›˜æ€§èƒ½ä½ä¸‹çš„è§£å†³åŠæ³•</title>
        <url>https://orchidflower.github.io/2017/03/29/Performance-regression-on-Docker-for-Mac/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Docker</tag><tag>Mac</tag>
        </tags>
        <content type="html"> æœ€è¿‘å¤‡ä»½æ¢å¤Gogsçš„æ—¶å€™ï¼Œå‘ç°åŒæ ·çš„é…ç½®å‚æ•°åœ¨Macä¸Šè®¿é—®Gogsçš„ç”¨æˆ·é¦–é¡µç‰¹åˆ«æ…¢ï¼Œå¤§æ¦‚è€—æ—¶8ç§’ï¼Œè€Œåœ¨Linuxä¸Šé¢è¿è¡Œçš„æ—¶å€™ä¸åˆ°1ç§’é’Ÿã€‚åæ¥å°±ä¸Šç½‘æœç´¢ï¼ŒåŠ ä¸Šè‡ªå·±è¯•éªŒï¼Œæœ€åæ‰¾åˆ°äº†åŸå› åº”è¯¥æ˜¯Gogsé•œåƒæœ¬èº«çš„é—®é¢˜ï¼ˆå¯èƒ½æ˜¯é‡‡ç”¨äº†alpineè¿™ä¸€å†…æ ¸ï¼Œä½†æ˜¯å…·ä½“åŸå› ä¸è¯¦ï¼Œæœ‰å¾…è¿›ä¸€æ­¥å®éªŒï¼‰ã€‚
è¿™ä¸ªè¿‡ç¨‹ä¸­æ›¾ç»æ€€ç–‘æ˜¯Dockerè¿è¡ŒMySQLè¿‡æ…¢çš„åŸå› ï¼Œè™½ç„¶æœ€ç»ˆå‘ç°ä¸æ˜¯ï¼Œä½†æ˜¯æœç´¢è¿‡ç¨‹ä¸­å‘ç°äº†Docker for Macç¡®å®æœ‰æ€§èƒ½é—®é¢˜ï¼Œé‚£å°±æ˜¯å¯¹å¤§é‡ç£ç›˜IOçš„æ“ä½œæ€§èƒ½ä¼šéå¸¸å·®ï¼Œå¤§æ¦‚ä¼šå·®10å€ã€‚
å…·ä½“è®¨è®ºå¯ä»¥çœ‹é™„å½•çš„å¸–å­ï¼Œè¿™é‡Œå¤§æ¦‚æ‘˜å½•ä¸€ä¸‹ï¼š
It seems the VM calls the virtio-blk implementation of flush in hyperkit approximately 25000 times. Each of these is implemented currently by an fsync(F_FULLFSYNC) to avoid writes being partially written or re-ordered over a power loss (as recommended by the Apple docs). Unfortunately each fsync(F_FULLFSYNC) seems to take about 10ms which accounts for the slowdown.
I agree that there are important use-cases where data persistence is less important than throughput, especially on developer setups or CI builds where containers are ephemeral. I&amp;rsquo;ll investigate the possibility of a configuration option.
è§£å†³åŠæ³• å¸–å­é‡Œé¢ä¹Ÿç»™å‡ºäº†è§£å†³åŠæ³•ï¼Œå°±æ˜¯é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚ä»¥ä¸‹æ–¹æ³•é€‚åº”äº17.03.0-CEã€‚
1$ cd ~/Library/Containers/com.docker.docker/Data/database/ 2git reset --hard 3HEAD is now at 5e56922 last-start-time changed at 1487162086 4$ echo os &amp;gt; com.docker.driver.amd64-linux/disk/on-flush 5$ git add com.docker.driver.amd64-linux/disk/on-flush 6$ git commit -s -m &amp;#39;Use fsync&amp;#39; 7[master d0b523f] Use fsync 8 1 file changed, 1 insertion(&#43;), 1 deletion(-) é™„å½•A. å‚è€ƒèµ„æ–™ Severe Docker 1.12.1 performance regression with DB2 images (~10x slower) #668 </content>
    </entry>
    
     <entry>
        <title>Electronå¼€å‘ä½¿ç”¨Vue Devtools</title>
        <url>https://orchidflower.github.io/2017/03/29/Using-Vue-Devtools-in-Electron/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Electron</tag><tag>Vue.js</tag>
        </tags>
        <content type="html"> æœ€è¿‘åœ¨ç”¨Electron &#43; Vue.js 2.0å†™ä¸€ä¸ªæ¡Œé¢å·¥å…·ã€‚ä½¿ç”¨ä¸‹æ¥æ„Ÿè§‰Electronç”¨èµ·æ¥è¿˜æ˜¯æŒºçˆ½çš„ã€‚ä¹‹å‰ä¸ºäº†å¼€å‘è·¨å¹³å°çš„æ¡Œé¢åº”ç”¨ï¼Œæˆ‘æ›¾ç»ç”¨è¿‡Python&#43;wxPythonï¼ŒSwingï¼ŒSWTç­‰å„ç§æŠ€æœ¯ï¼Œä½†æ˜¯éƒ½æœ‰è¿™æ ·é‚£æ ·çš„é—®é¢˜ï¼ˆä¾‹å¦‚æ‰“åŒ…æ¯”è¾ƒéº»çƒ¦ã€ç•Œé¢å„å¹³å°ä¸å¤ªä¸€è‡´ç­‰ï¼‰ã€‚è€ŒElectronåŸºäºç›®å‰æˆç†Ÿçš„å‰ç«¯æŠ€æœ¯ï¼Œé€šè¿‡å†…åµŒçš„æµè§ˆå™¨å†…æ ¸å®ç°äº†ç»Ÿä¸€çš„è¡¨ç°å½¢å¼ï¼Œè¿™ä¸€ç‚¹ç”¨äºåšè·¨å¹³å°å¼€å‘çœŸæ˜¯å¤ªæ–¹ä¾¿äº†ã€‚
1. Electronä»‹ç» ElectronæŠ€æœ¯å‡ºç°å·²ç»æœ‰å‡ å¹´äº†ã€‚è¿™é‡Œåªæ˜¯ç®€å•è®°å½•ä¸€ä¸‹ï¼š
ç®€è€Œè¨€ä¹‹ï¼ŒElectron æä¾›äº†ä¸€ä¸ªå®æ—¶æ„å»ºæ¡Œé¢åº”ç”¨çš„çº¯ JavaScript ç¯å¢ƒã€‚Electron å¯ä»¥è·å–åˆ°ä½ å®šä¹‰åœ¨ package.json ä¸­ main æ–‡ä»¶å†…å®¹ï¼Œç„¶åæ‰§è¡Œå®ƒã€‚é€šè¿‡è¿™ä¸ªæ–‡ä»¶ï¼ˆé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸º main.jsï¼‰ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåº”ç”¨çª—å£ï¼Œè¿™ä¸ªåº”ç”¨çª—å£åŒ…å«ä¸€ä¸ªæ¸²æŸ“å¥½çš„ web ç•Œé¢ï¼Œè¿˜å¯ä»¥å’Œç³»ç»ŸåŸç”Ÿçš„ GUI äº¤äº’ã€‚
å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å½“ä½ å¯åŠ¨äº†ä¸€ä¸ª Electron åº”ç”¨ï¼Œå°±æœ‰ä¸€ä¸ªä¸»è¿›ç¨‹ï¼ˆmain process ï¼‰è¢«åˆ›å»ºäº†ã€‚è¿™æ¡è¿›ç¨‹å°†è´Ÿè´£åˆ›å»ºå‡ºåº”ç”¨çš„ GUIï¼ˆä¹Ÿå°±æ˜¯åº”ç”¨çš„çª—å£ï¼‰ï¼Œå¹¶å¤„ç†ç”¨æˆ·ä¸è¿™ä¸ª GUI ä¹‹é—´çš„äº¤äº’ã€‚
ä½†ç›´æ¥å¯åŠ¨ main.js æ˜¯æ— æ³•æ˜¾ç¤ºåº”ç”¨çª—å£çš„ï¼Œåœ¨ main.js ä¸­é€šè¿‡è°ƒç”¨BrowserWindowæ¨¡å—æ‰èƒ½å°†ä½¿ç”¨åº”ç”¨çª—å£ã€‚ç„¶åæ¯ä¸ªæµè§ˆå™¨çª—å£å°†æ‰§è¡Œå®ƒä»¬å„è‡ªçš„æ¸²æŸ“å™¨è¿›ç¨‹ï¼ˆ renderer process ï¼‰ã€‚æ¸²æŸ“å™¨è¿›ç¨‹å°†ä¼šå¤„ç†ä¸€ä¸ªçœŸæ­£çš„ web é¡µé¢ï¼ˆHTML &#43; CSS &#43; JavaScriptï¼‰ï¼Œå°†é¡µé¢æ¸²æŸ“åˆ°çª—å£ä¸­ã€‚é‰´äº Electron ä½¿ç”¨çš„æ˜¯åŸºäº Chrominum çš„æµè§ˆå™¨å†…æ ¸ï¼Œä½ å°±ä¸å¤ªéœ€è¦è€ƒè™‘å…¼å®¹çš„é—®é¢˜ã€‚
kmokidd ä½¿ç”¨ Electron æ„å»ºæ¡Œé¢åº”ç”¨
2. å®‰è£…Vue Devtools ä»Šå¤©ä¸»è¦è®²ä¸€ä¸‹æ€ä¹ˆåœ¨Electronä¸­å®‰è£…Vue devtoolsï¼Œä»¥æ–¹ä¾¿å¼€å‘ã€‚æ–¹æ³•å‚è€ƒElectronå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œåªåšè®°å½•å’Œç¿»è¯‘ã€‚
2.1 ç‰¹åˆ«è¯´æ˜ å› ä¸ºElectronæ˜¯åŸºäºChromiumå†…æ ¸çš„ï¼Œå’ŒChromeåŒæ ¹åŒæºã€‚å› æ­¤è¿™é‡Œçš„æ–¹æ³•æ˜¯åœ¨Chromeå®‰è£…Dev Vuetoolsï¼Œç„¶åæ·»åŠ åˆ°Electronä¸­çš„æ–¹æ³•ã€‚
2.2 å®‰è£…æ­¥éª¤ é¦–å…ˆåœ¨Chromeä¸­å®‰è£…Vue Devtoolsï¼› åœ¨Chromeä¸­æ‰“å¼€about:extensionsï¼Œå¹¶ä¸”å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥è·å–æ‰©å±•ç¨‹åºçš„IDï¼Œè®°ä½è¿™ä¸ªIDï¼Œä¾‹å¦‚æˆ‘è¿™è¾¹çš„å€¼æ˜¯nhdogjmejiglipccpnnnanhbledajbpdï¼Œä¸‹é¢éœ€è¦ç”¨åˆ°ã€‚ æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨æˆ–è€…Finderï¼Œå¯¼èˆªåˆ°Chromeä¿å­˜æ‰©å±•ç¨‹åºçš„æ–‡ä»¶å¤¹ï¼š åœ¨Windowsä¸Šï¼š%LOCALAPPDATA%\Google\Chrome\User Data\Default\Extensions åœ¨Linuxå¯èƒ½æ˜¯ï¼ˆçœ‹ä¸åŒçš„ç‰ˆæœ¬ï¼‰ï¼š ~/.config/google-chrome/Default/Extensions/ ~/.config/google-chrome-beta/Default/Extensions/ ~/.config/google-chrome-canary/Default/Extensions/ ~/.config/chromium/Default/Extensions/ åœ¨Macä¸Šæ˜¯ï¼š~/Library/Application Support/Google/Chrome/Default/Extensions åœ¨ä¸Šé¢çš„æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°åˆšæ‰è·å–çš„IDå¯¹åº”çš„é‚£ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ï¼Œè®°å½•ä¸‹æ–‡ä»¶å¤¹ä¸­å­˜åœ¨çš„æ–‡ä»¶å¤¹åå­—ï¼Œä¸€èˆ¬æ˜¯ç‰ˆæœ¬å·ã€‚è¿™æ ·å°±è·å–äº†æœ€ç»ˆéœ€è¦ä½¿ç”¨çš„æ–‡ä»¶å¤¹åœ°å€ã€‚ä¾‹å¦‚æˆ‘è¿™è¾¹è¿™ä¸ªåœ°å€æ˜¯ï¼š~/Library/Application Support/Google/Chrome/Default/Extensions/nhdogjmejiglipccpnnnanhbledajbpd/3.1.2_0ã€‚ åœ¨Electronåº”ç”¨ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 1app.on(&amp;#39;ready&amp;#39;, createWindow) 2 3function createWindow() { 4 ... 5 // Open the DevTools. 6 if (process.env.NODE_ENV === &amp;#39;development&amp;#39;) { 7 BrowserWindow.addDevToolsExtension(&amp;#34;/Users/zhang/Library/Application Support/Google/Chrome/Default/Extensions/nhdogjmejiglipccpnnnanhbledajbpd/3.1.2_0&amp;#34;); 8 } 9 ... 10} 2.3 é™åˆ¶ BrowserWindow.addDevToolsExtensionéœ€è¦åœ¨readyäº‹ä»¶ä¹‹åè°ƒç”¨ï¼Œæˆ‘ä¸Šé¢çš„ä»£ç å°±æ˜¯åœ¨appçš„readyäº‹ä»¶ä¸­è°ƒç”¨çš„ï¼› Electronç‰ˆæœ¬ä¸èƒ½ä½äº1.2.1ï¼Œå› ä¸ºå¯¹Extension toolsçš„æ”¯æŒAPIæ˜¯è¿™ä¸ªç‰ˆæœ¬æ·»åŠ çš„ã€‚ é™„å½•A. å‚è€ƒèµ„æ–™ Using DevTools Extension in Electron Vue-devtools for Electron apps </content>
    </entry>
    
     <entry>
        <title>åœ¨Ubuntu 14.04ä¸Šå®‰è£…Docker 17.03.0-ce</title>
        <url>https://orchidflower.github.io/2017/03/28/install-docker-17-03-0-ce-on-ubuntu-14-04/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Docker</tag>
        </tags>
        <content type="html"> 0. æ¦‚è¿° Dockeråœ¨1.13.xç‰ˆæœ¬ä¹‹åæ›´æ–°äº†ç‰ˆæœ¬å·è§„åˆ™ï¼ŒåŒºåˆ†äº†ç¤¾åŒºç‰ˆå’Œä¼ä¸šç‰ˆã€‚è¿™å¯¼è‡´äº†å®‰è£…æ–¹å¼æœ‰æ‰€å˜åŒ–ã€‚æ‰€ä»¥ç‰¹æ„å‚è€ƒå®˜æ–¹çš„å¸®åŠ©é‡æ–°æ•´ç†äº†ä¸€ä¸‹å®‰è£…æ­¥éª¤ã€‚
é€‚åº”èŒƒå›´ï¼šUbuntu 14.04ã€‚å®‰è£…ç‰ˆæœ¬ï¼š17.03.0-ceï¼ˆç¤¾åŒºç‰ˆï¼‰ã€‚
1. ä¾èµ–å®‰è£… 1.1 curlç­‰ä¾èµ– 1sudo apt-get -y install \ 2 apt-transport-https \ 3 ca-certificates \ 4 curl 1.2 add-apt-repository å®˜æ–¹çš„æ–‡æ¡£ä¸­é—æ¼äº†å¯¹è¿™ä¸ªçš„å®‰è£…ï¼Œæ‰€ä»¥ç›´æ¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å®‰è£…ä¼šåœ¨ç”¨åˆ°è¿™ä¸ªå·¥å…·çš„æ—¶å€™æŠ¥é”™ã€‚æˆ‘ä»¬é¦–å…ˆè¦å®‰è£…å®ƒã€‚å®ƒçš„ä½œç”¨æ˜¯ç»´æŠ¤aptçš„source.listæ–‡ä»¶ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªæºã€‚
1sudo apt-get install software-properties-common python-software-properties 2. å¼€å§‹å®‰è£… 2.1 å®‰è£…gpg-key 1curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - 2.2 æ·»åŠ aptæº 1sudo add-apt-repository \ 2 &amp;#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \ 3 $(lsb_release -cs) \ 4 stable&amp;#34; 2.3 å®‰è£…Docker ce 1sudo apt-get update 2sudo apt-get -y install docker-ce 3. éªŒè¯ 1sudo docker run hello-world é™„å½•A. å‚è€ƒèµ„æ–™ Docker Community Edition for Ubuntu installation Ubuntu Missing add-apt-repository command </content>
    </entry>
    
     <entry>
        <title>Node.jsä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆä¸€ï¼‰-åŸºç¡€çŸ¥è¯†</title>
        <url>https://orchidflower.github.io/2017/02/27/nodejs-learning-note-01/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Node.js</tag><tag>å‰ç«¯</tag>
        </tags>
        <content type="html"> æœ€è¿‘ä¸€å‘¨æ¯”è¾ƒå¿™ï¼Œä¸€ç›´å¿™ç€æ­å»ºå¼€å‘å¹³å°ã€‚ä¹‹å‰ä¸å°±åˆšç”¨Golangæ­å»ºäº†ä¸€ä¸ªæœåŠ¡ç«¯å¼€å‘å¹³å°ã€‚å®Œæˆä¹‹åï¼Œå°±éœ€è¦é’ˆå¯¹Golangå¼€å‘çš„æœåŠ¡å¼€å‘ä¸€ä¸ªç®¡ç†å¹³å°ï¼Œç”¨Golangä¹Ÿèƒ½åšï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯éº»çƒ¦ï¼Œæœ€åå†³å®šä½¿ç”¨Node.jsã€‚
è¿™æ¬¡æ­å»ºçš„å¹³å°å€¾å‘äºä½¿ç”¨æ¯”è¾ƒæ–°çš„ä¸€äº›Node.jsç‰¹æ€§ï¼Œä¾‹å¦‚ES6ã€async/awaitè§£å†³å›è°ƒåœ°ç‹±ç­‰ã€‚ä¹‹å‰ç”¨è¿‡Node.jsï¼Œä½†æ˜¯å±äºæµ…å°è¾„æ­¢ï¼Œè¿™æ¬¡å‡†å¤‡å……åˆ†äº†è§£ä¸€ä¸‹ã€‚å› æ­¤æœ‰äº†è¿™äº›å­¦ä¹ ç¬”è®°ã€‚
æ¦‚è¿° Node.jsè¿™å‡ å¹´å¯ä»¥è¯´æ˜¯å¦‚æ—¥ä¸­å¤©ï¼Œä½¿ç”¨Javascriptè¿™ç§ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å‰ç«¯å¼€å‘è¯­è¨€è¿›è¡Œåç«¯å¼€å‘ï¼Œå¼€å‘æ•ˆç‡æˆå€æå‡ï¼šçœå»äº†ç¼–è¯‘ã€å‘å¸ƒçš„è¿‡ç¨‹ï¼Œå¼€å‘ä¸­æœåŠ¡å™¨é‡å¯å†ä¹Ÿä¸åƒJavaé‚£ä¹ˆç¬¨é‡è€—æ—¶ï¼Œä¿®æ”¹ä¹‹åç§’èµ·çš„æ„Ÿè§‰çˆ½å¾—ä¸è¦ä¸è¦çš„ã€‚
Node.jsçš„è¿è¡Œæ•ˆç‡ä¹Ÿè¿˜ä¸é”™ï¼Œè™½ç„¶ä¸èƒ½å’ŒJavaã€Golangä¹‹ç±»çš„æ¯”è¾ƒï¼Œä½†æ˜¯å¯¹ä»˜è´Ÿè½½ã€å¹¶å‘é‡ä¸å¤§çš„ç®¡ç†ç³»ç»Ÿè¿˜æ˜¯ç»°ç»°æœ‰ä½™ã€‚å› æ­¤ä¸ªäººæ„Ÿè§‰åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ä½¿ç”¨Node.jsæ­£æ˜¯ä¸Šä½³ä¹‹é€‰ã€‚
æœ¬ç¯‡ä¸»è¦æ˜¯Javascriptçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚æ¥æºè‡ªç½‘ä¸Šä¸åŒçš„åœ°æ–¹ï¼Œä¹Ÿæœ‰è‡ªå·±å†™çš„ä¸€äº›å¿ƒå¾—ã€‚
åè¯è§£é‡Š ä½¿ç”¨Node.jsçš„æ—¶å€™ä¼šç¢°åˆ°å¾ˆå¤šæ–°åè¯ï¼Œè¿™é‡Œæ•´ç†äº†ä»¥ä¸‹ç»å¸¸è§åˆ°çš„ä¸œè¥¿ã€‚å¯¹æ¦‚å¿µæœ‰ä¸ªæ˜ç¡®çš„äº†è§£æœ‰åŠ©äºä¹‹åçš„å­¦ä¹ ã€‚
ECMA Ecmaå›½é™…ï¼ˆEcma Internationalï¼‰æ˜¯ä¸€å®¶å›½é™…æ€§ä¼šå‘˜åˆ¶åº¦çš„ä¿¡æ¯å’Œç”µä¿¡æ ‡å‡†ç»„ç»‡ã€‚1994å¹´ä¹‹å‰ï¼Œåä¸ºæ¬§æ´²è®¡ç®—æœºåˆ¶é€ å•†åä¼šï¼ˆEuropean Computer Manufacturers Associationï¼‰ã€‚å› ä¸ºè®¡ç®—æœºçš„å›½é™…åŒ–ï¼Œç»„ç»‡çš„æ ‡å‡†ç‰µæ¶‰åˆ°å¾ˆå¤šå…¶ä»–å›½å®¶ï¼Œå› æ­¤ç»„ç»‡å†³å®šæ”¹åè¡¨æ˜å…¶å›½é™…æ€§ã€‚ç°åç§°å·²ä¸å±äºé¦–å­—æ¯ç¼©ç•¥å­—ã€‚
ECMAScript å°±æ˜¯Javascriptçš„å›½é™…æ ‡å‡†ã€‚Javascriptå‘å¸ƒä»¥æ¥å‡ºç°äº†å¾ˆå¤šå˜ç§ï¼Œä¾‹å¦‚Netscapeçš„Javascriptã€Microsoftçš„JScriptç­‰ç­‰ã€‚åæ¥é€šè¿‡ECMAç»„ç»‡é‡æ–°è¿›è¡Œäº†æ ‡å‡†åŒ–ï¼Œå½¢æˆäº†ECMAScriptã€‚
æ‰€ä»¥è¯´ECMAScriptå°±æ˜¯JavaScriptè¯­è¨€çš„æ­£å¼åç§°ã€‚è‡ªä»Sunå…¬å¸å®£å¸ƒæ‹¥æœ‰JavaScriptè¿™ä¸ªåå­—ä¹‹åï¼Œå•†æ ‡ä¸Šå‡ºç°å†²çªï¼Œæ‰€ä»¥å¯¹JavaScriptæ‹¥æœ‰è®¤è¯æƒåˆ©çš„ECMAå§”å‘˜ä¼šå¼ºåˆ¶æ”¹æˆè¿™ä¸ªåå­—ã€‚
å†æ¬¡ç‰ˆæœ¬ ECMAScript 1 1997å¹´6æœˆï¼Œé¦–ç‰ˆï¼› ECMAScript 2 1998å¹´6æœˆï¼Œæ ¼å¼ä¿®æ­£ï¼Œä»¥ä½¿å¾—å…¶å½¢å¼ä¸ISO/IEC16262å›½é™…æ ‡å‡†ä¸€è‡´ï¼› ECMAScript 3 1999å¹´12æœˆ å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›´å¥½çš„æ–‡å­—é“¾å¤„ç†ï¼Œæ–°çš„æ§åˆ¶æŒ‡ä»¤ï¼Œå¼‚å¸¸å¤„ç†ï¼Œé”™è¯¯å®šä¹‰æ›´åŠ æ˜ç¡®ï¼Œæ•°è¾“å‡ºçš„æ ¼å¼åŒ–åŠå…¶å®ƒæ”¹å˜ï¼› ECMAScript 4 æœªå®Œæˆ&amp;hellip;å¯èƒ½æ›´æ˜ç¡®çš„ç±»çš„å®šä¹‰ï¼Œå‘½åç©ºé—´ç­‰ç­‰&amp;hellip; ECMAScript 5 2009å¹´12æœˆå‘å¸ƒã€‚2004å¹´6æœˆæ¬§æ´²è®¡ç®—æœºåˆ¶é€ å•†åä¼šå‘è¡¨äº†ECMA-357æ ‡å‡†ï¼Œå®ƒæ˜¯ECMAScriptçš„ä¸€ä¸ªæ‰©å»¶ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºE4Xï¼ˆECMAScript for XMLï¼‰ã€‚ ECMAScript 2015 2015å¹´6æœˆ17æ—¥å‘å¸ƒã€‚æˆªæ­¢å‘å¸ƒæ—¥æœŸï¼ŒJavaScriptçš„å®˜æ–¹åç§°æ˜¯ECMAScript 2015ï¼ŒEcmaå›½é™…æ„åœ¨æ›´é¢‘ç¹åœ°å‘å¸ƒåŒ…å«å°è§„æ¨¡å¢é‡æ›´æ–°çš„æ–°ç‰ˆæœ¬ï¼Œä¸‹ä¸€ç‰ˆæœ¬å°†äº2016å¹´å‘å¸ƒï¼Œå‘½åä¸ºECMAScript 2016ã€‚ä»ç°åœ¨å¼€å§‹ï¼Œæ–°ç‰ˆæœ¬å°†æŒ‰ç…§ECMAScript&#43;å¹´ä»½çš„å½¢å¼å‘å¸ƒã€‚ ES6 ES6å°±æ˜¯ES2015ã€‚
ES2016ã€ES2017 ä»ES5 2009-ES6 2015ç»å†äº†6å¹´ï¼Œè¯­è¨€çš„å˜åŒ–æ¯”è¾ƒå¤§ã€‚ä¸ºäº†é¿å…å‰§çƒˆçš„å˜åŠ¨ï¼Œä»ES7 2016å¼€å§‹ï¼Œç‰ˆæœ¬å‘å¸ƒä¼šå˜å¾—æ›´åŠ é¢‘ç¹ï¼Œæ¯æ¬¡çš„å˜åŠ¨ä¹Ÿæ›´å°ã€‚æ¯å¹´ä¼šå‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å·²ç»å®Œæˆçš„ç‰¹æ€§ã€‚æ‰€ä»¥ä¹‹åå¯¹åº”çš„ç‰ˆæœ¬å°±æ˜¯ES2016ã€ES2017ã€‚ã€‚ã€‚æ¯ä¸€ç‰ˆæœ¬éƒ½åŒ…å«ä¸€äº›æ–°å¢çš„ç‰¹æ€§ã€‚
ES6ç›®å‰çš„å…¼å®¹æƒ…å†µ Javascriptæ˜¯ä¸€é—¨æ´»çš„è¯­è¨€ï¼Œæœ€è¿‘å‡ å¹´ä¸€ç›´åœ¨æ›´æ–°ã€‚å› æ­¤å¾ˆå¤šç‰¹æ€§å¹¶ä¸æ˜¯æ‰€æœ‰ç¯å¢ƒéƒ½å·²ç»æ”¯æŒï¼ŒåŒ…æ‹¬Node.jsã€æµè§ˆå™¨ï¼Œä¼šæœ‰å¾ˆå¤šç‰¹æ€§å¹¶ä¸æ”¯æŒã€‚
å¯¹äºNode.jså…¼å®¹æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ç½‘ç«™ Node green: es2015 support status æŸ¥çœ‹ã€‚æµè§ˆå™¨å…¼å®¹æƒ…å†µå¯ä»¥é€šè¿‡ç½‘ç«™ es2015 compatibility status æŸ¥çœ‹ã€‚
ä¸ºäº†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ES6çš„ç‰¹æ€§ï¼Œå¯¹äºåç«¯å¼€å‘ï¼Œå¯ä»¥é€‰æ‹©æ–°ç‰ˆæœ¬çš„Node.jsæˆ–è€…ä½¿ç”¨Babelè¿›è¡Œç¼–è¯‘ï¼›å¯¹äºå‰ç«¯æ¥è¯´ï¼ŒBabelæ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚
TC39 Process TC39 TC39ï¼ˆTechnical Committee 39ï¼‰æ˜¯ä¸€ä¸ªæ¨åŠ¨JavaScriptå‘å±•çš„å§”å‘˜ä¼šï¼Œå—ç‰¹è®¸è§£å†³JavaScriptè¯­è¨€ç›¸å…³äº‹å®œã€‚å®ƒçš„æˆå‘˜ç”±å„ä¸ªä¸»æµæµè§ˆå™¨å‚å•†çš„ä»£è¡¨æ„æˆã€‚ä¼šè®®çš„æ¯ä¸€é¡¹å†³è®®å¿…é¡»å¤§éƒ¨åˆ†äººèµåŒï¼Œå¹¶ä¸”æ²¡æœ‰äººå¼ºçƒˆåå¯¹æ‰å¯ä»¥é€šè¿‡ã€‚å› ä¸ºï¼Œå¯¹æˆå‘˜æ¥è¯´ï¼ŒåŒæ„å°±æ„å‘³ç€æœ‰è´£ä»»å»å®ç°å®ƒã€‚
æ¯ä¸€é¡¹æ–°ç‰¹æ€§ï¼Œè¦æœ€ç»ˆçº³å…¥ECMAScriptè§„èŒƒä¸­ï¼ŒTC39æ‹Ÿå®šäº†ä¸€ä¸ªå¤„ç†è¿‡ç¨‹ï¼Œç§°ä¸ºTC39 processã€‚å…¶ä¸­å…±åŒ…å«5ä¸ªé˜¶æ®µï¼ŒStage 0 ~ Stage 4ã€‚
Stage 0: strawman ä¸€ç§æ¨è¿›ECMAScriptå‘å±•çš„è‡ªç”±å½¢å¼ï¼Œä»»ä½•TC39æˆå‘˜ï¼Œæˆ–è€…æ³¨å†Œä¸ºTC39è´¡çŒ®è€…çš„ä¼šå‘˜ï¼Œéƒ½å¯ä»¥æäº¤ã€‚
Stage 1: proposal è¯¥é˜¶æ®µäº§ç”Ÿä¸€ä¸ªæ­£å¼çš„ææ¡ˆã€‚ ï¼ˆ1ï¼‰ç¡®å®šä¸€ä¸ªå¸¦å¤´äººæ¥è´Ÿè´£è¯¥ææ¡ˆï¼Œå¸¦å¤´äººæˆ–è€…è”åˆå¸¦å¤´äººå¿…é¡»æ˜¯TC39çš„æˆå‘˜ã€‚ ï¼ˆ2ï¼‰æè¿°æ¸…æ¥šè¦è§£å†³çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆä¸­å¿…é¡»åŒ…å«ä¾‹å­ï¼ŒAPIä»¥åŠå…³äºç›¸å…³çš„è¯­ä¹‰å’Œç®—æ³•ã€‚ ï¼ˆ3ï¼‰æ½œåœ¨é—®é¢˜ä¹Ÿåº”è¯¥æŒ‡å‡ºæ¥ï¼Œä¾‹å¦‚ä¸å…¶ä»–ç‰¹æ€§çš„å…³ç³»ï¼Œå®ç°å®ƒæ‰€é¢ä¸´çš„æŒ‘æˆ˜ã€‚ ï¼ˆ4ï¼‰polyfillå’Œdemoä¹Ÿæ˜¯å¿…è¦çš„ã€‚
Stage 2: draft è‰æ¡ˆæ˜¯è§„èŒƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸æœ€ç»ˆæ ‡å‡†ä¸­åŒ…å«çš„ç‰¹æ€§ä¸ä¼šæœ‰å¤ªå¤§å·®åˆ«ã€‚ è‰æ¡ˆä¹‹åï¼ŒåŸåˆ™ä¸Šåªæ¥å—å¢é‡ä¿®æ”¹ã€‚ ï¼ˆ1ï¼‰è‰æ¡ˆä¸­åŒ…å«æ–°å¢ç‰¹æ€§è¯­æ³•å’Œè¯­ä¹‰çš„ï¼Œå°½å¯èƒ½çš„å®Œå–„çš„å½¢å¼è¯´æ˜ï¼Œå…è®¸åŒ…å«ä¸€äº›å¾…åŠäº‹é¡¹æˆ–è€…å ä½ç¬¦ã€‚ ï¼ˆ2ï¼‰å¿…é¡»åŒ…å«2ä¸ªå®éªŒæ€§çš„å…·ä½“å®ç°ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä»¥æ˜¯ç”¨è½¬è¯‘å™¨å®ç°çš„ï¼Œä¾‹å¦‚Babelã€‚
Stage 3: candidate å€™é€‰é˜¶æ®µï¼Œè·å¾—å…·ä½“å®ç°å’Œç”¨æˆ·çš„åé¦ˆã€‚ æ­¤åï¼Œåªæœ‰åœ¨å®ç°å’Œä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†é‡å¤§é—®é¢˜æ‰ä¼šä¿®æ”¹ã€‚ ï¼ˆ1ï¼‰è§„èŒƒæ–‡æ¡£å¿…é¡»æ˜¯å®Œæ•´çš„ï¼Œè¯„å®¡äººå’ŒECMAScriptçš„ç¼–è¾‘è¦åœ¨è§„èŒƒä¸Šç­¾å­—ã€‚ ï¼ˆ2ï¼‰è‡³å°‘è¦æœ‰ä¸¤ä¸ªç¬¦åˆè§„èŒƒçš„å…·ä½“å®ç°ã€‚
Stage 4: finished å·²ç»å‡†å¤‡å°±ç»ªï¼Œè¯¥ç‰¹æ€§ä¼šå‡ºç°åœ¨å¹´åº¦å‘å¸ƒçš„è§„èŒƒä¹‹ä¸­ã€‚ ï¼ˆ1ï¼‰é€šè¿‡Test 262çš„éªŒæ”¶æµ‹è¯•ã€‚ ï¼ˆ2ï¼‰æœ‰2ä¸ªé€šè¿‡æµ‹è¯•çš„å®ç°ï¼Œä»¥è·å–ä½¿ç”¨è¿‡ç¨‹ä¸­çš„é‡è¦å®è·µç»éªŒã€‚ ï¼ˆ3ï¼‰ECMAScriptçš„ç¼–è¾‘å¿…é¡»è§„èŒƒä¸Šçš„ç­¾å­—ã€‚
æŒ‰ç…§ä¸Šè¿°çš„æµç¨‹ï¼Œä¸€ä¸ªç‰¹æ€§ä»Stage 0èµ°åˆ°Stage 4å°±ç®—æ­£å¼å‘å¸ƒäº†ã€‚æ­£å¼å‘å¸ƒçš„ç‰¹æ€§å°†è¢«åŠ å…¥åˆ°å½“å¹´çš„ç‰ˆæœ¬ä¸­ï¼Œä¾‹å¦‚å˜æˆES2017æˆ–è€…ES2018çš„æ–°ç‰¹æ€§ã€‚
Babel Babelæ˜¯ä¸€ä¸ªè½¬æ¢ç¼–è¯‘å™¨ï¼Œå®ƒèƒ½å°†ES6è½¬æ¢æˆå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç ã€‚Babelç”±æ¥è‡ªæ¾³å¤§åˆ©äºšçš„å¼€å‘è€…Sebastian McKenzieåˆ›å»ºã€‚ä»–çš„ç›®æ ‡æ˜¯ä½¿Babelå¯ä»¥å¤„ç†ES6çš„æ‰€æœ‰æ–°è¯­æ³•ï¼Œå¹¶ä¸ºå®ƒå†…ç½®äº†React JSXæ‰©å±•åŠFlowç±»å‹æ³¨è§£æ”¯æŒã€‚
æ®codemixåˆ›å§‹äººCharles Pickä»‹ç»ï¼ŒBabelæ˜¯æ‰€æœ‰ES6è½¬æ¢ç¼–è¯‘å™¨ä¸­ä¸ES6è§„èŒƒå…¼å®¹åº¦æœ€é«˜çš„ï¼Œç”šè‡³è¶…è¿‡äº†è°·æ­Œåˆ›å»ºå·²ä¹…çš„Traceurç¼–è¯‘å™¨ã€‚Babelå…è®¸å¼€å‘è€…ä½¿ç”¨ES6çš„æ‰€æœ‰æ–°ç‰¹æ€§ï¼Œè€Œä¸”ä¸ä¼šå½±å“ä¸è€ç‰ˆæœ¬æµè§ˆå™¨çš„å…¼å®¹æ€§ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒè®¸å¤šä¸åŒçš„æ„å»º&amp;amp;æµ‹è¯•ç³»ç»Ÿï¼Œä½¿å¼€å‘è€…å¾ˆå®¹æ˜“å°†å®ƒé›†æˆåˆ°è‡ªå·±çš„å·¥å…·é“¾ä¸­ã€‚ Charlesè®¤ä¸ºï¼ŒBabelä»æ ¹æœ¬ä¸Šè®²æ˜¯ä¸€ä¸ªå¹³å°ï¼Œè¿™æ˜¯å®ƒä¸compile-to-JSè¯­è¨€CoffeeScriptå’ŒTypeScriptæœ€å¤§çš„ä¸åŒã€‚Babelçš„æ’ä»¶ç³»ç»Ÿå…è®¸å¼€å‘è€…è‡ªå®šä¹‰ä»£ç è½¬æ¢å™¨å¹¶æ’å…¥åˆ°ç¼–è¯‘è¿‡ç¨‹ã€‚è¿™äº›è½¬æ¢å™¨ä¼šæ¥æ”¶ä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘ï¼Œå¹¶åœ¨ä»£ç è½¬æ¢æˆå¯æ‰§è¡Œçš„JavaScriptä¹‹å‰å¯¹å…¶è¿›è¡Œæ“ä½œã€‚codemixå·²ç»å°è¯•å¼€å‘äº†é™æ€&amp;amp;è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ã€é—­åŒ…æ¶ˆé™¤ã€JavaScriptâ€œå¥åº·å®ï¼ˆhygienic macrosï¼‰â€ç­‰æ’ä»¶ã€‚ Babelä¸ä»…è·Ÿè¸ªES6çš„è¿›å±•æƒ…å†µï¼Œè€Œä¸”è¿˜æ˜¯ES7æˆ–ES2016çš„è¯•éªŒåœºã€‚æ¯”å¦‚ï¼Œå®ƒå·²ç»æ”¯æŒasync/awaitï¼Œ ä½¿å¼€å‘è€…æ›´å®¹æ˜“ç¼–å†™å¼‚æ­¥JavaScriptä»£ç ï¼Œè€Œä¸”ä¸ä½¿ç”¨å›è°ƒæˆ–Promisesç›¸æ¯”ï¼Œä»£ç æ›´ç®€æ´æ˜“æ‡‚ã€‚è™½ç„¶ä¸»æµæµè§ˆå™¨å¯èƒ½è¿˜éœ€è¦å‡ å¹´çš„æ—¶é—´æ‰èƒ½æ”¯æŒ è¿™ç§å¼‚æ­¥JavaScriptä»£ç ç¼–å†™æ–¹å¼ï¼Œä½†Babelä½¿å¼€å‘è€…ç°åœ¨å°±å¯ä»¥ç”¨ä¸Šå®ƒã€‚è¿™å¾—ç›ŠäºBabelä¸JavaScriptæŠ€æœ¯å§”å‘˜ä¼šï¼ˆTC39ï¼‰ä¿æŒç€é«˜åº¦ä¸€è‡´ï¼Œèƒ½å¤Ÿåœ¨ECMAScriptæ–°ç‰¹æ€§æ ‡å‡†åŒ–ä¹‹å‰ä¸ºå¼€å‘è€…æä¾›ç°å®ä¸–ç•Œå¯ç”¨çš„å®ç°ã€‚è€ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæœ‰åˆ©äºJavaScriptçš„è¿›ä¸€æ­¥å‘å±•ï¼Œå› ä¸ºå…¶å›¢é˜Ÿå¯ä»¥åœ¨ECMAScriptè§„èŒƒæœ€åå®šç¨¿å‰å°±è·å¾—æ¥è‡ªç°å®ä¸–ç•Œçš„åé¦ˆã€‚ Babelè¿˜èƒ½æå‡JavaScriptçš„æ‰§è¡Œé€Ÿåº¦ã€‚ç”±äºJavaScript æ–‡ä»¶åŠ è½½å’Œæ‰§è¡Œé€Ÿåº¦æ…¢ä¼šä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥JITæ²¡æœ‰æ—¶é—´åœ¨è¿è¡Œæ—¶æ‰§è¡Œæ‰€æœ‰æŠ€æœ¯ä¸Šå¯è¡Œçš„ä¼˜åŒ–ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒBabelæ˜¯åœ¨ç¼–è¯‘æ—¶è¿è¡Œï¼Œæ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„æ—¶ é—´é™åˆ¶ã€‚å€ŸåŠ©å¼ºå¤§çš„ä½œç”¨åŸŸè·Ÿè¸ªå’Œç±»å‹æ¨æ–­åŠŸèƒ½åŠæ’ä»¶ç³»ç»Ÿï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºè½¬æ¢å™¨æ¥æ‰§è¡Œæ­¤ç±»ä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸Šæ–‡æåˆ°çš„é—­åŒ…æ¶ˆé™¤å¯ä»¥å°†é—­åŒ…è½¬æ¢æˆå¹³å¸¸çš„å‡½æ•°ã€‚
ä¸‹ä¸€ç¯‡åšå®¢å°†é‡ç‚¹è®²ä¸€ä¸‹Babelçš„ç”Ÿæ€ç³»ç»ŸåŠç®€å•çš„ä½¿ç”¨ã€‚
é™„å½•. å‚è€ƒèµ„æ–™ Node green: es2015 support status es2015 compatibility status ES6 Browser Support detection </content>
    </entry>
    
     <entry>
        <title>å®‰è£…Goè¯­è¨€è°ƒè¯•å·¥å…·dlv</title>
        <url>https://orchidflower.github.io/2017/02/15/install-golang-debugger-dlv-on-mac/</url>
        <categories>
          <category>å¼€å‘</category>
        </categories>
        <tags>
          <tag>Golang</tag><tag>Dlv</tag><tag>è°ƒè¯•</tag>
        </tags>
        <content type="html"> Dlvï¼Œä¹Ÿæˆä¸ºDelveï¼Œæ˜¯Goè¯­è¨€çš„æºç è°ƒè¯•å·¥å…·ã€‚ç”±derekparkerå¼€å‘ï¼Œå¼€æºä¸Githubã€‚åœ¨Macä¸Šé…ç½®Goè¯­è¨€å¼€å‘ç¯å¢ƒçš„æ—¶å€™ï¼Œç»å¸¸ç¢°åˆ°çš„é—®é¢˜å°±æ˜¯Dlvè°ƒç”¨æ€»æ˜¯ä¸æˆåŠŸï¼Œæ— æ³•å¯åŠ¨åº”ç”¨ï¼Œæ— æ³•è°ƒè¯•ç­‰ç­‰ã€‚å¤§éƒ¨åˆ†çš„é—®é¢˜éƒ½ä¸Macçš„å®‰å…¨æœºåˆ¶æœ‰å…³ã€‚Macä¸Šä½¿ç”¨codesignå¯¹åº”ç”¨è¿›è¡Œç­¾åï¼Œæ²¡æœ‰ç­¾åçš„ç¨‹åºä¼šå—åˆ°ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚æ— æ³•ä½œä¸ºè°ƒè¯•ç¨‹åºã€‚
å½“ç„¶å¦‚æœä¸ºäº†æ–¹ä¾¿ï¼Œä½ å¯ä»¥é€šè¿‡Homebrewå®‰è£…Homebrewç¼–è¯‘å¥½çš„Dlvã€‚ä¸‹é¢æè¿°çš„æ˜¯å¦‚ä½•ä»æºç æ„å»ºè¿™ä¸€å·¥å…·ã€‚Delveä½œè€…ä¸“é—¨å†™äº†ä¸€ç¯‡æ–‡æ¡£ï¼ˆè¯·çœ‹é™„å½•çš„é“¾æ¥ï¼‰ï¼Œæè¿°å¦‚ä½•å¯¹Dlvè¿›è¡Œè‡ªç­¾åã€‚æ–¹æ³•æ˜¯ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„è¯ä¹¦ï¼Œç„¶åä»æºç ç¼–è¯‘å®‰è£…Dlvã€‚
0. å‰æ éœ€è¦å®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
1xcode-select --install 1. ç­¾åè¯ä¹¦å‡†å¤‡ 1.1 ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè¯ä¹¦ æ‰“å¼€é’¥åŒ™ä¸²è®¿é—®ï¼› èœå•æ ä¸­é€‰æ‹©é’¥åŒ™ä¸²è®¿é—®-è¯ä¹¦åŠ©ç†-åˆ›å»ºè¯ä¹¦å¼€å§‹åˆ›å»ºè‡ªç­¾åè¯ä¹¦ï¼› è¯ä¹¦åç§°è®¾ç½®ä¸ºdlv-certï¼ˆè®°ä½è¿™ä¸ªåå­—ï¼Œåé¢ä¼šç”¨åˆ°ï¼‰ï¼›èº«ä»½ç±»å‹é€‰æ‹©è‡ªç­¾åæ ¹è¯ä¹¦ï¼›è¯ä¹¦ç±»å‹é€‰æ‹©ä»£ç ç­¾åï¼Œæœ€ååœ¨è®©æˆ‘è¦†ç›–è¿™äº›é»˜è®¤å€¼å¤„æ‰“ä¸Šå‹¾ï¼Œé€‰æ‹©ç»§ç»­ï¼› åœ¨æ¥ä¸‹æ¥çš„çª—å£ä¸­æŠŠæœ‰æ•ˆæœŸæ”¹é•¿ä¸€äº›ï¼Œä¾‹å¦‚æ”¹æˆ10å¹´ï¼ˆ3650å¤©ï¼‰ï¼› ç„¶åä¸€ç›´å¾€åï¼Œç›´åˆ°å‡ºç°é€‰æ‹©æŒ‡å®šç”¨äºè¯¥è¯ä¹¦çš„ä½ç½®ï¼Œé€‰æ‹©é’¥åŒ™ä¸²ç³»ç»Ÿï¼Œç„¶åé€‰æ‹©åˆ›å»ºï¼› è¿™æ ·è¯ä¹¦å°±åˆ›å»ºå¥½äº†ã€‚ 1.2 ç¬¬äºŒéƒ¨ï¼šåç»­æ“ä½œ åœ¨é’¥åŒ™ä¸²è®¿é—®çª—å£å·¦é¢é€‰æ‹©é’¥åŒ™ä¸²ç³»ç»Ÿï¼›ç„¶ååœ¨å³é¢é€‰æ‹©åˆšæ‰åˆ›å»ºçš„è¯ä¹¦ï¼ˆæŒ‰åå­—æŸ¥æ‰¾ï¼Œä¾‹å¦‚dlv-certï¼‰ï¼› ç‚¹é¼ æ ‡å³é”®ï¼Œé€‰æ‹©æ˜¾ç¤ºç®€ä»‹æ‰“å¼€è¯ä¹¦è¯¦ç»†ä¿¡æ¯çª—å£ï¼› åœ¨ä¿¡ä»»ä¸€æ ä¸­ä»£ç ç­¾åå¤„é€‰æ‹©å§‹ç»ˆä¿¡ä»»ï¼Œè¿™æ ·ä½¿ç”¨è¯¥è¯ä¹¦è¿›è¡Œç­¾åæ“ä½œçš„æ—¶å€™å°±ä¸ä¼šå¼¹å‡ºæç¤ºæ¡†è¯¢é—®äº†ã€‚ ç„¶ååœ¨çª—å£å·¦é¢é€‰æ‹©å¯†é’¥ï¼Œåœ¨å³é¢æ ¹æ®åå­—é€‰æ‹©å¯¹åº”çš„ä¸“ç”¨å¯†é’¥ï¼Œç‚¹å‡»é¼ æ ‡å³é”®é€‰æ‹©æ˜¾ç¤ºç®€ä»‹ï¼› åœ¨å¼¹å‡ºçš„çª—å£ä¸­é€‰æ‹©è®¿é—®æ§åˆ¶æ ‡ç­¾é¡µï¼Œç„¶åé€‰æ‹©å…è®¸æ‰€æœ‰åº”ç”¨ç¨‹åºè®¿é—®æ­¤é¡¹ç›®ï¼Œè¿™æ ·è¿›è¡Œè°ƒè¯•çš„æ—¶å€™å°±ä¸éœ€è¦æ¯æ¬¡è¾“å…¥å¯†ç äº†ã€‚ 1.3 è¯´æ˜ ä»¥ä¸Šæ­¥éª¤è¯·ç¡®è®¤æ‰§è¡Œå®Œæ¯•ï¼Œå¦åˆ™ä¼šå‡ºç°è¯¸å¦‚error: could not launch process: could not fork/execä¹‹ç±»çš„é”™è¯¯ã€‚
2. å®‰è£…å’Œç­¾å è¯ä¹¦æå®šä¹‹åï¼Œå…¶ä»–æ“ä½œå°±ç®€å•äº†ã€‚æŒ‰ç…§ä¸‹é¢å‘½ä»¤æ“ä½œå³å¯ã€‚
2.1 ä¸‹è½½æºç  1mkdir $GOPATH/src/github.com/derekparker &amp;amp;&amp;amp; cd $GOPATH/src/github.com/derekparker 2git clone https://github.com/derekparker/delve.git &amp;amp;&amp;amp; cd delve 2.2 ç­¾åå®‰è£… 1CERT=dlv-cert make install 2.3 å‡çº§ å‡çº§æ—¶ä¸éœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œåªéœ€è¦æ›´æ–°æºç é‡æ–°ç¼–è¯‘ç­¾åå³å¯ã€‚
é™„å½•A. å‚è€ƒèµ„æ–™ Installation on OSX Mac å¹³å°: ä½¿ç”¨ vscode æ­å»º Golang å¼€å‘ç¯å¢ƒ Delve on Github Debugging Go code using VS Code </content>
    </entry>
    
     <entry>
        <title>Hexoåšå®¢æäº¤æœç´¢å¼•æ“</title>
        <url>https://orchidflower.github.io/2017/02/14/submit-to-search-engine/</url>
        <categories>
          <category>åšå®¢</category>
        </categories>
        <tags>
          <tag>Hexo</tag><tag>åšå®¢</tag>
        </tags>
        <content type="html"> æ–°åšå®¢ä¸Šçº¿å¤šå¤©ä¹‹åï¼Œé€šè¿‡ç™¾åº¦å’ŒGoogleä»ç„¶æœç´¢ä¸åˆ°æˆ‘å†™çš„å†…å®¹ã€‚å¿½ç„¶æ„è¯†åˆ°è¿™åº”è¯¥æ˜¯ç½‘ç«™æ²¡æœ‰è¢«æœç´¢å¼•æ“ç´¢å¼•ã€‚ç»è¿‡æœç´¢ï¼Œå‘ç°è¿˜çœŸæ˜¯è¿™ä¹ˆå›äº‹ã€‚ç›´æ¥æœç´¢ï¼šsite:orchidflower.oschina.ioå’Œsite:orchidflower.github.ioï¼Œå‘ç°çœŸçš„æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„è®°å½•ã€‚
ç»è¿‡ä¸Šç½‘æŸ¥æ‰¾åŸå› ï¼Œæ‰¾åˆ°äº†ä¸€äº›èµ„æ–™ï¼ŒåŸæ¥Hexoå·²ç»æœ‰è¿™æ–¹é¢çš„è§£å†³æ–¹æ¡ˆäº†ã€‚
æ ¹æ®ç½‘ä¸Šæœç´¢åˆ°çš„èµ„æ–™ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼š
åœ¨æœç´¢å¼•æ“æ³¨å†Œç½‘ç«™ï¼› æäº¤é“¾æ¥ä¿¡æ¯æˆ–è€…ç«™ç‚¹åœ°å›¾ç»™æœç´¢å¼•æ“ã€‚ ä¸‹é¢ç®€å•æè¿°ä¸€ä¸‹è¿‡ç¨‹ã€‚
1. æ³¨å†Œç½‘ç«™ ä¸è®ºGoogleè¿˜æ˜¯ç™¾åº¦éƒ½æä¾›äº†ç«™é•¿å·¥å…·ï¼Œå¯ä»¥è®©ç½‘ç«™æ‹¥æœ‰è€…è‡ªåŠ©æäº¤ç½‘ç«™ä¿¡æ¯ã€‚ç›¸å½“äºç»™æœç´¢å¼•æ“çš„çˆ¬è™«æŒ‡ä¸ªæ–¹å‘ï¼Œèƒ½å¤Ÿæ›´å¿«é€Ÿçš„ç´¢å¼•ä½ çš„ç½‘ç«™ã€‚ç›¸å…³çš„ç½‘ç«™åœ°å€ä¸ºï¼šGoogleæœç´¢å¼•æ“æäº¤å…¥å£ï¼Œç™¾åº¦æäº¤å…¥å£ã€‚
1.1 å‰ææ¡ä»¶ é¦–å…ˆä½ è¦æœ‰å¯¹åº”çš„æœç´¢å¼•æ“çš„è´¦å·ã€‚å› ä¸ºGoogleå’Œç™¾åº¦çš„æ“ä½œè¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ‰€ä»¥åªæè¿°Googleçš„æ“ä½œæ­¥éª¤ã€‚
1.2 æ­¥éª¤ ç™»å½•Googleä¹‹åï¼Œé€‰æ‹©æ·»åŠ ä¸€ä¸ªç½‘å€ã€‚æ·»åŠ å®Œä¹‹åéœ€è¦åšéªŒè¯ã€‚éªŒè¯çš„ç›®çš„æ˜¯è¯æ˜ä½ å¯¹æäº¤çš„ç½‘å€ç¡®å®æœ‰ç®¡ç†æƒï¼Œé˜²æ­¢åˆ«äººèƒ¡ä¹±æ“ä½œã€‚éªŒè¯çš„æ–¹æ³•æœ‰å‡ ç§ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„æœ‰ï¼š
1.2.1 HTMLéªŒè¯ éªŒè¯æ–¹å¼å°±æ˜¯å°†Googleæä¾›çš„æ–‡ä»¶æ”¾ç½®åˆ°ä½ ç½‘ç«™çš„æ ¹ç›®å½•ä¸Šï¼ŒGoogleå¯ä»¥è®¿é—®åˆ°å°±å¯ä»¥äº†ã€‚
æ‰€ä»¥ä¸‹è½½éªŒè¯æ–‡ä»¶ï¼Œæ”¾åˆ°sourceç›®å½•ä¸­ï¼Œæ‰§è¡Œhexo deployé‡æ–°å‘å¸ƒåº”è¯¥å°±å¯ä»¥äº†ï¼›
1.2.2 HTMLæ ‡è®°éªŒè¯ éªŒè¯æ–¹å¼å°±æ˜¯åœ¨ç½‘ç«™çš„é¡µé¢ä¸­æ·»åŠ ä¸€ä¸ªmetaå±æ€§ï¼Œè¿™æ ·Googleè®¿é—®ç½‘é¡µåå¯ä»¥ä»ä¸­è§£æå‡ºæ¥å¯¹åº”çš„metaï¼Œä»¥æ­¤è¯æ˜ç½‘ç«™å½’ä½ ç®¡ç†ã€‚
è¿™ç§æ–¹å¼Hexoå·²ç»æä¾›äº†å†…ç½®æ”¯æŒã€‚åªéœ€è¦ä¿®æ”¹Hexoçš„_config.ymlæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹å³å¯ï¼š
1google_site_verification: [your code from google] 2baidu_site_verification: [your code from baidu] æ·»åŠ ä¹‹åï¼Œæ‰§è¡Œhexo generate; hexo deployï¼Œåº”è¯¥å°±å¯ä»¥äº†ã€‚
1.2.3 å®ŒæˆéªŒè¯ æ— è®ºé‡‡å–ä¸Šé¢é‚£ç§æ–¹å¼ï¼Œåšå®¢é‡æ–°å‘å¸ƒä¹‹åå°±å¯ä»¥åœ¨Googleä¸­ç‚¹å‡»éªŒè¯ç¡®è®¤ç½‘ç«™æ‰€æœ‰æƒäº†ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ·ç ”ç©¶å°±é€šè¿‡äº†ã€‚å¦‚æœç¢°åˆ°é—®é¢˜ï¼Œè¯·ä»”ç»†æ£€æŸ¥ä»¥ä¸Šå‡ æ­¥æ˜¯å¦æœ‰æ“ä½œé”™è¯¯ã€‚
2. æäº¤é“¾æ¥ä¿¡æ¯ è¦è®©æœç´¢å¼•æ“ç´¢å¼•æˆ‘ä»¬çš„ç½‘ç«™ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯æäº¤ç«™ç‚¹åœ°å›¾æ–‡ä»¶ï¼ˆsitemap.xmlï¼‰ç»™æœç´¢å¼•æ“ã€‚
ç«™ç‚¹åœ°å›¾æ–‡ä»¶æ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬ç½‘ç«™æ‰€æœ‰æœ‰æ•ˆçš„é“¾æ¥ï¼Œè¿™æ ·æœç´¢å¼•æ“å¯ä»¥ç›´æ¥ä»ä¸­æŠ“å–æœ‰ç”¨çš„é“¾æ¥ï¼Œç†è®ºä¸Šå¯ä»¥ä¸ç”¨ä½¿ç”¨çˆ¬è™«å¯¹ç½‘ç«™è¿›è¡Œæ‰«æäº†ã€‚
å¹¸è¿çš„æ˜¯Hexoç›®å‰æœ‰æ’ä»¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”Ÿæˆç«™ç‚¹åœ°å›¾æ–‡ä»¶ã€‚ç”Ÿæˆçš„æ–‡ä»¶ä¼šéšç€deployå‘å¸ƒåˆ°æˆ‘ä»¬çš„ç½‘ç«™ä¸Šã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥é€šè¿‡urlç›´æ¥è®¿é—®åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™ä¸ªurlæäº¤ç»™æ‰€æœå¼•æ“å³å¯ï¼Œä¸ç”¨æ¯æ¬¡æ›´æ–°ä¹‹åå†æ¬¡æäº¤ã€‚ä¸€æ¬¡æäº¤ï¼Œç»ˆç”Ÿå—ç›Š:)
2.1 å®‰è£…æ’ä»¶ é¦–å…ˆæ˜¯å®‰è£…æ’ä»¶ã€‚è¿™ä¸¤ä¸ªæ’ä»¶å®é™…ä¸Šçš„åŠŸèƒ½å·®ä¸å¤šï¼Œå¦‚æœä½ åªæœ‰ä¸€ä¸ªåŸŸåï¼Œæäº¤ç»™Googleå’Œç™¾åº¦çš„ç«™ç‚¹åœ°å›¾æ–‡ä»¶æ˜¯ä¸€æ ·çš„ï¼Œé‚£éšä¾¿å®‰è£…å“ªä¸€ä¸ªéƒ½å¯ä»¥ã€‚ä½†æ˜¯å¦‚æœä½ æœ‰å¤šä¸ªåŸŸåï¼ˆé•œåƒï¼‰ï¼Œåƒæˆ‘è¿™æ ·åœ¨Githubå’ŒOSChinaä¸Šéƒ½æœ‰ç«™ç‚¹ï¼Œé‚£å°±éœ€è¦å®‰è£…ä¸¤ä¸ªæ’ä»¶ï¼Œåˆ†åˆ«ç”¨æ¥ç”Ÿæˆæäº¤ç»™Googleå’Œç™¾åº¦çš„ç«™ç‚¹åœ°å›¾æ–‡ä»¶ã€‚
å¯¹æˆ‘æ¥è¯´ï¼Œä½¿ç”¨hexo-generator-sitemapç”Ÿæˆæäº¤ç»™Googleçš„æ–‡ä»¶ï¼Œé‡Œé¢çš„é“¾æ¥éƒ½æ˜¯å¯¹åº”ç½‘å€orchidflower.github.ioçš„ï¼›ä½¿ç”¨hexo-generator-baidu-sitemapç”Ÿæˆæäº¤ç»™ç™¾åº¦çš„æ–‡ä»¶ï¼Œé‡Œé¢çš„é“¾æ¥éƒ½æ˜¯orchidflower.oschina.ioçš„ã€‚
1npm install hexo-generator-sitemap --save 2npm install hexo-generator-baidu-sitemap --save 2.2 ä¿®æ”¹ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªæ’ä»¶ç”Ÿæˆçš„urléƒ½ä¼šä½¿ç”¨_config.ymlæ–‡ä»¶ä¸­çš„urlå±æ€§è®¡ç®—å‡ºæ¥çš„è·¯å¾„ã€‚è¿™æ ·å®é™…ä¸Šç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„é“¾æ¥æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·ä¸ç¬¦åˆæˆ‘çš„è¦æ±‚ã€‚æ‰€ä»¥æˆ‘å¯¹hexo-generator-sitemapæ’ä»¶è¿›è¡Œäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œä»è€Œé’ˆå¯¹Googleçš„æ–‡ä»¶é‡Œé¢åˆ¶å®šäº†Githubä¸Šé¢çš„ç½‘å€ã€‚ä¿®æ”¹æ–¹æ³•å¦‚ä¸‹ï¼š
ä¿®æ”¹æ–‡ä»¶node_modules/hexo-generator-sitemap/sitemap.xmlï¼š
1&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt; 2&amp;lt;urlset xmlns=&amp;#34;http://www.sitemaps.org/schemas/sitemap/0.9&amp;#34;&amp;gt; 3 {% for post in posts %} 4 &amp;lt;url&amp;gt; 5 &amp;lt;loc&amp;gt;{{ (config.urlforgoogle&#43;post.path) | uriencode }}&amp;lt;/loc&amp;gt; 6 {% if post.updated %} 7 &amp;lt;lastmod&amp;gt;{{ post.updated.toISOString() }}&amp;lt;/lastmod&amp;gt; 8 {% elif post.date %} 9 &amp;lt;lastmod&amp;gt;{{ post.date.toISOString() }}&amp;lt;/lastmod&amp;gt; 10 {% endif %} 11 &amp;lt;/url&amp;gt; 12 {% endfor %} 13&amp;lt;/urlset&amp;gt; ç¬¬5è¡Œä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå˜é‡config.urlforgoogleï¼Œè¿™é‡ŒæŒ‡å®šäº†Githubç«™ç‚¹çš„åœ°å€ã€‚å…·ä½“å€¼å¯ä»¥å‚è€ƒä¸‹é¢çš„è¯´æ˜ã€‚
2.3 é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶_config.ymlï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹ï¼š
1urlforgoogle: http://orchidflower.github.io/ 2 3# è‡ªåŠ¨ç”Ÿæˆsitemap 4sitemap: 5 path: sitemap.xml 6baidusitemap: 7 path: baidusitemap.xml å…¶ä¸­æŒ‡å®šäº†urlforgoogleï¼Œé…ç½®äº†æäº¤ç»™Googleçš„ç«™ç‚¹åœ°å›¾æ–‡ä»¶ä¸­çš„ç«™ç‚¹æ˜¯Githubä¸Šçš„ã€‚å¦å¤–ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æŒ‡å®šäº†ä¸¤ä¸ªåœ°å›¾æ–‡ä»¶çš„åå­—ã€‚
2.4 æäº¤ åˆ†åˆ«æŠŠhttp://orchidflower.github.io/sitemap.xmlæäº¤ç»™Googleï¼›æŠŠhttp://orchidflower.oschina.io/baidusitemap.xmlæäº¤ç»™ç™¾åº¦ã€‚ç„¶åå°±æ˜¯ç­‰å¾…å§ã€‚
3. åç»­ 2.13 æäº¤ç»™Googleå’Œç™¾åº¦ï¼› 2.14 å·²ç»èƒ½å¤Ÿé€šè¿‡Googleæœç´¢åˆ°ï¼›ç™¾åº¦è¿˜ä¸è¡Œã€‚ é™„å½•A. å‚è€ƒèµ„æ–™ hexoå¹²è´§ç³»åˆ—ï¼šï¼ˆå…­ï¼‰hexoæäº¤æœç´¢å¼•æ“ï¼ˆç™¾åº¦&#43;è°·æ­Œï¼‰ Hexo&#43;Nextä¸»é¢˜åšå®¢æäº¤ç™¾åº¦è°·æ­Œæ”¶å½• </content>
    </entry>
    
     <entry>
        <title>ä»ä¸€å°æ²¡æœ‰å¤–ç½‘è¿æ¥çš„é˜¿é‡Œäº‘ä¸»æœºä¸Šè®¿é—®å¾®ä¿¡API</title>
        <url>https://orchidflower.github.io/2017/02/12/access-weixin-qyapi-from-one-server-without-internet-on-aliyun/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>é˜¿é‡Œäº‘</tag><tag>Ubuntu</tag><tag>å¾®ä¿¡</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ å…¬å¸çš„ç”Ÿäº§ç¯å¢ƒæ˜¯éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ä¸Šçš„ã€‚Zabbixæœ€åˆè£…åœ¨ä¸€å°æ²¡æœ‰å¤–ç½‘è¿æ¥çš„ECSä¸Šï¼Œé€šè¿‡Nginxè¿›è¡Œè®¿é—®ã€‚ä½†æ˜¯åæ¥å‘ç°å¦‚æœéœ€è¦æŠ¥è­¦ï¼Œéœ€è¦ä»Zabbixè¿™å°ä¸»æœºè®¿é—®å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨ï¼ˆqyapi.weixin.qq.comï¼‰ã€‚è¿ç»´çš„å…„å¼Ÿæœ€åˆé€‰æ‹©äº†å›ºå®šå¸¦å®½çš„ç½‘ç»œï¼Œä½†æ˜¯è€ƒè™‘åˆ°è´¹ç”¨é—®é¢˜ï¼ŒåæœŸæƒ³åˆ‡æ¢åˆ°æŒ‰é‡ä»˜è´¹çš„ç½‘ç»œï¼Œä½†æ˜¯é˜¿é‡Œäº‘å±…ç„¶ä¸æ”¯æŒè¿™ç§åˆ‡æ¢ï¼ˆè¿™é‡Œåæ§½ä¸€ä¸‹é˜¿é‡Œçš„è®¾è®¡ï¼‰ã€‚
ç”±äºè¯¥ä¸»æœºæ˜¯æŒ‰ç…§åŒ…æœˆåŒ…å¹´æ–¹å¼è´­ä¹°çš„ï¼Œé€€æ‰é‡æ–°ç”³è¯·ä¸»æœºå®‰è£…Zabbixæ˜¾ç„¶ä¸åˆ’ç®—ã€‚åœ¨ä¸»æœºåˆ°æœŸä¹‹å‰ï¼Œå¿…é¡»æƒ³åŠæ³•å®ç°åœ¨æ²¡æœ‰å¤–ç½‘çš„æƒ…å†µä¸‹è®¿é—®å¾®ä¿¡æœåŠ¡å™¨ï¼ˆè€ƒè™‘åˆ°è´¹ç”¨é—®é¢˜ï¼ŒåŸå…ˆå›ºå®šå¸¦å®½å·²ç»è¢«ä¿®æ”¹æˆäº†0Mï¼Œä¹Ÿå°±æ²¡æœ‰è´¹ç”¨äº†ï¼‰ã€‚
2. è§£å†³ è€ƒè™‘åˆ°æ•´ä¸ªç”Ÿäº§ç¯å¢ƒä¸­æœ‰å¤šå°èƒ½å¤Ÿè®¿é—®Internetçš„ä¸»æœºï¼Œæ‰€ä»¥è‡ªç„¶çš„æƒ³åˆ°æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–ä¸»æœºä¸­è½¬è¿™ç§è®¿é—®å‘¢ï¼Ÿ
2.1 Nginx æœ€å…ˆæƒ³åˆ°çš„æ–¹æ¡ˆæ˜¯é€šè¿‡Nginxï¼Œé€šè¿‡Nginxåšä¸€ä¸ªæ­£å‘ä»£ç†ï¼Œä»£ç†åˆ°å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨ï¼ˆ https://qyapi.weixin.qq.com ï¼‰ï¼Œç„¶åé€šè¿‡ä»Zabbixè®¿é—®Nginxä»£ç†åçš„ç«™ç‚¹ã€‚ä½†æ˜¯é€šè¿‡æœç´¢å‘ç°ï¼ŒNginxä¸æ”¯æŒè¿™ç§ä»£ç†æ–¹å¼ï¼ˆForward Proxyï¼‰è¿æ¥httpsæœåŠ¡å™¨ã€‚å…·ä½“çš„å¯ä»¥çœ‹é™„å½•ä¸­çš„è¿æ¥ã€‚ä»¥ä¸‹æ˜¯Nginxä½œè€…çš„ç­”å¤ï¼š
1&amp;gt; Is there any schedule to support the feathure, forward proxy ? 2Not in near future: there is alreay good forward proxy Squid. 2.2 iptables ç„¶ååˆæƒ³åˆ°æ˜¯ä¸æ˜¯å¯ä»¥ä½¿ç”¨iptablesè¿›è¡Œç«¯å£è½¬å‘å‘¢ï¼Ÿä½†æ˜¯å¯èƒ½æ˜¯æˆ‘å¯¹iptablesè¿˜ä¸å¤Ÿç†Ÿæ‚‰ï¼ŒæŒ‰ç…§é™„å½•4çš„å‘½ä»¤æ€»ä¹Ÿè°ƒè¯•ä¸æˆåŠŸï¼Œæ€»æ˜¯ä¼šè¿”å›è¶…æ—¶ã€‚è¿™ä¸ªæ–¹æ³•æ²¡æœ‰è§£å†³é—®é¢˜ã€‚
2.3 socat è¿™æ—¶æƒ³èµ·ä»¥å‰ç”¨è¿‡ä¸€ä¸ªå°å·¥å…·socatï¼Œç”¨å®ƒå°†ä¸€ä¸ªunix socketè½¬æ¢æˆä¸€ä¸ªtcp socketï¼Œå®ƒçš„ç”¨å¤„å°±æ˜¯å°†ä¸€ä¸ªæµè½¬æ¢æˆå¦ä¸€ä¸ªæµã€‚ç»è¿‡å°è¯•æœç„¶å¯ä»¥ã€‚å‘½ä»¤ä¹Ÿå¾ˆç®€å•ï¼š
1socat TCP-LISTEN:443,fork,reuseaddr TCP:140.207.127.79:443 ç„¶ååœ¨Zabbixä¸»æœºä¸Šä½¿ç”¨curlè®¿é—®è¯•è¯•ï¼š
1root@prd-zabbix:~# curl https://192.168.61.64 2curl: (51) SSL: certificate subject name &amp;#39;qy.weixin.qq.com&amp;#39; does not match target host name &amp;#39;192.168.61.64&amp;#39; å·²ç»å¯ä»¥è®¿é—®äº†ï¼Œè¯´æ˜æœåŠ¡å·²ç»ä¸­è½¬åˆ°å¾®ä¿¡çš„æœåŠ¡å™¨ä¸Šäº†ã€‚
3. åç»­æ“ä½œ 3.1 åŸŸå ä¸Šé¢ä½¿ç”¨curlå‡ºç°çš„æç¤ºè¡¨æ˜ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨åŸŸåè¿›è¡Œè®¿é—®æ‰èƒ½å¤Ÿè¢«æ­£ç¡®å¤„ç†ã€‚è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡æœ¬åœ°åŸŸåæ˜ å°„è¿›è¡Œè§£å†³ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹/etc/hostså¢åŠ æ˜ å°„çš„æ–¹å¼è§£å†³ã€‚å› ä¸ºæˆ‘ä»¬æœ¬åœ°çš„Zabbixæ˜¯é€šè¿‡Dockerè¿è¡Œçš„ï¼Œè¿™ä¸ªä¿®æ”¹å°±è¦é€šè¿‡Dockerè¿è¡Œã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯docker-composeï¼Œåœ¨docker-compose.yamlä¸­å¢åŠ å¦‚ä¸‹é…ç½®å³å¯ï¼š
1extra_hosts: 2 - &amp;#34;qyapi.weixin.qq.com:192.168.61.64&amp;#34; è¿™æ ·ï¼Œåœ¨Zabbixè¿è¡Œçš„å®¹å™¨ä¸­ï¼ŒåŸŸåqyapi.weixin.qq.comæŒ‡å‘äº†192.168.61.64è¿™å°ä¸»æœºã€‚è€Œå¯¹è¿™å°ä¸»æœºä¸Šçš„443ç«¯å£çš„è®¿é—®è¢«é‡å®šå‘åˆ°äº†140.207.127.79:443ï¼Œä»è€Œå®ç°äº†å¯¹å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨çš„è®¿é—®ã€‚
3.2 å¤šæœåŠ¡å™¨ ä½¿ç”¨nslookupæŸ¥è¯¢å¯ä»¥çŸ¥é“å¯¹åº”äºåŸŸåqyapi.weixin.qq.comï¼Œå¾®ä¿¡æ˜¯æä¾›äº†å¤šå°æœåŠ¡å™¨çš„ï¼š
1root@prd-zabbix:~# nslookup qyapi.weixin.qq.com 2Server: 100.100.2.138 3Address: 100.100.2.138#53 4 5Non-authoritative answer: 6qyapi.weixin.qq.com canonical name = qy.weixin.qq.com. 7Name: qy.weixin.qq.com 8Address: 140.207.189.106 9Name: qy.weixin.qq.com 10Address: 140.207.127.79 ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆä¸­åªæŒ‡å‘äº†ä¸€å°æœåŠ¡å™¨ï¼Œè¿™æ ·å¦‚æœè¿™å°æœåŠ¡å™¨å‡ºç°é—®é¢˜çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´è®¿é—®å¤±è´¥ã€‚å¯ä»¥è€ƒè™‘çš„ä¸€ä¸ªæ–¹æ¡ˆæ˜¯åœ¨å¦ä¸€å°ä¸»æœºä¸Šä½¿ç”¨socatåšåŒæ ·çš„è½¬å‘å·¥ä½œï¼Œåªæ˜¯è½¬å‘ç»™å¦ä¸€å°ä¸»æœºã€‚è¿™æ ·åº”è¯¥å¯ä»¥è§£å†³éƒ¨åˆ†é—®é¢˜ã€‚ä½†æ˜¯è¿˜ä¸æ˜¯æœ€å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚æœ‰å¾…äºä»¥åç»§ç»­ç ”ç©¶ã€‚
3.3 è‡ªå¯åŠ¨ éœ€è¦è€ƒè™‘æœåŠ¡å™¨é‡å¯çš„æƒ…å†µä¸‹ï¼Œè¦è‡ªåŠ¨å¯åŠ¨socatã€‚è¿™ä¸ªåœ¨Ubuntuä¸Šå¯ä»¥é€šè¿‡ä¿®æ”¹/etc/rc.localæ–‡ä»¶è§£å†³ï¼š
1socat TCP-LISTEN:443,fork,reuseaddr TCP:140.207.127.79:443 &amp;amp; 2exit 0 é™„å½•A. å‚è€ƒèµ„æ–™ Re: https and nginx as forward proxy Nginx as forward proxy for HTTPS Lets Talk About Proxies, Pt. 2: Nginx as a Forward HTTP Proxy - See more at: https://blog.opendns.com/2015/11/03/lets-talk-about-proxies-pt-2-nginx-as-a-forward-http-proxy/ Forward a TCP port to another IP or port using NAT with Iptables socat port forwarding for https Execute a Script at Startup and Shutdown on Ubuntu </content>
    </entry>
    
     <entry>
        <title>åœ¨Macä¸Šå¯ç”¨Dockerçš„Bash Completion</title>
        <url>https://orchidflower.github.io/2017/02/12/enable-docker-bash-completion-on-mac/</url>
        <categories>
          <category>è¿ç»´</category>
        </categories>
        <tags>
          <tag>Docker</tag><tag>Mac</tag><tag>Bash</tag>
        </tags>
        <content type="html"> 1. èƒŒæ™¯ åœ¨Ubuntuä¸Šä½¿ç”¨Dockerçš„æ—¶å€™ï¼Œä½¿ç”¨tabé”®è‡ªåŠ¨å®Œæˆdockerå‘½ä»¤æ„Ÿè§‰éå¸¸æ–¹ä¾¿ï¼Œä¾‹å¦‚ï¼šåªéœ€è¦è¾“å…¥imageæˆ–è€…container IDçš„å‰å‡ ä½å°±å¯ä»¥ä½¿ç”¨Tabé”®è¡¥é½æ•´ä¸ªå‘½ä»¤è¡Œã€‚ä½†æ˜¯åœ¨Macä¸Šå´æ²¡æœ‰åŠæ³•å®ç°ç›¸åŒçš„æ“ä½œã€‚
ç»è¿‡æœç´¢ç»ˆäºæ‰¾åˆ°äº†åŸå› ï¼šåŸæ¥æ˜¯å› ä¸ºæ²¡æœ‰å¯ç”¨Bash completionåŠŸèƒ½å¯¼è‡´çš„ã€‚è€Œå®é™…ä¸ŠDockerå®‰è£…åŒ…å†…å·²ç»æä¾›äº†é’ˆå¯¹Dockerçš„Bash Completionè„šæœ¬ï¼Œåªéœ€è¦å¯ç”¨å³å¯ã€‚
2. å®‰è£… è¦å¯ç”¨Dockerçš„Bash CompletionåŠŸèƒ½ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
ä½ ç”¨çš„æ˜¯Bashè¿™ä¸ªshellï¼ˆå¥½åƒåºŸè¯äº†ï¼Œå˜¿å˜¿ï¼‰ï¼› å®‰è£…æœ‰Bash completionè¿™ä¸ªåŠŸèƒ½ã€‚ ä½†æ˜¯Macä¸Šé»˜è®¤æ˜¯æ²¡æœ‰å®‰è£…Bash completionåŠŸèƒ½çš„ã€‚éœ€è¦é€šè¿‡Homebrewè¿›è¡Œå®‰è£…ã€‚å¦‚æœä¹‹å‰æ²¡æœ‰å®‰è£…è¿‡Homebrewï¼Œé¦–å…ˆå‚è€ƒé™„å½•å®‰è£…ã€‚
2.1 å®‰è£…bash-completion å®‰è£…bash-completionã€‚æ–¹æ³•å¦‚ä¸‹ï¼š
1brew install bash-completion 2.2 å¯ç”¨bash-completion ç„¶åå°†/Applications/Docker.app/Contents/Resources/etcç›®å½•ä¸­çš„docker-compose.bash-completion,docker.bash-completionä¸¤ä¸ªæ–‡ä»¶æ‹·è´åˆ°/usr/local/etc/bash_completion.dç›®å½•ä¸­ã€‚
æœ€åä¿®æ”¹.bash_profileï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹å³å¯ï¼š
1[ -f /usr/local/etc/bash_completion ] &amp;amp;&amp;amp; . /usr/local/etc/bash_completion é™„å½•A. å‚è€ƒèµ„æ–™ Command Line Completion Homebrew Official Website é™„å½•B. Homebrewä½¿ç”¨è®°å½• 1zhang@zhangdeMacBook-Pro:~$ brew info bash-completion 2bash-completion: stable 1.3 (bottled) 3Programmable completion for Bash 3.2 4https://bash-completion.alioth.debian.org/ 5/usr/local/Cellar/bash-completion/1.3_1 (189 files, 607.8K) * 6 Poured from bottle on 2017-01-16 at 18:09:59 7From: https://github.com/Homebrew/homebrew-core/blob/master/Formula/bash-completion.rb 8==&amp;gt; Caveats 9Add the following lines to your ~/.bash_profile: 10 [ -f /usr/local/etc/bash_completion ] &amp;amp;&amp;amp; . /usr/local/etc/bash_completion 11 12Bash completion has been installed to: 13 /usr/local/etc/bash_completion.d </content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨Hexoæ­å»ºä¸ªäººåšå®¢</title>
        <url>https://orchidflower.github.io/2017/01/24/hexo-deploy/</url>
        <categories>
          <category>åšå®¢</category>
        </categories>
        <tags>
          <tag>Hexo</tag><tag>åšå®¢</tag>
        </tags>
        <content type="html"> 0. ä»€ä¹ˆæ˜¯Hexo Hexo æ˜¯é«˜æ•ˆçš„é™æ€ç«™ç‚¹ç”Ÿæˆæ¡†æ¶ï¼Œå®ƒåŸºäº Node.jsã€‚ é€šè¿‡ Hexo ä½ å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ Markdown ç¼–å†™æ–‡ç« ï¼Œé™¤äº† Markdown æœ¬èº«çš„è¯­æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Hexo æä¾›çš„ æ ‡ç­¾æ’ä»¶ æ¥å¿«é€Ÿçš„æ’å…¥ç‰¹å®šå½¢å¼çš„å†…å®¹ã€‚ ç½‘ä¸Šå…³äºHexoä»‹ç»çš„æ–‡ç« å·²ç»å¾ˆå¤šï¼Œè¿™é‡Œä¸å†™ä¸€èˆ¬çš„å®‰è£…éƒ¨ç½²æ­¥éª¤ï¼Œåªå†™ä¸€äº›ä¸å¸¸æåˆ°çš„åœ°æ–¹ã€‚
1. ä¸»é¢˜ ä¸»é¢˜é¦–æ¨Nextï¼ˆ https://github.com/iissnan/hexo-theme-next ï¼‰ï¼Œè¯¥ä¸»é¢˜å¯å®šåˆ¶æ€§é«˜ï¼Œè€Œä¸”é›†æˆäº†å¾ˆå¤šç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚
ä¸ªäººæ„Ÿè§‰Nextæœ‰å‡ ç‚¹åŠŸèƒ½åšçš„éå¸¸æ£’ï¼š
æ–‡ç« å¯ä»¥å¸¦æœ‰å¯¼èˆªåŠŸèƒ½ï¼Œåªéœ€è¦é…ç½®å¥½ä¸»é¢˜å‚æ•°ï¼Œå°±å¯ä»¥åœ¨ä¾§æ ä¸­æ˜¾ç¤ºæ–‡ç« çš„å¯¼èˆªä¿¡æ¯ï¼Œè¿™å¯¹äºæ¯”è¾ƒé•¿çš„åšæ–‡æ¥è¯´éå¸¸å®ç”¨ï¼› é›†æˆäº†å¾ˆå¤šå®ç”¨çš„ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚ä¾‹å¦‚ï¼šæ•°æ®ç»Ÿè®¡ï¼ˆç™¾åº¦ã€Googleã€é€šè®¯ç­‰ï¼‰ã€å†…å®¹åˆ†äº«æœåŠ¡ã€è¯„è®ºç³»ç»Ÿã€æœç´¢æœåŠ¡ç­‰ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†äººçš„éœ€è¦ï¼Œä¸éœ€è¦é¢å¤–å®šåˆ¶å…¶ä»–åŠŸèƒ½äº†ï¼› é™¤äº†ç¬¬ä¸‰æ–¹æœç´¢æœåŠ¡ä»¥å¤–ï¼Œè¿˜æä¾›äº†æœ¬åœ°æœç´¢æœåŠ¡ï¼Œæœç´¢é€Ÿåº¦å¾ˆå¿«ï¼Œä¹Ÿä¸ä¾èµ–äºç¬¬ä¸‰æ–¹ï¼Œéå¸¸æ–¹ä¾¿å¿«æ·ã€‚ 2. ç½‘é¡µæ‰˜ç®¡ Hexoç”Ÿæˆçš„é™æ€é¡µé¢å¯ä»¥éƒ¨ç½²åˆ°ä»»ä½•WebæœåŠ¡å™¨ä¸­ã€‚å½“ç„¶å¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´ï¼Œæ²¡æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡Github PagesåŠŸèƒ½æˆ–è€…OSChina PagesåŠŸèƒ½éƒ¨ç½²åˆ°Githubæˆ–è€…OSChinaä¸Šå»ã€‚
2.1 Github ä½œä¸ºGithubï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªäºŒçº§åŸŸåï¼š[yourname].github.ioï¼Œå¦‚æœè¦å°†æˆ‘ä»¬çš„åšå®¢å†…å®¹éƒ¨ç½²åˆ°è¿™ä¸ªåœ°å€ä¸Šï¼Œåˆ™éœ€è¦æŒ‰ç…§Githubçš„è¦æ±‚åˆ›å»ºä¸€ä¸ªåå­—å«[yourname].github.ioï¼ˆæ³¨æ„æ›¿æ¢[yourname]éƒ¨åˆ†ä¸ºä½ è‡ªå·±çš„åå­—ï¼‰çš„é¡¹ç›®ï¼Œç„¶åæŠŠé¡µé¢ä¸Šä¼ åˆ°é‡Œé¢ã€‚
2.2 OSChina ä½œä¸ºOSChinaçš„ç”¨æˆ·ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªäºŒçº§åŸŸåï¼š[yourname].oschina.ioã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œåå­—å’Œä½ çš„åå­—ç›¸åŒå³å¯ã€‚
3. å®šåˆ¶ æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæˆ‘å¯¹Nextä¸»é¢˜ä¸»è¦è°ƒæ•´äº†ä»¥ä¸‹å‡ å¤„å‚æ•°ï¼š
åˆ‡æ¢Schemaåˆ°Piscesï¼Œè°ƒæ•´ä¾§è¾¹æ åˆ°å·¦ä¾§ï¼› èœå•ä¸­å¢åŠ aboutã€categoriesç­‰æ ç›®ï¼› å¯ç”¨æœ¬åœ°æœç´¢åŠŸèƒ½ï¼Œé€šè¿‡ä¾§è¾¹æ çš„æœç´¢åŠŸèƒ½å¯ä»¥è®¿é—®åˆ°ï¼› å¯ç”¨äº†duoshuoæä¾›çš„è¯„è®ºç³»ç»Ÿï¼› å¯ç”¨äº†Leancloudæä¾›çš„é˜…è¯»æŠ€æœ¯åŠŸèƒ½ï¼› 3.1 é™„åŠ è¯´æ˜ è€ƒè™‘åˆ°å®‰å…¨åŸå› ï¼Œä½¿ç”¨LeancloudæœåŠ¡çš„æ—¶å€™ä¸€å®šè¦è®¾ç½®Webå®‰å…¨åŸŸåï¼Œé™åˆ¶èƒ½å¤Ÿæ›´æ–°æ•°æ®çš„ç½‘ç«™ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé™„å½•ä¸­çš„è¯´æ˜ã€‚
é™„å½•. å‚è€ƒèµ„æ–™ Hexoä¸­æ–‡æ–‡æ¡£ Hexoä¸»é¢˜Next ä¸ºNexTä¸»é¢˜æ·»åŠ æ–‡ç« é˜…è¯»é‡ç»Ÿè®¡åŠŸèƒ½ </content>
    </entry>
    
     <entry>
        <title>å®‰ä¸ªæ–°å®¶</title>
        <url>https://orchidflower.github.io/2017/01/22/hello-world/</url>
        <categories>
          
        </categories>
        <tags>
          
        </tags>
        <content type="html"> ä¸€ç›´æ‰¾ä¸åˆ°åˆé€‚çš„åšå®¢ä¾›åº”å•†ï¼Œä¹‹å‰ç”¨è¿‡CSDNï¼Œä½“éªŒä¸€ç›´ä¸å¥½ã€‚æœ€è¿‘åœ¨ç ”ç©¶Node.jsï¼Œæ‰€ä»¥å‘ç°äº†Hexo Hexoï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ï¼ŒæŒºæœ‰å…´è¶£å°è¯•ä¸€ä¸‹çš„ã€‚æ‰€ä»¥åœ¨oschinaä¸Šå¼€é€šäº†PagesåŠŸèƒ½ï¼Œä»¥åå°±åœ¨è¿™å„¿å®‰å®¶äº†ã€‚
</content>
    </entry>
    
</search>